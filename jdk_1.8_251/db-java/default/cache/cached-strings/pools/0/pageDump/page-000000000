/** com/sun/corba/se/PortableActivationIDL/Activator.java . ... */// interface Activator/** com/sun/corba/se/PortableActivationIDL/ActivatorHelper.java . ... */{ ... }<Expr>;...=...super(...)String _id;var ...;OutputStream outcreate_output_stream(...)type(...)write(...)read_value(...)create_input_stream(...)return ...read(...)TypeCode __typeCode;if (...)... == ...create_interface_tc(...)init(...)id(...)narrow(...)read_Object(...)_ActivatorStub.classwrite_Object(...)(...)......instanceof...!...throw ..._is_a(...)new BAD_PARAM(...)Delegate delegate_get_delegate(...)_ActivatorStub stubnew _ActivatorStub(...)_set_delegate(...)/** com/sun/corba/se/PortableActivationIDL/ActivatorHolder.java . ... */Activator value;<obinit>(...)/** com/sun/corba/se/PortableActivationIDL/ActivatorOperations.java . ... *//** A new ORB started server registers itself with the Activator *//** A server is shutting down that was started by this activator. ... *//** Called whenever an ORB instance is created.  This registers ... */...[]/** Construct or find an ORBD object template corresponding to the ... *//** Called whenever a POA is destroyed. *//** If the server is not running, start it up.  This is allowed ... *//** If the server is running, shut it down *//** Invoke the server install hook.  If the server is not ... *//** Invoke the server uninstall hook.  If the server is not ... *//** list active servers *//** list all registered ORBs for a server *//** Find the server template that corresponds to the ORBD's ... */// interface ActivatorOperations/** com/sun/corba/se/PortableActivationIDL/BadServerDefinition.java . ... */String reason;// ctor... + ...// class BadServerDefinition/** com/sun/corba/se/PortableActivationIDL/BadServerDefinitionHelper.java . ... */boolean __active;synchronized (...)TypeCode.classStructMember[] _members0new StructMember[]TypeCode _tcOf_members0create_recursive_tc(...)create_string_tc(...)...[...]new StructMember(...)create_exception_tc(...)BadServerDefinition valuenew BadServerDefinition(...)read_string(...)value.reasonwrite_string(...)// read and discard the repository ID// write the repository ID/** com/sun/corba/se/PortableActivationIDL/BadServerDefinitionHolder.java . ... */BadServerDefinition value;/** com/sun/corba/se/PortableActivationIDL/EndPointInfo.java . ... */String endpointType;// class EndPointInfo/** com/sun/corba/se/PortableActivationIDL/EndPointInfoHelper.java . ... */get_primitive_tc(...)TCKind.tk_longcreate_alias_tc(...)create_struct_tc(...)EndPointInfo valuenew EndPointInfo(...)value.endpointTypevalue.portread_long(...)write_long(...)/** com/sun/corba/se/PortableActivationIDL/EndPointInfoHolder.java . ... */EndPointInfo value;/** A list of endpoint information for a particular ORB. *//** com/sun/corba/se/PortableActivationIDL/EndpointInfoListHelper.java . ... */create_sequence_tc(...)EndPointInfo[] valueint _len0for (...;...;...)new EndPointInfo[]int _o1... < ...++...value.lengthint _i0/** com/sun/corba/se/PortableActivationIDL/EndpointInfoListHolder.java . ... */...[] value;/** com/sun/corba/se/PortableActivationIDL/IIOP_CLEAR_TEXT.java . ... */String value;/** Possible values for endpointType argument on Server.getEndpoint() ... *//** Interface used to support binding references in the bootstrap name ... *//** com/sun/corba/se/PortableActivationIDL/InitialNameService.java . ... */// interface InitialNameService/** com/sun/corba/se/PortableActivationIDL/InitialNameServiceHelper.java . ... */_InitialNameServiceStub.class_InitialNameServiceStub stubnew _InitialNameServiceStub(...)/** com/sun/corba/se/PortableActivationIDL/InitialNameServiceHolder.java . ... */InitialNameService value;/** com/sun/corba/se/PortableActivationIDL/InitialNameServiceOperations.java . ... *//** bind initial name */// interface InitialNameServiceOperations/** com/sun/corba/se/PortableActivationIDL/InitialNameServicePackage/NameAlreadyBound.java . ... */// class NameAlreadyBound/** com/sun/corba/se/PortableActivationIDL/InitialNameServicePackage/NameAlreadyBoundHelper.java . ... */NameAlreadyBound valuenew NameAlreadyBound(...)/** com/sun/corba/se/PortableActivationIDL/InitialNameServicePackage/NameAlreadyBoundHolder.java . ... */NameAlreadyBound value;/** com/sun/corba/se/PortableActivationIDL/InvalidORBid.java . ... */// class InvalidORBid/** com/sun/corba/se/PortableActivationIDL/InvalidORBidHelper.java . ... */InvalidORBid valuenew InvalidORBid(...)/** com/sun/corba/se/PortableActivationIDL/InvalidORBidHolder.java . ... */InvalidORBid value;/** com/sun/corba/se/PortableActivationIDL/Locator.java . ... */// interface Locator/** com/sun/corba/se/PortableActivationIDL/LocatorHelper.java . ... */_LocatorStub.class_LocatorStub stubnew _LocatorStub(...)/** com/sun/corba/se/PortableActivationIDL/LocatorHolder.java . ... */Locator value;/** com/sun/corba/se/PortableActivationIDL/LocatorOperations.java . ... *//** locate server - returns the port with a specific type for all registered ... *//** locate server - returns all ports registered with a specified ORB for ... *//** get the port for the endpoint of the locator *//** Useful from external BadServerIdHandlers which need ... */// interface LocatorOperations/** com/sun/corba/se/PortableActivationIDL/LocatorPackage/ServerLocationPerORB.java . ... */String hostname;...[] ports;// class ServerLocationPerORB/** com/sun/corba/se/PortableActivationIDL/LocatorPackage/ServerLocationPerORBHelper.java . ... */ServerLocationPerORB valuenew ServerLocationPerORB(...)value.hostnamevalue.ports/** com/sun/corba/se/PortableActivationIDL/LocatorPackage/ServerLocationPerORBHolder.java . ... */ServerLocationPerORB value;/** com/sun/corba/se/PortableActivationIDL/LocatorPackage/ServerLocationPerType.java . ... */// class ServerLocationPerType/** com/sun/corba/se/PortableActivationIDL/LocatorPackage/ServerLocationPerTypeHelper.java . ... */ServerLocationPerType valuenew ServerLocationPerType(...)/** com/sun/corba/se/PortableActivationIDL/LocatorPackage/ServerLocationPerTypeHolder.java . ... */ServerLocationPerType value;/** com/sun/corba/se/PortableActivationIDL/NoSuchEndPoint.java . ... */// class NoSuchEndPoint/** com/sun/corba/se/PortableActivationIDL/NoSuchEndPointHelper.java . ... */NoSuchEndPoint valuenew NoSuchEndPoint(...)/** com/sun/corba/se/PortableActivationIDL/NoSuchEndPointHolder.java . ... */NoSuchEndPoint value;/** com/sun/corba/se/PortableActivationIDL/ORBAlreadyRegistered.java . ... */String orbId;// class ORBAlreadyRegistered/** com/sun/corba/se/PortableActivationIDL/ORBAlreadyRegisteredHelper.java . ... */ORBAlreadyRegistered valuenew ORBAlreadyRegistered(...)value.orbId/** com/sun/corba/se/PortableActivationIDL/ORBAlreadyRegisteredHolder.java . ... */ORBAlreadyRegistered value;/** com/sun/corba/se/PortableActivationIDL/ORBPortInfo.java . ... */// class ORBPortInfo/** com/sun/corba/se/PortableActivationIDL/ORBPortInfoHelper.java . ... */ORBPortInfo valuenew ORBPortInfo(...)/** com/sun/corba/se/PortableActivationIDL/ORBPortInfoHolder.java . ... */ORBPortInfo value;/** A list of ORB and port information for a particular endpoint type. *//** com/sun/corba/se/PortableActivationIDL/ORBPortInfoListHelper.java . ... */ORBPortInfo[] valuenew ORBPortInfo[]/** com/sun/corba/se/PortableActivationIDL/ORBPortInfoListHolder.java . ... *//** ORB callback interface, passed to Activator in registerORB method. *//** com/sun/corba/se/PortableActivationIDL/ORBProxy.java . ... */// interface ORBProxy/** com/sun/corba/se/PortableActivationIDL/ORBProxyHelper.java . ... */_ORBProxyStub.class_ORBProxyStub stubnew _ORBProxyStub(...)/** com/sun/corba/se/PortableActivationIDL/ORBProxyHolder.java . ... */ORBProxy value;/** com/sun/corba/se/PortableActivationIDL/ORBProxyOperations.java . ... *//** Method used to cause ORB to activate the named adapter, if possible. ... */// interface ORBProxyOperations/** A list of ORB IDs. *//** com/sun/corba/se/PortableActivationIDL/ORBidListHelper.java . ... */String[] valuenew String[]/** com/sun/corba/se/PortableActivationIDL/ORBidListHolder.java . ... *//** com/sun/corba/se/PortableActivationIDL/Repository.java . ... */// interface Repository/** com/sun/corba/se/PortableActivationIDL/RepositoryHelper.java . ... */_RepositoryStub.class_RepositoryStub stubnew _RepositoryStub(...)/** com/sun/corba/se/PortableActivationIDL/RepositoryHolder.java . ... */Repository value;/** com/sun/corba/se/PortableActivationIDL/RepositoryOperations.java . ... *//** register server definition. ... *//** unregister server definition *//** get server definition *//** Return whether the server has been installed *//** Mark the server as being installed.  Raises ServerAlreadyInstalled ... *//** Mark the server as being uninstalled.  Raises ServerAlreadyUninstalled ... *//** list registered servers *//** Returns list of ALL applicationNames defined in ServerDefs of registered ... *//** Find the ServerID associated with the given application name. */// interface RepositoryOperations/** Type used for a list of application names *//** com/sun/corba/se/PortableActivationIDL/RepositoryPackage/AppNamesHelper.java . ... *//** com/sun/corba/se/PortableActivationIDL/RepositoryPackage/AppNamesHolder.java . ... *//** com/sun/corba/se/PortableActivationIDL/RepositoryPackage/ServerDef.java . ... */String applicationName;String serverName;// serverName values.String serverClassPath;// Class name of server's main class.String serverArgs;// class path used to run the server.String serverVmArgs;// arguments passed to the serverboolean isInstalled;// arguments passed to the server's Java VM1// class ServerDef/** com/sun/corba/se/PortableActivationIDL/RepositoryPackage/ServerDefHelper.java . ... */TCKind.tk_booleanServerDef valuenew ServerDef(...)value.applicationNamevalue.serverNamevalue.serverClassPathvalue.serverArgsvalue.serverVmArgsvalue.isInstalledread_boolean(...)write_boolean(...)/** com/sun/corba/se/PortableActivationIDL/RepositoryPackage/ServerDefHolder.java . ... */ServerDef value;/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyActive.java . ... */String serverId;// class ServerAlreadyActive/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyActiveHelper.java . ... */ServerAlreadyActive valuenew ServerAlreadyActive(...)value.serverId/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyActiveHolder.java . ... */ServerAlreadyActive value;/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyInstalled.java . ... */// class ServerAlreadyInstalled/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyInstalledHelper.java . ... */ServerAlreadyInstalled valuenew ServerAlreadyInstalled(...)/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyInstalledHolder.java . ... */ServerAlreadyInstalled value;/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyRegistered.java . ... */// class ServerAlreadyRegistered/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyRegisteredHelper.java . ... */ServerAlreadyRegistered valuenew ServerAlreadyRegistered(...)/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyRegisteredHolder.java . ... */ServerAlreadyRegistered value;/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyUninstalled.java . ... */// class ServerAlreadyUninstalled/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyUninstalledHelper.java . ... */ServerAlreadyUninstalled valuenew ServerAlreadyUninstalled(...)/** com/sun/corba/se/PortableActivationIDL/ServerAlreadyUninstalledHolder.java . ... */ServerAlreadyUninstalled value;/** com/sun/corba/se/PortableActivationIDL/ServerHeldDown.java . ... */// class ServerHeldDown/** com/sun/corba/se/PortableActivationIDL/ServerHeldDownHelper.java . ... */ServerHeldDown valuenew ServerHeldDown(...)/** com/sun/corba/se/PortableActivationIDL/ServerHeldDownHolder.java . ... */ServerHeldDown value;/** Sequence of server Ids, used for queries about servers. *//** com/sun/corba/se/PortableActivationIDL/ServerIdsHelper.java . ... *//** com/sun/corba/se/PortableActivationIDL/ServerIdsHolder.java . ... *//** Interface used to combine the Activator and Locator when both are ... *//** com/sun/corba/se/PortableActivationIDL/ServerManager.java . ... */// interface ServerManager/** com/sun/corba/se/PortableActivationIDL/ServerManagerHelper.java . ... */_ServerManagerStub.class_ServerManagerStub stubnew _ServerManagerStub(...)/** com/sun/corba/se/PortableActivationIDL/ServerManagerHolder.java . ... */ServerManager value;/** com/sun/corba/se/PortableActivationIDL/ServerManagerOperations.java . ... */// interface ServerManagerOperations/** com/sun/corba/se/PortableActivationIDL/ServerNotActive.java . ... */// class ServerNotActive/** com/sun/corba/se/PortableActivationIDL/ServerNotActiveHelper.java . ... */ServerNotActive valuenew ServerNotActive(...)/** com/sun/corba/se/PortableActivationIDL/ServerNotActiveHolder.java . ... */ServerNotActive value;/** com/sun/corba/se/PortableActivationIDL/ServerNotRegistered.java . ... */// class ServerNotRegistered/** com/sun/corba/se/PortableActivationIDL/ServerNotRegisteredHelper.java . ... */ServerNotRegistered valuenew ServerNotRegistered(...)/** com/sun/corba/se/PortableActivationIDL/ServerNotRegisteredHolder.java . ... */ServerNotRegistered value;/** Server callback interface, passed to Activator in registerServer method. *//** com/sun/corba/se/PortableActivationIDL/ServerProxy.java . ... */// interface ServerProxy/** com/sun/corba/se/PortableActivationIDL/ServerProxyHelper.java . ... */_ServerProxyStub.class_ServerProxyStub stubnew _ServerProxyStub(...)/** com/sun/corba/se/PortableActivationIDL/ServerProxyHolder.java . ... */ServerProxy value;/** com/sun/corba/se/PortableActivationIDL/ServerProxyOperations.java . ... *//** Shutdown this server.  Returns after orb.shutdown() completes. *//** Install the server.  Returns after the install hook completes ... *//** Uninstall the server.  Returns after the uninstall hook ... */// interface ServerProxyOperations/** Type of TCP port number, used in structures that describe ... *//** com/sun/corba/se/PortableActivationIDL/TCPPortHelper.java . ... *//** com/sun/corba/se/PortableActivationIDL/_ActivatorImplBase.java . ... */new Hashtable<>(...)Map$Entryput(...)new Integer(...){...}// ConstructorsHashtable<> _methods;Integer __methodget(...)switch (...)new BAD_OPERATION(...)CompletionStatus.COMPLETED_MAYBEintValue(...)case ...try ...catch (...)String serverIdServerProxy serverObjregisterServer(...)createReply(...)ServerNotRegistered $excreateExceptionReply(...)serverGoingDown(...)String orbIdORBProxy orbEndPointInfo[] endPointInforegisterORB(...)NoSuchEndPoint $exORBAlreadyRegistered $exObjectReferenceTemplate poaTemplateObjectReferenceTemplate $resultregisterPOA(...)poaDestroyed(...)activate(...)ServerAlreadyActive $exServerHeldDown $exshutdown(...)ServerNotActive $exinstall(...)ServerAlreadyInstalled $exuninstall(...)ServerAlreadyUninstalled $exString[] $resultgetActiveServers(...)getORBNames(...)String[] orbAdapterNamelookupPOATemplate(...)...[] __ids;// Type-specific CORBA::Object operations// _invokeclone(...)// PortableActivationIDL/Activator/registerServer// PortableActivationIDL/Activator/serverGoingDown// PortableActivationIDL/Activator/registerORB// PortableActivationIDL/Activator/registerPOA// PortableActivationIDL/Activator/poaDestroyed// PortableActivationIDL/Activator/activate// PortableActivationIDL/Activator/shutdown// PortableActivationIDL/Activator/install// PortableActivationIDL/Activator/uninstall// PortableActivationIDL/Activator/getActiveServers// PortableActivationIDL/Activator/getORBNames// PortableActivationIDL/Activator/lookupPOATemplate// class _ActivatorImplBase/** com/sun/corba/se/PortableActivationIDL/_ActivatorStub.java . ... */InputStream $inOutputStream $out_request(...)_invoke(...)ApplicationException $exString _idgetId(...)getInputStream(...)equals(...)new MARSHAL(...)RemarshalException $rm_releaseReply(...)// registerServer// serverGoingDown// registerORB// registerPOA// poaDestroyed// activate// shutdown// install// uninstall// getActiveServers// getORBNames// lookupPOATemplateString strreadUTF(...)String[] argsProperties propsORB orbObject objstring_to_object(...)destroy(...)object_to_string(...)writeUTF(...)// class _ActivatorStub/** com/sun/corba/se/PortableActivationIDL/_InitialNameServiceImplBase.java . ... */String nameboolean isPersistantbind(...)NameAlreadyBound $ex// PortableActivationIDL/InitialNameService/bind// class _InitialNameServiceImplBase/** com/sun/corba/se/PortableActivationIDL/_InitialNameServiceStub.java . ... */// bind// class _InitialNameServiceStub/** com/sun/corba/se/PortableActivationIDL/_LocatorImplBase.java . ... */String endPointServerLocationPerType $resultlocateServer(...)ServerLocationPerORB $resultlocateServerForORB(...)InvalidORBid $exString endPointTypeint $resultgetEndpoint(...)ServerLocationPerORB locationgetServerPortForType(...)// PortableActivationIDL/Locator/locateServer// PortableActivationIDL/Locator/locateServerForORB// PortableActivationIDL/Locator/getEndpoint// PortableActivationIDL/Locator/getServerPortForType// class _LocatorImplBase/** com/sun/corba/se/PortableActivationIDL/_LocatorStub.java . ... */// locateServer// locateServerForORB// getEndpoint// getServerPortForType// class _LocatorStub/** com/sun/corba/se/PortableActivationIDL/_ORBProxyImplBase.java . ... */String[] nameboolean $resultactivate_adapter(...)// PortableActivationIDL/ORBProxy/activate_adapter// class _ORBProxyImplBase/** com/sun/corba/se/PortableActivationIDL/_ORBProxyStub.java . ... */// activate_adapter// class _ORBProxyStub/** com/sun/corba/se/PortableActivationIDL/_RepositoryImplBase.java . ... */ServerDef serverDefString $resultServerAlreadyRegistered $exBadServerDefinition $exunregisterServer(...)ServerDef $resultgetServer(...)isInstalled(...)listRegisteredServers(...)getApplicationNames(...)String applicationNamegetServerID(...)// PortableActivationIDL/Repository/registerServer// PortableActivationIDL/Repository/unregisterServer// PortableActivationIDL/Repository/getServer// PortableActivationIDL/Repository/isInstalled// PortableActivationIDL/Repository/install// PortableActivationIDL/Repository/uninstall// PortableActivationIDL/Repository/listRegisteredServers// PortableActivationIDL/Repository/getApplicationNames// PortableActivationIDL/Repository/getServerID// class _RepositoryImplBase/** com/sun/corba/se/PortableActivationIDL/_RepositoryStub.java . ... */// unregisterServer// getServer// isInstalled// listRegisteredServers// getApplicationNames// getServerID// class _RepositoryStub/** com/sun/corba/se/PortableActivationIDL/_ServerManagerImplBase.java . ... */// class _ServerManagerImplBase/** com/sun/corba/se/PortableActivationIDL/_ServerManagerStub.java . ... */// class _ServerManagerStub/** com/sun/corba/se/PortableActivationIDL/_ServerProxyImplBase.java . ... */// PortableActivationIDL/ServerProxy/shutdown// PortableActivationIDL/ServerProxy/install// PortableActivationIDL/ServerProxy/uninstall// class _ServerProxyImplBase/** com/sun/corba/se/PortableActivationIDL/_ServerProxyStub.java . ... */// class _ServerProxyStubimport ORBimport PrintStream/** @author ... */boolean shortHelp;boolean longHelp;boolean parseError;boolean commandDone;/* Copyright (c) 1997, 2002, Oracle and/or its affiliates. All rights reserved. ... */import Fileimport NamingContextimport NameServiceimport ORBConstants// make the registration of PNameService for INS and BootStrap neat.// REVISIT: After Merlin to see if we can get rid of this Thread andORB orb;File dbDir;NameService nameServicenew NameService(...)NamingContext rootContextinitialNamingContext(...)register_initial_reference(...)ORBConstants.PERSISTENT_NAME_SERVICE_NAMEException eprintln(...)System.errprintStackTrace(...)/* Copyright (c) 1999, 2003, Oracle and/or its affiliates. All rights reserved. ... */// start Name Serviceimport Propertiesimport INITIALIZEimport INTERNALimport CompletionStatusimport POAimport Acceptorimport Repositoryimport ServerDefimport Locatorimport LocatorHelperimport Activatorimport ActivatorHelperimport ServerAlreadyRegisteredimport LegacyServerSocketEndPointInfoimport SocketInfoimport SocketFactoryAcceptorImplimport TransientNameServiceimport CorbaResourceUtilimport SocketOrChannelAcceptorImplnew String[][]int initSvcPort;Acceptor acceptorgetORBInitialPort(...)getORBData(...)getLegacySocketFactory(...)new SocketOrChannelAcceptorImpl(...)LegacyServerSocketEndPointInfo.BOOT_NAMINGSocketInfo.IIOP_CLEAR_TEXTnew SocketFactoryAcceptorImpl(...)registerAcceptor(...)getCorbaTransportManager(...)getProperties(...)ORBConstants.SERVER_ID_PROPERTYORBConstants.PERSISTENT_SERVER_PORT_PROPERTYgetProperty(...)ORBConstants.ORBD_PORT_PROPERTYtoString(...)ORBConstants.DEFAULT_ACTIVATION_PORTcreateORB(...)boolean firstRuncreateSystemDirs(...)ORBConstants.DEFAULT_DB_DIRNameServiceStartThread theThreadnew NameServiceStartThread(...)processArgs(...)orb.orbdDebugFlagSystem.outstartActivationObjects(...)installOrbServers(...)getRepository(...)getActivator(...)String pollingTimeORBConstants.SERVER_POLLING_TIMEString startupDelayORBConstants.SERVER_STARTUP_DELAYORBConstants.DB_DIR_PROPERTYORBConstants.DEFAULT_SERVER_POLLING_TIMEORBConstants.DEFAULT_SERVER_STARTUP_DELAYstart(...)run(...)COMM_FAILURE cexgetText(...)INTERNAL iexException exint i...++args.length/** Ensure that the Db directory exists. If not, create the Db ... */boolean dirCreatedString fileSepFile logDirnew File(...)ORBConstants.SERVER_LOG_DIRgetAbsolutePath(...)exists(...)mkdir(...)String dbDirName;ServerManagerImpl serverMgrnew ServerManagerImpl(...)getDbDirName(...)TransientNameService nameServicenew TransientNameService(...)ORBConstants.TRANSIENT_NAME_SERVICE_NAMEinitializeBootNaming(...)new RepositoryImpl(...)ORBConstants.SERVER_REPOSITORY_NAMEORBConstants.SERVER_LOCATOR_NAMEORBConstants.SERVER_ACTIVATOR_NAMEActivator activator;RepositoryImpl repository;/** Go through the list of ORB Servers and initialize and start ... */int serverIdString[] serverorbServers.lengthvalueOf(...)ORBD orbdnew ORBD(...)...[] orbServers;/** List of servers to be auto registered and started by the ORBd. ... *//* Copyright (c) 1997, 2004, Oracle and/or its affiliates. All rights reserved. ... */// create a bootstrap server// REVISIT: see ORBConfigurator. use factory in TransportDefault.// For debugging.//props.put( ORBConstants.DEBUG_PROPERTY, "naming" ) ;//props.put( ORBConstants.DEBUG_PROPERTY, "transport,giop,naming" ) ;// See Bug 4396928 for more information about why we are initializing// the ORBClass to PIORB (now ORBImpl, but should check the bugid).// parse the args and try setting the values for these// properties// orbd is being run the first time// The following two lines start the Persistent NameService// determine the ORB db directory// create the db and the logs directories// create Initial Name Service object// create Repository object// create Locator and Activator objectsimport java.util.*/** ProcessMonitorThread is started when ServerManager is instantiated. The ... */HashMap<> serverTable;int sleepTime;ProcessMonitorThread instance;while (...)Iterator<> serverListsleep(...)InterruptedException eiterator(...)values(...)HashMap$NodeHashMap$TreeNodeLinkedHashMap$Entryp4checkServerHealth(...)ConcurrentModificationException ehasNext(...)ServerTableEntry entrynext(...)checkProcessHealth(...)int sleepTime... != ...parseInt(...)new ProcessMonitorThread(...)setDaemon(...)interrupt(...)/* Copyright (c) 2001, 2003, Oracle and/or its affiliates. All rights reserved. ... */// Sleep's for a specified time, before checking// the Servers health. This will repeat as long as// the ServerManager (ORBD) is up and running.// Check each ServerTableEntry to make sure that they// are in the right state.// Too late to complain, Just use the default// sleepTimeimport FileInputStreamimport FileOutputStreamimport ObjectInputStreamimport ObjectOutputStreamimport Serializableimport Hashtableimport Enumerationimport Vectorimport SystemExceptionimport BadServerDefinitionimport _RepositoryImplBaseimport ServerAlreadyInstalledimport ServerAlreadyUninstalledimport ServerNotRegisteredimport SocketOrChannelAcceptorimport CORBALogDomainsimport ActivationSystemException-...long serialVersionUID;// added serialver computed by the toolFile dbFilethis.debugthis.orbCORBALogDomains.ORBD_REPOSITORYnew RepositoryDB(...)flush(...)FileInputStream fisnew FileInputStream(...)ObjectInputStream oisnew ObjectInputStream(...)readObject(...)close(...)cannotReadRepositoryDb(...)connect(...)sd.serverVmArgssd.serverArgssd.serverClassPathsd.serverNamesd.applicationNameDBServerDef serverEnumeration<> enumerationelements(...)db.serverTablehasMoreElements(...)nextElement(...)serverDef.applicationNameserver.applicationName...?...:...printServerDef(...)server.idincrementServerIdCounter(...)new DBServerDef(...)LegacyServerSocketEndPointInfo endpointlegacyGetEndpoint(...)getLegacyServerSocketManager(...)int initSvcPortgetLocalPort(...)getServerSocket(...)new ServerTableEntry(...)verify(...)ServerMain.OKServerMain.MAIN_CLASS_NOT_FOUNDServerMain.NO_MAIN_METHODServerMain.APPLICATION_ERRORInteger idremove(...)getDBServerDef(...)server.nameserver.classPathserver.argsserver.vmArgsserver.isInstalledint[] serversnew int[]size(...)StringBuffer sbnew StringBuffer(...)int ctrservers.lengthappend(...)int resultEnumeration<> serverIdskeys(...)Integer nextServerIdDBServerDef dbServerDefdbServerDef.applicationNameVector<> vnew Vector<>(...)String[] appsaddElement(...)elementAt(...)apps.length/** Typically the Repositoy is created within the ORBd VM but it can ... */boolean debugnew Properties(...)String dbORBConstants.DB_PROPERTYORBConstants.DEFAULT_DB_NAMERepositoryImpl repositoryboolean debug;int illegalServerId;RepositoryDB db;ActivationSystemException wrapper;RepositoryImpl$RepositoryDBFile db;Hashtable<> serverTable;Integer serverIdCounter;FileOutputStream fosnew FileOutputStream(...)ObjectOutputStream oosnew ObjectOutputStream(...)delete(...)writeObject(...)cannotWriteRepositoryDb(...)RepositoryImpl$DBServerDefserver.serverNameserver.serverClassPathserver.serverArgsserver.serverVmArgsString name;String classPath;String args;String vmArgs;int id;// if databse does not exist, create it otherwise read it in// export the repository// check if server already registered// generate a new server id// add server def to the database// verify that the entry is valid// check to see if the server is registered// remove server from the database// See Bug 4396928 for more information about why we are// initializing the ORBClass to PIORB (now ORBImpl, but see the bug).// create the repository object// wait for shutdown// initialize the Server Id counter and hashtable.// the lower id range is reserved for system serversimport Methodimport Modifierimport java.io.*import Dateint OK;/* TODO: ... */int MAIN_CLASS_NOT_FOUND;int NO_MAIN_METHOD;int APPLICATION_ERROR;int UNKNOWN_ERROR;int NO_SERVER_ID;int REGISTRATION_FAILED;String logDirNameString serverFileOutputStream foutStreamFileOutputStream ferrStreamPrintStream pSoutnew PrintStream(...)PrintStream pSerrsetOut(...)setErr(...)logInformation(...)/** Write a time-stamped message to the indicated PrintStream. */Date datenew Date(...)print(...)/** Write information to standard out only. */writeLogMessage(...)/** Write error message to standard out and standard err. *//** Write final message to log(s) and then terminate by calling ... */printResult(...)exit(...)Class<>[] argTypesnew Class<>[]...[].classMethod methodgetDeclaredMethod(...)Exception exclogTerminal(...)getMessage(...)isPublicStaticVoid(...)int modifiersgetModifiers(...)... || ...isPublic(...)isStatic(...)logError(...)getName(...)getExceptionTypes(...).lengthgetExceptionTypes(...)getReturnType(...)Void.TYPEORB.classString serverClassNameORBConstants.SERVER_NAME_PROPERTYClassLoader clgetContextClassLoader(...)currentThread(...)Class<> serverClassMethod mainMethodgetMainMethod(...)boolean serverVerifyFlaggetBoolean(...)ORBConstants.SERVER_DEF_VERIFY_PROPERTYObject[] paramsnew Object[]redirectIOStreams(...)getSystemClassLoader(...)forName(...)ClassNotFoundException exregisterCallback(...)invoke(...)ClassNotFoundException eServerMain servernew ServerMain(...)Integer serverIdgetInteger(...)Method installMethodgetNamedMethod(...)Method uninstallMethodMethod shutdownMethodServerCallback serverObjnew ServerCallback(...)getServerId(...)ORBConstants.ACTIVATED_PROPERTYActivator activatorresolve_initial_references(...)active(...)Method installMethod;Method uninstallMethod;Method shutdownMethod;...[] methodArgs;this.installMethodthis.uninstallMethodthis.shutdownMethod// shutdown the ORB and wait for completioninvokeMethod(...)/* Copyright (c) 1997, 2012, Oracle and/or its affiliates. All rights reserved. ... */// redirect out and err streams// check modifiers: public static// check return type and exceptions// determine the class loader to be used for loading the class// since ServerMain is going to be in JDK and we need to have this// class to load application classes, this is required here.// determine the main class// determine the main class, try loading with current class loader// eat the exception and try to load using SystemClassLoader// get the main method// This piece of code is required, to verify the server definition// without launching it.// verify the server// build args to the main and call it// NOTE: Very important to pass this property, otherwise the// Persistent Server registration will be unsucessfull.import Constructorimport ArrayListimport HashMapimport Iteratorimport NoSuchElementExceptionimport OBJECT_NOT_EXISTimport EndPointInfoimport IIOP_CLEAR_TEXTimport ORBPortInfoimport ServerLocationimport ServerLocationPerORBimport _ServerManagerImplBaseimport ServerAlreadyActiveimport ORBAlreadyRegisteredimport ServerHeldDownimport ServerNotActiveimport NoSuchEndPointimport InvalidORBidimport Serverimport IORTemplateimport IORimport ObjectKeyimport ObjectKeyTemplateimport IORFactoriesimport GIOPVersionimport IIOPAddressimport IIOPProfileTemplateimport IIOPFactoriesimport ForwardExceptionimport CorbaTransportManagerimport BadServerIdHandlerimport ORBUtilityimport Utility// routines// Using HashMap, since synchronization should be done by the callingRepository repository;CorbaTransportManager transportManager;int initialPort;int serverStartupDelay;String delayClass<> clsgetBadServerIdHandler(...)CORBALogDomains.ORBD_ACTIVATORthis.transportManagerthis.repositorythis.dbDirNamenew HashMap<>(...)setBadServerIdHandler(...)initBadServerIdHandler(...)ServerLocation locationInteger key... && ...isActive(...)getEntry(...)IIOP_CLEAR_TEXT.valuelocation.hostnameNoSuchEndPoint exserverNotExpectedToRegister(...)register(...)registerPorts(...)int[] listArrayList<> serversnew ArrayList<>(...)keySet(...)isValid(...)add(...)NoSuchElementException elist.lengthnew ServerLocation(...)ORBPortInfo[] serverORBAndPortListString hostgetHostName(...)LegacyServerSocketEndPointInfo.DEFAULT_ENDPOINTint listLengthlookup(...)serverORBAndPortList.lengthlocation.ports...[...].orbId...[...].portEndPointInfo[] endpointInfoListlookupForORB(...)InvalidORBid exendpointInfoList.length...[...].endpointTypegetORBList(...)getRunningEntry(...)/** This method is used to obtain the registered ports for an ORB. ... */IOR newIORObjectKeyTemplate oktempgetTemplate(...)getORBId(...)int clearPortEndPointInfo[] listenerPortsIIOPAddress addrmakeIIOPAddress(...)IIOPProfileTemplate iptempmakeIIOPProfileTemplate(...)GIOPVersion.V1_2IORTemplate iortempmakeIORTemplate(...)listenerPorts.lengthsupportsIORIIOPProfileComponents(...)makeCodeSetsComponent(...)makeMaxStreamFormatVersionComponent(...)makeIOR(...)errorInBadServerIdHandler(...)new ForwardException(...)legacyGetTransientServerPort(...)/* Copyright (c) 1997, 2013, Oracle and/or its affiliates. All rights reserved. ... */// REVISIT - NOT USED.// The ServerStartupDelay is the delay added after the Server registers// end point information. This is to allow the server to completely// initialize after ORB is instantiated.// Just use the default 1000 milliseconds as the default// locate the server// We call getEntry here so that state of the entry is// checked for validity before we actually go and locate a server// orbId is ignored for now// unlike vectors, list is not synchronized// get an entry// all done// collect the active entries// if server location is desired, then wait for the server// to register back, then return location// this is to see if the server has any listeners// passing in entry to eliminate multiple lookups for// the same entry in some cases// we need to get the serverid and the orbid from the object key// get the ORBName corresponding to the orbMapid, that was// first registered by the server// we received a list of ports corresponding to an ORB in a// particular server, now retrieve the one corresponding// to IIOP_CLEAR_TEXT, and for other created the tagged// components to be added to the IOR// create a new IOR with the correct port and correct tagged// components// This delay is required in case of Server is activated or// re-activated the first time. Server needs some time before// handling all the requests.// (Talk to Ken to see whether there is a better way of doing this).int DE_ACTIVATED;int ACTIVATING;int ACTIVATED;int RUNNING;int HELD_DOWN;long waitTime;int ActivationRetryMax;int state;// state of each entryint serverId;HashMap<> orbAndPortInfo;Server serverObj;ServerDef serverDef;Process process;int activateRetryCount;String activationCmd;printState(...)String javaHome, ...;// get the string needed to make the activation commandthis.wrapperthis.serverIdthis.serverDefserverDef.serverArgsserverDef.serverClassPathserverDef.serverNameORBConstants.INITIAL_PORT_PROPERTYserverDef.serverVmArgs/** Verify whether the server definition is valid. */waitFor(...)exec(...)getRuntime(...)printDebug(...)ServerMain.UNKNOWN_ERRORdeActivate(...)unableToStartProcess(...)int numListenerPortsendpointList.lengthEndPointInfo[] serverListenerPortscontainsKey(...)notifyAll(...)Server localServerObjserverNotRunning(...)Process localProcessint exitValexitValue(...)IllegalThreadStateException e1clear(...)holdDown(...)ORBPortInfo[] orbAndPortListwait(...)Iterator<> setORBidsint numElementsint portserverListenerPorts.lengthEndPointInfo[] portListString[] orbList/* Copyright (c) 1997, 2003, Oracle and/or its affiliates. All rights reserved. ... */// create a HashMap with capacity 255// Since all methods are synchronized, we don't need any// additional synchronization mechanisms// compute the activation command// add path to the java vm// add any arguments to the server Java VM// add ORB properties// we need to pass in the verify flag, so that the server is not// launched, when we try to validate its definition during registration// into the RepositoryImpl// add classpath to the server// add server class name and arguments// Add the debug flag, if any//state = RUNNING;//notifyAll();// find if the ORB is already registered, then throw an exception// store all listener ports and their types// put this set of listener ports in the HashMap associated// with the orbId// _REVISIT_, If the state is not equal to ACTIVATED then it is a bug// need to log that error, once the Logging framework is in place// for rip-int.// shutdown the server// call the uninstall// what kind of exception should be thrown// If the State in the ServerTableEntry is RUNNING and the// Process was shut down abnormally, The method will change the// server state as De-Activated.// Clear the PortInformation as it is old// Move the state to De-Activated, So that the next// call to this server will re-activate.// get an entry corresponding to orbId// return the port corresponding to the endpointType// have everything in the table// no element in HashMap corresponding to ORBid found// ex.printStackTrace();import BufferedReaderimport InputStreamReaderimport StringTokenizerimport com.sun.corba.se.spi.activation.*int cmdNameLennew RegisterServer(...)new UnRegisterServer(...)new GetServerID(...)new ListServers(...)new ListAliases(...)new ListActiveServers(...)new LocateServer(...)new LocateServerForORB(...)new ListORBs(...)new ShutdownServer(...)new StartServer(...)new Help(...)new Quit(...)CommandHandler handlerlength(...)getCommandName(...)... > ...String helpCommand;String toolName;String commandArg;Repository repint serveridString[] cmdint cmdLen... - ...int jexecuteCommand(...)new BufferedReader(...)new InputStreamReader(...)System.inreadCommand(...)printAvailableCommands(...)ServerTool toolnew ServerTool(...)String cmdLinereadLine(...)StringTokenizer stnew StringTokenizer(...)countTokens(...)hasMoreTokens(...)nextToken(...)printCommandHelp(...)CommandHandler.shortHelpboolean resultcmd.lengthCommandHandler.longHelpString[] cmdArgscmdArgs.lengthprocessCommand(...)CommandHandler.parseErrorVector<> handlers;int maxNameLen;String classpathString argsString vmargsString argRepository repositoryServerDef serverServerNotRegistered exServerAlreadyActive exServerHeldDown exServerAlreadyRegistered exBadServerDefinition exex.reasongetServerIdForAlias(...)Locator locatorint numEntrieslocation.ports.lengthORBPortInfo orbPortorbPort.orbIdorbPort.portEndPointInfo PortPort.endpointTypePort.portServerNotRegistered eboolean listOneServersortServers(...)/** Do a simple bubble sort to sort the server ids in ascending ... */int sizeserverIds.lengthint lowestint tempString[] applicationNamesapplicationNames.lengthServerNotActive exorbList.length// if command specified in the args, get it// get the command// create the POA ORB// if command specified in the args, process it// process commands interactively// create a buffered reader to read commands from standard in// print tool banner// process commands until user quits// print short help// handle the help command// print long help for a specific command// determine the subcommand and execute it// construct args to the command// execute the command// unknown command - print available commands// determine longest command name// parse register server command// minimally the server class name has to be specified// register server and activate it// register the server with the repository// activate the server// print success message// the server id has to be specified// deactivate server, hold it down and and unregister it// deactivate the server// unregister the server from the repository// parse command// determine if list single server or all servers// process the list server command// process the list active servers command// determine the server id// startup the serverimport DenseIntMapImplimport ObjectCopierFactoryimport CopierManagerint defaultId;DenseIntMapImpl map;new DenseIntMapImpl(...)set(...)/* Copyright (c) 2003, Oracle and/or its affiliates. All rights reserved. ... */import ObjectCopierimport ReflectiveCopyException/** Trys a first ObjectCopier.  If the first throws a ReflectiveCopyException, ... */ObjectCopier first;ObjectCopier second;this.firstthis.secondcopy(...)ReflectiveCopyException rce// XXX log this fallback at a low levelimport Levelimport Loggerimport Remoteimport MarshalExceptionimport InputStreamimport OutputStreamimport ByteArrayInputStreamimport ByteArrayOutputStreamautoConnect(...)ByteArrayOutputStream osnew ByteArrayOutputStream(...)byte[] arrtoByteArray(...)InputStream isnew ByteArrayInputStream(...)/* Copyright (c) 2004, Oracle and/or its affiliates. All rights reserved. ... */// Yes, so make sure it is connected and converted// to a stub (if needed)...InputStream inwrite_value(...)import BigDecimalimport AccessControllerimport PrivilegedActionimport Listimport Principalimport TypeCodeimport Anyimport TCKindimport Streamableimport BadKindimport Boundsimport ORBVersionFactoryimport StubAdapterimport CDRInputStreamimport EncapsInputStreamimport EncapsOutputStreamimport ValueUtilityimport RepositoryIdFactoryimport RepositoryIdStringsimport ORBUtilSystemException// subclasses must provide a matching helper classnew boolean[]AnyInputStream aISdoPrivileged(...)new (...)new PrivilegedAction<AnyInputStream>(...) { ... }AnyImpl$AnyOutputStream$1new AnyInputStream(...)TypeCodeImpl typeCode;// Always valid.ORBUtilSystemException wrapper;CDRInputStream stream;// detect an optimization in read_value().// stream type is an Any extension of CDR stream that is used to// holds the value in CDR marshaled format. As an optimization, the// isStreamed[] table below. Otherwise, 'stream' is non-null and// members are used to hold immutable types as defined by the// Validity depends upon typecode. The 'value' and 'object' instanceObject object;boolean isInitialized;// in a BAD_OPERATION exception being raised.// An attempt to extract before the value is set will result// Setting the typecode via the type() accessor wipes out the value.int DEFAULT_BUFFER_SIZE;...[] isStreamed;/* This boolean array tells us if a given typecode must be ... */AnyImpl anyImplnew AnyImpl(...)anyImpl.typeCodeconvertToNative(...)/** A constructor that sets the Any to contain a null. It also marks ... */CORBALogDomains.RPC_PRESENTATIONTCKind._tk_null// Create a new AnyImpl which is a copy of obj.this(...)AnyImpl objImplobjImpl.typeCodeobjImpl.valueobjImpl.objectobjImpl.isInitializedobjImpl.streamdup(...)/** returns the type of the element contained in the Any. ... */// basic accessorsrealType(...)TypeCode realTypevalue(...)TCKind._tk_aliaskind(...)content_type(...)BadKind badbadkindCannotOccur(...)/** sets the type of the element to be contained in the Any. ... *//** checks for equality between Anys. ... */equal(...)InputStream copyOfMyStreamInputStream copyOfOtherStreamTCKind._tk_voidTCKind._tk_shortextract_short(...)TCKind._tk_longextract_long(...)TCKind._tk_ushortextract_ushort(...)TCKind._tk_ulongextract_ulong(...)TCKind._tk_floatextract_float(...)TCKind._tk_doubleextract_double(...)TCKind._tk_booleanextract_boolean(...)TCKind._tk_charextract_char(...)TCKind._tk_wcharextract_wchar(...)TCKind._tk_octetextract_octet(...)TCKind._tk_anyextract_any(...)TCKind._tk_TypeCodeextract_TypeCode(...)TCKind._tk_stringextract_string(...)TCKind._tk_wstringextract_wstring(...)TCKind._tk_longlongextract_longlong(...)TCKind._tk_ulonglongextract_ulonglong(...)TCKind._tk_objrefextract_Object(...)TCKind._tk_Principalextract_Principal(...)TCKind._tk_enumTCKind._tk_fixedcompareTo(...)extract_fixed(...)TCKind._tk_exceptTCKind._tk_structTCKind._tk_unionTCKind._tk_sequenceTCKind._tk_arrayequalMember(...)TCKind._tk_valueTCKind._tk_value_boxextract_Value(...)errorResolvingAlias(...)TCKind._tk_longdoubletkLongDoubleNotSupported(...)typecodeNotSupported(...)// Uses up (recursively) copies of the InputStream in both Anys that got created in equal().// Needed for equal() in order to achieve linear performance for complex types.InputStream mineInputStream otherread_short(...)read_ushort(...)read_ulong(...)read_float(...)read_double(...)read_char(...)read_wchar(...)read_octet(...)read_any(...)read_TypeCode(...)read_wstring(...)read_longlong(...)read_ulonglong(...)read_Principal(...)read_fixed(...)int lengthmember_count(...)member_type(...)Any myDiscriminatorcreate_any(...)Any otherDiscriminatorTypeCodeImpl realTypeCodeImplint memberIndexcurrentUnionMemberIndex(...)discriminator_type(...)unionDiscriminatorError(...)BadKind badKindBounds boundsboundsCannotOccur(...)/** returns an output stream that an Any value can be marshaled into. ... */// accessors for marshaling/unmarshalingORB finalorbnew PrivilegedAction<AnyOutputStream>(...) { ... }AnyImpl$1new AnyOutputStream(...)/** returns an input stream that an Any value can be marshaled out of. ... */AnyImpl.isStreamedOutputStream osmarshalIn(...)// since it is in our format and does not have alignment issues.// If the InputStream is a CDRInputStream then we can copy the bytes// marshaling/unmarshaling routinesint kind... >= ...isStreamed.lengthinvalidIsstreamedTckind(...)Object[] objholderlong[] longholdernew long[]unmarshalIn(...)// drive the remarshaling through typecode interpretation.// If not, then we can just do a byte array copy without having to// alignment of greater than 4 (was write_double() ever called on it).// has ever had anything marshaled on it that required an// We could optimize this by noticing whether the target stream/** takes a streamable and inserts its reference into the any ... */_type(...)/** See the description of the <a href="#anyOps">general Any operations.</a> */// insertion/extraction/replacement for all basic typesTypeCodeImpl.kindNames.lengthTypeCodeImpl.kindNamesint tcextractNotInitialized(...)String tcNamegetTCKindName(...)String expectedNameextractWrongType(...)List<> listexpected.lengthextractWrongTypeList(...)checkExtractBadOperation(...)checkExtractBadOperationList(...)floatToIntBits(...)intBitsToFloat(...)doubleToLongBits(...)longBitsToDouble(...)TCKind.tk_stringbadStringBounds(...)TCKind.tk_wstringisStub(...)String[] idsgetTypeIds(...)new TypeCodeImpl(...)badInsertobjParam(...)getClass(...)/** A variant of the insertion operation that takes a typecode ... */insertObjectIncompatible(...)insertObjectFailed(...)extractObjectIncompatible(...)extractObjectFailed(...)/** @deprecated *//** Note that the Serializable really should be an IDLEntity of ... */TCKind._tk_abstract_interfaceTypeCode tcTCKind.tk_valuecreateTypeCodeForClass(...)create_fixed_tc(...)digits(...)scale(...)fixed_digits(...)fixed_scale(...)fixedNotMatch(...)BadKind bkfixedBadTypecode(...)/** Utility method for insert_Value and Util.writeAny. ... */TypeCodeImpl classTCgetTypeCodeForClass(...)RepositoryIdStrings repStrsgetRepIdStringsFactory(...)isArray(...)Class<> componentClassgetComponentType(...)TypeCode embeddedTypeTypeCode tString idcreateForJavaType(...)isPrimitive(...)getPrimitiveTypeCodeForClass(...)create_value_box_tc(...)String.classcreateValueHandler(...)setCaching(...)setTypeCodeForClass(...)/** It looks like this was copied from io.ValueUtility at some ... */Integer.TYPEByte.TYPETCKind.tk_octetLong.TYPETCKind.tk_longlongFloat.TYPETCKind.tk_floatDouble.TYPETCKind.tk_doubleShort.TYPETCKind.tk_shortCharacter.TYPE... <= ...getFOREIGN(...)getORBVersion(...)getNEWER(...)TCKind.tk_wcharTCKind.tk_charBoolean.TYPETCKind.tk_any// and returns it wrapped into a new Any// (at the Anys current internal stream position, consuming the anys stream on the way)// Extracts a member value according to the given TypeCode from the given complex AnyAny returnValue// but is has to be in this package.// This method could very well be moved into TypeCodeImpl or a common utility class,// There is no other way for DynAnys to find out whether the Any is initialized./* Licensed Materials - Property of IBM ... */// null// void// short// long// ushort// ulong// float// double// boolean// char// octet// any// TypeCode// Principal// objref// struct// union// enum// string// sequence// array// alias// except// longlong// ulonglong// longdouble// wchar// wstring// fixed// value// value_box (used to be true)// native// abstract interface// null is a valid value// Note: Indirect types are handled in kind() method// impossible//debug.log ("type2");// set the typecode// null is the only legal value this Any can have after resetting the type code//debug.log ("equal");// first check for typecode equality.// note that this will take aliases into account// Resolve aliases here// _REVISIT_ Possible optimization for the case where// otherAny is a AnyImpl and the endianesses match.// Need implementation of CDRInputStream.equals()// For now we disable this to encourage testing the generic,// unoptimized code below.// Unfortunately this generic code needs to copy the whole stream// at least once.//    if (AnyImpl.isStreamed[realType.kind().value()]) {//        if (otherAny instanceof AnyImpl) {//            return ((AnyImpl)otherAny).stream.equals(stream);//        }// handle primitive types// Too complicated to handle value types the way we handle// other complex types above. Don't try to decompose it here// for faster comparison, just use Object.equals().// Unspecified for Java// just so that the two stream are in sync// error resolving alias above//debug.log ("create_output_stream");// We create a new InputStream so that multiple threads can call here// and read the streams in parallel without thread safety problems.//debug.log ("create_input_stream");//debug.log ("read_value");// Assume that someone isn't going to think they can keep reading// from this stream after calling us. That would be likely for// an IIOPInputStream but if it is an AnyInputStream then they// presumably obtained it via our create_output_stream() so they could// write the contents of an IDL data type to it and then call// create_input_stream() for us to read it. This is how Helper classes// typically implement the insert() method.// We should probably document this behavior in the 1.1 revision// task force.// could only have been created here//debug.log ("write_value");// _REVISIT_ check isInitialized whether all we write is TypeCode!//debug.log ("insert_Streamable");//debug.log( "extract_Streamable" ) ;//debug.log ("insert_short");//debug.log ("extract_short");//debug.log ("insert_long");// A long value is applicable to enums as well, so don't erase the enum type code// in case it was initialized that way before.//debug.log ("extract_long");//debug.log ("insert_ushort");//debug.log ("extract_ushort");//debug.log ("insert_ulong");//debug.log ("extract_ulong");//debug.log ("insert_float");//debug.log ("extract_float");//debug.log ("insert_double");//debug.log ("extract_double");//debug.log ("insert_longlong");//debug.log ("extract_longlong");//debug.log ("insert_ulonglong");//debug.log ("extract_ulonglong");//debug.log ("insert_boolean");//debug.log ("extract_boolean");//debug.log ("insert_char");//debug.log ("extract_char");//debug.log ("insert_wchar");//debug.log ("extract_wchar");//debug.log ("insert_octet");//debug.log ("extract_octet");//debug.log ("insert_string");// Make sure type code information for bounded strings is not erased// Check if bounded strings length is not exceeded//debug.log ("extract_string");//debug.log ("insert_wstring");//debug.log ("extract_wstring");//debug.log ("insert_any");//debug.log ("extract_any");//debug.log ("insert_Object");//debug.log ("insert_Object2");//debug.log ("extract_Object");// Check if the object contained here is of the type in typeCode//debug.log ("insert_TypeCode");//debug.log ("extract_TypeCode");//debug.log ("extract_Value");//debug.log ("insert_Value");// See note in getPrimitiveTypeCodeForClass.  We// have to use the latest type code fixes in this// case since there is no way to know what ORB will// actually send this Any.  In RMI-IIOP, when using// Util.writeAny, we can do the versioning correctly,// and use the insert_Value(Serializable, TypeCode)// method.// The ORB singleton uses the latest version.//debug.log ("insert_Value2");// type isn't even of kind fixed// Look in the cache first// All cases need to be able to create repository IDs.// See bug 4391648 for more info about the tcORB in this// case.// Assertion: c instanceof Serializable?// Arrays - may recurse for multi-dimensional arrays// Strings// Anything else// We know that this is a TypeCodeImpl since it is our ORB// Intruct classTC to store its buffer// Update the cache//debug.log ("getPrimitiveTypeCodeForClass");// For Merlin or later JDKs, or for foreign ORBs,// we correctly say that a Java char maps to a// CORBA wchar.  For backwards compatibility// with our older ORBs, we say it maps to a// CORBA char.  This is only used in RMI-IIOP// in our javax.rmi.CORBA.Util delegate's// writeAny method.  In Java IDL, there's no way// to know the ORB version that the Any will be// sent out with -- it could be different than// the one used to create the Any -- so we use the// most recent version (see insert_Value).// _REVISIT_ Not sure if this is right.write_any(...)/* Copyright (c) 1999, 2002, Oracle and/or its affiliates. All rights reserved. ... *//* The AsynchInvoke class allows for the support of asynchronous ... */// helper class for deferred invocationsRequestImpl _req;ORB _orb;boolean _notifyORB;/* The run operation calls the invocation on the request object, ... */doInvocation(...)_req.gotResponsenotify(...)notifyORB(...)// do the actual invocation// for the asynchronous case, note that the response has been// received.// update local boolean indicator// notify any client waiting on a 'get_response'// Bare implementation of CORBA Object.String[] typeidsimport Contextimport NO_IMPLEMENTimport NVListcontextNotImplemented(...)/* Copyright (c) 1996, 2003, Oracle and/or its affiliates. All rights reserved. ... */import ContextListint INITIAL_CAPACITY;int CAPACITY_INCREMENT;Vector<> _contexts;ArrayIndexOutOfBoundsException enew Bounds(...)removeElementAt(...)/* Copyright (c) 1996, 2002, Oracle and/or its affiliates. All rights reserved. ... */// Note: This orb could be an instanceof ORBSingleton or ORBimport Environmentimport UserExceptionException _exc;import ExceptionListVector<> _exceptions;import NamedValueVector<> _namedValues;NamedValue tmpValnew NamedValueImpl(...)// Note: the size arg is only a hint of the size of the NVList.String _name;Any _value;int _flags;this.valueimport ARG_INimport ARG_OUTimport ARG_INOUTimport Requestimport UnknownUserExceptionimport UNKNOWNimport WrongTransactionimport ApplicationExceptionimport RemarshalExceptionimport AsynchInvokeObject _target;// data membersString _opName;NVList _arguments;ExceptionList _exceptions;NamedValue _result;Environment _env;Context _ctx;ContextList _ctxList;ORBUtilSystemException _wrapper;boolean _isOneWay;// invocation-specific stuff...[] _paramCodes;...[] _paramLongs;...[] _paramObjects;boolean gotResponse;// thread object doing the asynchronous invocation.// protected instead of private since it needs to be set by the// support for deferred invocations.// accessed from xgiop.// REVISIT - used to be protected.  Now public so it can be// constructorCORBALogDomains.OA_INVOCATIONnew NVListImpl(...)new ExceptionListImpl(...)new ContextListImpl(...)new EnvironmentImpl(...)new ContextImpl(...)ARG_IN.valueadd_item(...)ARG_INOUT.valueARG_OUT.valueAsynchInvoke invokeObjectnew AsynchInvoke(...)new Thread(...)/* The doInvocation operation is where the real mechanics of ... */// private helper methodsgetDelegate(...)initiateClientPIRequest(...)getPIHandler(...)setClientPIInfo(...)request(...)count(...)NamedValue nvitem(...)flags(...)Bounds exboundsErrorInDiiRequest(...)ApplicationException eRemarshalException eSystemException exexception(...)releaseReply(...)// REVISIT -  make protected after development - so xgiop can get it.Any returnAnyTypeCode returnTypeAny any/* Copyright (c) 1996, 2004, Oracle and/or its affiliates. All rights reserved. ... */// initialize the orb// initialize target, context and operation name// initialize argument list if not passed in// set result container.// initialize exception list if not passed in// initialize context list if not passed in// initialize environment// this method has to be synchronized even though it seems// "readonly" since the thread object doing the asynchronous// invocation can potentially update this variable in parallel.// updates are currently simply synchronized againt the request// object.// release the lock. wait to be notified by the thread that is// doing the asynchronous invocation.// Initiate Client Portable Interceptors.  Inform the PIHandler that// this is a DII request so that it knows to ignore the second// inevitable call to initiateClientPIRequest in createRequest.// Also, save the RequestImpl object for later use.// Marshal args// REVISIT - minor code.// This is already handled in subcontract.// REVISIT - uncomment.//throw new INTERNAL();// NOTE: The exception should not be thrown.// However, JDK 1.4 and earlier threw the exception,// so we keep the behavior to be compatible.// First unmarshal the return value if it is not void// Now unmarshal the out/inout args// Cannot happen since we only iterate till _arguments.count()import ServerRequestimport CorbaMessageMediatorInputStream _ins;boolean _paramsCalled;// booleans to check for various operation invocation restrictionsboolean _resultSet;boolean _exceptionSet;Any _resultAny;Any _exception;getOperationName(...)getInputObject(...)NamedValue argargumentsCalledMultiple(...)argumentsCalledAfterException(...)argumentsCalledNullArgs(...)Bounds ebadArgumentsNvlist(...)setServerPIInfo(...)invokeServerPIIntermediatePoint(...)argumentsNotCalled(...)setResultCalledMultiple(...)setResultAfterException(...)setResultCalledNullArgs(...)TCKind kindsetExceptionCalledNullArgs(...)TCKind.tk_exceptsetExceptionCalledBadType(...)setServerPIExceptionInfo(...)/** This is called from the ORB after the DynamicImplementation.invoke ... */TypeCode result_tcTCKind.tk_voiddsiResultException(...)dsimethodNotcalled(...)contextCalledOutOfOrder(...)// if we support contexts, this would// presumably also  be available on// the server invocation// unmarshal the value into the Any// hang on to the NVList for marshaling the result// check for invocation restrictions// Notify portable interceptors of the result so that// ServerRequestInfo.result() functions as desired.// actual marshaling of the reply msg header and params takes place// after the DSI returns control to the ORB.// except can be called by the DIR at any time (CORBA 2.2 section 6.3).// Ensure that the Any contains a SystemException or a// UserException. If the UserException is not a declared exception,// the client will get an UNKNOWN exception.// Inform Portable interceptors of the exception that was set// so sending_exception can return the right value.// The user can only call arguments once and not at all after// set_exception.  (internal flags ensure this).  However, the user// can call set_exception multiple times.  Therefore, we only// invoke receive_request the first time set_exception is// called (if they haven't already called arguments).// We need to invoke intermediate points here.// actual marshaling of the reply msg header and exception takes place// Two things to be checked (CORBA 2.2 spec, section 6.3):// 1. Unless it calls set_exception(), the DIR must call arguments()//    exactly once, even if the operation signature contains//    no parameters.// 2. Unless set_exception() is called, if the invoked operation has a//    non-void result type, set_result() must be called exactly once//    before the DIR returns.// normal invocation return// Neither a result nor an exception has been set.// Assume that the return type is void. If this is not so,// the client will throw a MARSHAL exception while// unmarshaling the return value.// marshal the operation return value// marshal the inouts/outsimport CDROutputStream/** Static functions for TypeCode interpretation. */ORBUtilSystemException wrapperorb(...)TCKind._tk_nativewrite_short(...)... & ...write_ushort(...)write_ulong(...)write_float(...)write_double(...)write_char(...)write_octet(...)write_TypeCode(...)write_Principal(...)write_longlong(...)write_ulonglong(...)write_wchar(...)write_wstring(...)write_fixed(...)_write(...)write_abstract_interface(...)long lObject o_read(...)BigDecimal bigDecimalmovePointLeft(...)read_abstract_interface(...)/* Copyright (c) 1998, 2004, Oracle and/or its affiliates. All rights reserved. ... */// nothing to write// _REVISIT_ As soon as the java-rtf adds digits and scale parameters to// OutputStream, this check will be unnecessary// Nothing to read// InputStream, this check will be unnecessaryimport Mapimport Collectionsimport IOExceptionimport BigIntegerimport StructMemberimport UnionMemberimport ValueMemberimport BAD_TYPECODEimport BAD_PARAMimport BAD_OPERATIONimport MARSHALimport OSFCodeSetRegistryimport MarshalInputStreamimport CodeSetConversionimport TypeCodeInputStreamimport TypeCodeOutputStreamimport TypeCodeReaderimport WrapperInputStream// no chance of subclasses, so no problems with runtime helper lookupint tk_indirect;// the indirection TCKind, needed for recursive typecodes.//static final boolean debug = false;int EMPTY;// how the encoding should be done.// typecode encodings have three different categories that determineint SIMPLE;// no parametersint COMPLEX;// simple parameters....[] typeTable;// a table storing the encoding category for the various typecodes.// parameters// use CDR encapsulation for// complex parameters. need to...[] kindNames;// This is also used in AnyImpl.// Maps TCKind values to namesint _kind;// data members for representing the various kinds of typecodes.// the typecode kind// the typecode repository idint _memberCount;// the typecode name...[] _memberNames;// member count...[] _memberTypes;// names of members...[] _unionLabels;// types of membersTypeCodeImpl _discriminator;// values of union labelsint _defaultIndex;// union discriminator typeint _length;// union default indexTypeCodeImpl _contentType;// string/seq/array lengthshort _digits;// seq/array/alias typeshort _scale;short _type_modifier;// Is the data immutable? What about StructMember, UnionMember etc.?// passed in at initialization instead of copying the relevant data.// _REVISIT_ We might want to keep references to the ValueMember classes// value typeTypeCodeImpl _concrete_base;// VM_ABSTRACT, VM_TRUNCATABLE// VM_NONE, VM_CUSTOM,...[] _memberAccess;// concrete base typeTypeCodeImpl _parent;// recursive sequence support// visibility of ValueMemberint _parentOffset;// the enclosing type codeTypeCodeImpl _indirectType;// recursive type code support// the level of enclosure...[] outBuffer;// caches the byte buffer written in write_value for quick remarshaling...boolean cachingEnabled;// ... but only if caching is enabled// the ORB instance: may be instanceof ORBSingleton or ORB// Constructors...TypeCodeImpl tcitci._kindbadRemoteTypecode(...)tci._contentTypeTypeCode tccbconcrete_base_type(...)type_modifier(...)new short[]member_visibility(...)new TypeCodeImpl[]setParent(...)member_name(...)setId(...)name(...)default_index(...)new AnyImpl[]member_label(...)BadKind emembers.length...[...].name...[...].type...[...].label...[...].accessnegativeBounds(...)tryIndirectType(...)// efficient typecode comparisons for primitive typecodes.// here we could reduce object creation and also enable more// If we checked for and returned constant primitive typecodes// Optimization:// Other creation functions...TypeCodeOutputStream tcosnewTypeCodeOutputStream(...)// Support for indirect/recursive type codesunresolvedRecursiveTypecode(...)setIndirectType(...)getTypeCode(...)setTypeCode(...)getParentAtLevel(...)TypeCodeImpl realParentrealParent._id// Other private functions// TypeCode operationslazy_content_type(...)/** The equivalent operation is used by the ORB when determining type equivalence ... */TypeCode myRealTypeindirectType(...)TypeCode otherRealTypeString myIDString otherIDint myKindequivalent(...)from_int(...)new BadKind(...)read_value_kind(...)read_value_body(...)WrapperInputStream wrappernew WrapperInputStream(...)int myPositiongetTopLevelPosition(...)TypeCodeReader topStreamgetTopLevelStream(...)typeTable.lengthcannotMarshalBadTckind(...)cannotMarshalNative(...)int streamOffsetint topPosint indirectTypePositionTypeCodeImpl typegetTypeCodeAtPosition(...)invalidIndirection(...)indirectionNotFound(...)addTypeCodeAtPosition(...)recursiveTypecodeError(...)invalidSimpleTypecode(...)TypeCodeInputStream _encapreadEncapsulation(...)read_value_recursive(...)insert_octet(...)insert_short(...)insert_long(...)insert_ushort(...)insert_ulong(...)insert_float(...)insert_double(...)insert_boolean(...)insert_char(...)insert_longlong(...)insert_ulonglong(...)insert_wchar(...)invalidComplexTypecode(...)invalidTypecodeKindMarshal(...)TypeCodeOutputStream wrapperOutStreamwrapOutputStream(...)getTypeCodeBuffer(...)write_octet_array(...)outBuffer.lengthwriteRawBuffer(...)TypeCodeOutputStream topStreamint posgetPositionForID(...)writeIndirection(...)addIDAtPosition(...)TypeCodeOutputStream _encapcreateEncapsulation(...)writeOctetSequenceTo(...)/** This is not a copy of the TypeCodeImpl objects, but instead it ... */int seqLengthString sAny tmpTypeCodeImpl t_memberTypes.lengthAny tagValueint labelIndexshort valuechar valueillegalUnionDiscriminatorType(...)_unionLabels.lengthbadSequenceBounds(...)short lengthunscaledValue(...)signum(...)...--// default index or -1 if there is no default index.// corresponding to the discriminator. If not found returns the// Only for union type. Returns the index of the union member// Utility methodsByteArrayOutputStream byteOutPrintStream printOutprintStream(...)indent(...)_contentType._nameString indent...+=.../* Copyright (c) 1996, 2013, Oracle and/or its affiliates. All rights reserved. ... */// tk_null// tk_void// tk_short// tk_long// tk_ushort// tk_ulong// tk_float// tk_double// tk_boolean// tk_char// tk_octet// tk_any// tk_typecode// tk_principal// tk_objref// tk_struct// tk_union// tk_enum// tk_string// tk_sequence// tk_array// tk_alias// tk_except// tk_longlong// tk_ulonglong// tk_longdouble// tk_wchar// tk_wstring// tk_fixed// tk_value// tk_value_box// tk_native// tk_abstract_interface// initialized to tk_null// to handle conversion of "remote" typecodes into "native" style.// also see the 'convertToNative(ORB orb, TypeCode tc)' function// This is a protection against misuse of this constructor.// Should only be used if tc is not an instance of this class!// Otherwise we run into problems with recursive/indirect type codes.// _REVISIT_ We should make this constructor private// set up kind// set up parameters// concrete base may be null//_memberAccess = tc._memberAccess;// Need to reconstruct _memberAccess using member_count() and member_visibility()// set up member types// set up member names// set up member count// set up stuff for unions// set up length// set up content type// dont have to worry about these since code ensures we dont step// out of bounds.// for primitive types// private API. dont bother checking that//     (creationKind < 0 || creationKind > typeTable.length)// do initialization for special cases// this is being used to create typecode for CORBA::Object// for structs and exceptions// else initializes to null// for unions// check whether this is the default branch.// for value types// for enums// for aliases and value boxes// for strings// for sequences and arrays// for recursive sequences// for recursive type codes// This is the type code of the type we stand in for, not our own.// Try to resolve it now. May return null in which case// we try again later (see indirectType()).// for fixed//if (digits < 1 || digits > 31)//throw new BAD_TYPECODE();//if (debug) System.out.println("Created TypeCodeOutputStream " + tcos +// " with no parent");// Nothing we can do about that.// Assert that _kind == tk_indirect// can't happen// check whether return value != this which would indicate that the// repository id isn't unique.// This is an unresolved recursive sequence tc.// Try to resolve it now if the hierarchy is complete.// Create a recursive type code object as the content type.// This is when the recursive sequence typecode morphes// into a sequence typecode containing a recursive typecode.// _REVISIT_ for all optional names/ids, we might want to check that// they are equal in case both are non-nil.//return indirectType().equal(tc);// make sure kinds are identical.// no parameters to check.// check for bound.// check for logical id.// ignore name since its optional.// check for member count// check for repository id// check for member types.// ignore id and names since those are optional.// check for default index// check for discriminator type// check for label types and values// check for branch types// check member count// ignore names since those are optional.// check bound/length// check content type// ignore id and name since those are optional.// concrete_base may be null// check for equality with the true type// dont have to worry about these since the code ensures these dont// arise.// If the result of the kind operation on either TypeCode is tk_alias, recursively// replace the TypeCode with the result of calling content_type, until the kind// is no longer tk_alias.// Note: Always resolve indirect types first!// If results of the kind operation on each typecode differ,// equivalent returns false.// At this point the id operation is valid for both TypeCodes.// Return true if the results of id for both TypeCodes are non-empty strings// and both strings are equal.// If both ids are non-empty but are not equal, then equivalent returns FALSE.// id operation is not valid for either or both TypeCodes// If either or both id is an empty string, or the TypeCode kind does not support// the id operation, perform a structural comparison of the TypeCodes.// impossible if we checked correctly above// Structural comparison succeeded!// _REVISIT_ It isn't clear whether this method should operate on this or a copy.// For now just return this unmodified because the name and member_name fields// aren't used for comparison anyways.// Recursive is the only form of indirect type codes right now.// Indirection can also be used for repeated type codes.//return indirectType().id(); // same as _id// exception and objref typecodes must have a repository id.// structs, unions, enums, and aliases may or may not.// all other typecodes throw the BadKind exception.// _REVISIT_ Why create a new Any for this?// hardly possible unless caller knows our "private" stream classes.//if (debug) System.out.println("Created WrapperInputStream " + wrapper +// don't wrap a CDRInputStream reading "inner" TypeCodes.// Bug fix 5034649: allow for padding that precedes the typecode kind.// check validity of kind// Don't do any work if this is native// We have to remember the stream and position for EVERY type code// in case some recursive or indirect type code references it.// The encoding used for indirection is the same as that used for recursive ,// TypeCodes i.e., a 0xffffffff indirection marker followed by a long offset// (in units of octets) from the beginning of the long offset.// substract 4 to get back to the beginning of the long offset.// Now we have to find the referenced type// by its indirectTypePosition within topStream.//if (debug) System.out.println(// "TypeCodeImpl looking up indirection at position topPos " +//topPos + " - 4 + offset " + streamOffset + " = " + indirectTypePosition);// unmarshal the kind// start unmarshaling the rest of the typecode, based on the// encoding (empty, simple or complex).// nothing to unmarshal// get the repository id// get the name// discriminant typecode// default index// get the number of members// create arrays for the label values, names and types of members// read off label values, names and types// for the default case, read off the zero octet// _REVISIT_ figure out long double mapping// case TCKind.tk_longdouble:// _unionLabels[i].insert_longdouble(_encap.getDouble());// break;// create arrays for the identifier names// read off identifier names// get the type of the sequence// get the bound on the length of the sequence// get the type of the array// get the length of the array// get the type aliased// create arrays for the names and types of members// read off member names and types//if (debug) System.out.println("TypeCode " + _name +// " reading member " + _memberNames[i]);// get the type modifier// create arrays for the names, types and visibility of members// read off value member visibilities// Wrap OutputStream into TypeCodeOutputStream.// This test shouldn't be necessary according to the Java language spec.// Cache the buffer for repeated writes//if (outBuffer != null)//System.out.println("Caching outBuffer with length = " +//outBuffer.length + " for id = " + _id);//System.out.println("Using cached outBuffer: length = " + outBuffer.length +//", id = " + _id);// Write the first 4 bytes first to trigger alignment.// We know that it is the kind.//System.out.println("Buffer is empty for " + _id);//if (debug) tcos.printBuffer();//if (debug) System.out.println("Writing indirection " + _name + "to " + _id);//if (debug) System.out.println("TypeCodeImpl " + tcos +// " writing indirection " + _id +//" to position " + pos + " at position " + topPos);// All that gets written is _kind and offset.// The original approach changed for 5034649// topStream.addIDAtPosition(_id, tcos.getTopLevelPosition());// marshal the kind//if (debug) System.out.println("Writing " + _name + " with id " + _id);// Bug fix 5034649:// Do this AFTER the write of the _kind in case the alignment// for the long changes the position.// nothing more to marshal// marshal the bound on string length// unknown typecode kind// create an encapsulation// put the repository id// put the name// put the number of members// marshal label values, names and types// for the default case, marshal the zero octet// _encap.putDouble(_unionLabels[i].extract_longdouble());// marshal identifier names// put the type of the sequence// put the bound on the length of the sequence// put the type of the array// put the length of the array// put the type aliased// marshal member names and types// " writing member " + _memberNames[i]);// put the type modifier// marshal the encapsulation// make sure length bound in typecode is not violated//Any tmp = new AnyImpl(_orb);// Copy repositoryId// Fall into ...// _REVISIT_ what about the inherited members of this values concrete base type?// copy each element, using the corresponding member type/* _REVISIT_ More generic code? ... */// {// double value = src.read_double();//  tagValue.insert_longdouble(value);//  dst.putDouble(value);//  break;//}// using the value of the tag, find out the type of the value// following.// use equality over anys// get the length of the sequence// check for sequence bound violated// write the length of the sequence// copy each element of the seq using content type// make sure it's resolved// copy each element of the array using content type// follow the alias// need to follow offset, get unmarshal typecode from that// offset, and use that to do the copy// Don't need to read type code before using it to do the copy.// It should be fully usable.// memberName might differ from the name of the member.TCKind.tk_TypeCode/* Copyright (c) 1999, 2004, Oracle and/or its affiliates. All rights reserved. ... */import org.omg.DynamicAny.*import TypeMismatchimport InvalidValueimport InconsistentTypeCode// DynAny interface methodsdynAnyDestroyed(...)assign(...)from_any(...)// Spec: Returns a copy of the internal AnygetAny(...)createMostDerivedDynAny(...)InconsistentTypeCode ictcnew TypeMismatch(...)new InvalidValue(...)insert_string(...)insert_Object(...)insert_TypeCode(...)insert_wstring(...)insert_any(...)to_any(...)insert_Value(...)/* Copyright (c) 2000, 2003, Oracle and/or its affiliates. All rights reserved. ... */// set the current position to 0 if any has components, otherwise to -1.// If the other DynAny is a constructed one we don't want it to have// to create its Any representation just for this test.//System.out.println("Comparing anys");// Throw InvalidValue if this is a bounded string and the length is exceeded// _REVISIT_ Copy value here?// The spec doesn't allow us to throw back this exception// incase the anys any if of type Principal, native or abstract interface....[] anys;// Keep in sync with DynAny[] components at all times.// Instance variablesInconsistentTypeCode itc// For array any value indicates the boundary.// values > 0 indicate a bounded sequence.// For sequence value of 0 indicates an unbounded sequence,// This method has a different meaning for sequence and array:// Collection methods// _REVISIT_ More efficient copy operationcheckInitComponents(...)// This operation does not change the current position.// the operation raises TypeMismatch.// If one or more elements have a type that is inconsistent with the collections TypeCode,// the operation raises InvalidValue.// If value does not contain the same number of elements as the array dimension,// Initializes the elements of the ordered collection.TypeCode expectedTypeCodegetContentType(...)checkValue(...)new DynAny[]clearData(...)// Same semantics as set_elements(Any[])new Any[]// get a hold of the default initialized Any without copying// We know that this is of kind tk_sequence or tk_array// _REVISIT_ More info// Creates the appropriate subtype without copying the Any//System.out.println(this + " created component " + components[i]);// Other representations are invalidated by this operation...[] names;...[] nameValuePairs;// with these two arrays at all times.// Instance variables components and names above are kept in sync...[] nameDynAnyPairs;// Complex methods/* public org.omg.DynamicAny.DynAny copy() { ... */// Copies all the internal representations which is faster than reconstructing them.// _REVISIT_ Overridden to provide more efficient copying.names.lengthcomponents.length// Creates references to the parameter instead of copying it.Any memberAnyDynAny memberDynAnyString memberNameint expectedMemberCountallocComponents(...)String expectedMemberNameTypeCode expectedMemberType...[...].id...[...].valueaddComponent(...)new NameValuePair[]new NameDynAnyPair[]new NameValuePair(...)new NameDynAnyPair(...)setStatus(...)// from the Any representation// Initializes components, names, nameValuePairs and nameDynAnyPairs representationTypeCode typeCodeTypeCode memberTypeInputStream inputextractAnyFromStream(...)// More levels are initialized lazily, on demand.// This is not done recursively, only one level.// from the internal TypeCode information with default values// and if not then the garbage collector will take care of it.// Some other DynAny or a user variable might still hold onto them// It is probably right not to destroy the released component DynAnys.// We can be sure that typeCode is of kind tk_struct// Initialize components lazily, on demand.// This is an optimization in case the user is only interested in storing Anys.// For DynAnyComplex, the operation sets the current position to -1// for empty exceptions and to zero for all other TypeCodes.// The members (if any) are (recursively) initialized to their default values.// We know that this is of kind tk_struct// This typeCode is of kind tk_struct.// _DEBUG_//System.out.println("Created DynAny for " + memberName +//                   ", type " + memberType.kind().value());/* if (memberDynAny instanceof DynAnyConstructedImpl) { ... */import TypeCodeImplbyte REPRESENTATION_NONE;byte REPRESENTATION_TYPECODE;byte REPRESENTATION_ANY;byte REPRESENTATION_COMPONENTS;byte RECURSIVE_UNDEF;byte RECURSIVE_NO;byte RECURSIVE_YES;...[] emptyComponents;...[] components;// Constructed DynAnys maintain an ordered collection of component DynAnys.byte representations;byte isRecursive;this.anyis_recursive(...)// DynAny traversal methodsthis.indexseek(...)checkInitAny(...)writeAny(...)// Makes sure that the components representation is initializedinitializeComponentsFromAny(...)...|=...initializeComponentsFromTypeCode(...)// Makes sure that the Any representation is initializedinitializeAnyFromComponents(...)isRecursive(...)// Collapses the whole DynAny hierarchys values into one single streamed AnyDynAny currentComponentcurrent_component(...)TypeMismatch tmset_current_component(...)// getter / setter methodsisConstructedDynAny(...)insert_reference(...)insert_typecode(...)insert_dyn_any(...)insert_val(...)get_val(...)get_boolean(...)get_octet(...)get_char(...)get_short(...)get_ushort(...)get_long(...)get_ulong(...)get_float(...)get_double(...)get_string(...)get_reference(...)get_typecode(...)get_longlong(...)get_ulonglong(...)get_wchar(...)get_wstring(...)get_any(...)get_dyn_any(...)// needed for recursive type codes//System.out.println(this + " constructed with any " + any);// assertion: typeCode has been checked to be valid for this particular subclass.// note: We don't copy TypeCodes since they are considered immutable.// _REVISIT_ Would need REPRESENTATION_TYPECODE for lazy initialization//if ( ! isRecursive()) {//    initializeComponentsFromTypeCode();// No way to find out unless the TypeCode spec changes.// _REVISIT_ What about status?// If all we got is TypeCode representation (no value)// then we don't want to force creating a default value//System.out.println(this + " checkInitAny before writeAny");//System.out.println(this + " checkInitAny: reps does not have REPRESENTATION_ANY");//System.out.println(this + " checkInitAny: reps has REPRESENTATION_COMPONENTS");//System.out.println(this + " checkInitAny: reps has REPRESENTATION_TYPECODE");//System.out.println(this + " checkInitAny: reps != REPRESENTATION_ANY");//System.out.println(this + " initializeAnyFromComponents");// Not our implementation. Nothing we can do to prevent copying.//System.out.println(this + " to_any ");// Anys value may still be uninitialized if DynAny was initialized by TypeCode only// This changes the current position of dyn_any.// Make sure that our position isn't changed.// Remember the current position to restore it later//System.out.println(this + " comparing component " + i + "=" + components[i] +//                   " of type " + components[i].type().kind().value());//System.out.println("Not equal component " + i);// impossible, we checked the type codes already// Restore the current position of the other DynAnyimport LocalObjectimport org.omg.DynamicAny.DynAnyFactoryPackage.*// Returns the most derived DynAny type based on the Anys TypeCode.// DynAnyFactory interface methods// Returns the most derived DynAny type based on the TypeCode.// Needed for org.omg.CORBA.Object/* Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved. ... */import InvalidNameint NO_INDEX;byte STATUS_DESTROYABLE;// A DynAny is destroyable if it is the root of a DynAny hierarchy.byte STATUS_UNDESTROYABLE;// A DynAny is undestroyable if it is a node in a DynAny hierarchy other than the root.byte STATUS_DESTROYED;// A DynAny is destroyed if its root has been destroyed.Any any;// For complex types it is the streamed representation.// For primitive types it is the only representation.// It stores the DynAnys TypeCode.// An Any is used internally to implement the basic DynAny.byte status;// Destroyable is the default status for free standing DynAnys.createDefaultAnyOfType(...)ORBConstants.DYN_ANY_FACTORY_NAMEInvalidName innew RuntimeException(...)// which copies the Any.// Uses getAny() if this is our implementation, otherwise uses to_any()// Makes a copy of the Any value inside the parameter// Makes a copy of the Any parameterAny tempAnyisInitialized(...)// _REVISIT_ Nothing we can do about copying at this point// if this is not our implementation of DynAny.// To prevent this we would need another representation,// one where component DynAnys are initialized but not the component Anys.//System.out.println(this + " writeAny of type " + type().kind().value());// This clears the data part of the Any while keeping the TypeCode info.// If the passed Any does not contain a legal value// (such as a null string), the operation raises InvalidValue.import AnyImplisConsistentType(...)new InconsistentTypeCode(...)new DynSequenceImpl(...)new DynStructImpl(...)new DynArrayImpl(...)new DynUnionImpl(...)new DynEnumImpl(...)new DynFixedImpl(...)new DynValueImpl(...)new DynValueBoxImpl(...)new DynAnyBasicImpl(...)/* static Any extractAnyFromAny(TypeCode memberType, Any any, ORB orb) { ... */// Creates a default Any of the given type.insert_fixed(...)new BigDecimal(...)/* static Any setTypeOfAny(TypeCode typeCode, Any value) { ... *//* static Any copy(Any inAny, ORB orb) { ... */boolean isInitialized// before we changed it. See DynAnyConstructedImpl.equal for use.// This is a convenient method to reset the current component to where it wasdo ... while (...)rewind(...)//import org.omg.CORBA.ORBPackage.*;// DynFixed is constructed but not a subclass of DynAnyConstructedImpl//return (dynAny instanceof DynAnyConstructedImpl);// The spec for DynAny differs from Any on initialization via type code:// - false for boolean// - zero for numeric types// - zero for types octet, char, and wchar// - the empty string for string and wstring// - nil for object references// - a type code with a TCKind value of tk_null for type codes// - for Any values, an Any containing a type code with a TCKind value of tk_null//   type and no value// false for boolean// zero for numeric types// zero for types octet, char, and wchar// the empty string for string and wstring// Make sure that type code for bounded strings gets respected// Doesn't erase the type of bounded string// nil for object references// a type code with a TCKind value of tk_null for type codes// We can reuse the type code that's already in the any.// for Any values, an Any containing a type code with a TCKind value// of tk_null type and no value.// This is exactly what the default AnyImpl constructor provides.// _REVISIT_ Note that this inner Any is considered uninitialized.// There are no default value for complex types since there is no// concept of a hierarchy of Anys. Only DynAnys can be arrange in// a hierarchy to mirror the TypeCode hierarchy.// See DynAnyConstructedImpl.initializeComponentsFromTypeCode()// on how this DynAny hierarchy is created from TypeCodes.// Any is already initialized to null// if copy flag wasn't true we would be using our DynAny with// a foreign Any in it.// Returning simply the value of Any.isInitialized() is not enough.// The DynAny spec says that Anys containing null strings do not contain// a "legal value" (see ptc 99-10-07, 9.2.3.3)/* impossible */// Initializes components and anys representationgetBound(...)TypeCode contentTypeBAD_OPERATION e// from the internal TypeCode information with default values.createDefaultComponentAt(...)/* public void set_elements (org.omg.CORBA.Any[] value) ... */// If one or more elements have a type that is inconsistent with the DynArrays TypeCode,// Initializes the elements of the array.// DynArray interface methods// This typeCode is of kind tk_array.// _REVISIT_ Could use read_xxx_array() methods on InputStream for efficiency// but only for primitive typesimport org.omg.DynamicAny.DynAnyPackage.*int currentEnumeratorIndex;// This int and the any value are kept in sync at all times// The current position of a DynEnum is always -1.// to the first enumerator value indicated by the TypeCode.// Sets the current position to -1 and sets the value of the enumeratorint memberCountmemberCount(...)memberName(...)// Returns always 0 for DynEnum// such as a DynEnum or an empty exception, raises TypeMismatch.// Calling current_component on a DynAny that cannot have components,// Returns the value of the DynEnum as an IDL identifier.// DynEnum interface methods// for the corresponding enumerated type, the operation raises InvalidValue.// If value contains a string that is not a valid IDL identifier// whose IDL identifier is passed in the value parameter.// Sets the value of the DynEnum to the enumerated valueint newIndexcomputeCurrentEnumeratorIndex(...)// as they appear from left to right in the corresponding IDL definition.// Enumerators have ordinal values 0 to n-1,// Returns the value of the DynEnum as the enumerated values ordinal value.// If value contains a value that is outside the range of ordinal values// Sets the value of the DynEnum as the enumerated values ordinal value.// The any doesn't have to be initialized. We have a default value in this case.// _REVISIT_: Fix Me// Sets the current position to -1 and the value to zero.// DynFixed interface methods/* public int component_count() { ... */// other than leading or trailing white space, the operation raises TypeMismatch.// If val does not contain a valid fixed-point literal or contains extraneous characters// fractional digits are truncated and the return value is false.// If val has more fractional digits than can be represented in the DynFixed,// The return value is true if val can be represented as the DynFixed without loss of precision.// If val contains a value whose scale exceeds that of the DynFixed or is not initialized,// Either the integer part or the fraction part, but not both, may be missing.// The integer and fraction parts both must be sequences of decimal (base 10) digits.// a fraction part and an optional letter d or D.// It may consist of an integer part, an optional decimal point,// as used for IDL fixed-point literals.// The val string must contain a fixed string constant in the same format// Initializes the value of the DynFixed.int digitsint scaleboolean preservedPrecisionString stringtrim(...)String signint dIndexindexOf(...)String integerPartString fractionPartint currentScaleint currentDigitsint dotIndexBigDecimal resultBadKind excharAt(...)substring(...)new BigInteger(...)NumberFormatException nfeget_value(...)// First get rid of leading or trailing whitespace which is allowed// Now scan for the sign// Now get rid of the letter d or D.// Just to be sure// Now look for the dot to determine the integer part// Let's see if we have to drop some precision// truncate the fraction part// currentScale > 0// drop the fraction completely// integerPart.length() > digits// unable to truncate fraction part// Reinterpreted to mean raise InvalidValue only if the integer part exceeds precision,// which is handled above (integerPart.length() > digits)/* if (currentScale > scale) { ... */// Now check whether both parts are valid numbers// which the spec doesn't mention (it also doesn't forbid it).// But that would mean that an object that implements DynSequence also implements DynArray// _REVIST_ Could make this a subclass of DynArrayImpl// Sets the current position to -1 and creates an empty sequence.// Returns the current length of the sequence// DynSequence interface methods// current position is set to -1.// ?f the current position indicates a valid element and that element is removed, the// when the length is decreased, the current position remains unaffected.// ?f the current position indicates a valid element and that element is not removed// ?f the current position is -1 before decreasing the length, it remains at -1.// ?f the length of the sequence is set to zero, the current position is set to -1.// as follows:// The new current position after decreasing the length of a sequence is determined// without affecting the value of those elements that remain.// Decreasing the length of a sequence removes elements from the tail// raises InvalidValue.// Increasing the length of a bounded sequence to a value larger than the bound// the current position is not affected.// Otherwise, if the previous current position was not -1,// newly-added element if the previous current position was -1.// Increasing the length of a sequence sets the current position to the first// existing elements. Newly added elements are default-initialized.// adds new elements at the tail without affecting the values of already// Sets the length of the sequence. Increasing the length of a sequenceint boundint oldLengthDynAny[] newComponentsAny[] newAnysarraycopy(...)/* public void set_elements(org.omg.CORBA.Any[] value) ... */// to the element TypeCode of the DynSequence, the operation raises TypeMismatch.// If value contains one or more elements whose TypeCode is not equivalent// If the length of value exceeds the bound of a bounded sequence,// and to -1 if value is a zero-length sequence.// The current position is set to zero if value has non-zero length// The length of the DynSequence is set to the length of value.// Initializes the elements of the sequence.// This typeCode is of kind tk_sequence.// already done in the type code constructor// Writing the length first is the only difference to supers implementation// Increase length// Newly added elements are default-initialized// Decrease length//for (int i=len; i<oldLength; i++) {//    components[i].destroy();// ?f the current position indicates a valid element and that element is removed,// the current position is set to -1.// Length unchanged// Maybe components is now default initialized from type code// Methods differing from DynValues// For DynStruct, the operation sets the current position to -1DynAny discriminator;DynAny currentMember;// The currently active member, which is of the same type as the discriminator.// index either points to the discriminator or the named member is it exists.int currentMemberIndex;Any discriminatorAnydiscriminatorType(...)memberType(...)// of the union. That member is activated and (recursively) initialized to its default value.// The discriminator value is set to a value consistent with the first named member// Sets the current position to zero.memberLabel(...)// Convenience methodsTypeCode discriminatorTypeAny memberLabelint defaultIndexdefaultIndex(...)/** Returns the current discriminator value. */// DynUnion interface methods// component_count returns 2 in this case).// Otherwise the current position is set to 1 (has_no_active_member returns false and// (has_no_active_member returns true in this case).// this operation sets the current position to 0// If the discriminator value indicates a non-existent union member// by initializing the member to its default value.// with the new discriminator value (if there is a member for that value)// active member deactivates the member and activates the member that is consistent// Setting the discriminator to a value that is inconsistent with the currently// active union member does not affect the currently active member.// Setting the discriminator to a value that is consistent with the currently// to the TypeCode of the unions discriminator, the operation raises TypeMismatch.// If the TypeCode of the parameter is not equivalent// Sets the discriminator of the DynUnion to the specified value.Any newDiscriminatorAnyint newCurrentMemberIndex// default case raises TypeMismatch.// Calling set_to_default_member on a union that does not have an explicit// zero and causes component_count to return 2.// of the default case of a union; it sets the current position to// Sets the discriminator to a value that is consistent with the value// for explicit case labels raises TypeMismatch.// or on a union that uses the entire range of discriminator values// Calling set_to_no_active_member on a union that has an explicit default case// It sets the current position to zero and causes component_count to return 1.// to any of the unions case labels.// Sets the discriminator to a value that does not correspond// values for explicit case labels returns false.// Calling this operation on a union that uses the entire range of discriminator// Calling this operation on a union that has a default case returns false.// discriminator has a value that is not listed as an explicit case label).// (that is, the unions value consists solely of its discriminator because the// Returns true if the union has no active member// of the currently active member raises OBJECT_NOT_EXIST.// Using the returned reference beyond the life time// as the currently active member does not change.// Note that the returned reference remains valid only for as long// If the union has no active member, the operation raises InvalidValue.// Returns the currently active member.// Calling member_name on a union without an active member raises InvalidValue.// the operation returns an empty string.// If the unions TypeCode does not contain a member name for the currently active member,// Returns the name of the currently active member.// Returns the TCKind value of the TypeCode of the currently active member.// We can be sure that typeCode is of kind tk_union//System.out.println(this + " initializeComponentsFromTypeCode");// We can be sure that memberCount() > 0 according to the IDL language spec// Necessary to guarantee OBJECT_NOT_EXIST in member()// _REVISIT_ Could possibly optimize here if we don't need to initialize components// _REVISIT_ How does one check for "entire range of discriminator values"?// erase the discriminators value so that it does not correspond// to any of the unions case labels// DynValueBox methodsboolean isNull;// Returns TRUE if this object represents a null valuetype// DynValueCommon methods// Changes the representation to a null valuetype.// If this object represents a non-null valuetype, then this operation has no effect.// initialized to default values as in DynAnyFactory::create_dyn_any_from_type_code.// replaces it with a newly constructed value with its components// If this object represents a null valuetype then this operation// Required to raise InvalidValue if this is a null value type.// Methods differing from DynStruct// Overridden to change to non-null status.// Overridden methodsset_members(...)set_members_as_dyn_any(...)// the rest is done lazily// else: there is nothing to do// If we didn't get an exception then this must be a valid non-null valueimport BufferManagerReadimport BufferManagerReadGrowimport BufferManagerReadStreamimport BufferManagerWriteimport Message/** Creates read/write buffer managers to handle over/under flow ... */int GROW;int COLLECT;int STREAM;// These are only used for sending messages (so could be fragmenting)// We may want more criteria to be involved in this decision.// The next two methods allow creation of BufferManagers based on GIOP version.Message.CDR_ENC_VERSIONnew BufferManagerReadGrow(...)GIOPVersion.VERSION_1_0GIOPVersion.VERSION_1_1GIOPVersion.VERSION_1_2new BufferManagerReadStream(...)new INTERNAL(...)BufferManagerFactory.GROWCORBALogDomains.RPC_ENCODINGinvalidBuffMgrStrategy(...)BufferManagerFactory.COLLECTBufferManagerFactory.STREAMnew BufferManagerWriteGrow(...)new BufferManagerWriteCollect(...)new BufferManagerWriteStream(...)newBufferManagerWrite(...)getGIOPBuffMgrStrategy(...)/* Copyright (c) 2000, 2004, Oracle and/or its affiliates. All rights reserved. ... */// REVISIT - On the reading side, shouldn't we monitor the incoming// fragments on a given connection to determine what fragment size// they're using, then use that ourselves?// The stream reader can handle fragmented and// non fragmented messages// REVISIT - what is appropriate?import ByteBufferimport ByteBufferWithInfoimport FragmentMessage/** Case: Called from ReaderThread on complete message or fragments. ... *//** Case: called from CDRInputStream.grow. ... *//** Case: called from CDRInputStream constructor before unmarshaling. ... *//** Called once after creating this buffer manager and before ... *//** Returns the mark/reset handler for this stream. *//* Signals that the processing be cancelled. *//* Close BufferManagerRead and perform any oustanding cleanup. *///           BufferManagerReadBase.//           BufferManagerRead. Then, this class should extend//           BufferManagerReadBase which should implement// REVISIT - This should go in an abstract class calledunexpectedEof(...)Object streamMemento;// Mark and reset handler -------------------------RestorableInputStream inputStream;boolean markEngaged;createStreamMemento(...)// This will never happenrestoreInternalState(...)// Nothing to close and cleanup.// REVISIT - should we consider throwing an exception similar to what's//           done for underflow()???import ByteBufferPoolimport RequestCanceledExceptionnew BufferQueue(...)boolean receivedCancel;int cancelReqId;boolean endOfStream;// We should convert endOfStream to a final static dummy end nodeBufferQueue fragmentQueue;long FRAGMENT_TIMEOUT;//           interface.//           might ought to be an abstract class instead of an//           BufferManagerRead is an interface. BufferManagerRead// REVISIT - This should go in BufferManagerRead. But, sinceorb.transportDebugFlagByteBufferWithInfo bbwinew ByteBufferWithInfo(...)getHeaderLength(...)int bbAddressidentityHashCode(...)String strMsgdprint(...)enqueue(...)moreFragmentsToFollow(...)ByteBufferWithInfo resultnew RequestCanceledException(...)boolean interruptedendOfStream(...)bufferReadManagerTimeout(...)dequeue(...)result.fragmentedint bbAddrresult.byteBufferStringBuffer sb1String msg1bbwi.byteBufferByteBufferPool byteBufferPoolgetByteBufferPool(...)String msgreleaseByteBuffer(...)// ByteBufferPoool// Release any queued ByteBufferWithInfo's byteBuffers to theint inputBbAddressByteBufferWithInfo abbwiabbwi.byteBufferLinkedList$NodeListIterator<> itrlistIterator(...)// Mark and reset handler ----------------------------------------LinkedList<> fragmentStack;// the mark was engaged.// List of fragment ByteBufferWithInfos received since// Original state of the streamthis.inputStream// Collects fragments received since the mark was engaged.new LinkedList<>(...)addFirst(...)ListIterator<> iterpush(...)/* Copyright (c) 2000, 2009, Oracle and/or its affiliates. All rights reserved. ... */// print address of ByteBuffer being queued//System.out.println("ENTER underflow");// print address of ByteBuffer being dequeued// VERY IMPORTANT// Release bbwi.byteBuffer to the ByteBufferPool only if// this BufferManagerStream is not marked for potential restore.// print address of ByteBuffer being released//System.out.println("EXIT underflow");// release ByteBuffers on fragmentQueue// IMPORTANT: The fragment queue may have one ByteBuffer//            on it that's also on the CDRInputStream if//            this method is called when the stream is 'marked'.//            Thus, we'll compare the ByteBuffer passed//            in (from a CDRInputStream) with all ByteBuffers//            on the stack. If one is found to equal, it will//            not be released to the ByteBufferPool.// print address of ByteBuffer released// release ByteBuffers on fragmentStack// IMPORTANT: The fragment stack may have one ByteBuffer// Get the magic Object that the stream will use to// reconstruct it's state when reset is called// REVISIT - call to reset without call to mark// If we actually did peek across fragments, we need// to push those fragments onto the front of the// buffer queue.// Give the stream the magic Object to restore// it's state./** Defines the contract between the BufferManager and ... *//** Has the stream sent out any fragments so far? *//** Has the entire message been sent?  (Has ... *//** Returns the correct buffer size for this type of ... *//* Called from CDROutputStream.grow. ... *//** Called after Stub._invoke (i.e., before complete message has been sent). ... *//** A reference to the connection level stream will be required when ... */this.outputObject/** Close the BufferManagerWrite and do any outstanding cleanup. */Object outputObject;// become a GIOPOutputObject.// the rip-int-generic transition.  Should eventually// XREVISIT - Currently a java.lang.Object duringboolean sentFullMessage;import LinkedListimport BufferQueueimport MessageBaseimport CDROutputObjectimport Connectionimport OutputObject/** Collect buffer manager. */BufferQueue queue;boolean sentFragment;getGIOPFragmentSize(...)// queue, and allocate a new bbwi.// Set the fragment's "more fragments" bit to true, put it in theByteBufferWithInfo newBbwiFragmentMessage headercreateFragmentMessage(...)getMessageHeader(...)setFlag(...)Message.MORE_FRAGMENTS_BITnewBbwi.fragmentedsetByteBufferWithInfo(...)// Send all fragmentsIterator<> bufsConnection conngetConnection(...)getMessageMediator(...)getByteBufferWithInfo(...)writeLock(...)sendWithoutLock(...)writeUnlock(...)/** Close the BufferManagerWrite - do any outstanding cleanup. ... */new BufferManagerWriteCollectIterator(...)BufferManagerWriteCollect$BufferManagerWriteCollectIteratornew UnsupportedOperationException(...)// Set the fragment's moreFragments field to true// Enqueue the previous fragment// Create a new bbwi// XREVISIT - Downcast// Now we must marshal in the fragment header/GIOP header// REVISIT - we can optimize this by not creating the fragment message// each time.// Enqueue the last fragment// With the collect strategy, we must lock the connection// while fragments are being sent.  This is so that there are// no interleved fragments in GIOP 1.1.// Note that this thread must not call writeLock again in any// of its send methods!// Get a reference to ByteBufferPool so that the ByteBufferWithInfo// ByteBuffer can be released to the ByteBufferPool// Release ByteBufferWithInfo's ByteBuffer back to the pool// of ByteBuffers.// iterate thru queue and release any ByteBufferWithInfo's// ByteBuffer that may be remaining on the queue to the// ByteBufferPool.import ORBDataORBData orbDataint bufferSizeORBConstants.GIOP_DEFAULT_BUFFER_SIZEgetGIOPBufferSize(...)growBuffer(...)bbwi.fragmented/** Close the BufferManagerWrite and do any outstanding cleanup. ... *//* Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved. ... */// The code that once lived directly in CDROutputStream.grow()// has been moved ByteBufferWithInfo.growBuffer().// Grow ByteBufferWithInfo to a larger size.// Must be false for the grow caseimport ReplyMessage/** Streaming buffer manager. */int fragmentCount;sendFragment(...)SystemException seinvokeClientPIEndingPoint(...)ReplyMessage.SYSTEM_EXCEPTIONposition(...)bbwi.buflenlimit(...)// Sends the last fragment/* Copyright (c) 2000, 2010, Oracle and/or its affiliates. All rights reserved. ... */// Reuse the old buffer// REVISIT - need to account for case when needed > available// even after fragmenting.  This is the large array case, so// the caller should retry when it runs out of space.// REVISIT: need an ORB//System.out.println("sendFragment: last?: " + isLastFragment);// Send the fragment// XREVISIT - Should be in orbutil or package private/** Simple unsynchronized queue implementation for ByteBufferWithInfos. */LinkedList<> list;addLast(...)removeFirst(...)// of the queue.// Adds the given ByteBufferWithInfo to the front// ByteBuffer limit().// which length is used in this object, this.buflen is actually the// Although, a ByteBuffer's length is it's capacity(), the context in// any time there's a call to this class's position().// position in the buffer, the ByteBuffer's position is updated// data. Also, since the index variable tracks the current empty// index variable and the ByteBuffer's limit points to the end of the// Assumptions, the ByteBuffer's position is set by the constructor's// Notes about the class.// REVISIT - index should eventually be replaced with byteBuffer.position()ByteBuffer byteBuffer;// REVISIT - CHANGE THESE TO PRIVATE// Current empty position in buffer.int buflen;// Marshal buffer.int needed;// Total length of buffer. // Unnecessary...boolean fragmented;// How many more bytes are needed on overflow.// Did the overflow operation fragment?this.orb.transportDebugFlagthis.byteBufferthis.buflenthis.neededthis.fragmented// See EncapsOutputStream for additional information.// byte buffers. Hence, the reason for the boolean 'usePooledByteBuffers'.// EncapsOutputStream's is the only one that does not use pooled// Right now, EncapsOutputStream's do not use pooled byte buffers.getBufferSize(...)getByteBuffer(...)String msgStrallocate(...)// Shallow copy constructorbbwi.orbbbwi.debugbbwi.needed// So IIOPOutputStream seems more intuitive// accessor to buflen// get position in this buffer// set position in this buffer// mutator to buflen// Grow byteBuffer to a size larger than position() + neededint newLength... * ...ByteBuffer newBBint newbbAddressString msgStr2StringBuffer str// print address of ByteBuffer gotten from pool// don't allocate from pool, allocate non-direct ByteBuffer// REVISIT - This should be changed to return the//           value of byteBuffer.position() rather//           than this.index. But, byteBuffer.position//           is manipulated via ByteBuffer writes, reads,//           gets and puts. These locations need to be//           investigated and updated before//           byteBuffer.position() can be returned here.// return byteBuffer.position();// REVISIT - This should be changed to set only the//           value of byteBuffer.position rather//           than this.index. This change should be made//           in conjunction with the change to this.position().// This code used to live directly in CDROutputStream.grow.// Recall that the byteBuffer size is 'really' the limit or// buflen.// print address of ByteBuffer just gotten// return 'old' byteBuffer reference to the ByteBuffer pool// update the byteBuffer with a larger ByteBuffer// limit and buflen must be set to newLength.import CodeBaseimport InputObjectimport CorbaConnectionimport BufferManagerFactoryimport CodeSetComponentInfoimport OMGSystemException/** @author */CorbaConnection corbaConnection;Message header;boolean unmarshaledHeader;OMGSystemException omgWrapper;getSize(...)isLittleEndian(...)getGIOPVersion(...)getEncodingVersion(...)newBufferManagerRead(...)this.corbaConnectionthis.omgWrappergetBufferManager(...)this.headersetIndex(...)Message.GIOPMessageHeaderLengthsetBufferLength(...)// *before* the message mediator is available.// However, giop input needs to get code set info from the connetion// This connection normally is accessed from the message mediator.// REVISIT - think about this some more.// directly?// have the information stored in the message mediator// message mediator?  Or should we not have a header and// XREVISIT - Should the header be kept in the stream or the/** Unmarshal the extended GIOP header ... */(...).transportDebugFlagRuntimeException e/** Override the default CDR factory behavior to get the ... */CodeSetConversion.BTCConverterCodeSetComponentInfo.CodeSetContextCodeSetContext codesetsgetCodeSets(...)OSFCodeSetRegistry.EntryEntry charSetlookupEntry(...)getCharCodeSet(...)createCharBTCConverter(...)unknownCodeset(...)getBTCConverter(...)impl(...)Entry wcharSetgetWCharCodeSet(...)isServer(...)noClientWcharCodesetCtx(...)noServerWcharCodesetCmp(...)OSFCodeSetRegistry.UTF_16// are illegal.// yet, then we use ISO8859-1 for char/string and wchar/wstring// If the connection doesn't have negotiated code sets// local code sets, otherwise get them from the connection.// If we're local and don't have a Connection, use theCodeSetComponentInfo.LOCAL_CODE_SETSgetCodeSetContext(...)getCodeBase(...)//     }//         this.unmarshaledHeader = stream.unmarshaledHeader;//         this.msg = stream.msg;//         this.conn = stream.conn;//         super(stream);//     private XIIOPInputStream(XIIOPInputStream stream) {// XREVISIT// -----------------------------------------------------------// these issues in the future.// from the old stream.  We must find ways to address// Below this point are commented out methods with features/* Copyright (c) 2001, 2004, Oracle and/or its affiliates. All rights reserved. ... */// Unmarshal the extended GIOP message from the buffer.// If the connection doesn't have its negotiated// code sets by now, fall back on the defaults defined// in CDRInputStream.// code sets by now, we have to throw an exception.// See CORBA formal 00-11-03 13.9.2.6.// For GIOP 1.2 and UTF-16, use big endian if there is no byte// order marker.  (See issue 3405b)// For GIOP 1.1 and UTF-16, use the byte order the stream if// there isn't (and there shouldn't be) a byte order marker.// GIOP 1.0 doesn't have wchars.  If we're talking to a legacy ORB,// we do what our old ORBs did.// return new XIIOPInputStream(this);// End of file.import MessageMediator/** This is delegates to the real implementation. ... */CorbaMessageMediator messageMediator;CDRInputStreamBase impl;CDRInputStream$InputStreamFactory// to create a concrete CDR delegate based on the GIOP version.// We can move this out somewhere later.  For now, it serves its purposenew CDRInputStream_1_0(...)new CDRInputStream_1_1(...)new IDLJavaSerializationInputStream(...)new CDRInputStream_1_2(...)unsupportedGiopVersion(...)// REVISIT.// Probably also required by ServerRequestImpl.// not be initialized in this case.// connection with no warning.  Note that the stream will// created with a SystemException due to a dead server/closed// Required for the case when a ClientResponseImpl isis.implnewInputStream(...)// org.omg.CORBA.portable.InputStreamread_boolean_array(...)read_char_array(...)read_wchar_array(...)read_octet_array(...)read_short_array(...)read_ushort_array(...)read_long_array(...)read_ulong_array(...)read_longlong_array(...)read_ulonglong_array(...)read_float_array(...)read_double_array(...)read_Context(...)// org.omg.CORBA_2_3.portable.InputStream// com.sun.corba.se.impl.encoding.MarshalInputStreamconsumeEndian(...)getPosition(...)// org.omg.CORBA.DataInputStreamread_Abstract(...)read_Value(...)read_any_array(...)// org.omg.CORBA.portable.ValueBase_truncatable_ids(...)// java.io.InputStreamskip(...)available(...)mark(...)reset(...)markSupported(...)// Needed by TCUtilitysetByteBuffer(...)/** return true if our ByteBuffer is sharing/equal to bb */getBufferLength(...)getIndex(...)// have to do this.// which wants to read values.  Thus, TypeCodeInputStream doesn't// This should be overridden by any stream (ex: IIOPInputStream)// performed.// Use Latin-1 for GIOP 1.0 or when code set negotiation was notOSFCodeSetRegistry.ISO_8859_1// make the class and this method abstract because of dup().// Subclasses must decide what to do here.  It's inconvenient to// Prints the current buffer in a human readable formprintBuffer(...)/** Aligns the current position on the given octet boundary ... */alignOnBoundary(...)// Needed by request and reply messages for GIOP versions >= 1.2 only.setHeaderPadding(...)/** This must be called after determining the proper ORB version, ... */performORBVersionSpecificInit(...)/** Resets any internal references to code set converters. ... */resetCodeSetConverters(...)this.messageMediator// ValueInputStream -----------------------------start_value(...)end_value(...)// else fall through and report exception.// In the case of SystemExceptions, a stream is created// with its default constructor (and thus no impl is set)./** Describes CDRInputStream delegates and provides some ... */CDRInputStream parent;this.parentnew NO_IMPLEMENT(...)//     public abstract void close() throws IOException;//     public abstract int available() throws IOException;//     public abstract long skip(long n) throws IOException;//     public abstract int read(byte b[], int off, int len) throws IOException//     public abstract int read(byte b[]) throws IOException;// Right now, they'll go up to the java.io versions!// REVISIT - should we make these throw UnsupportedOperationExceptions?// Object obj1b = is.readObject();// is.reset();// Object obj1a = is.readObject();// is.mark(10000);// like expect obj1a == obj1b in the following code:// custom marshaling code.  This is necessary since they could do things// don't have any guarantees that mark/reset will work in their// This should return false so that outside users (people using the JDK)// Needed by AnyImpl and ServiceContexts// Needed by TypeCodeImpl// Needed by IIOPInputStream and other subclasses// ValueInputStream -------------------------import MalformedURLExceptionimport InvocationTargetExceptionimport PrivilegedExceptionActionimport PrivilegedActionExceptionimport ValueBaseimport IndirectionExceptionimport CustomMarshalimport BoxedValueHelperimport ValueFactoryimport CustomValueimport StreamableValueimport IDLEntityimport Tieimport ValueHandlerimport CorbaClientDelegateimport PresentationManagerimport PresentationDefaultsimport PrincipalImplimport CORBAObjectImplimport RepositoryIdimport RepositoryIdInterfaceimport RepositoryIdUtilityimport CacheTableimport ValueHelperString kReadMethod;int maxBlockLength;BufferManagerRead bufferManagerRead;ByteBufferWithInfo bbwi;// used if the ORB is null.// Set to the ORB's transportDebugFlag value.  This value isboolean littleEndian;ValueHandler valueHandler;CacheTable valueCache;// Value cacheCacheTable repositoryIdCache;// Repository ID cacheCacheTable codebaseCache;// codebase cacheint blockLength;// Length of current chunk, or a large positive number if not in a chunk// private Stack currentStack = null;// Current Class Stack (repository Ids of current class being read)int end_flag;// Read end flag (value nesting depth)int chunkedValueNestingLevel;// older ORBs.// the old computation around for interoperability with our// when computing the nesting level.  However, we still need// only enclosing chunked valuetypes are taken into account// Beginning with the resolution to interop issue 3526 (4328?),int valueIndirection;// before calling ValueFactory.read_value// Int used by read_value(Serializable) that is set by this class// private boolean outerValueDone = true;// Indicates whether we are inside a value// private boolean inBlock = false;// In block flag// private int checkForNullBlock = -1;// Flag used to determine whether blocksize was zeroint stringIndirection;// offset of the string length field back to the caller// Int set by readStringOrIndirection to communicate the actualboolean isChunked;// Flag indicating whether we are unmarshalling a chunked valueRepositoryIdUtility repIdUtil;// Repository ID handlersRepositoryIdStrings repIdStrs;CodeSetConversion.BTCConverter charConverter;// Code set converters (created when first needed)CodeSetConversion.BTCConverter wcharConverter;boolean specialNoOptionalDataState;// calls end_value after the readObject method exits.// to readObject.  The state is cleared when the ValueHandler// so that the ValueHandler can give the correct exception// we must throw a MARSHAL with the special minor code// Serializable's readObject method tries to read anything,// that there is no more optional data available.  If the// RMI-IIOP stream format version 2 case in which we know// Template methodCDRInputStreamBase resultnewInstance(...)couldNotDuplicateCdrInputStream(...)this.bbwi.byteBufferthis.bbwi.buflenthis.littleEndianthis.bufferManagerReadthis.bbwi(...).bbwi(...).bbwi.byteBuffer/** NOTE:  size passed to init means buffer size */this.markAndResetHandlergetMarkAndResetHandler(...)// See description in CDRInputStreamcreateRepositoryIdHandlers(...)getRepIdUtility(...)GIOPVersion.V1_0// Illegal for GIOP versions < 1.2.// Called by Request and Reply message. Valid for GIOP versions >= 1.2 only.giopVersionError(...)int incrboolean checkForEndTagint requiredNumBytescomputeAlignment(...)rmiiiopOptionalDataIncompatible1(...)get_offset(...)start_block(...)chunkOverflow(...)rmiiiopOptionalDataIncompatible2(...)int nextLongrmiiiopOptionalDataIncompatible3(...)int alignResultcheckBlockLength(...)grow(...)// This can be overridden....underflow(...)// Marshal primitives.// No such type in javalongDoubleNotImplemented(...)alignAndCheck(...)getConvertedChars(...)getCharConverter(...)int b1int b2isForeignORB(...)wcharDataInGiop10(...)... << ...byte b... | ...int b3int b4int bufPoslong i1long i2negativeStringLength(...)int lencheckForNegativeLength(...)internalReadString(...)char[] resultnew String(...)getNumChars(...)readStringOrIndirection(...)char[] cnew char[]int nnullParam(...)int availint bytesint wantedbyte[] pvaluenew byte[]Principal pnew PrincipalImpl(...)TypeCodeImpl tcMARSHAL exdprintThrowable(...)//    stub factory.// 3. If clz is an interface, use it to create the appropriate//    IDLEntity.class.isAssignableFrom( clz ).//    In addition, clz is a IDL stub class iff//    clz is a stub class iff StubAdapter.isStubClass( clz ).// 2. If clz is a stub class, just use it as a static factory.// 1. If clz==null, just use the repository ID from the stub// This functions as follows:// that is statically expected."// Class or the "Class object for the RMI/IDL interface type// The clz argument to read_Object can be either a stub// IDL to Java ptc-00-01-08 1.21.4.1// ------------ RMI related methods --------------------------IOR iorPresentationManager.StubFactoryFactoryStubFactoryFactory sffgetStubFactoryFactory(...)String codeBasegetCodebase(...)getProfile(...)PresentationManager.StubFactoryStubFactory stubFactoryisNil(...)RepositoryId ridRepositoryId.cachegetTypeId(...)String classNamegetClassName(...)boolean isIDLInterfaceisIDLType(...)validateIORClass(...)createStubFactory(...)isStubClass(...)makeStaticStubFactory(...)boolean isIDLisAssignableFrom(...)IDLEntity.classgetClassLoader(...)internalIORToObject(...)/* This is used as a general utility (e.g., the PortableInterceptor ... */Object servantgetServant(...)CorbaClientDelegate delmakeClientDelegate(...)Object objrefString codebaseloadStub(...)readObjectException(...)badServantReadObject(...)makeStub(...)Throwable estubCreateError(...)new CORBAObjectImpl(...)setDelegate(...)boolean objectint indirectioncontainsVal(...)Serializable cachedValuegetKey(...)new IndirectionException(...)readRepositoryIds(...)/** Examines the valuetag to see how many (if any) repository IDs ... */getTypeInfo(...)RepositoryIdUtility.NO_TYPE_INFOget_id(...)expectedTypeNullAndNoRepId(...)createForAnyType(...)RepositoryIdUtility.SINGLE_REP_TYPE_INFOread_repositoryId(...)RepositoryIdUtility.PARTIAL_LIST_TYPE_INFOread_repositoryIds(...)badValueTag(...)toHexString(...)int vTypereadValueTag(...)boolean saveIsChunkedObject valueString codebase_URLString repositoryIDStringhandleIndirection(...)isChunkedEncoding(...)isCodeBasePresent(...)read_codebase_URL(...)getWStringValueRepId(...)getClassDescValueRepId(...)readClass(...)Class<> valueClassgetClassFromString(...)couldNotFindClass(...)new ClassNotFoundException(...)readIDLValue(...)readValue(...)SystemException sysExvaluehandlerReadException(...)Error evaluehandlerReadError(...)handleEndOfValue(...)readEndTag(...)new CacheTable(...)getHelper(...)readIDLValueWithHelper(...)get_type(...)VM_CUSTOM.valuebadKind(...)// header information itself.// Therefore, it is not a truly independent read call that handles// read_value(String repositoryId).// This method is actually called indirectly byunmarshal(...)ValueFactory factorygetFactory(...)String codebasesString classRepIdClass<> clRepositoryIdInterface repositoryIDgetFromString(...)getClassFromType(...)ClassNotFoundException cnfecnfeReadClass(...)MalformedURLException memalformedUrl(...)Method readMethodObject valInputStream.classget_class(...)NoSuchMethodException nsmeObject resultInstantiationException iecouldNotInstantiateHelper(...)IllegalAccessException iaeisCustomType(...)Object[] argsIllegalAccessException iae2couldNotInvokeHelperReadMethod(...)InvocationTargetException iteClassLoader clazzLoaderClass<> helperClassloadClassForClass(...)new PrivilegedExceptionAction<>(...) { ... }CDRInputStream_1_0$1PrivilegedActionException paegetException(...)MARSHAL marshalStreamableValue.classCustomValue.classValueBase.classBoxedValueHelper helperreadBoxedIDLEntity(...)/** End tags are only written for chunked valuetypes. ... */int anEndTagpositiveEndTag(...)unexpectedEnclosingValuetype(...)// in position to read the end tag.// After calling this method, if we are chunking, we should be// unmarshalling code read.// at the right place in the stream, no matter how little the// Makes sure that if we were reading a chunked value, we end upend_block(...)couldNotSkipBytes(...)skipToOffset(...)badChunkLength(...)// ------------ End RMI related methods --------------------------//         return bbwi.buflen - bbwi.position();//     public int available() throws IOException {//      return bbwi.position() == bbwi.buflen;//     public final boolean isAtEnd() {/** Are we at the end of the input stream? */// CDRInputStream state management.//--------------------------------------------------------------------//int numRepIdscontainsOrderedVal(...)unableToLocateRepIdArray(...)String repIDString resultbadRepIdIndirection(...)badCodebaseIndirection(...)/* DataInputStream methods */seq.valueStringBuffer bufferread_fixed_buffer(...)badFixed(...)insert(...)// This method is unable to yield the correct scale.// is 0xD for negative numbers and 0xC for positive and zero values.// The sign configuration, in the last half-octet of the representation,// is in the second half-octet.// Otherwise, this first half-octet is all zero, and the first digit// begins with the first (most significant) digit.// If the fixed type has an odd number of decimal digits, then the representation// Each octet contains (up to) two decimal digits.byte doubleDigitint firstDigitint secondDigitboolean wroteFirstDigitboolean more... >> ...forDigit(...)...[] _ids;/* for debugging */char[] charBufint xint kString hexisPrintable(...)Throwable tByteBuffer resultMarkAndResetHandler markAndResetHandler;// Mark and reset -------------------------------------------------CDRInputStream_1_0$StreamMementoint blockLength_;// the stream position, so we need to save them.// These are the fields that may change after markingint end_flag_;int chunkedValueNestingLevel_;int valueIndirection_;int stringIndirection_;boolean isChunked_;ValueHandler valueHandler_;ByteBufferWithInfo bbwi_;boolean specialNoOptionalDataState_;new StreamMemento(...)StreamMemento memmem.blockLength_mem.end_flag_mem.chunkedValueNestingLevel_mem.valueIndirection_mem.stringIndirection_mem.isChunked_mem.valueHandler_mem.specialNoOptionalDataState_mem.bbwi_// is actually used.// instance in IIOPInputStream, the only subclass where this// a CodeBase.  This ultimately allows us to grab a Connection// Provides a hook so subclasses of CDRInputStream can provide// ---------------------------------- end Mark and Reset/** Attempts to find the class described by the given ... */ClassNotFoundException cnfeOuterimplementation(...)ClassNotFoundException cnfeInnerMalformedURLException mue// Utility method used to get chars from bytesbyte[] tmpBufgetChars(...)hasArray(...)array(...)byte[] bytesbytes.lengthcreateWCharBTCConverter(...)int neededcustomWrapperIndirection(...)customWrapperWithCodebase(...)customWrapperNotSingleRepid(...)MessageMediator messageMediatorCDROutputObject outputObjgetOutputObject(...)isSharing(...)/* Copyright (c) 1997, 2017, Oracle and/or its affiliates. All rights reserved. ... */// To ensure we keep bbwi.byteBuffer.limit in sync with bbwi.buflen.// Since chunks can end at arbitrary points (though not within// primitive CDR types, arrays of primitives, strings, wstrings,// or indirections),// we must check here for termination of the current chunk.// we must throw a MARSHAL exception with the special minor code// Are we at the end of the current chunk?  If so,// try to interpret the next long as a chunk length.// (It has to be either a chunk length, end tag,// or valuetag.)// If it isn't a chunk length, blockLength will// remain set to maxBlockLength.// What's next is either a valuetag or// an end tag.  If it's a valuetag, we're// probably being called as part of the process// to read the valuetag.  If it's an end tag,// then there isn't enough data left in// this valuetype to read!// Are we already past the end of the current chunk?// This is always an error.// If what's next on the wire isn't a chunk length or// what we want to read (which can't be split across chunks)// won't fit in the current chunk, throw this exception.// This probably means that we're in an RMI-IIOP// Serializable's readObject method or a custom marshaled// IDL type is reading too much/in an incorrect order// REVISIT - We should look at using the built in advancement//           of using ByteBuffer.get() rather than explicitly//           advancing the ByteBuffer's position.//           This is true for anywhere we are incrementing//           the ByteBuffer's position.// It was an end tag, so there wasn't enough data// left in the valuetype's encoding on the wire// to read what we wanted// WARNING: Must compute real alignment after calling// checkBlockLength since it may move the position// Don't allow transmission of wchar/wstring data with// foreign ORBs since it's against the spec.// If we're talking to one of our legacy ORBs, do what// they did:// Check for indirection// Workaround for ORBs which send string lengths of// zero to mean empty string.// IMPORTANT: Do not replace 'new String("")' with "", it may result// in a Serialization bug (See serialization.zerolengthstring) and// bug id: 4728756 for details// Skip over the 1 byte null// skip the two null terminator bytes// bbwi.position(bbwi.position() + 2);// Must call alignAndCheck at least once to ensure// we aren't at the end of a chunk.  Of course, we// should only call it if we actually need to read// something, otherwise we might end up with an// exception at the end of the stream.// Microbenchmarks are showing a loop of ByteBuffer.get(int) being// faster than ByteBuffer.get(byte[], int, int).// read off the typecode// REVISIT We could avoid this try-catch if we could peek the typecode// kind off this stream and see if it is a tk_value.  Looking at the// code we know that for tk_value the Any.read_value() below// ignores the tc argument anyway (except for the kind field).// But still we would need to make sure that the whole typecode,// including encapsulations, is read off.// We can be sure that the whole typecode encapsulation has been// read off.// read off the value of the any// In any case, we must first read the IOR.// Could not create stubFactory, so use null.// XXX stubFactory handling is still too complex:// Can we resolve the stubFactory question once in// a single place?// clz is an interface class// If we managed to load a stub, return it, otherwise we// must fail...// Return the "default" stub...// In RMI-IIOP the ValueHandler will recognize this// exception and use the provided indirection value// to lookup a possible indirection to an object// currently on the deserialization stack.// Throw an exception if we have no repository ID info and// no expectedType to work with.  Otherwise, how would we// know what to unmarshal?// Read value tag// Is value null?// Is this an indirection to a previously// read valuetype?// Save where this valuetype started so we// can put it in the indirection valueCache// later// Need to save this special marker variable// to restore its value during recursion// Read repository id(s)// If isChunked was determined to be true based// on the valuetag, this will read a chunk length// Remember that end_flag keeps track of all nested// valuetypes and is used for older ORBs// read in the class whether with the old ClassDesc or the// new one// By this point, either the expectedType or repositoryIDString// is guaranteed to be non-null.// No point attempting to use value handler below, since the// class information is not available.// Must be some form of RMI-IIOP valuetype// Just rethrow any CORBA system exceptions// that come out of the ValueHandler// Skip any remaining chunks until we get to// an end tag or a valuetag.  If we see a valuetag,// that means there was another valuetype in the sender's// version of this class that we need to skip over.// Read and process the end tag if we're chunking.// Assumes that we're at the position of the end tag// (handleEndOfValue should assure this)// Cache the valuetype that we read// Allow for possible continuation chunk.// If we're a nested valuetype inside of a chunked// valuetype, and that enclosing valuetype has// more data to write, it will need to have this// new chunk begin after we wrote our end tag.// value is null// Indirection tag// end_block();// Read repository id// Compare rep. ids to see if we should use passed helper// for callback// Put into valueCache// allow for possible continuation chunk// Put into valueCache using valueIndirection// if (inBlock)//    end_block();// Pre-Merlin/J2EE 1.3 ORBs wrote the repository ID// and codebase strings in the wrong order.// look for two-argument static read method// must be boxed value helper// found two-argument read method, so must be non-boxed value...// ...create a blank instance// Value's constructor is protected or private// So, use the helper to read the value.// NOTE : This means that in this particular case a recursive ref.// would fail.// add blank instance to cache table// if custom type, call unmarshal method// call two-argument read method using reflection// getDeclaredMethod requires RuntimePermission accessDeclaredMembers// if a different class loader is used (even though the javadoc says otherwise)// this gets caught below// Always try to find a ValueFactory first, as required by the spec.// There are some complications here in the IDL 3.0 mapping (see 1.13.8),// but basically we must always be able to override the DefaultFactory// or Helper mappings that are also used.  This appears to be the case// even in the boxed value cases.  The original code only did the lookup// in the case of class implementing either StreamableValue or CustomValue,// but abstract valuetypes only implement ValueBase, and really require// the use of the repId to find a factory (including the DefaultFactory).// use new-style OBV support (factory object)// XXX log marshal at one of the INFO levels// Could not get a factory, so try alternatives// use old-style OBV support (helper object)// must be a boxed IDLEntity, so make a reflective call to the// helper's static read method...// If there was no error in getting the factory, use it.// Read the end tag// End tags should always be negative, and the outermost// enclosing chunked valuetype should have a -1 end tag.// handleEndOfValue should have assured that we were// at the end tag position!// If the ORB is null, or if we're sure we're talking to// a foreign ORB, Merlin, or something more recent, we// use the updated end tag computation, and are more strenuous// about the values.// If the end tag we read was less than what we were expecting,// then the sender must think it's sent more enclosing// chunked valuetypes than we have.  Throw an exception.// If the end tag is bigger than what we expected, but// still negative, then the sender has done some end tag// compaction.  We back up the stream 4 bytes so that the// next time readEndTag is called, it will get down here// again.  Even with fragmentation, we'll always be able// to do this.// When talking to Kestrel or Ladybird, we use our old// end tag rules and are less strict.  If the end tag// isn't what we expected, we back up, assuming// compaction.// This only keeps track of the enclosing chunked// valuetypes// This keeps track of all enclosing valuetypes// if (outerValueDone)// if called from alignAndCheck, need to reset blockLength// to avoid an infinite recursion loop on read_long() call// Must remember where we began the chunk to calculate how far// along we are.  See notes above about chunkBeginPos.// _REVISIT_ unsafe, should use a Java long// inBlock = true;// System.out.println("start_block snooped a " + Integer.toHexString(blockLength));// not a chunk length field// If we're not chunking, we don't have to worry about// skipping remaining chunks or finding end tags// Skip any remaining chunks// Now look for the end tag// This is a little wasteful since we're reading// this long up to 3 times in the worst cases (once// in start_block, once here, and once in readEndTag// Peek next long// We did find an end tag, so we're done.  readEndTag// should take care of making sure it's the correct// end tag, etc.  Remember that since end tags,// chunk lengths, and valuetags have non overlapping// ranges, we can tell by the value what the longs are.// A custom marshaled valuetype left extra data// on the wire, and that data had another// nested value inside of it.  We've just// read the value tag or null of that nested value.// In an attempt to get by it, we'll try to call// read_value() to get the nested value off of// the wire.  Afterwards, we must call handleEndOfValue// recursively to read any further chunks that the containing// valuetype might still have after the nested// value.// This probably means that the code to skip chunks has// an error, and ended up setting blockLength to something// other than maxBlockLength even though we weren't// starting a new chunk.// if in a chunk, check for underflow or overflow// Chunk ended correctly// Skip over anything left by bad unmarshaling code (ex:// a buggy custom unmarshaler).  See handleEndOfValue.// outerValueDone = false;// Read # of repository ids// read first array element and store it as an indirection to the whole array// read and ignore the subsequent array elements, but put them in the// indirection table in case there are later indirections back to them// Indirection// digits isn't really needed here// positive number or zero// zero// positive number// done// negative number// For every 16 bytes, there is one line// of output.  First, the hex output of// the 16 bytes with each byte separated// by a space.// Add any extra spaces to align the// text column in case we didn't end// at 16// Now output the ASCII equivalents.  Non-ASCII// characters are shown as periods.// Number of bytes to skip// First try to load the class locally, then use// the provided URL (if it isn't null)// class cannot be loaded remotely.// Get a URL from the remote CodeBase and retry// Don't bother trying to find it locally again if// we got a null URL// Failed to load the class// Always report a bad URL// First try to load the class locally// Try to load the class using the provided// codebase URL (falls out below)// Try to load the class using a URL from the// remote CodeBase// Don't bother if the codebaseURL is null// Will ultimately return null if all three// attempts fail, but don't do anything here.// If we get here, we have failed to load the class// REVISIT - Look at CodeSetConversion.BTCConverter to see//           if it can work with an NIO ByteBuffer. We should//           avoid getting the bytes into an array if possible.// To be honest, I doubt this saves much real time// If the entire string is in this buffer,// just convert directly from the bbwi rather than// allocating and copying.// Microbenchmarks are showing a loop of ByteBuffer.get(int)// being faster than ByteBuffer.get(byte[], int, int).// Stretches across buffers.  Unless we provide an// incremental conversion interface, allocate and// copy the bytes.// Stream needs to go into a state where it// throws standard exception until end_value// is called.  This means the sender didn't// send any custom data.  If the reader here// tries to read more, we need to throw an// exception before reading beyond where// we're supposed to// One should never indirect to a custom wrapper// REVISIT - Could verify repository ID even though// it isn't used elsewhere// Note: isChunked should be true here.  Should have// been set to true in the containing value's read_value// Note that isChunked should still be true here.// If the containing valuetype is the highest// chunked value, it will get set to false// at the end of read_value.// tell BufferManagerRead to release any ByteBuffers// It's possible bbwi.byteBuffer is shared between// this InputStream and an OutputStream. Thus, we check// if the Input/Output streams are using the same ByteBuffer.// If they sharing the same ByteBuffer we need to ensure only// one of those ByteBuffers are released to the ByteBufferPool.// Set OutputStream's ByteBuffer and bbwi to null// so its ByteBuffer cannot be released to the pool// release this stream's ByteBuffer to the poolint fragmentOffset;// See notes in CDROutputStreamGIOPVersion.V1_1(...).fragmentOffsetthis.fragmentOffsetint alignmentint oldSizefragmentationOccured(...)CDRInputStream_1_1$FragmentableStreamMemento// Mark/reset ---------------------------------------int fragmentOffset_;new FragmentableStreamMemento(...)(...).fragmentOffset_// --------------------------------------------------getWCharConverter(...)btcResultMoreThanOneChar(...)// Some other ORBs may have found a way to send 1.1// fragments which put alignment bytes at the end// of a fragment// We must recalculate the alignment after a possible// fragmentation since the new bbwi.position() (after the header)// may require a different alignment.// Save the size of the current buffer for// possible fragmentOffset calculation// By this point we should be guaranteed to have// a new fragment whose header has already been// unmarshalled.  bbwi.position() should point to the// end of the header.// Clear the flag// In GIOP 1.1, interoperability with wchar is limited// to 2 byte fixed width encodings.  CORBA formal 99-10-07 15.3.1.6.// WARNING:  For UTF-16, this means that there can be no// byte order marker, so it must default to big endian!// Because of the alignAndCheck, we should be guaranteed// 2 bytes of real data.// Did the provided bytes convert to more than one// character?  This may come up as more unicode values are// assigned, and a single 16 bit Java char isn't enough.// Better to use strings for i18n purposes.// Don't include the two byte null for the// following computations.  Remember that since we're limited// to a 2 byte fixed width code set, the "length" was the// number of such 2 byte code points plus a 2 byte null.// Skip over the 2 byte nullboolean headerPadding;// message, there is no header padding, in the unfragmented case.// padded appropriately. However, if there is no body to a request or reply// the body must be aligned on an 8-octet boundary, and so the header is// Indicates whether the header is padded. In GIOP 1.2 and above,boolean restoreHeaderPadding;// used to remember headerPadding flag when mark() and restore() are used.// Called by RequestMessage_1_2 or ReplyMessage_1_2 classes only.this.headerPadding// headerPadding flag.// the mark and reset methods have been overridden to remember the// inherits the headerPadding flag, in case of GIOP 1.2 and above, streams.// This method has been overriden to ensure that the duplicated stream(...).headerPaddingint alignIncrORBConstants.GIOP_12_MSG_BODY_ALIGNMENTint numBytes// headerPadding bit is set by read method of the RequestMessage_1_2// or ReplyMessage_1_2 classes. When set, the very first body read// operation (from the stub code) would trigger an alignAndCheck// method call, that would in turn skip the header padding that was// inserted during the earlier write operation by the sender. The// padding ensures that the body is aligned on an 8-octet boundary,// for GIOP versions 1.2 and beyond.// In GIOP 1.2, a fragment may end with some alignment// padding (which leads to all fragments ending perfectly// on evenly divisible 8 byte boundaries).  A new fragment// never requires alignment with the header since it ends// on an 8 byte boundary.// In GIOP 1.2, a wchar is encoded as an unsigned octet length// followed by the octets of the converted wchar.// In GIOP 1.2, wstrings are not terminated by a null.  The// length is the number of octets in the converted format.// A zero length string is represented with the 4 byte length// value of 0.import CorbaOutputObjectimport ServiceContextsimport CDROutputStream_1_0CorbaConnection connection;// REVISIT - only used on sendCancelRequest.shouldUseDirectByteBuffers(...)setOutputObject(...)this.corbaMessageMediator// Used in msgtypes test.// Used in SharedCDR (i.e., must be grow).// NOTE:// Used for needs addressing mode.// Used on sendCancelRequest.// REVISITthis.connection// REVISIT - make protected once all encoding together// Another possibility: merge header and message mediator.// Header should only be in message mediator.sendMessage(...)/** Write the contents of the CDROutputStream to the specified ... */setSize(...)(...).giopDebugFlag/** overrides create_input_stream from CDROutputStream */// to xgiop.// package, it will need this, here, to give package access// XREVISIT - If CDROutputObject doesn't live in the iiopCodeSetConversion.CTBConvertercreateCharCTBConverter(...)getCTBConverter(...)boolean useByteOrderMarkersuseByteOrderMarkers(...)// Update the GIOP MessageHeader size field.//return new XIIOPInputStream(orb(), getByteBuffer(), getIndex(),//isLittleEndian(), getMessageHeader(), conn);// REVISIT - only set when doing sendCancelRequest.// With UTF-16:// For GIOP 1.2, we can put byte order markers if we want to, and// use the default of big endian otherwise.  (See issue 3405b)// For GIOP 1.1, we don't use BOMs and use the endianness of// the stream.// In the normal case, let the converter system handle it/** This is delegates to the real implementation. */CDROutputStreamBase impl;CorbaMessageMediator corbaMessageMediator;CDROutputStream$OutputStreamFactorynew CDROutputStream_1_0(...)new CDROutputStream_1_1(...)new IDLJavaSerializationOutputStream(...)new CDROutputStream_1_2(...)// ByteBuffers.// it notifies the constructor not to use pooled (i.e, direct)// NOTE: When a stream is constructed for non-channel-backed sockets// does _not_ use pooled ByteBuffers, see EncapsOutputStream.// that does not use pooled ByteBuffers. Right now, only EncapsOutputStream// the fact that someone extending this class 'can' construct a CDROutputStream// REVISIT - These two constructors should be re-factored to better hidenewOutputStream(...)// Provided by IIOPOutputStream and EncapsOutputStream// org.omg.CORBA.portable.OutputStreamwrite_boolean_array(...)write_char_array(...)write_wchar_array(...)write_short_array(...)write_ushort_array(...)write_long_array(...)write_ulong_array(...)write_longlong_array(...)write_ulonglong_array(...)write_float_array(...)write_double_array(...)write_Context(...)// org.omg.CORBA_2_3.portable.OutputStream// java.io.OutputStream// com.sun.corba.se.impl.encoding.MarshalOutputStreamputEndian(...)writeTo(...)// org.omg.CORBA.DataOutputStreamwrite_Abstract(...)write_Value(...)write_any_array(...)// Other// REVISIT - was protected - need access from msgtypes test.// XREVISIT - return to final if possible// REVISIT: was protected - but need to access from xgiop.freeInternalCaches(...)// ValueOutputStream -----------------------------// REVISIT - what is appropriate?  INTERNAL exceptions// are really hard to track later.// Used in indirections. Overridden by TypeCodeOutputStream./** Describes CDROutputStream delegates and provides some ... */CDROutputStream parent;// Required by parent CDROutputStream// non-pooled ByteBuffers, for additional info.// See EncapsOutputStream, the only one that uses the//     public abstract void flush() throws IOException;//     public abstract void write(byte b[], int off, int len) throws IOException;//     public abstract void write(byte b[]) throws IOException;// Required by IIOPOutputStream and other subclasses// org.omg.CORBA.portable.ValueOutputStreamimport Stackimport Utilimport ValueHandlerMultiFormatimport DataOutputStreamimport Objectimport VM_CUSTOMimport VM_TRUNCATABLEimport VM_NONEimport ORBVersionimport MarshalOutputStreamint INDIRECTION_TAG;BufferManagerWrite bufferManagerWrite;int blockSizeIndex;int blockSizePosition;byte streamFormatVersion;String kWriteMethod;// Codebase cache// Write end flag// Beginning with the resolution to interop issue 3526,boolean mustChunk;boolean inBlock;// In block markerint end_flag_position;// Last end tag positionint end_flag_index;// ValueHandlerCodeSetConversion.CTBConverter charConverter;CodeSetConversion.CTBConverter wcharConverter;// to use pool byte buffers or not doesn't need to be known.// REVISIT - This should be re-factored so that including whetherthis.bufferManagerWritethis.streamFormatVersionbyte[] it// fragmentation policy for IIOP 1.1.// Always grow the single buffer. This needs to delegate// Default implementation of grow.  Subclassers may override this.overflow(...)done(...)alignAndReserve(...)CTBConverter converterconvert(...)getNumBytes(...)invalidSingleCharCtb(...)getBytes(...)// legacy ORBs, now.// These wchar methods are only used when talking to... >>> ...writeLittleEndianWchar(...)writeBigEndianWchar(...)writeLittleEndianShort(...)writeBigEndianShort(...)writeLittleEndianLong(...)writeBigEndianLong(...)writeLittleEndianLongLong(...)writeBigEndianLongLong(...)writeString(...)handleSpecialChunkBegin(...)internalWriteOctetArray(...)handleSpecialChunkEnd(...)// Performs no checks and doesn't tamper with chunkingboolean alignname(...).lengthconnectAndGetIOR(...)IOR nullIORwriteLocalObject(...)boolean corbaObjectObject theObjectClassCastException ccethrowNotSerializableForCorba(...)writeValueTag(...)write_repositoryId(...)updateIndirectionTable(...)writeEndTag(...)createSequenceRepID(...)ValueHandlerMultiFormat vhwriteValue(...)String repIdwriteIDLValue(...)Serializable keywriteReplace(...)getVal(...)isCustomMarshaled(...)Class<> clazzboolean oldMustChunkwriteArray(...)writeValueBase(...)shouldWriteAsIDLEntity(...)writeIDLEntity(...)writeWStringValue(...)writeClass(...)writeRMIIIOPValueType(...)boolean isCustomshort modifierVM_NONE.valueVM_TRUNCATABLE.valueuseRepId(...)marshal(...)// recursive scenarios which lose the chunking state.// calling alignAndReserve.  Otherwise, it's possible to get into// by allowing us to end_block and update chunk lengths without// Utility method which will hopefully decrease chunking complexitywriteLongWithoutAlign(...)// CDROutputStream state management.byte[] bufgetStandardRMIChunkedNoRepStrId(...)getCodeBaseRMIChunkedNoRepStrId(...)write_codebase(...)getStandardRMIChunkedId(...)getCodeBaseRMIChunkedId(...)getStandardRMIUnchunkedNoRepStrId(...)getCodeBaseRMIUnchunkedNoRepStrId(...)getStandardRMIUnchunkedId(...)getCodeBaseRMIUnchunkedId(...)badTypecodeForCustomValue(...)// Handles end tag compaction...writeNestingLevel(...)/** Handles ORB versioning of the end tag.  Should only ... */writeClassBody(...)// backwards compatibility.// and codebase strings in the wrong order.  This handles// }//  return (java.io.Serializable)object;// private java.io.Serializable make_serializable(java.lang.Object object)// passing arrays as Serializable// This is required for JDK 1.1 only to avoid VerifyErrors when// Casts and returns an Object as a SerializableString repository_idOutputStream.classMethod writeMethodCDROutputStream_1_0$1errorInvokingHelperWrite(...)/* DataOutputStream methods */// digits and scale before it gets written to the stream.// Pads the string representation of bigDecimal with zeros to fit the given// Then it should be declared in org.omg.CORBA.portable.OutputStream.// This will stay a custom add-on until the java-rtf issue is resolved.StringBuffer stringBuffer// Right now the scale and digits information of the type code is lost.// This method should be remove by the java-rtf issue.// The string may contain a sign and dotint stringLengthchar chbyte digitint numDigitsdigit(...)badDigitInFixed(...)... % ...getRealIndex(...)createWCharCTBConverter(...)CDRInputObject inputObj// ORB must not be null.  See CDROutputStream constructor.// Micro-benchmarks show ByteBuffer.get(int) out perform the bulk// ByteBuffer.get(byte[], offset, length).// No-op for GIOP 1.0// The 'if' stmt is commented out since we need the alignAndReserve to// be called, particularly when the first body byte is written,// to induce header padding to align the body on a 8-octet boundary,// for GIOP versions 1.2 and above. Refer to internalWriteOctetArray()// method that also has a similar change.//if (bbwi.position() + 1 > bbwi.buflen)//      REVISIT - Should just use ByteBuffer.put(byte) and let it//                increment the ByteBuffer position. This is true//                for all write operations in this file.// CORBA formal 99-10-07 15.3.1.6: "In the case of multi-byte encodings// of characters, a single instance of the char type may only// hold one octet of any multi-byte character encoding."// If it's one of our legacy ORBs, do what they did:// A string is encoded as an unsigned CORBA long for the// number of bytes to follow (including a terminating null).// There is only one octet per character in the string.// Write the null ending// When talking to our legacy ORBs, do what they did:// This will only have an effect if we're already chunking// This flag forces the alignAndReserve method to be called the// first time an octet is written. This is necessary to ensure// that the body is aligned on an 8-octet boundary. Note the 'if'// condition inside the 'while' loop below. Also, refer to the// write_octet() method that has a similar change.// IDL to Java formal 01-06-06 1.21.4.2// Assume value type.// Is it a CORBA.Object?// Yes.// Write our flag...// Now write out the object...// Write WStringValue's repository ID// Add indirection for object to indirection table// Write Value chunk// Write end tag//d11638// Write value_tag// Write repository ID// _REVISIT_ could check to see whether chunking really needed// Get rep id// Write rep id// Allow the ValueHandler to call writeReplace on// the Serializable (if the method is present)// Write null tag and return// Write rep. id// Handle null references// Handle shared references// Handle arrays// Handle IDL Value types// RMI-IIOP value type// Check to see if we need to start another block for a// possible outer value// no need to test for custom on the non-chunked path//Move inBlock=true to after write_long since write_long might//trigger grow which will lead to erroneous behavior with a//missing blockSizeIndex.//inBlock = true;// Save space in the buffer for block size//Has to happen after write_long since write_long could//trigger grow which is overridden by supper classes to//depend on inBlock.// Remember where to put the size of the endblock less 4// Test to see if the block was of zero length// If so, remove the block instead of ending it// (This can happen if the last field written//  in a value was another value)// Need to assert that blockSizeIndex == bbwi.position()?  REVISIT// System.out.println("      post end_block: " + get_offset() + " " + bbwi.position());// Micro-benchmarks are showing a loop of ByteBuffer.get(int) is// faster than ByteBuffer.get(byte[], offset, length)// int indirection = get_offset();// Use an indirection if available// Write it as a string.  Note that we have already done the// special case conversion of non-Latin-1 characters to escaped// Latin-1 sequences in RepositoryId.// It's not a good idea to cache them now that we can have// multiple code sets.// Add indirection for id to indirection table// We are exactly at the same position and index as the// end of the last end tag.  Thus, we can back up over it// and compact the tags.// Special case in which we're at the beginning of a new// fragment, but the position is the same.  We can't back up,// so we just write the new end tag without compaction.  This// occurs when a value ends and calls start_block to open a// continuation chunk, but it's called at the very end of// a fragment.// Remember the last index and position.  These are only used when chunking.// Increment the nesting level// Write the IDLEntity using reflection// Get rid of the sign// Determine integer and fraction parts// Pad both parts with zeros as necessary// This string contains no sign or dot// This string might contain sign and/or dot// Each octet contains (up to) two decimal digits// First calculate the length of the string without optional sign and dot// If the fixed type has an odd number of decimal digits,// then the representation begins with the first (most significant) digit.// is 0xD for negative numbers and 0xC for positive and zero values// Must ensure that there are no chunks between the tag// and the actual indirection value.  This isn't talked about// in the spec, but seems to cause headaches in our code.// At the very least, this method isolates the indirection code// that was duplicated so often.// write indirection tag// write indirection// Use parent.getRealIndex() so that it can be overridden by TypeCodeOutputStreams/* System.out.println("CDROutputStream_1_0 writing indirection pos " + posIndirectedTo + ... */// Make sure to chunk the custom data// possible outer value.  Since we're in the stream// format 2 custom type contained by another custom// type, mustChunk should always be true.// Here's why we need to open a continuation chunk:// We need to enclose the default data of the// next subclass down in chunks.  There won't be// an end tag separating the superclass optional// data and the subclass's default data.// tell BufferManagerWrite to release any ByteBuffers// this OutputStream and an InputStream. Thus, we check// Set InputStream's ByteBuffer and bbwi to null//          = sum i=[1,n] { bbwi_i-1_.size - buffer i header length }// n > 0, fragmentOffset// n == 0, fragmentOffset = 0// n = number of buffers (0 is original buffer, 1 is first fragment, etc)// It is equal to the following:// in the byte stream without any fragment headers.// to the current bbwi.position(), the result is the current position// This is used to keep indirections working across fragments.  When addedbadGiop11Ctb(...)getAlignment(...)// Notice that in 1.1, we won't end a fragment with// alignment padding.  We also won't guarantee that// our fragments end on evenly divisible 8 byte// boundaries.  There may be alignment// necessary with the header of the next fragment// since the header isn't aligned on an 8 byte// boundary, so we have to calculate it twice.// Must recompute the alignment after a grow.// In the case of fragmentation, the alignment// calculation may no longer be correct.// People shouldn't be able to set their fragment// sizes so small that the fragment header plus// this alignment fills the entire buffer.// Save the current size for possible post-fragmentation calculation// At this point, if we fragmented, we should have a ByteBufferWithInfo// with the fragment header already marshalled.  The size and length fields// should be updated accordingly, and the fragmented flag should be set.// Update fragmentOffset so indirections work properly.// At this point, oldSize is the entire length of the// previous buffer.  bbwi.position() is the length of the// fragment header of this buffer.// Note that the following code prohibits UTF-16 with a byte// order marker (which would result in 4 bytes).// The length is the number of code points (which are 2 bytes each)// including the 2 byte null.  See CORBA formal 99-10-07 15.3.2.7.// Write the 2 byte null endingboolean primitiveAcrossFragmentedChunk;// also means we do not support chunking there.// Since we will not support valuetypes with GIOP 1.1, that// **** NOTE ****// at grow points, now.// Note that in the grow case, chunks are _NOT_ closed// using inheritance.// We want to move to a compositional model rather than// to a different level, perhaps in the buffer managers.// All of the CDR code should be rewritten moving chunking// change the variables, etc.// will lose your state because the primitive calls will// write calls with handleSpecialChunkBegin/End, you// specialChunk.  If you wrap each of the following// Unfortunately, given the current code, we can't reuse// as that for specialChunks.// must go into fragment N + 1.  The behavior is the same// to fill fragment N, but the primitive won't fit so// in which the alignment for a primitive value is needed// There's a situation with chunking with fragmentationboolean specialChunk;//               b) Set specialChunk to false//               a) Close the chunk//     4.  if specialChunk is true//     [write the data]// Now back to the array only case://               b) fragment//               a) call end_block//     3.  In grow, if we need to fragment and specialChunk is false// 3 applies to ALL chunking://     2.  Set specialChunk to true//     1.  Write the length of the chunk including the array length// you can see, this is a very "special" chunk.)// wstring, _AND_ it won't fit in the buffer do the following.  (As// When chunking and writing an array of primitives, a string, or a// Used in chunking.  Here's how this works:// message, there is no need to pad the header, in the unfragmented case.// body must be aligned on a 8-octet boundary, and so the header needs to be// Indicates whether the header should be padded. In GIOP 1.2 and above, the// Called after writing primitivescheckPrimitiveAcrossFragmentedChunk(...)boolean handleChunkint oldIndexbyte[] resultint totalNumBytesint maxLengthceil(...)getMaxBytesPerChar(...)byte[] buffer// If we're chunking and the item won't fit in the buffer// Duplicating some code from end_block.  Compute// and write the total chunk length.//write_long(oldSize - blockSizeIndex);// Set the special flag so we don't end the chunk when// we fragment// If we're in a chunk and the item spanned fragments// This is unnecessary, but I just want to show that// we're done with the current chunk.  (the end_block// call is inappropriate here)// Start a new chunk since we fragmented during the item.// Thus, no one can go back to add more to the chunk length// Now turn off the flag so we go back to the normal// behavior of closing a chunk when we fragment and// reopening afterwards.// It would be nice to have a StreamPosition// abstraction if we could avoid allocation// overhead.// Start a new chunk// headerPadding bit is set by the write operation of RequestMessage_1_2// or ReplyMessage_1_2 classes. When set, the very first body write// operation (from the stub code) would trigger an alignAndReserve// method call, that would in turn add the appropriate header padding,// such that the body is aligned on a 8-octet boundary. The padding// is required for GIOP versions 1.2 and above, only if body is present.// In GIOP 1.2, we always end fragments at our// fragment size, which is an "evenly divisible// 8 byte boundary" (aka divisible by 16).  A fragment can// end with appropriate alignment padding, but no padding// is needed with respect to the next GIOP fragment// header since it ends on an 8 byte boundary.// See notes where specialChunk is defined, as well as the// above notes for primitiveAcrossFragmentedChunk.// If we're writing a primitive and chunking, we need to update// the chunk length to include the length of the primitive (unless// this complexity is handled by specialChunk).// Note that this is wasted processing in the grow case, but that// we don't actually close the chunk in that case.// with the fragment header already marshalled.  The buflen and position// Note that fragmented is only true in the streaming and collect cases.// We just fragmented, and need to signal that we should// start a new chunk after writing the primitive.// followed by the octets of the converted wchar.  This is good,// but it causes problems with our chunking code.  We don't// want that octet to get put in a different chunk at the end// of the previous fragment.// Ensure that this won't happen by overriding write_wchar_array// and doing our own handleSpecialChunkBegin/End here.// Write the bytes without messing with chunking// See CDROutputStream_1_0// Unfortunately, because of chunking, we have to convert the// entire char[] to a byte[] array first so we can know how// many bytes we're writing ahead of time.  You can't split// an array of primitives into multiple chunks.// Remember that every wchar starts with an octet telling// its length.  The buffer size is an upper bound estimate.// Convert one wchar// Make sure to add the octet length// Copy it into our buffer// Now that we know the total length, we can deal with chunking.// Note that we don't have to worry about alignment since they're// just octets.// Must use totalNumBytes rather than buffer.length since the// buffer.length is only the upper bound estimate.// Write the octet array without tampering with chunkingimport FullValueDescriptionimport CodeBaseHelperimport _CodeBaseImplBaseimport _CodeBaseStub/** Provides the reading side with a per connection cache of ... */new Object(...)new Hashtable<IOR,CodeBase>(...)Hashtable<> implementations, ...;CodeBase delegate;CorbaConnection conn;Object iorMapLock;Hashtable<IOR,CodeBase> iorMap;for (... : ...)getORB(...)String urlResultconnectedCodeBase(...)String[] urlResultsrepIds.lengthurlResults.lengthFullValueDescription resultmeta(...)FullValueDescription[] resultsnew FullValueDescription[]results.lengthString[] resultsbases(...)// it is not valid to access the delegate.// a valid CodeBase delegate.  If this returns false, then// Ensures that we've used the connection's IOR to creategetCodeBaseIOR(...)getBroker(...).transportDebugFlaggetBroker(...)CachedCodeBase.iorMapgetObjectFromIOR(...)/* Copyright (c) 2001, 2012, Oracle and/or its affiliates. All rights reserved. ... */// The delegate was null, so see if the connection's// IOR was set.  If so, then we just need to connect// it.  Otherwise, there is no hope of checking the// remote code base.  That could be bug if the// service context processing didn't occur, or it// could be that we're talking to a foreign ORB which// doesn't include this optional service context.// REVISIT.  Use Merlin logging service to report that// codebase functionality was requested but unavailable.// Recheck the condition to make sure another// thread didn't already do this while we waited// Do we have a reference initialized by another connection?// Connect the delegate and update the cache// Save it for the benefit of other connections// It's now safe to use the delegate/* stubFactory */import CharsetDecoderimport CharsetEncoderimport WeakHashMap/** Thread local cache of sun.io code set converters for performance. ... */new ThreadLocal<>(...) { ... }CodeSetCache$1new Map<>[]new WeakHashMap<>(...)WeakHashMap$EntryThreadLocal<> converterCaches;/** The ThreadLocal data is a 2 element Map array indexed ... */int BTC_CACHE_MAP;/** Index in the thread local converterCaches array for ... */int CTB_CACHE_MAP;/** Retrieve a CharsetDecoder from the Map using the given key. */Map<> btcMap/** Retrieve a CharsetEncoder from the Map using the given key. */Map<> ctbMap/** Stores the given CharsetDecoder in the thread local cache, ... *//** Stores the given CharsetEncoder in the thread local cache, ... */import ArraysCodeSetComponent charDatanew CodeSetComponent(...)getNumber(...)OSFCodeSetRegistry.UTF_8OSFCodeSetRegistry.ISO_646CodeSetComponent wcharDataOSFCodeSetRegistry.UCS_2new CodeSetComponentInfo(...)new CodeSetContext(...)CodeSetComponentInfo$CodeSetComponent/** CodeSetComponent is part of an IOR multi-component profile.  Two ... */int nativeCodeSet;...[] conversionCodeSets;CodeSetComponent otherother.nativeCodeSetother.conversionCodeSetsconversionCodeSets.lengththis.nativeCodeSetthis.conversionCodeSetsStringBuffer sbufCodeSetComponent forCharData;CodeSetComponent forWCharData;CodeSetComponentInfo otherother.forCharDataother.forWCharData... ^ ...hashCode(...)CodeSetComponentInfo.JAVASOFT_DEFAULT_CODESETS.forCharDataCodeSetComponentInfo.JAVASOFT_DEFAULT_CODESETSCodeSetComponentInfo.JAVASOFT_DEFAULT_CODESETS.forWCharDataCodeSetComponentInfo$CodeSetContext/** CodeSetContext goes in a GIOP service context */int char_data;int wchar_data;CodeSetComponentInfo JAVASOFT_DEFAULT_CODESETS;/** Our default code set scheme is as follows: ... *//** Creates a CodeSetComponent from a String which contains a comma ... */StringTokenizer stokint nativeSetint[] conversionIntsbadCodeSetString(...)List<> conversionListdecode(...)unknownNativeCodeset(...)Integer valueunknownConversionCodeSet(...)conversionInts.lengthinvalidCodeSetNumber(...)NoSuchElementException nseeinvalidCodeSetString(...)CodeSetContext LOCAL_CODE_SETS;/** Code sets for local cases without a connection. *//* Copyright (c) 1998, 2003, Oracle and/or its affiliates. All rights reserved. ... */// The first value is the native code set// Now process the other values as part of the// conversion code set list.// decode allows us to specify hex, decimal, etc// Otherwise return the CodeSetComponent representing// the given valuesimport CharBufferimport Charsetimport CharacterCodingExceptionimport IllegalCharsetNameExceptionimport MalformedInputExceptionimport UnsupportedCharsetExceptionimport UnmappableCharacterException/** Collection of classes, interfaces, and factory methods for ... */new CodeSetCache(...)/** Abstraction for char to byte conversion. ... */// before writing.// allowing the caller to query for more information// Perform the conversion of the provided char or String,// How many bytes resulted from the conversion?// What's the maximum number of bytes per character?// is just information available to the caller.// Note: This has no effect on the converted bytes.  It// on a 2 byte boundary.  (Ex:  UTF16 in GIOP1.1)// doesn't encapsulate the char's bytes should align// encoding with 2 bytes per char in a stream which// calling writeBytes?  For instance, a fixed width// What byte boundary should the stream align to before// save references.// of array.length!  The array may be used internally, so don't// to determine the end of the data in the byte array instead// Get the resulting bytes.  Warning:  You must use getNumBytes()/** Abstraction for byte to char conversion. */// the length in octets.// specified how many code points follow rather than specifying// fixed width encodings like UTF-16.  This is because wstrings// In GIOP 1.1, interoperability can only be achieved with// converted array.// Called after getChars to determine the true size of the// calls.// The same array may be used internally over multiple// determine the correct length of the resulting array.// input stream.  Warning:  You must use getNumChars() to// Perform the conversion using length bytes from the givenCodeSetConversion$JavaCTBConverter/** Implementation of CTBConverter which uses a nio.Charset.CharsetEncoder ... */CharsetEncoder ctb;// because we want to know when errors occur during the conversion.// have to use it directly rather than through String's interface// nio.Charset.CharsetEncoder actually does the work hereint alignment;// alignment of 2 (2 bytes per char)// ASCII has alignment of 1 (1 byte per char) but UTF16 has// Proper alignment for this type of converter.  For instance,...[] chars;// Char buffer to hold the input.int numBytes;// How many bytes are generated from the conversion?int numChars;// for cross method communication)// How many characters were converted (temporary variableByteBuffer buffer;// before writing the array to the stream.// since we have to do calculations that require the conversion// ByteBuffer holding the converted input.  This is necessaryOSFCodeSetRegistry.Entry codeset;// What code set are we using?getCharToByteConverter(...)Charset tmpCharsetnewEncoder(...)setConverter(...)IllegalCharsetNameException icneinvalidCtbConverterName(...)UnsupportedCharsetException ucnethis.codesetmaxBytesPerChar(...)convertCharArray(...)chars.lengthisFixedWidth(...)encode(...)wrap(...)IllegalStateException isectbConverterFailure(...)MalformedInputException miebadUnicodePair(...)UnmappableCharacterException ucecharNotInCodeset(...)CharacterCodingException cce/** Special UTF16 converter which can either always write a BOM ... */// Using this constructor, we will always write a BOM// byte order specified// Using this constructor, we don't use a BOM and use theOSFCodeSetRegistry.UTF_16LEOSFCodeSetRegistry.UTF_16BECodeSetConversion$JavaBTCConverter/** Implementation of BTCConverter which uses a sun.io.ByteToCharConverter ... */CharsetDecoder btc;...[] buffer;int resultingNumChars;getConverter(...)//            CharsetDecoder.maxCharsPerByte().// IMPORTANT: This calls OSFCodeSetRegistry.Entry, not// Should only be called if isFixedWidthEncoding is trueByteBuffer byteBufCharBuffer charBufcapacity(...)IllegalStateException ilebtcConverterFailure(...)/** Utility method to find a CharsetDecoder in the ... */CharsetDecoder resultgetByteToCharConverter(...)newDecoder(...)invalidBtcConverterName(...)CodeSetConversion$UTF16BTCConverter/** Special converter for UTF16 since it's required to optionally ... */boolean defaultToLittleEndian;boolean converterUsesBOM;char UTF16_BE_MARKER;char UTF16_LE_MARKER;// order specified.// When there isn't a byte order marker, used the bytethis.defaultToLittleEndianhasUTF16ByteOrderMarker(...)switchToConverter(...)/** Utility method for determining if a UTF-16 byte order marker is present. */char marker/** The current solution for dealing with UTF-16 in CORBA ... *//** CTB converter factory for single byte or variable length encodings. */new JavaCTBConverter(...)/** CTB converter factory for multibyte (mainly fixed) encodings. ... */new UTF16CTBConverter(...)/** BTCConverter factory for single byte or variable width encodings. */new JavaBTCConverter(...)/** BTCConverter factory for fixed width multibyte encodings. */new UTF16BTCConverter(...)/** Follows the code set negotiation algorithm in CORBA formal 99-10-07 13.7.2. ... */CodeSetComponentInfo.CodeSetComponentint serverNativeserver.nativeCodeSetserver.conversionCodeSets.lengthserver.conversionCodeSetsCodeSetConversion.FALLBACK_CODESETclient.nativeCodeSetclient.conversionCodeSets.lengthclient.conversionCodeSetsint y/** Perform the code set negotiation algorithm and come up with ... */int charDataselectEncoding(...)getCharComponent(...)int wcharDatagetWCharComponent(...)// instance method// No one should instantiate a CodeSetConversion but the singletonCodeSetConversion$CodeSetConversionHolder// initialize-on-demand holdernew CodeSetConversion(...)CodeSetConversion csc;/** CodeSetConversion is a singleton, and this is the access point. */CodeSetConversionHolder.cscCodeSetConversion implementation;// Singleton instanceint FALLBACK_CODESET;// set.// Number used internally to indicate the fallback codeCodeSetCache cache;// converters.// Provides a thread local cache for the sun.io// This can only happen if one of our Entries has// an invalid name.// an unsupported name.// The CharToByteConverter only takes a char[]// Try to save a memory allocation if possible.  Usual// space/time trade off.  If we could get the char[] out of// the String without copying, that would be great, but// it's forbidden since String is immutable.// Note that you can't use buffer.length since the buffer might// be larger than the actual number of converted bytes depending// on the encoding.// Possible optimization of directly converting into the CDR buffer.// However, that means the CDR code would have to reserve// a 4 byte string length ahead of time, and we'd need a// confusing partial conversion scheme for when we couldn't// fit everything in the buffer but needed to know the// converted length before proceeding due to fragmentation.// Then there's the issue of the chunking code.// For right now, this is less messy and basic tests don't// show more than a 1 ms penalty worst case.  Less than a// factor of 2 increase.// Convert the characters// ByteBuffer returned by the encoder will set its limit// to byte immediately after the last written byte.// an encoding operation is already in progress// There were illegal Unicode char pairs// A character doesn't map to the desired code set// CORBA formal 00-11-03.// If this happens, then some other encoding error occured// Obtain a Decoder// Possible optimization of reading directly from the CDR// byte buffer.  The sun.io converter supposedly can handle// incremental conversions in which a char is broken across// two convert calls.// Basic tests didn't show more than a 1 ms increase// worst case.  It's less than a factor of 2 increase.// Also makes the interface more difficult.// CharBuffer returned by the decoder will set its limit// IMPORTANT - It's possible the underlying char[] in the//             CharBuffer returned by btc.decode(byteBuf)//             is longer in length than the number of characters//             decoded. Hence, the check below to ensure the//             char[] returned contains all the chars that have//             been decoded and no more.// There were a decoding operation already in progress// A character doesn't map to the desired code set.// If this happens, then a character decoding error occured.// This can only happen if one of our charset entries has// an illegal name.// If there aren't enough bytes to represent the marker and data,// return false.// Use the getConverter method from our superclass.// UCS2 doesn't have byte order markers, and we're encoding it// as UTF-16 since UCS2 isn't available in all Java platforms.// They should be identical with only minor differences in// negative cases.// We can write UTF-16 with or without a byte order marker.// Everything else uses the generic JavaCTBConverter.// Variable width encodings are aligned on 1 byte boundaries.// A fixed width encoding with a max. of 4 bytes/char should// align on a 4 byte boundary.  Note that UTF-16 is a special// case because of the optional byte order marker, so it's// handled above.// This doesn't matter for GIOP 1.2 wchars and wstrings// since the encoded bytes are treated as an encapsulation.// A "null" value for the server's nativeCodeSet means that// the server desired not to indicate one.  We'll take that// to mean that it wants the first thing in its conversion list.// If it's conversion list is empty, too, then use the fallback// codeset.// Best case -- client and server don't have to convert// Is this client capable of converting to the server's// native code set?// The client will convert to the server's// native code set.// Is the server capable of converting to the client's// The server will convert to the client's// See if there are any code sets that both the server and client// support (giving preference to the server).  The order// of conversion sets is from most to least desired.// Before using the fallback codesets, the spec calls for a// compatibility check on the native code sets.  It doesn't make// sense because loss free communication is always possible with// UTF8 and UTF16, the fall back code sets.  It's also a lot// of work to implement.  In the case of incompatibility, the// spec says to throw a CODESET_INCOMPATIBLE exception.// Use the fallbackimport EncapsInputStreamFactory/** Encapsulations are supposed to explicitly define their ... */// iiop/ORB// corba/ORBSingleton// corba/EncapsOutputStream// ior/IIOPProfile// ior/IdentifiableBase// corba/AnyImpl// mark at the beginning)// the endianness if it is an encapsulation with a byte order// Assumes big endian (can use consumeEndian to read and set// ServiceContext// CDREncapsCodec/** Full constructor with a CodeBase parameter useful for ... */this.codeBasenewEncapsInputStream(...)CodeBase codeBase;/* Copyright (c) 2001, 2013, Oracle and/or its affiliates. All rights reserved. ... */// Wide characters don't exist in GIOP 1.0// In GIOP 1.1, we shouldn't have byte order markers.  Take the order// of the stream if we don't see them.// Assume anything else adheres to GIOP 1.2 requirements.// Our UTF_16 converter will work with byte order markers, and if// they aren't present, it will use the provided endianness.// With no byte order marker, it's big endian in GIOP 1.2.// formal 00-11-03 15.3.16.boolean usePooledByteBuffers;// byte buffers.// the EncapsOutputStream doesn't know it's using pooled// static constant. This should be re-factored such that// pooled byte buffers. This is controlled by the following// REVISIT - Right now, EncapsOutputStream's do not use// iiop/GIOPImpl// corba/ORB// for service contexts or codecs (?).// only use stream format version 1, which may create problems// REVISIT - Right now, valuetypes in encapsulations will// with byte order markers.// REVISIT.  A UTF-16 encoding with GIOP 1.1 will not work// Used by IIOPProfileTemplateORBConstants.STREAM_FORMAT_VERSION_1boolean useBOMuseByteOrderMarkersInEncapsulations(...)// GIOP version 1.2 with no fragmentation, big endian,// UTF8 for char data and UTF-16 for wide char data;// In the case of GIOP 1.1, we take the byte order of the stream and don't// use byte order markers since we're limited to a 2 byte fixed width encoding.// Assume anything else meets GIOP 1.2 requirements// Use byte order markers?  If not, use big endian in GIOP 1.2.// (formal 00-11-03 15.3.16)/** Implementation class that uses Java serialization for input streams. ... */int bufSize;byte encodingVersion;ObjectInputStream is;_ByteArrayInputStream bis;BufferManagerRead bufferManager;int directReadLength;// [GIOPHeader(12) + requestID(4)] bytesboolean markOn;// Used for mark / reset operations.int peekIndex, ...;LinkedList<> markedItemQ;IDLJavaSerializationInputStream$_ByteArrayInputStreamthis.posnew IndexOutOfBoundsException(...)IDLJavaSerializationInputStream$MarshalObjectInputStreamnew PrivilegedAction<>(...) { ... }IDLJavaSerializationInputStream$MarshalObjectInputStream$1enableResolveObject(...)/** Connect the Stub to the ORB. */RemoteException reIOException ienew IOException(...)initCause(...)this.encodingVersionthis.bufSizethis.bufferManagernew _ByteArrayInputStream(...)// Called from read_octet or read_long or read_ulong method.javaStreamInitFailed(...)new MarshalObjectInputStream(...)// Primitive types.isEmpty(...)booleanValue(...)readBoolean(...)javaSerializationException(...)charValue(...)readChar(...)new Character(...)initObjectInputStream(...)byteValue(...)readByte(...)new Byte(...)shortValue(...)readShort(...)new Short(...)readInt(...)longValue(...)readLong(...)new Long(...)floatValue(...)readFloat(...)new Float(...)doubleValue(...)readDouble(...)new Double(...)// String types.// Array types.// Complex types.// an odd number of decimal digits, then the representation// Each octet contains (up to) two decimal digits. If the fixed type hasSerializable valueboolean isObject//     public void close() throws IOException;//     public int available() throws IOException;//     public long skip(long n) throws IOException;//     public int read(byte b[], int off, int len) throws IOException//     public int read(byte b[]) throws IOException;this.bufferskipBytes(...)setMarkData(...)// Used exclusively by the dup() method.this.markOnthis.peekIndexthis.peekCountthis.markedItemQsetPosition(...)IndexOutOfBoundsException ebuf.length// needs SerializablePermission("enableSubstitution")// Note: at this point, the buffer position is zero. The setIndex()// method call can be used to set a desired read index.//System.out.print(" is ");// dequeue// peek// enqueue// check if size < [ GIOPHeader(12) + requestID(4)] bytes//markedItemQ.addLast(Byte.valueOf(value)); // only in JDK 1.5// Use big endian (network byte order). This is fixed.// Both the writer and reader use the same byte order.// Cannot happen. All direct reads are contained// within the first 16 bytes./* // Cannot use this efficient read due to mark/reset support. ... */// kind off this stream and see if it is a tk_value.// Looking at the code we know that for tk_value the Any.read_value()// below ignores the tc argument anyway (except for the kind field).// read off the value of the any.// We don't need an implementation for this method, since principal// is absent in GIOP version 1.2 or above.// Nested mark disallowed.// Further, mark is not supported until first 16 bytes are read./* // Note: only ByteArrayInputStream supports mark/reset. ... */// Set the buffer position.// Set mark related data.// no-op. We don't care about body alignment while using// Java serialization. What the GIOP spec states does not apply here.// this is redundant, since buffer size was already specified// as part of the init call. So, ignore.// No-op./** Implementation class that uses Java serialization for output streams. ... */ObjectOutputStream os;_ByteArrayOutputStream bos;BufferManagerWrite bufferManager;int directWriteLength;IDLJavaSerializationOutputStream$_ByteArrayOutputStreamthis.bufIDLJavaSerializationOutputStream$MarshalObjectOutputStreamIDLJavaSerializationOutputStream$MarshalObjectOutputStream$1enableReplaceObject(...)/** Checks for objects that are instances of java.rmi.Remote ... */new _ByteArrayOutputStream(...)new MarshalObjectOutputStream(...)writeBoolean(...)writeChar(...)initObjectOutputStream(...)writeByte(...)writeShort(...)writeInt(...)writeLong(...)writeFloat(...)writeDouble(...)// Complex types (objects and graphs).boolean isCorbaObjectObject theCorbaObject// com.sun.corba.se.os.encoding.MarshalOutputStream// Other.ByteBuffer byteBuffergetByteArray(...)/* Copyright (c) 2004, 2013, Oracle and/or its affiliates. All rights reserved. ... *///System.out.print(" os ");// direct write.// Cannot happen. All direct writes are contained// First calculate the string length without optional sign and dot.// If the fixed type has an odd number of decimal digits, then the// representation begins with the first (most significant) digit.// Otherwise, this first half-octet is all zero, and the first// digit is in the second half-octet.// The sign configuration in the last half-octet of the representation,// Write the boolean flag.// Now write out the object.// new copy.// Java serialization uses network byte order, that is, big-endian.//System.out.println("Total length : " + buf.length);// Note: These methods are defined in the super class and accessible.//public abstract void write(byte b[]) throws IOException;//public abstract void write(byte b[], int off, int len)//    throws IOException;//public abstract void flush() throws IOException;//public abstract void close() throws IOException;/** Defines an abstraction for a RestorableInputStream to ... *//* The methods necessary to support RMI *//* Additional Methods */// (also handles fragmented streams)// Determines the current byte stream position// mark/reset from java.io.InputStream/** This must be called once before unmarshaling valuetypes or anything ... *//** Tells the input stream to null any code set converter ... *//** Information from the OSF code set registry version 1.2g. ... */new Entry(...)int ISO_8859_1_VALUE;// more details.// Please see the individual Entry definitions for// Numbers from the OSF code set registry version 1.2g.int UTF_16_VALUE;int UTF_8_VALUE;int UCS_2_VALUE;int ISO_646_VALUE;OSFCodeSetRegistry$Entry/** An entry in the OSF registry which allows users ... */String javaName;int encodingNum;boolean isFixedWidth;int maxBytesPerChar;this.javaNamethis.encodingNumthis.isFixedWidththis.maxBytesPerChar/** Returns the Java equivalent name.  If the encoding has ... *//** Get the OSF registry number for this code set. *//** Is this a fixed or variable width code set?  (In CORBA ... *//** First checks reference equality since it's expected ... */Entry otherother.javaNameother.encodingNumother.isFixedWidthother.maxBytesPerChar/** Uses the registry number as the hash code. */Entry ISO_8859_1;/** 8-bit encoding required for GIOP 1.0, and used as the char set ... */Entry UTF_16BE;/** UTF-16 as specified in the OSF registry has an optional ... */Entry UTF_16LE;Entry UTF_16;/** Fallback wchar code set. ... */Entry UTF_8;/** Fallback char code set.  Also the code set for char data ... */Entry UCS_2;/* At least in JDK 1.3, UCS-2 isn't one of the mandatory Java character ... */Entry ISO_646;/** This is the encoding older JavaSoft ORBs advertised as their ... *//** Given an OSF registry value, return the corresponding Entry. ... *//** Defines the methods on an input stream which provide ... */Map<> typeMap;InputStream enclosure;boolean isEncapsulation;this.enclosureTypeCodeInputStream encapint encapLengthbyte[] encapBufferencapBuffer.lengthnewTypeCodeInputStream(...)setEnclosingInputStream(...)makeEncapsulation(...)Iterator<> iInteger posdescription(...)/* Copyright (c) 2002, 2013, Oracle and/or its affiliates. All rights reserved. ... *///if (TypeCodeImpl.debug) System.out.println("Creating typeMap");//if (TypeCodeImpl.debug) System.out.println(this + " adding tc " + tc + " at position " + position);//if (TypeCodeImpl.debug) {//System.out.println("Getting tc " + (TypeCode)typeMap.get(new Integer(position)) +//" at position " + position);// The enclosed stream has to consider if the enclosing stream// had to read the enclosed stream completely when creating it.// This is why the size of the enclosed stream needs to be substracted.// Substract getBufferLength from the parents pos because it read this stream// from its own when creating it//System.out.println("TypeCodeInputStream.getTopLevelPosition using getTopLevelPosition " + topPos +//(isEncapsulation ? " - encaps length 4" : "") +//" - getBufferLength() " + getBufferLength() +//" + getPosition() " + getPosition() + " = " + pos);//System.out.println("TypeCodeInputStream.getTopLevelPosition returning getPosition() = " +//getPosition() + " because enclosure is " + enclosure);// _REVISIT_ Would be nice if we didn't have to copy the buffer!// read off part of the buffer corresponding to the encapsulation// create an encapsulation using the marshal buffer//System.out.println("Created TypeCodeInputStream " + encap + " with parent " + is);//encap.printBuffer();// first entry in an encapsulation is the endianessOutputStream enclosure;TypeCodeInputStream tcis/* public boolean isEncapsulatedIn(TypeCodeOutputStream outerEnclosure) { ... */refTypeIndirType(...)CompletionStatus.COMPLETED_NOTypeCodeOutputStream encapsetEnclosingOutputStream(...)boolean littleEndianTypeCodeOutputStream tos/* protected void printBuffer() { ... */ByteBuffer theBufferbyte[] tcBuffertcBuffer.length//System.out.println("Created TypeCodeInputStream " + tcis + " with no parent");//tcis.printBuffer();// Add four bytes for the encaps length, not another 4 for the byte order// which is included in getPosition().//System.out.println("TypeCodeOutputStream.getTopLevelPosition using getTopLevelPosition " +//((TypeCodeOutputStream)enclosure).getTopLevelPosition() +//" + getPosition() " + getPosition() +//(isEncapsulation ? " + encaps length 4" : "") +//" = " + pos);//System.out.println("TypeCodeOutputStream.getTopLevelPosition returning getPosition() = " +//getPosition() + ", enclosure is " + enclosure);//if (TypeCodeImpl.debug) System.out.println(this + " adding id " + id + " at position " + position);//if (TypeCodeImpl.debug) System.out.println("Getting position " + ((Integer)typeMap.get(id)).intValue() +//" for id " + id);// Writes this streams buffer to the given OutputStream// without byte order flag and length as is the case for encapsulations.// Make sure to align s to 4 byte boundaries.// Unfortunately we can't do just this:// s.alignAndReserve(4, 4);// So we have to take the first four bytes given in firstLong and write them// with a call to write_long which will trigger the alignment.// Then write the rest of the byte array.//System.out.println(this + ".writeRawBuffer(" + s + ", " + firstLong + ")");//if (s instanceof CDROutputStream) {//System.out.println("Parent position before writing kind = " + ((CDROutputStream)s).getIndex());//System.out.println("Parent position after writing kind = " + ((CDROutputStream)s).getIndex());// get bytes from DirectByteBuffer// NOTE: Microbenchmarks are showing it is faster to do//       a loop of ByteBuffer.get(int) than it is to do//       a bulk ByteBuffer.get(byte[], offset, length)//System.out.println("Parent position after writing all " + getIndex() + " bytes = " + ((CDROutputStream)s).getIndex());//if (TypeCodeImpl.debug) System.out.println("Created TypeCodeOutputStream " + encap + " with parent " + this);//if (TypeCodeImpl.debug) System.out.println("Created TypeCodeOutputStream " + tos + " with parent " + os);//if (TypeCodeImpl.debug) System.out.println("TypeCodeOutputStream.getRealIndex using getTopLevelPosition " +//topPos + " instead of getPosition " + getPosition());// Returns the buffer trimmed of the trailing zeros and without the// known _kind value at the beginning.//System.out.println("outBuffer length = " + (getIndex() - 4));// Micro-benchmarks show that DirectByteBuffer.get(int) is faster// than DirectByteBuffer.get(byte[], offset, length).// REVISIT - May want to check if buffer is direct or non-direct//           and use array copy if ByteBuffer is non-direct.//public void printBuffer();// for debugging/* Copyright (c) 2002, 2003, Oracle and/or its affiliates. All rights reserved. ... */int startPos;//public void printBuffer() { stream.printBuffer(); }List<> sortedKeyssort(...)//if (TypeCodeImpl.debug) System.out.println("Getting tc " + (TypeCodeImpl)typeMap.get(new Integer(position)) +// WrapperInputStream has no enclosure//if (TypeCodeImpl.debug) System.out.println("WrapperInputStream.getTopLevelPosition " +//"returning getPosition " + getPosition() + " - startPos " + startPos +//" = " + (getPosition() - startPos));// This is never actually called on a WrapperInputStream, but// exists to satisfy the interface requirement.import Codecimport FormatMismatchimport InvalidTypeForEncoding/** CDREncapsCodec is an implementation of Codec, as described ... */// The ORB that created the factory this codec was created fromGIOPVersion giopVersion;// The GIOP version we are encoding for/** Creates a new codec implementation.  Uses the given ORB to create ... *//* ****************************************************************** ... */CORBALogDomains.RPC_PROTOCOLgetInstance(...)/** Convert the given any into a CDR encapsulated octet sequence */encodeImpl(...)/** Decode the given octet sequence into an any based on a CDR ... */decodeImpl(...)/** Convert the given any into a CDR encapsulated octet sequence.  Only ... *//** Convert the given any into a CDR encapsulated octet sequence. ... */EncapsOutputStream cdrOutnewEncapsOutputStream(...)AnyImpl anyEncapsInputStream cdrIndata.lengthnew FormatMismatch(...)/* Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved. ... */// _REVISIT_ Note that InvalidTypeForEncoding is never thrown in// the body of this method.  This is due to the fact that CDR*Stream// will never throw an exception if the encoding is invalid.  To// fix this, the CDROutputStream must know the version of GIOP it// is encoding for and it must check to ensure that, for example,// wstring cannot be encoded in GIOP 1.0.// As part of the GIOP 1.2 work, the CDRInput and OutputStream will// be versioned.  This can be handled once this work is complete.// Create output stream with default endianness.// This is an encapsulation, so put out the endian:// Sometimes encode type code:// Encode value and return.// return value// _REVISIT_ Currently there is no way for us to distinguish between// a FormatMismatch and a TypeMismatch because we cannot get this// information from the CDRInputStream.  If a RuntimeException occurs,// it is turned into a FormatMismatch exception.// If type code not specified, read it from octet stream:// Create a new Any object:// See above note.import BAD_INV_ORDERimport CTX_RESTRICT_SCOPEimport NO_RESOURCESimport ParameterModeimport Policyimport UnknownServiceContextimport ServiceContextimport ServiceContextHelperimport TaggedProfileimport TaggedProfileHelperimport TaggedComponentimport TaggedComponentHelperimport TAG_INTERNET_IOPimport Parameterimport ClientRequestInfoimport LOCATION_FORWARDimport SUCCESSFULimport SYSTEM_EXCEPTIONimport TRANSPORT_RETRYimport USER_EXCEPTIONimport RetryTypeimport CorbaContactInfoimport CorbaContactInfoListimport CorbaContactInfoListIteratorimport CDRInputStream_1_0import CorbaInvocationInfo/** Implementation of the ClientRequestInfo interface as specified in ... */new boolean[][]int CALL_SEND_REQUEST;// The available constants for startingPointCallint CALL_SEND_POLL;int CALL_RECEIVE_REPLY;// The available constants for endingPointCallint CALL_RECEIVE_EXCEPTION;int CALL_RECEIVE_OTHER;RetryType retryRequest;// retried and this info object is to be reused, or false otherwise.// The current retry request status.  True if this request is being// NOTE: IF AN ATTRIBUTE IS ADDED, PLEASE UPDATE RESET();int entryCount;// is popped from the ClientRequestInfoImpl ThreadLocal stack in the ORB.// time a request is complete.  When this reaches zero, the info object// incremented every time a request is retried, and decremented every// The number of times this info object has been (re)used.  This isRequest request;// ContextList will be delegated to RequestImpl.// The DII query calls like ParameterList, ExceptionList,// The RequestImpl is set when the call is DII based.boolean diiInitiate;// Sources of client request informationObject cachedTargetObject;// Cached information:Object cachedEffectiveTargetObject;...[] cachedArguments;...[] cachedExceptions;...[] cachedContexts;...[] cachedOperationContext;String cachedReceivedExceptionId;Any cachedResult;Any cachedReceivedException;TaggedProfile cachedEffectiveProfile;HashMap<> cachedRequestServiceContexts;// key = Integer, value = IOP.ServiceContext.HashMap<> cachedReplyServiceContexts;HashMap<> cachedEffectiveComponents;// key = Integer, value = TaggedComponentboolean piCurrentPushed;/** Reset the info object so that it can be reused for a retry, ... */RetryType.NONEint MID_TARGET;// convenient O(1) lookup for checkAccess().// Method IDs for all methods in ClientRequestInfo.  This allows for a/* ********************************************************************* ... */int MID_EFFECTIVE_TARGET;int MID_EFFECTIVE_PROFILE;int MID_RECEIVED_EXCEPTION;int MID_RECEIVED_EXCEPTION_ID;int MID_GET_EFFECTIVE_COMPONENT;int MID_GET_EFFECTIVE_COMPONENTS;int MID_GET_REQUEST_POLICY;int MID_ADD_REQUEST_SERVICE_CONTEXT;...[] validCall;// Note: These must be in the same order as specified in contants.// ClientRequestInfo validity table (see ptc/00-08-06 table 21-1)./** Creates a new ClientRequestInfo implementation. ... *//** The object which the client called to perform the operation. */CorbaContactInfo corbaContactInfogetContactInfo(...)iorToObject(...)getTargetIOR(...)/** The actual object on which the operation will be invoked.  If the ... */getEffectiveTargetIOR(...)/** The profile that will be used to send the request.  If a location ... */getIOPProfile(...)getEffectiveProfile(...)/** Contains the exception to be returned to the client. */checkAccess(...)exceptionToAny(...)/** The CORBA::RepositoryId of the exception to be returned to the client. */exceptionWasNull(...)repositoryIdOf(...)/** Returns the IOP::TaggedComponent with the given ID from the profile ... */get_effective_components(...)/** Returns all the tagged components with the given ID from the profile ... */Integer integerIdTaggedComponent[] resultboolean justCreatedCacheIIOPProfileTemplate ptempgetTaggedProfileTemplate(...)getIOPComponents(...)result.lengthinvalidComponentId(...)/** Returns the given policy in effect for this operation. */piOrbNotPolicyBased(...)/** Allows interceptors to add service contexts to the request. ... */addServiceContext(...)getRequestServiceContexts(...)/** See RequestInfoImpl for javadoc. */// 3. Define entries in the validCall[][] table for interception points.// 2. Call checkAccess at the start of the method// 1. Add a MID_* constant for that method// NOTE: When adding a method, be sure to:getRequestId(...)piOperationNotSupported1(...)nvListToParameterArray(...)arguments(...)ExceptionList excListexceptions(...)int countTypeCode[] excTCListnew TypeCode[]piOperationNotSupported2(...)exceptionInExceptions(...)ContextList ctxListcontexts(...)String[] ctxListToReturnpiOperationNotSupported3(...)exceptionInContexts(...)Context ctxctx(...)NVList nvListget_values(...)CTX_RESTRICT_SCOPE.valueString[] contextpiOperationNotSupported4(...)int indexNamedValue nvResultresult(...)piOperationNotSupported5(...)piDiiResultIsNull(...)isOneWay(...)getLocatedIOR(...)LOCATION_FORWARD.valueinvalidPiCall1(...)CorbaContactInfoList contactInfoListgetContactInfoList(...)CorbaContactInfoListIterator iteratorgetContactInfoListIterator(...)getInvocationInfo(...)reportRedirect(...)getServiceContext(...)/** does not contain an etry for that ID, BAD_PARAM with a minor code of ... */ServiceContexts serviceContextsgetReplyServiceContexts(...)new NullPointerException(...)NullPointerException einvalidServiceContextId(...)// Override RequestInfoImpl connection to work in framework.setDIIInfo(...)/** Set or reset the retry request flag. */this.retryRequest/** Retrieve the current retry request status. *//** Increases the entry count by 1. */this.entryCount/** Decreases the entry count by 1. *//** Retrieve the current entry count *//** Overridden from RequestInfoImpl.  Calls the super class, then ... */setReplyStatus(...)SUCCESSFUL.valueSYSTEM_EXCEPTION.valueUSER_EXCEPTION.valueTRANSPORT_RETRY.value/** Sets DII request object in the RequestInfoObject. *//** Keeps track of whether initiate was called for a DII request.  The ORB ... */this.diiInitiate/** See comment for setDIIInitiate *//** The PICurrent stack should only be popped if it was pushed. ... */this.piCurrentPushed/** Overridden from RequestInfoImpl. */setException(...)response_expected(...)/** See description for RequestInfoImpl.checkAccess */int validCallIndexinvalidPiCall2(...)/* Copyright (c) 2000, 2012, Oracle and/or its affiliates. All rights reserved. ... */// Please keep these in the same order that they're declared above.// 6763340// Do not reset entryCount because we need to know when to pop this// from the stack.// Clear cached attributes:// LEGEND:// s_req = send_request     r_rep = receive_reply// s_pol = send_poll        r_exc = receive_exception//                          r_oth = receive_other// A true value indicates call is valid at specified point.// A false value indicates the call is invalid.// NOTE: If the order or number of columns change, update// checkAccess() accordingly.//                              { s_req, s_pol, r_rep, r_exc, r_oth }// RequestInfo methods:/* request_id *//* operation *//* arguments *//* exceptions *//* contexts *//* operation_context *//* result *//* response_expected *//* sync_scope *//* reply_status *//* forward_reference *//* get_slot *//* get_request_service_context *//* get_reply_service_context */// ClientRequestInfo methods::/* target *//* effective_target *//* effective_profile *//* received_exception *//* received_exception_id *//* get_effective_component *//* get_effective_components *//* get_request_policy *//* add_request_service_context */// access is currently valid for all states://checkAccess( MID_TARGET );//checkAccess( MID_EFFECTIVE_TARGET );// Note: This is not necessarily the same as locatedIOR.// Reason: See the way we handle COMM_FAILURES in// ClientRequestDispatcher.createRequest, v1.32// REVISIT - get through chain like getLocatedIOR helper below.//checkAccess( MID_EFFECTIVE_PROFILE );// Good citizen: In the interest of efficiency, we assume interceptors// will not modify the returned TaggedProfile in any way so we need// not make a deep copy of it.// will not modify the returned Any in any way so we need// Note: exception should never be null here since we will// throw a BAD_INV_ORDER if this is not called from// receive_exception.// _REVISIT_ We need to be able to handle a UserException in the// DII case.  How do we extract the ID from a UserException?// Look in cache:// null could mean we cached null or not in cache.// Not in cache.  Get it from the profile:// As per ptc/00-08-06, section 21.3.13.6., If not found, raise// BAD_PARAM with minor code INVALID_COMPONENT_ID.// Good citizen: In the interest of efficiency, we will assume// interceptors will not modify the returned TaggedCompoent[], or// the TaggedComponents inside of it.  Otherwise, we would need to// clone the array and make a deep copy of its contents.// _REVISIT_ Our ORB is not policy-based at this time.//checkAccess( MID_REQUEST_ID );/* NOTE: The requestId in client interceptors is the same as the ... *///checkAccess( MID_OPERATION );// If it is DII request then get the arguments from the DII req// and convert that into parameters.// Good citizen: In the interest of efficiency, we assume// interceptors will be "good citizens" in that they will not// modify the contents of the Parameter[] array.  We also assume// they will not change the values of the containing Anys.// Get the list of exceptions from DII request data, If there are// no exceptions raised then this method will return null.// modify the contents of the TypeCode[] array.  We also assume// they will not change the values of the containing TypeCodes.// Get the list of contexts from DII request data, If there are// no contexts then this method will return null.// modify the contents of the String[] array.// _REVISIT_ The API for get_values is not compliant with the spec,// Revisit this code once it's fixed.// _REVISIT_ Our ORB doesn't support Operation Context, This code// will not be excerscised until it's supported.// The first parameter in get_values is the start_scope which// if blank makes it as a global scope.// The second parameter is op_flags which is set to RESTRICT_SCOPE// As there is only one defined in the spec.// The Third param is the pattern which is '*' requiring it to// get all the contexts.// The String[] array will contain Name and Value for each// context and hence double the size in the array.// Get the result from the DII request data.// Good citizen: In the interest of efficiency, we assume that// interceptors will not modify the contents of the result Any.// Otherwise, we would need to create a deep copy of the Any.//checkAccess( MID_RESPONSE_EXPECTED );// Check to make sure we are in LOCATION_FORWARD// state as per ptc/00-08-06, table 21-1// footnote 2.// Do not cache this value since if an interceptor raises// forward request then the next interceptor in the// list should see the new value.// REVISIT - this most likely causes reportRedirect to happen twice.// Once here and once inside the request dispatcher.// In the event this is called from a oneway, we will have no// response object.// In the event this is called after a IIOPConnection.purgeCalls,// we will have a response object, but that object will// not contain a header (which would hold the service context// container).  See bug 4624102.// REVISIT: this is the only thing used// from response at this time.  However, a more general solution// would avoid accessing other parts of response's header.// Instead of throwing a NullPointer, we will// "gracefully" handle these with a BAD_PARAM with minor code 25.// REVISIT how this is programmed - not what it does.// See purge calls test.  The waiter is woken up by the// call to purge calls - but there is no reply containing// service contexts.// REVISIT - so mediator can handle DII in subcontract.// Clear cached values:// Make sure currentPoint matches the appropriate index in the// validCall table:// Check the validCall table:import CodecFactoryimport UnknownEncodingimport Encodingimport ENCODING_CDR_ENCAPS/** CodecFactoryImpl is the implementation of the Codec Factory, as described ... */new Codec[]// The ORB that created this Codec Factoryint MAX_MINOR_VERSION_SUPPORTED;// Currently, this is 1.2.// The maximum minor version of GIOP supported by this codec factory....[] codecs;// 1.(MAX_MINOR_VERSION_SUPPORTED)// The pre-created minor versions of Codec version 1.0, 1.1, ...,/** Creates a new CodecFactory implementation.  Stores the ORB that ... */int minornew CDREncapsCodec(...)/** Creates a codec of the given encoding.  The only format recognized ... */Codec resultenc.formatENCODING_CDR_ENCAPS.valueenc.major_versionenc.minor_versionnew UnknownEncoding(...)/** Called when an invalid null parameter was passed.  Throws a ... */// Precreate a codec for version 1.0 through// 1.(MAX_MINOR_VERSION_SUPPORTED).  This can be// done since Codecs are immutable in their current implementation.// This is an optimization that eliminates the overhead of creating// a new Codec each time create_codec is called.// This is the only format we can currently create codecs for:import INV_POLICYimport IORInfoimport ObjectReferenceTemplateimport ObjectReferenceFactoryimport ObjectAdapterimport IORInfoExtimport UnknownTypeimport TaggedProfileTemplateimport TaggedComponentFactoryFinderimport InterceptorsSystemException/** IORInfoImpl is the implementation of the IORInfo class, as described ... */int STATE_INITIAL;// add_component, and add_component_to_profile are valid.// get_effective_policy, manager_id, and adapter_state are valid unless STATE_DONE// State values that determine which methods are allowed.int STATE_ESTABLISHED;// adapter_template, and R/W to current_factory are validint STATE_DONE;// No methods are valid in this state// The current state of this objectObjectAdapter adapter;// The ObjectAdapter associated with this IORInfo object.ORBUtilSystemException orbutilWrapper;InterceptorsSystemException wrapper;/** Creates a new IORInfo implementation.  This info object will establish ... */this.adapter/** An ORB service implementation may determine what server side policy ... */checkState(...)getEffectivePolicy(...)/** A portable ORB service implementation calls this method from its ... */addIORComponentToProfileInternal(...)getIORTemplate(...)iteratorById(...)/** @param ... */legacyGetTransientOrPersistentServerPort(...)new UnknownType(...)getManagerId(...)getState(...)getAdapterTemplate(...)getCurrentFactory(...)setCurrentFactory(...)/** Internal utility method to add an IOR component to the set of profiles ... */TaggedComponentFactoryFinder findergetTaggedComponentFactoryFinder(...)Object newTaggedComponentcreate(...)boolean foundTaggedProfileTemplate taggedProfileTemplateinvalidProfileId(...)// REVISIT: add minor codes!badState1(...)badState2(...)// At this point, the iortemp must contain only a single// IIOPProfileTemplate.  This is a restriction of our// implementation.  Also, note the the ObjectReferenceTemplate// is called when a certain POA is created in a certain ORB// in a certain server, so the server_id, orb_id, and// poa_id operations must be well-defined no matter what// kind of implementation is used: e.g., if a POA creates// IORs with multiple profiles, they must still all agree// about this information.  Thus, we are justified in// extracting the single IIOPProfileTemplate to create// an ObjectReferenceTemplate here.// Convert the given IOP::TaggedComponent into the appropriate// type for the TaggedProfileTemplate// Iterate through TaggedProfileTemplates and add the given tagged// component to the appropriate one(s).// If no profile was found with the given id, throw a BAD_PARAM:// (See orbos/00-08-06, section 21.5.3.3.)import Delegateimport ClientRequestInterceptorimport ForwardRequestimport IORInterceptorimport IORInterceptor_3_0import ServerRequestInfoimport ServerRequestInterceptor/** Handles invocation of interceptors.  Has specific knowledge of how to ... */// The ORBInterceptorList interceptorList;// The list of interceptors to be invokedboolean enabled;// in the RequestInfoStack in PIHandlerImpl is only for a particular Thread.// Note: This is a global enable/disable flag, whereas the enable flag// True if interceptors are to be invoked, or false if notPICurrent current;// PICurrent variable./** Creates a new Interceptor Invoker.  Constructor is package scope so ... */// time.// Multiple threads may be calling methods on this invoker at the same// NOTE: Be careful about adding additional attributes to this class.this.interceptorListthis.enabledthis.current/** Enables or disables the interceptor invoker *//** Called when a new POA is created. ... */IORInfoImpl infonew IORInfoImpl(...)IORInterceptor[] iorInterceptorsgetInterceptors(...)InterceptorList.INTERCEPTOR_TYPE_IORiorInterceptors.lengthIORInterceptor interceptorestablish_components(...)makeStateEstablished(...)IORInterceptor_3_0 interceptor30components_established(...)makeStateDone(...)IORInterceptor[] interceptorsinterceptors.lengthadapter_manager_state_changed(...)adapter_state_changed(...)/** Invokes either send_request, or send_poll, depending on the value ... */ClientRequestInterceptor[] clientInterceptorsInterceptorList.INTERCEPTOR_TYPE_CLIENTclientInterceptors.lengthint flowStackIndexboolean continueProcessingpushSlotTable(...)setPICurrentPushed(...)setCurrentExecutionPoint(...)info.EXECUTION_POINT_STARTINGsend_request(...)ForwardRequest esetForwardRequest(...)setEndingPointCall(...)ClientRequestInfoImpl.CALL_RECEIVE_OTHERupdateClientRequestDispatcherForward(...)SystemException eClientRequestInfoImpl.CALL_RECEIVE_EXCEPTIONsetFlowStackIndex(...)resetSlotTable(...)/** Invokes either receive_reply, receive_exception, or receive_other, ... */getFlowStackIndex(...)int endingPointCallgetEndingPointCall(...)info.EXECUTION_POINT_ENDINGgetIsOneWay(...)ClientRequestInfoImpl.CALL_RECEIVE_REPLYreceive_reply(...)receive_exception(...)receive_other(...)isPICurrentPushed(...)popSlotTable(...)/** Invokes receive_request_service_context interception points. */ServerRequestInterceptor[] serverInterceptorsInterceptorList.INTERCEPTOR_TYPE_SERVERserverInterceptors.lengthsetSlotTable(...)getSlotTable(...)receive_request_service_contexts(...)setIntermediatePointCall(...)ServerRequestInfoImpl.CALL_INTERMEDIATE_NONEServerRequestInfoImpl.CALL_SEND_OTHERServerRequestInfoImpl.CALL_SEND_EXCEPTION/** Invokes receive_request interception points */int intermediatePointCallgetIntermediatePointCall(...)info.EXECUTION_POINT_INTERMEDIATEreceive_request(...)/** Invokes either send_reply, send_exception, or send_other, ... */ServerRequestInfoImpl.CALL_SEND_REPLYsend_reply(...)send_exception(...)send_other(...)setForwardRequestRaisedInEnding(...)setAlreadyExecuted(...)/** Update the client delegate in the event of a ForwardRequest, given the ... */ForwardRequest forwardRequestgetForwardRequestException(...)Object objectforwardRequest.forwardgetIOR(...)setLocatedIOR(...)// If invocation is not yet enabled, don't do anything.// Create IORInfo object to pass to IORInterceptors:// Call each IORInterceptor:// Implementation note:// This loop counts backwards for greater efficiency.// Benchmarks have shown that counting down is more efficient// than counting up in Java for loops, as a compare to zero is// faster than a subtract and compare to zero.  In this case,// it doesn't really matter much, but it's simply a force of habit.// as per PI spec (orbos/99-12-02 sec 7.2.1), if// establish_components throws an exception, ignore it.// Change the state so that only template operations are valid// Note that exceptions here are NOT ignored, as per the// ORT spec (orbos/01-01-04)// Change the state so that no operations are valid,// in case a reference to info escapes this scope.// This also completes the actions associated with the// template interceptors on this POA.// No-op: ignore exception in this case// Make a a fresh slot table available to TSC in case// interceptors need to make out calls.// Client's TSC is now RSC via RequestInfo.// Get all ClientRequestInterceptors:// We will assume that all interceptors returned successfully,// and adjust the flowStackIndex to the appropriate value if// we later discover otherwise.// Determine whether we are calling send_request or send_poll:// (This is currently commented out because our ORB does not// yet support the Messaging specification, so send_poll will// never occur.  Once we have implemented messaging, this may// be uncommented.)// int startingPointCall = info.getStartingPointCall();// Again, it is not necessary for a switch here, since// there is only one starting point call type (see// above comment).//switch( startingPointCall ) {//case ClientRequestInfoImpl.CALL_SEND_REQUEST://clientInterceptors[i].send_request( info );//break;//case ClientRequestInfoImpl.CALL_SEND_POLL://clientInterceptors[i].send_poll( info );// as per PI spec (orbos/99-12-02 sec 5.2.1.), if// interception point throws a ForwardRequest,// no other Interceptors' send_request operations are// called.// For some reason, using break here causes the VM on// NT to lose track of the value of flowStackIndex// after exiting the for loop.  I changed this to// check a boolean value instead and it seems to work// fine.// interception point throws a SystemException,// check a boolean value instead and it seems to// work fine.// Remember where we left off in the flow stack:// Make the SlotTable fresh for the next interception point.// end enabled check// NOTE: It is assumed someplace else prepared a// fresh TSC slot table.// Determine whether we are calling receive_reply,// receive_exception, or receive_other:// If we would be calling RECEIVE_REPLY, but this is a// one-way call, override this and call receive_other:// Only step through the interceptors whose starting points// have successfully returned.// Unlike the previous loop, this one counts backwards for a// reason - we must execute these in the reverse order of the// starting points.// interception point throws a ForwardException,// ending point call changes to receive_other.// ending point call changes to receive_exception.// See doc for setPICurrentPushed as to why this is necessary.// Check info for null in case errors happen before initiate.// After the pop, original client's TSC slot table// remains avaiable via PICurrent.// Make a fresh slot table for RSC.// Make a fresh slot table for TSC in case// Get all ServerRequestInterceptors:// Currently, there is only one server-side starting point// interceptor called receive_request_service_contexts.// as per PI spec (orbos/99-12-02 sec 5.3.1.), if// no other Interceptors' starting points are// called and send_other is called.// The remaining points, ServantManager and Servant// all run in the same logical thread.// Now TSC and RSC are equivalent.// NOTE: do not touch the slotStack.  The RSC and TSC are// equivalent at this point.// Currently, there is only one server-side intermediate point// interceptor called receive_request.// no other Interceptors' intermediate points are// REVISIT: This is moved out to PIHandlerImpl until dispatch// path is rearchitected.  It must be there so that// it always gets executed so if an interceptor raises// an exception any service contexts added in earlier points// this point get put in the exception reply (via the SC Q).//info.setCurrentExecutionPoint( info.EXECUTION_POINT_ENDING );// Determine whether we are calling// send_exception, or send_other:// ending point call changes to send_exception.// Remember that all interceptors' starting and ending points// have already been executed so we need not do anything.// Get rid of the Server side RSC.// ForwardRequest may be null if the forwarded IOR is set internal// to the ClientRequestDispatcher rather than explicitly through Portable// Interceptors.  In this case, we need not update the client// delegate ForwardRequest object.// Convert the forward object into an IOR:import Interceptorimport ORBInitInfoimport DuplicateNameimport Collectionimport Array/** Provides a repository of registered Portable Interceptors, organized ... */new Interceptor[][]ClientRequestInterceptor.classServerRequestInterceptor.classIORInterceptor.classint INTERCEPTOR_TYPE_CLIENT;// types, so we know how many lists to maintain.// NUM_INTERCEPTOR_TYPES represents the number of interceptor// and update NUM_INTERCEPTOR_TYPES and classTypes accordingly.// add additional types in numerical order (do not skip numbers),// Interceptor type list.  If additional interceptors are needed,int INTERCEPTOR_TYPE_SERVER;int INTERCEPTOR_TYPE_IOR;int NUM_INTERCEPTOR_TYPES;...[] classTypes;// match the indices of the constants declared above.// appropriate array type for each interceptor type.  These must// Array of class types for interceptors.  This is used to create theboolean locked;// True if no further interceptors may be registered with this list....[] interceptors;// of objects of type ClientRequestInterceptor.// For example, interceptors[INTERCEPTOR_TYPE_CLIENT] contains an array// NUM_INTERCEPTOR_TYPES lists of registered interceptors.// List of interceptors currently registered.  There are/** Creates a new Interceptor List.  Constructor is package scope so ... */initInterceptorArrays(...)/** Registers an interceptor of the given type into the interceptor list. ... */String interceptorNameboolean anonymousboolean foundDuplicateInterceptor[] interceptorListinterceptorListLocked(...)interceptorList.lengthInterceptor ingrowInterceptorArray(...)...[...].lengthnew DuplicateName(...)/** Locks this interceptor list so that no more interceptors may be ... *//** Retrieves an array of interceptors of the given type.  For efficiency, ... *//** Returns true if there is at least one interceptor of the given type, ... *//** Initializes all interceptors arrays to zero-length arrays of the ... */Class<> classType/** Grows the given interceptor array by one: */int currentLengthInterceptor[] replacementArray/** Destroys all interceptors in this list by invoking their destroy() ... */int numTypesint numInterceptors/** Sort interceptors. */List<> sortedList<> unsortedInterceptor interceptorIterator<> sortedIteratorIterator<> unsortedIteratorsortSizeMismatch(...)// Create empty interceptors arrays for each type:// If locked, deny any further addition of interceptors.// Cache interceptor name:// If this is not an anonymous interceptor,// search for an interceptor of the same name in this category:// An O(n) search will suffice because register_interceptor is not// likely to be called often.// Create a zero-length array for each type:// Create new array to replace the old one.  The new array will be// one element larger but have the same type as the old one.// Get fresh sorting bins for each non empty type.// not synchronized like we want.// Let the RuntimeExceptions thrown by sort// (i.e., ClassCastException and UnsupportedOperationException)// flow back to the user.import PolicyErrorimport PolicyFactoryimport ORBInitInfoExt/** ORBInitInfoImpl is the implementation of the ORBInitInfo class to be ... */// The ORB we are initializing...[] args;// The arguments passed to ORB_init// The ID of the ORB being initializedCodecFactory codecFactory;// The CodecFactoryint stage;// The current stage of initializationint STAGE_PRE_INIT;// The pre-initialization stage (pre_init() being called)int STAGE_POST_INIT;// The post-initialization stage (post_init() being called)int STAGE_CLOSED;// Reject all calls - this object should no longer be around.String MESSAGE_ORBINITINFO_INVALID;// The description for the OBJECT_NOT_EXIST exception in STAGE_CLOSED/** Creates a new ORBInitInfoImpl object (scoped to package) ... */this.argsthis.orbIdthis.codecFactory/** Return the ORB behind this ORBInitInfo.  This is defined in the ... *//** Sets the current stage we are in.  This limits access to certain ... */this.stage/** Throws an exception if the current stage is STAGE_CLOSED. ... */orbinitinfoInvalid(...)/** This attribute contains the arguments passed to ORB_init.  They may ... */checkStage(...)/** This attribute is the ID of the ORB being initialized *//** This attribute is the IOP::CodecFactory.  The CodecFactory is normally ... *//** See orbos/99-12-02, Chapter 11, Dynamic Initial References on page ... */rirWithNullObject(...)InvalidName eInvalidName excnew InvalidName(...)/** This operation is only valid during post_init.  It is identical to ... */Object objRefrirInvalidPreInit(...)// New method from CORBA 3.1add_client_request_interceptor(...)/** This operation is used to add a client-side request Interceptor to ... */register_interceptor(...)add_server_request_interceptor(...)/** This operation is used to add a server-side request Interceptor to ... */add_ior_interceptor(...)/** This operation is used to add an IOR Interceptor to ... *//** A service calls allocate_slot_id to allocate a slot on ... */allocateSlotId(...)getPICurrent(...)/** Register a PolicyFactory for the given PolicyType. ... */registerPolicyFactory(...)// As per CORBA 3.0 section 21.8.1,// if null is passed as the obj parameter,// throw BAD_PARAM with minor code OMGSystemException.RIR_WITH_NULL_OBJECT.// Though the spec is talking about IDL null, we will address both// Java null and IDL null:// Note: Local Objects can never be nil!// This check was made to determine that the objref is a// non-local objref that is fully// initialized: this was called only for its side-effects of// possibly throwing exceptions.  However, registering// local objects should be permitted!// XXX/Revisit?// IOR ior = ORBUtility.getIOR( obj ) ;// Delegate to ORB.  If ORB version throws InvalidName, convert to// equivalent Portable Interceptors InvalidName.// Initializer is not allowed to invoke this method during// this stage.// _REVISIT_ Spec issue: What exception should really be// thrown here?// Convert PIDL to IDL exception:// XXX ignore policies for nowimport Currentimport InvalidSlot/** PICurrent is the implementation of Current as specified in the Portable ... */PICurrent$1SlotTable tablenew SlotTable(...)new SlotTableStack(...)int slotCounter;// slotCounter is used to keep track of ORBInitInfo.allocate_slot_id()ORB myORB;// The ORB associated with this PICurrent object.OMGSystemException wrapper;boolean orbInitializing;// to be called.// True if the orb is still initialzing and get_slot and set_slot are notThreadLocal<> threadLocalSlotTable;// for resolve_initial_references( "PICurrent" );// ThreadLocal contains a stack of SlotTable which are used/** PICurrent constructor which will be called for every ORB ... */this.myORBthis.orbInitializing/** This method will be called from ORBInitInfo.allocate_slot_id( ). ... */int slotId/** This method gets the SlotTable which is on the top of the ... */peekSlotTable(...)/** This method pushes a SlotTable on the SlotTableStack. When there is ... */SlotTableStack st/** This method pops a SlotTable on the SlotTableStack. *//** This method sets the slot data at the given slot id (index) in the ... */invalidPiCall3(...)set_slot(...)/** This method gets the slot data at the given slot id (index) from the ... */invalidPiCall4(...)get_slot(...)/** This method resets all the slot data to null in the ... */resetSlots(...)/** Called from ORB when the ORBInitializers are about to start ... */// As per ptc/00-08-06 if the ORB is still initializing, disallow// calls to get_slot and set_slot.  If an attempt is made to call,// throw a BAD_INV_ORDER.import BAD_POLICYimport COMM_FAILUREimport ORBInitializerimport ClosureFactoryimport PIHandlerimport RequestImplimport StackImpl/** Provides portable interceptor functionality. */PIHandlerImpl$1new RequestInfoStack(...)PIHandlerImpl$2boolean printPushPopEnabled;// REVISIT - delete these after framework merging.int pushLevel;printSpaces(...)int serverRequestIdCounter;// This does not correspond to the GIOP request id.// A unique id used in ServerRequestInfo.// Stores the codec factory for producing codecs...[] arguments;// This is used for ORBInitializers and set from set_parameters.// The arguments passed to the application's main method.  May be null.// The list of portable interceptors, organized by type:boolean hasIORInterceptors;// registered of the given types?  Set during ORB initialization.// Cached information for optimization - do we have any interceptorsboolean hasClientInterceptors;boolean hasServerInterceptors;// temp always trueInterceptorInvoker interceptorInvoker;// The class responsible for invoking interceptors// There will be one PICurrent instantiated for every ORB.HashMap<> policyFactoryTable;// Value is PolicyFactory.// Key for the table is PolicyType which is an Integer// ORBInitInfo.registerPolicyFactory() method.// This table contains a list of PolicyFactories registered using...[] REPLY_MESSAGE_TO_PI_REPLY_STATUS;// ReplyMessage not to change.// Note that this table relies on the order and constants of// Table to convert from a ReplyMessage.? to a PI replyStatus short.ThreadLocal<> threadLocalClientRequestInfoStack;// and a disable count.// ThreadLocal containing a stack to store client request info objectsThreadLocal<> threadLocalServerRequestInfoStack;// ThreadLocal containing the current server request info object.PIHandlerImpl$RequestInfoStack// RequestInfoStack is used quite frequently.// We use an ArrayList instead since it is not thread-safe.// maintenance.// Class to contain all ThreadLocal data for ClientRequestInfoint disableCount;// NOTE: The is only currently used on the client side.// value indicates they are enabled.// When this reaches 0, interception hooks are disabled.  Any higher// Number of times a request has been made to disable interceptors.new CodecFactoryImpl(...)new InterceptorList(...)new PICurrent(...)new InterceptorInvoker(...)getLocalResolver(...)ORBConstants.PI_CURRENT_NAMEmakeConstant(...)ORBConstants.CODEC_FACTORY_NAMEgetORBInitializers(...)ORBInitInfoImpl orbInitInfocreateORBInitInfo(...)setORBInitializing(...)preInitORBInitializers(...)postInitORBInitializers(...)sortInterceptors(...)setStage(...)ORBInitInfoImpl.STAGE_CLOSEDhasInterceptorsOfType(...)setEnabled(...)/** ptc/00-08-06 p 205: "When an application calls ORB::destroy, the ORB ... */destroyAll(...)objectAdapterCreated(...)adapterManagerStateChanged(...)adapterStateChanged(...)/* **************** ... */RequestInfoStack infoStackinfoStack.disableCountClientRequestInfoImpl infopeekClientRequestInfoImplStack(...)short replyStatusgetReplyStatus(...)isClientPIEnabledForThisThread(...)invokeClientInterceptorStartingPoint(...)Exception exceptionconvertPIReplyStatusToReplyMessage(...)exceptionInvalid(...)ClientRequestInfoImpl.UNINITIALIZEDreplyStatusNotInit(...)// but BEFORE invokeClientPIStartingPoint.// Needed when an error forces a retry AFTER initiateClientPIRequesthandleClientPIEndingPoint(...)short piReplyStatusinvokeClientInterceptorEndingPoint(...)setRetryRequest(...)RetryType.AFTER_RESPONSERetryType.BEFORE_RESPONSEnew RemarshalException(...)empty(...)peek(...)isDIIInitiate(...)setDIIInitiate(...)isRetry(...)getRetryRequest(...)new ClientRequestInfoImpl(...)printPush(...)incrementEntryCount(...)RequestInfoImpl.UNINITIALIZEDRetryType rtinfo.UNINITIALIZEDunknownRequestInvoke(...)decrementEntryCount(...)getEntryCount(...)pop(...)printPop(...)setInfo(...)setDIIRequest(...)ServerRequestInfoImpl infopeekServerRequestInfoImplStack(...)invokeServerInterceptorStartingPoint(...)serverPIHandleExceptions(...)invokeServerInterceptorIntermediatePoint(...)releaseServant(...)setReplyMessage(...)getAlreadyExecuted(...)int replyStatusException prevExceptionshort newPIReplyStatusException newExceptionisDynamic(...)unknownUserException(...)invokeServerInterceptorEndingPoint(...)getForwardRequestIOR(...)isForwardRequestRaisedInEnding(...)setIOR(...)setDSIArguments(...)setDSIException(...)setDSIResult(...)new ServerRequestInfoImpl(...)setExecutePIInResponseConstructor(...)/** Handles exceptions for the starting and intermediate points for ... *//** Utility method to convert a PI reply status short to a ReplyMessage ... */REPLY_MESSAGE_TO_PI_REPLY_STATUS.length/** Convenience method to get the ClientRequestInfoImpl object off the ... */clientInfoStackNull(...)/** Convenience method to get the ServerRequestInfoImpl object off the ... */serverInfoStackNull(...)/** Convenience method to determine whether Client PI is enabled ... *//** Call pre_init on all ORB initializers */ORBInitInfoImpl.STAGE_PRE_INITgetORBInitializers(...).lengthORBInitializer initpre_init(...)/** Call post_init on all ORB initializers */ORBInitInfoImpl.STAGE_POST_INITpost_init(...)/** Creates the ORBInitInfo object to be passed to ORB intializers' ... */ORBInitInfoImpl resultnew ORBInitInfoImpl(...)/** Called by ORBInitInfo when an interceptor needs to be registered. ... */InterceptorList.NUM_INTERCEPTOR_TYPEStypeOutOfRange(...)nameNull(...)/** This is the implementation of standard API defined in org.omg.CORBA.ORB ... */PolicyFactory factoryPolicy policycreate_policy(...)new PolicyError(...)BAD_POLICY.value/** This method registers the Policy Factory in the policyFactoryTable, ... */policyFactoryRegFailed(...)// = ReplyMessage.NO_EXCEPTION// = ReplyMessage.USER_EXCEPTION// = ReplyMessage.SYSTEM_EXCEPTION// = ReplyMessage.LOCATION_FORWARD// = ReplyMessage.LOCATION_FORWARD_PERM// = ReplyMessage.NEEDS_ADDRESSING_MODE// Create codec factory:// Create new interceptor list:// Create a new PICurrent.// Create new interceptor invoker, initially disabled:// Register the PI current and Codec factory objects// If we have any orb initializers, make use of them:// Create the ORBInitInfo object to pass to ORB intializers:// Make sure get_slot and set_slot are not called from within// ORB initializers:// Call pre_init on all ORB initializers:// Call post_init on all ORB initializers:// Proprietary: sort interceptors:// Re-enable get_slot and set_slot to be called from within// Ensure nobody makes any more calls on this object.// Set cached flags indicating whether we have interceptors// registered of a given type.// XXX This must always be true, so that using the new generic// RPC framework can pass info between the PI stack and the// framework invocation stack.  Temporary until Harold fixes// this.  Note that this must never be true until after the// ORBInitializer instances complete executing.//hasClientInterceptors = interceptorList.hasInterceptorsOfType(//InterceptorList.INTERCEPTOR_TYPE_CLIENT );// Enable interceptor invoker (not necessary if no interceptors// are registered).  This should be the last stage of ORB// initialization.// Invoke the starting interception points and record exception// and reply status info in the info object:// Check reply status.  If we will not have another chance later// to invoke the client ending points, do it now.// Note: Transport retry cannot happen here since this happens// before the request hits the wire.// Do not throw anything.  Otherwise, it must be a// SystemException, UserException or RemarshalException.// It should not be possible for an interceptor to throw// a UserException.  By asserting instead of throwing the// UserException, we need not declare anything but// RemarshalException in the throws clause.// Translate ReplyMessage.replyStatus into PI replyStatus:// Note: this is also an assertion to make sure a valid replyStatus// is passed in (IndexOutOfBoundsException will be thrown otherwise)// Invoke the ending interception points and record exception// Check reply status:// If this is a forward or a retry, reset and reuse// info object:// fix for 6763340:// ... and return a RemarshalException so the orb internals know// Get the most recent info object from the thread local// ClientRequestInfoImpl stack:// In RequestImpl.doInvocation we already called// initiateClientPIRequest( true ), so ignore this initiate.// If there is no info object or if we are not retrying a request,// push a new ClientRequestInfoImpl on the stack:// 6763340: don't push unless this is not a retry// Note: the entry count is automatically initialized to 0.// Reset the retry request flag so that recursive calls will// push a new info object, and bump up entry count so we know// when to pop this info object:// KMC 6763340: I don't know why this wasn't set earlier,// but we do not want a retry to pick up the previous// reply status, so clear it here.  Most likely a new// info was pushed before, so that this was not a problem.// If this is a DII request, make sure we ignore the next initiate.// fix for 6763340// If the replyStatus has not yet been set, this is an indication// that the ORB threw an exception before we had a chance to// invoke the client interceptor ending points.// _REVISIT_ We cannot handle any exceptions or ForwardRequests// flagged by the ending points here because there is no way// to gracefully handle this in any of the calling code.// This is a rare corner case, so we will ignore this for now.// Decrement entry count, and if it is zero, pop it from the stack.// fix for 6763340, and probably other cases (non-recursive retry)// RequestInfoStack<ClientRequestInfoImpl> infoStack =//     threadLocalClientRequestInfoStack.get();// Handle SystemException or ForwardRequest:// Clear servant from info object so that the user has control over// its lifetime:// REVISIT: This needs to be done "early" for the following workaround.// REVISIT: This was done inside of invokeServerInterceptorEndingPoint// but needs to be here for now.  See comment in that method for why.// It is possible we might have entered this method more than// once (e.g. if an ending point threw a SystemException, then// a new ServerResponseImpl is created).// Note: this is also an assertion to make sure a valid// replyStatus is passed in (IndexOutOfBoundsException will be// thrown otherwise)// Make forwarded IOR available to interceptors, if applicable:// REVISIT: Do early above for now.// Make reply message available to interceptors://info.setReplyMessage( replyMessage );// Remember exception so we can tell if an interceptor changed it.// _REVISIT_ We do not have access to the User Exception at// this point, so treat it as an UNKNOWN for now.// Note that if this is a DSI call, we do have the user exception.// Invoke the ending interception points:// Check reply status.  If an interceptor threw a SystemException// and it is different than the one that we came in with,// rethrow it so the proper response can be constructed:// If we are to forward the location:// Treat a ForwardRequest as a ForwardException.// Treat a ForwardRequest by changing the IOR.// Notify request object that once response is constructed, make// sure we execute ending points.// If a system exception was thrown, throw it to caller:// If an interceptor throws a forward request, convert it// into a ForwardException for easier handling:// Inform ORBInitInfo we are in pre_init stage// Step through each initializer instantiation and call its// pre_init.  Ignore any exceptions.// As per orbos/99-12-02, section 9.3.1.2, "If there are// any exceptions, the ORB shall ignore them and proceed."// Inform ORBInitInfo we are in post_init stage// Step through each initializer instantiation and call its post_init.// Ignore any exceptions.// arguments comes from set_parameters.  May be null.// _REVISIT_ The spec does not specify which ID this is to be.// We currently get this from the corba.ORB, which reads it from// the ORB_ID_PROPERTY property.// We will assume interceptor is not null, since it is called// internally.// Register with interceptor list:/** This is No-Op implementation of PIHandler. It is used in ORBConfigurator ... *//* Copyright (c) 2003, 2012, Oracle and/or its affiliates. All rights reserved. ... */import RequestInfoimport SYNC_WITH_TRANSPORTimport RequestInfoExtimport SharedSecrets/** Implementation of the RequestInfo interface as specified in ... */// The ORB from which to get PICurrent and other infoOMGSystemException stdWrapper;int flowStackIndex;// See setFlowStackIndex for a detailed description.// The number of interceptors actually invoked for this client request.int startingPointCall;// appropriate constants.// See ClientRequestInfoImpl and ServerRequestInfoImpl for a list of// The type of starting point call to make to the interceptorsint intermediatePointCall;// here in case intermediate points are introduced in the future.// This does not currently apply to client request interceptors but is// See ServerRequestInfoImpl for a list of appropriate constants.// The type of intermediate point call to make to the interceptorsint endingPointCall;// The type of ending point call to make to the interceptorsshort replyStatus;// to UNINITIALIZED so that we can tell if this has been set or not.// The reply status to return in reply_status.  This is initializedshort UNINITIALIZED;// Constant for an uninitizlied reply status.int currentExecutionPoint;// validity table).// Which points we are currently executing (so we can implement theint EXECUTION_POINT_STARTING;int EXECUTION_POINT_INTERMEDIATE;int EXECUTION_POINT_ENDING;boolean alreadyExecuted;// executed.// Set to true if all interceptors have had all their pointsConnection connection;// Sources of request informationServiceContexts serviceContexts;ForwardRequest forwardRequest;// two attributes are always kept in sync.// field is queried, it is lazily calculated and cached.  These// When set, the other field is set to null initially.  If the other// Either the forwardRequest or the forwardRequestIOR field is set.// The ForwardRequest object if this request is being forwarded.IOR forwardRequestIOR;SlotTable slotTable;// PICurrent's  SlotTableException exception;// received_exception_id// The exception to be returned by received_exception andint MID_REQUEST_ID;// Method IDs for all methods in RequestInfo.  This allows for aint MID_OPERATION;int MID_ARGUMENTS;int MID_EXCEPTIONS;int MID_CONTEXTS;int MID_OPERATION_CONTEXT;int MID_RESULT;int MID_RESPONSE_EXPECTED;int MID_SYNC_SCOPE;int MID_REPLY_STATUS;int MID_FORWARD_REFERENCE;int MID_GET_SLOT;int MID_GET_REQUEST_SERVICE_CONTEXT;int MID_GET_REPLY_SERVICE_CONTEXT;int MID_RI_LAST;// The last value from RequestInfo (be sure to update this):/** Creates a new RequestInfoImpl object. */PICurrent current/** Implementation for request_id() differs for client and server ... *//** Implementation for operation() differs for client and server ... *//** This method returns the list of arguments for the operation that was ... *//** This method returns the list of exceptios  that was raised when the ... *//** This method returns the list of contexts for the DII operation. ... *//** This method returns the list of operation_context for the DII operation. ... *//** This method returns the result from the invoked DII operation. ... *//** Implementation for response_expected() differs for client and server ... *//** Defined in the Messaging specification.  Pertinent only when ... */SYNC_WITH_TRANSPORT.value/** Describes the state of the result of the operation invocation.  Its ... *//** Implementation for forward_reference() differs for client and server ... *//** Returns the data from the given slot of the PortableInterceptor::Current ... *//** Implementation for get_request_service_context() differs for client ... *//** Implementation for get_reply_service_context() differs for client ... *//** @return ... *///    in both ClientRequestInfoImpl and ServerRequestInfoImpl.// 3. Define entries in the validCall[][] table for interception points/** Inserts the UserException inside the given ApplicationException ... */RepositoryId repIdString helperClassNameClass<?> helperClassloadClass(...)getJavaCorbaAccess(...)Class<>[] readParamsgetMethod(...)InputStream ueInputStreamUserException userException? ...Object[] readArgumentsIOException emarkAndResetFailed(...)insertUserException(...)NoSuchMethodException eSecurityException eIllegalAccessException eIllegalArgumentException eInvocationTargetException e/** Inserts the UserException into the given Any. ... */Class<> exceptionClassClass<>[] insertMethodParamsMethod insertMethodObject[] insertMethodArgumentsAny.class/** Internal utility method to convert an NVList into a PI Parameter[] */Parameter[] plistnew Parameter[]Parameter pnew Parameter(...)...[...].argument...[...].modeexceptionInArguments(...)/** Utility to wrap the given Exception in an Any object and return it. ... */Any resultexceptionWasNull2(...)insertSystemException(...)ApplicationException appExceptioninsertApplicationException(...)UNKNOWN e/** Utility method to look up a service context with the given id and ... */ServiceContext resultServiceContext contextEncapsOutputStream outInputStream inputStream/** Utility method to add an IOP.ServiceContext to a core.ServiceContexts ... */int idEncapsOutputStream outputStreamUnknownServiceContext coreServiceContextnew UnknownServiceContext(...)serviceContextAddFailed(...)/** Sets the number of interceptors whose starting interception ... */this.flowStackIndex/** Returns the number of interceptors whose starting interception ... *//** Sets which ending interception point should be called ... */this.endingPointCall/** Retrieves the current ending point call type (see ... *//** Sets which intermediate interception point should be called ... */this.intermediatePointCall/** Retrieves the current intermediate point call type (see ... *//** Sets which starting interception point should be called ... */this.startingPointCall/** Retrieves the current starting point call type (see ... *//** Returns true if all interceptors' starting and ending points ... */this.alreadyExecuted/** Sets whether all interceotrs' starting and ending points ... *//** Sets the value to be returned by reply_status */this.replyStatus/** Gets the current reply_status without doing an access check ... *//** Stores the given ForwardRequest object for later analysis. ... */this.forwardRequestthis.forwardRequestIOR/** Stores the given IOR for later forward request analysis. ... *//** Retrieves the ForwardRequest object as a ForwardRequest exception. */new ForwardRequest(...)/** Retrieves the IOR of the ForwardRequest exception. */this.forwardRequest.forward/** Sets the exception to be returned by received_exception and ... */this.exception/** Returns the exception to be returned by received_exception and ... *//** Sets the execution point that we are currently executing ... */this.currentExecutionPoint/** Check whether the caller is allowed to access this method at ... *//** The server side does an explicit set rather than taking the ... */this.slotTablemakeObjectReference(...)// Please keep these in the same order as declared above.// We don't need to reset the Slots because they are// already in the clean state after recieve_<point> interceptor// are called.// Capture the current TSC and make it the RSC of this request.// REVISIT - get from MessageMediator//checkAccess( MID_GET_SLOT );// Delegate the call to the slotTable which was set when RequestInfo was// created.// Extract the UserException from the ApplicationException.// Look up class name from repository id:// Find the read method on the helper class:// Invoke the read method, passing in the input stream to// retrieve the user exception.  Mark and reset the stream// as to not disturb it.// Insert this UserException into the provided Any using the// helper class.// Find insert( Any, class ) method// Call helper.insert( result, userException ):// _REVISIT_ This utility method should probably be doing a deep// copy so interceptor can't accidentally change the arguments.// ParameterMode spec can be found in 99-10-07.pdf// Section:10.5.22// nv.flags spec can be found in 99-10-07.pdf// Section 7.1.1// nv.flags has ARG_IN as 1, ARG_OUT as 2 and ARG_INOUT as 3// To convert this into enum PARAM_IN, PARAM_OUT and// PARAM_INOUT the value is subtracted by 1.// Note: exception should never be null here since we will throw// a BAD_INV_ORDER if this is not called from receive_exception.// Use the Helper class for this exception to insert it into an// Any.// Insert the user exception inside the application exception// into the Any result:// As per ptc/00-08-06, 21.3.13.4. if we cannot find the// appropriate class, then return an any containing UNKNOWN,// with a minor code of 1.  This is conveniently the same// exception that is returned from the// insertApplicationException utility method.// Search cache first:// null could normally mean that either we cached the value null// or it's not in the cache.  However, there is no way for us to// cache the value null in the following code.// Not in cache.  Find it and put in cache.// Get the desired "core" service context.// Convert the "core" service context to an// "IOP" ServiceContext by writing it to a// CDROutputStream and reading it back.// Good citizen: For increased efficiency, we assume that interceptors// will not modify the returned ServiceContext.  Otherwise, we would// have to make a deep copy.// Convert IOP.service_context to core.ServiceContext:// Constructor expects id to already have been read from stream.// Place IOP.ServiceContext in cache as well:// Convert the internal IOR to a forward request exception// by creating an object reference.import Servantimport ObjectAdapterId/** Implementation of the ServerRequestInfo interface as specified in ... */int CALL_RECEIVE_REQUEST_SERVICE_CONTEXT;int CALL_RECEIVE_REQUEST;// is receive_request, but can be set to none on demand.// The available constants for intermediatePointCall.  The default (0)int CALL_INTERMEDIATE_NONE;int CALL_SEND_REPLY;int CALL_SEND_EXCEPTION;int CALL_SEND_OTHER;boolean forwardRequestRaisedInEnding;// point in the ending point.// Set to true if the server ending point raised ForwardRequest at someCorbaMessageMediator request;// Sources of server request information:Object servant;...[] objectId;ObjectKeyTemplate oktemp;...[] adapterId;// Information cached from calls to oktemp...[] adapterName;ArrayList<> addReplyServiceContextQueue;ReplyMessage replyMessage;String targetMostDerivedInterface;NVList dsiArguments;Any dsiResult;Any dsiException;boolean isDynamic;ObjectAdapter objectAdapter;int serverRequestId;Any cachedSendingException;allocateServerRequestId(...)int MID_SENDING_EXCEPTION;// Method IDs for all methods in ServerRequestInfo.  This allows for aint MID_OBJECT_ID;int MID_ADAPTER_ID;int MID_TARGET_MOST_DERIVED_INTERFACE;int MID_GET_SERVER_POLICY;int MID_SET_SLOT;int MID_TARGET_IS_A;int MID_ADD_REPLY_SERVICE_CONTEXT;int MID_SERVER_ID;int MID_ORB_ID;int MID_ADAPTER_NAME;// ServerRequestInfo validity table (see ptc/00-08-06 table 21-2)./** Creates a new ServerRequestInfo implementation. ... *//** Any containing the exception to be returned to the client. */exceptionUnavailable(...)/** The opaque object_id describing the target of the operation invocation. */piOperationNotSupported6(...)piOperationNotSupported7(...)checkForNullTemplate(...)ObjectAdapterId oaidgetObjectAdapterId(...)getAdapterName(...)/** The opaque identifier for the object adapter. */getAdapterId(...)/** The RepositoryID for the most derived interface of the servant. *//** Returns the policy in effect for this operation for the given policy ... */Policy result/** Allows an Interceptor to set a slot in the Current that is in the scope ... *//** Returns true if the servant is the given RepositoryId, false if it is ... */servantInvalid(...)/** Allows Interceptors to add service contexts to the request. */AddReplyServiceContextCommand addReplynew AddReplyServiceContextCommand(...)ServiceContexts scsgetServiceContexts(...)new ServiceContexts(...)setServiceContexts(...)addReply.service_contextaddReply.replace/** See ServerRequestInfo for javadocs. */piOperationNotSupported8(...)piDsiResultIsNull(...)getForwardRequestException(...).forwardServerRequestInfoImpl$AddReplyServiceContextCommand// reply service context, at which point they are executed.// These commands are enqueued until we have a handle on the actual// A command encapsulating a request to add a reply service context.ServiceContext service_context;boolean replace;// in the queue is replaced by this command.// BAD_INV_ORDER is thrown.  If replace is true, the original command// the service context in this command, and replace is false,// such commands.  If a command is detected to have the same id as// Adds the given add reply service context command to the queue ofAddReplyServiceContextCommand cmdcmd.service_context.context_idaddReply.service_context.context_idcmd.service_context/** Overridden from RequestInfoImpl.  This version calls the super ... */add_reply_service_context(...)BAD_INV_ORDER e/** Stores the various sources of information used for this info object. */this.requestthis.objectIdthis.oktempthis.objectAdapterthis.dsiArgumentsthis.dsiExceptionthis.dsiResultthis.servantthis.targetMostDerivedInterfacethis.isDynamic/** Set reply message */this.replyMessage/** Release the servant object so the user has control over its lifetime. ... *//** Sets the forwardRequestRaisedInEnding flag to true, indicating that ... */this.forwardRequestRaisedInEnding/** Returns true if ForwardRequest was raised by a server ending point ... *//** Returns true if this is a dynamic invocation, or false if not */// reset cached attributes:// r_rsc = receive_request_service_contexts// r_req = receive_request// s_rep = send_reply// s_exc = send_exception// s_oth = send_other//                              { r_rsc, r_req, s_rep, s_exc, s_oth }// ServerRequestInfo methods::/* sending_exception *//* object_id *//* adapter_id *//* target_most_derived_inte... *//* get_server_policy *//* set_slot *//* target_is_a *//* add_reply_service_context *//* orb_id *//* server_id *//* adapter_name */// sending_exception should not be callable if both dsiException// and exception are null.// For some reason, we never set object id.  This could be// because a servant locator caused a location forward or// raised an exception.  As per ptc/00-08-06, section 21.3.14,// we throw NO_RESOURCES// interceptors will not change the resulting byte[] array.// Otherwise, we would need to make a clone of this array.// For some reason, we never set the ObjectKeyTemplate//checkAccess( MID_GET_SERVER_POLICY );// _REVISIT_ RTF Issue: get_server_policy spec not in sync with// get_effective_policy spec.//checkAccess( MID_SET_SLOT );//checkAccess( MID_ADD_REPLY_SERVICE_CONTEXT );// May be null.  If this is null, create a new one in its place.// This is during and ending point, so we now have enough// information to add the reply service context.// We enqueue all adds for the following reasons:// If we are not in the ending point then we do not yet have a// pointer to the ServiceContexts object so we cannot access the// service contexts until we get to the ending point.// So we enqueue this add reply service context request.// It is added when we do have a handle on the service contexts object.// If we are in the ending point and we just add directly to the// SC container but then an interceptor raises a SystemException// then that add will be lost since a new container is created// for the SystemException response.// Therefore we always enqueue and never dequeue (per request) so// that all adds will be completed.// REVISIT: this does not add to the cache./* NOTE: The request id in server interceptors is NOT the ... */// If it is a DSI request then get the arguments from the DSI req// _REVISIT_ PI RTF Issue: No exception list on server side.// We do not support this because our ORB does not send contexts.// We do not support this because our ORB does not send// operation_context.// state as per ptc/00-08-06, table 21-2// If we are transitioning to ending point, we will now have a pointer// to the reply service contexts, so we can execute all queued// add reply service context requests.// _REVISIT_  The only way this can happen is if during// rrsc or rr, the interceptor tried to add with// replace=false to a service context that is present in// the reply message.  At that time there was no way for// us to check for this, so the best we can do is ignore// the original request.// We specifically do not empty the SC queue so that if// the interceptor raises an exception the queued service contexts// will be put in the exception response.// Clear cached exception value:// Make sure DSIException is null because this is the more recent one./** SlotTable is used internally by PICurrent to store the slot information. */...[] theSlotData;// The vector where all the slot data for the current thread is stored// Required for instantiating Any object.boolean dirtyFlag;// The slots will be reset to null, only if this flag is set.// The flag to check whether there are any updates in the current SlotTable./** The constructor instantiates an Array of Any[] of size given by slotSize ... *//** This method sets the slot data at the given slot id (index). */theSlotData.lengthnew InvalidSlot(...)/** This method get the slot data for the given slot id (index). *//** This method resets all the slot data to null if dirtyFlag is set. *//** This method returns the size of the allocated slots. */// First check whether the slot is allocated// If not, raise the invalid slot exception/** SlotTableStack is the container of SlotTable instances for each thread */SlotTableStack$SlotTablePool// SlotTablePool is the container for reusable SlotTables'...[] pool;// Contains a list of reusable SlotTableint HIGH_WATER_MARK;// not put SlotTable to the pool.// If the pool size reaches this limit then putSlotTable will// High water mark for the poolint currentIndex;// currentIndex points to the last SlotTable in the listnew SlotTable[]/** Puts SlotTable to the re-usable pool. *//** Gets SlotTable from the re-usable pool. */List<> tableContainer;// The List is made to behave like a stack.// Contains all the active SlotTables for each thread.// Keeps track of number of PICurrents in the stack.SlotTablePool tablePool;// stored in SlotTablePool// For Every Thread there will be a pool of re-usable SlotTables'// The ORB associated with this slot table stack/** Constructs the stack and and SlotTablePool */new SlotTablePool(...)/** pushSlotTable  pushes a fresh Slot Table on to the stack by doing the ... */SlotTable tableTempslotTableInvariant(...)/** popSlotTable does the following ... */cantPopOnlyPicurrent(...)putSlotTable(...)/** peekSlotTable gets the top SlotTable from the SlotTableStack without ... */// If there are enough SlotTables in the pool, then don't add// this table to the pool.// Let the garbage collector collect it.// If there are no entries in the pool then return null// Works like a stack, Gets the last one added first// SlotTableStack will be created with one SlotTable on the stack.// This table is used as the reference to query for number of// allocated slots to create other slottables.// get an existing PICurrent to get the slotSize// NOTE: Very important not to always "add" - otherwise a memory leak.// Add will cause the table to grow.// Set will override unused slots.// Do not pop the SlotTable, If there is only one.// This should not happen, But an extra check for safety.// Do not leak memory./** This class acts as the remote interface to receivers wishing to retrieve ... */Hashtable<> fvds;// Contains rep. ids as keys to FullValueDescriptions// having a delegate set.// Private ORBSingleton used when we need an ORB while notValueHandlerImpl vhandler;// marshalling/unmarshalling// this needs to be transient to prevent serialization during// can take place// backward compatability so that appropriate rep-id calculations// Operation to obtain the IR from the sending context// Operations to obtain a URL to the implementation codemissingLocalValueImpl(...)String[] resultx.length// the same informationtranslate(...)_orb(...)getAnyClassFromType(...)incompatibleValueImpl(...)FullValueDescription[] descriptions// informationStack<> repIdsnew Stack<>(...)Class<> parentgetSuperclass(...)forClass(...)Object.class/* Copyright (c) 1999, 2011, Oracle and/or its affiliates. All rights reserved. ... */// default to using the current ORB version in case the// vhandler is not set// Util.getCodebase may return null which would// cause a BAD_PARAM exception.import StreamCorruptedExceptionimport ObjectInputValidationimport NotActiveExceptionimport InvalidObjectExceptionimport InvalidClassExceptionimport DataInputStreamimport OptionalDataExceptionimport WriteAbortedExceptionimport Externalizableimport EOFExceptionimport java.lang.reflect.*import Bridgeimport ObjectStreamClassimport ValueInputStreamimport PortableRemoteObjectimport java.security.*import ObjectUtilityimport UtilSystemException/** IIOPInputStream is used by the ValueHandlerImpl to handle Java serialization ... */new ActiveRecursionManager(...)IIOPInputStream$1TCKind.tk_objrefgetOptDataExceptionCtor(...)Bridge bridge;UtilSystemException utilWrapper;...[] defaultReadObjectFVDMembers;// bug 4365188.// Part of serialization evolution fixes for Ladybird,// version difference.  Set in inputObjectUsingFVD.// to be obtained remotely because of a serializable// This is only used in the case where the fields had// which we can't change).// java.io.ObjectInpuStream defaultReadObject()// parameters since it's called from// defaultReadObjectDelegate method (which takes no// Necessary to pass the appropriate fields into theInputStream orbStream;CodeBase cbSender;Object currentObject;//d4365188ObjectStreamClass currentClassDesc;Class<> currentClass;int recursionDepth;int simpleReadDepth;ActiveRecursionManager activeRecursionMgr;// passive recursion system failed.// to one of the objects currently being unmarshaled, and the// unmarshaling in readObject, there can be recursive references// That created problems (as in bug 4414154) because when custom// an object was completely deserialized.// used to record how many recursions were made, and resolve them after// The ActiveRecursionManager replaces the old RecursionManager whichIOException abortIOException;ClassNotFoundException abortClassNotFoundException;/* Remember the first exception that stopped this stream. */Vector<> callbacks;/* Vector of validation callback objects ... */...[] classdesc;/* Arrays used to keep track of classes and ObjectStreamClasses ... */// Serialization machinery fields...[] classes;int spClass;String kEmptyStr;TypeCode kRemoteTypeCode;// removed TypeCodeImpl dependency//public static final TypeCode kValueTypeCode =  new TypeCodeImpl(TCKind._tk_value);//public static final TypeCode kRemoteTypeCode = new TypeCodeImpl(TCKind._tk_objref);// TCKind TypeCodes used in FVD inputClassFieldsTypeCode kValueTypeCode;boolean useFVDOnly;// optimize out the check.// TESTING CODE - useFVDOnly should be made final before FCS in order toConstructor<> OPT_DATA_EXCEPTION_CTOR;// cases, we try to do it by reflection.// package private, but we need to throw it in some special// Since java.io.OptionalDataException's constructors are...[] readObjectArgList;// will be wrapped in ExceptionInInitializerErrors.// it accessible.  Note that any exceptions// Grab the OptionalDataException boolean ctor and makeConstructor<> resultIIOPInputStream$2Constructor<> boolCtorgetDeclaredConstructor(...)OptionalDataException.classsetAccessible(...)new Error(...)new ExceptionInInitializerError(...)// set to true.  See handleOptionalDataMarshalException.// Create a new OptionalDataException with the EOF markerOptionalDataException resultp5p6p7Boolean.TRUE// to deserialize an object// Return the stream format version currently being used// reader the stream format version.// writeExternal method there is a byte telling the// At the beginning of data sent by a writeObject orgetMaximumStreamFormatVersion(...)SystemException sysexunsupportedFormatVersion(...)IOException resultnotAValueinputstream(...)/** Dummy constructor; passes upper stream a dummy stream; */resetStream(...)//added setSender and getSender// rep-ids// 4365188 this is added to enable backward compatability w/ wrong--.../** Override the actions of the final method "readObject()" ... */readData(...)MARSHAL marshalExceptionhandleOptionalDataMarshalException(...)IndirectionException cdriegetObject(...)cdrie.offsetObject prevObjectObjectStreamClass prevClassDescClass<> prevClassbyte oldStreamFormatVersionIOException exIOEClassNotFoundException exCNFuseFullValueDescription(...)inputObjectUsingFVD(...)inputObject(...)readResolve(...)throwException(...)IOException ioeskipObjectUsingFVD(...)/** This method is called by trusted subclasses of ObjectOutputStream ... */readObjectDelegate(...)/** Override the actions of the final method "defaultReadObject()" ... */new NotActiveException(...)defaultReadObjectFVDMembers.lengthinputClassFields(...)ObjectStreamField[] fieldsgetFieldsNoCopy(...)fields.lengthNotActiveException nae/** Override the actions of the final method "enableResolveObject()" ... */// to provide mark/reset behavior as defined in java.io.InputStream.// The following three methods allow the implementing orbStreamIOException errmarshalException.minorOMGSystemException.RMIIIOP_OPTIONAL_DATA_INCOMPATIBLE1setState(...)IOException excreadFully(...)/** Helper method for correcting the Kestrel bug 4367783 (dealing ... */internalReadUTF(...)// set the OptionalDataException's EOF marker to true.// tell the readObject how much data is available, so we always// So far in RMI-IIOP, this process isn't specific enough to// This is rethrown to the readObject as an OptionalDataException.// it throws a MARSHAL exception with a specific minor code.// on the wire and what our Serializable's readObject wants,// If the ORB stream detects an incompatibility between what'snew EOFException(...)createOptionalDataException(...)Enum<>.classint ordinalisExternalizable(...)Externalizable extaddObject(...)readFormatVersion(...)readExternal(...)InvalidClassException excnew InvalidClassException(...)UnsupportedOperationException eInstantiationException eObjectStreamClass currdescClass<> currclassint spBaseisSerializable(...)Class<> ccclasses.lengthint newlenClass<>[] newclassesObjectStreamClass[] newclassdescnew ObjectStreamClass[]ReadObjectState oldStatehasWriteObject(...)boolean calledDefaultWriteObjectbeginUnmarshalCustomValue(...)currentClassDesc.readObjectMethodhasReadObject(...)invokeObjectReader(...)endUnmarshalCustomValue(...)removeObject(...)// classes!// repositoryID.  It is assumed that the sender will not provide base_value id's for non-serializable// This retrieves a vector of FVD's for the hierarchy of serializable classes stemming fromVector<> descsFullValueDescription aFVDinsertElementAt(...)aFVD.base_value/** This input method uses FullValueDescriptions retrieved from the sender's runtime to ... */Enumeration<> fvdsListgetOrderedDescriptions(...)FullValueDescription fvdString repIDForFVDfvd.idString repIDForClassgetRMIRepositoryID(...)findNextClass(...)fvd.is_customfvd.membersgetStreamFormatVersion(...)getOrbStream(...)boolean usedReadObjectskipCustomUsingFVD(...)throwAwayData(...)/* Invoke the readObject method if present.  Assumes that in the case of custom ... */osc.readObjectMethodgetTargetException(...)/* Reset the stream to be just like it was after the constructor. */classdesc.length/** Factored out of inputClassFields  This reads a primitive value and sets it ... */byte byteValueboolean booleanValuechar charValueshort shortValueint intValuelong longValuefloat floatValuedouble doubleValuegetField(...)putByte(...)getFieldID(...)putBoolean(...)putChar(...)putShort(...)putInt(...)putLong(...)putFloat(...)putDouble(...)new ClassCastException(...)getType(...)Object objectValueClass<> typefield.idString signaturegetSignature(...)readAny(...)int callTypeValueHandlerImpl.kValueTypeisSequence(...)field.typeValueHandlerImpl.kRemoteTypeisInterface(...)isAbstractBase(...)isAbstractInterface(...)ValueHandlerImpl.kAbstractTypereadObjectAndNarrow(...)readAbstractAndNarrow(...)new StreamCorruptedException(...)/** Factored out of inputClassFields and reused in ... */Class<> fieldTypeClass<> actualTypeboolean narrowisAny(...)getTypeString(...)boolean loadStubClassRemote.classClass<> stubTypeloadStubClass(...)mustUseRemoteValueMembers(...)inputRemoteMembersForReadFields(...)inputCurrentClassFieldsForReadFields(...)ValueMember[] fieldsnew Boolean(...)inputObjectField(...)StreamCorruptedException result/** Called from InputStreamHook. ... */int primFieldscurrentClassDesc.objFields/* Read the fields of the specified class from the input stream and set ... */inputPrimitiveField(...)Class<?> fieldClgetClazz(...)Field declaredClassFieldString inputStreamFieldNameClass<?> declaredFieldClassnew IllegalArgumentException(...)getDeclaredField(...)PrivilegedActionException paExSecurityException secExNullPointerException npExNoSuchFieldException eisInstance(...)putObject(...)IllegalArgumentException iaExString objectValueClassNameString currentClassDescClassNameString fieldNameClassCastException ccExhasField(...)setByteField(...)setBooleanField(...)setCharField(...)setShortField(...)setIntField(...)setLongField(...)setFloatField(...)setDoubleField(...)setObjectField(...)StreamCorruptedException sce/* Read the fields of the specified class from the input stream throw data away. ... */FullValueDescription fieldFVDfieldFVD.is_abstractField fldClass<> fieldCllong keyobjectFieldOffset(...)new Exception(...)errorSetObjectField(...)new InvalidObjectException(...)errorSetBooleanField(...)errorSetByteField(...)errorSetCharField(...)errorSetShortField(...)errorSetIntField(...)errorSetLongField(...)errorSetFloatField(...)errorSetDoubleField(...)getSecurityManager(...)new PrivilegedExceptionAction<Field>(...) { ... }IIOPInputStream$3IIOPInputStream$ActiveRecursionManager/** This class maintains a map of stream position to ... */Map<Integer,Object> offsetToObjectMap;new HashMap<Integer,Object>(...)// of the object.// Offset is the starting position in the stream// Called right after allocating a new object.// Otherwise, it returns a reference to the// deserialized, this throws an IOException.// to the beginning of an object currently being// If the given starting position doesn't referInteger position// further indirections.// this mapping.  The CDR level can handle// deserialized, so it should no longer be in// Called when an object has been completely// currently being deserialized.// then it isn't an indirection to an object// If the given offset doesn't map to an Object,/* Copyright (c) 1998, 2015, Oracle and/or its affiliates. All rights reserved. ... */// XXX I18N, logging needed.// XXX I18N?  Logging for IOException?//  useFVDOnly = val;// The CDR stream had never seen the given offset before,// so check the recursion manager (it will throw an// IOException if it doesn't have a reference, either)./* throws OptionalDataException, ClassNotFoundException, IOException *//* Save the current state and get ready to read an object. */// Entering/* Check for reset, handle it before reading an object. */// d4365188: backward compatability// System.out.println("CLZ = " + clz + "; " + ioe.toString());/* Check for thrown exceptions and re-throw them, clearing them if ... *//* throws IOException, ClassNotFoundException, NotActiveException */// The array will be null unless fields were retrieved// remotely because of a serializable version difference.// Bug fix for 4365188.  See the definition of// defaultReadObjectFVDMembers for more information.// WARNING:  Be very careful!  What if some of// these fields actually have to do this, too?// This works because the defaultReadObjectFVDMembers// reference is passed to inputClassFields, but// there is no guarantee that// defaultReadObjectFVDMembers will point to the// same array after calling inputClassFields.// Use the remote fields to unmarshal.// Use the local fields to unmarshal./* throws SecurityException */// unreliable// no op// d11623 : implement readFully, required for serializing some core classes// Java Object Serialization spec 3.4: "If the readObject method// of the class attempts to read more data than is present in the// optional part of the stream for this class, the stream will// return -1 for bytewise reads, throw an EOFException for// primitive data reads, or throw an OptionalDataException// with the eof field set to true for object reads."/* Get the descriptor and then class of the incoming object. *///currentClassDesc.setClass(currentClass);/* If Externalizable, ... */// Store this object and its beginning position// since there might be indirections to it while// it's been unmarshalled.// Read format version// end : if (currentClassDesc.isExternalizable())/* Count number of classes and descriptors we might have ... */// current top of stack/* The object's classes should be processed from supertype to subtype ... *//* This is your basic diff pattern, made simpler ... */// sun.4296963 ibm.11861// d11861 we should stop when we find the highest serializable class// We need this so that when we allocate the new object below, we// can call the constructor of the non-serializable superclass.// Note that in the JRMP variant of this code the// ObjectStreamClass.lookup() method handles this, but we've put// this fix here rather than change lookup because the new behaviour// is needed in other cases./* sun.4296963 ibm.11861 *//* Search the classes to see if the class of this ... */// found a superclass that matches this descriptor/* Ignore a class that doesn't match.  No ... */// end : for (cl = currclass; cl != null; cl = cl.getSuperclass())/* Test if there is room for this new entry. ... *//* Class not found corresponding to this descriptor. ... *//* Current class descriptor matches current class. ... */// end : for (currdesc = currentClassDesc, currclass = currentClass;/* Allocate a new object.  The object is only constructed ... *//* For all the pushed descriptors and classes. ... *//* Set current descriptor and corresponding class *//* Read the data from the stream described by the ... */// Changed since invokeObjectReader no longer does this.// Read defaultWriteObject indicator// Error case of no readObject and didn't call// defaultWriteObject handled in default state// _REVISIT_ : Can we ever get here?/* No local class for this descriptor, ... */// Make sure we exit at the same stack level as when we started.// We've completed deserializing this object.  Any// future indirections will be handled correctly at the// CDR level.  The ActiveRecursionManager only deals with// objects currently being deserialized./* Allocate a new object. */// Read and throw away one level of the fvdslist// This seems to mean that the sender had a superclass that// we don't have// WARNING: If stream format version is 1 and there's// optional data, we'll get some form of exception down// the line or data corruption.// If the sender used custom marshaling, then it should have put// the two bytes on the wire indicating stream format version// and whether or not the writeObject method called// defaultWriteObject/writeFields.// Always use readObject if it exists, and fall back to default// unmarshaling if it doesn't.// See the definition of defaultReadObjectFVDMembers// for more information.  This concerns making sure// we use the remote FVD's members in defaultReadObject.// Note that the !usedReadObject !calledDefaultWriteObject// case is handled by the beginUnmarshalCustomValue method// of the default state// The remaining hierarchy of the local class does not match the sender's FVD.// So, use remaining FVDs to read data off wire.  If any remaining FVDs indicate// custom marshaling, throw MARSHAL error.// end : while(fvdsList.hasMoreElements())// the line.// Use default marshaling// discard any pending callbacks//reflective code: field.getField().setByte( o, byteValue ) ;//reflective code: field.getField().setBoolean( o, booleanValue ) ;//reflective code: field.getField().setChar( o, charValue ) ;//reflective code: field.getField().setShort( o, shortValue ) ;//reflective code: field.getField().setInt( o, intValue ) ;//reflective code: field.getField().setLong( o, longValue ) ;//reflective code: field.getField().setFloat( o, floatValue ) ;//reflective code: field.getField().setDouble( o, doubleValue ) ;/* This case should never happen. If the field types ... */// Make sure type = null// Decide what method call to make based on the type. If// it is a type for which we need to load a stub, convert// the type to the correct stub type.// NOTE : Since FullValueDescription does not allow us// to ask whether something is an interface we do not// have the ability to optimize this check.// RMI Object reference...// REVISIT.  If we don't have the local class,// we should probably verify that it's an RMI type,// query the remote FVD, and use is_abstract.// Our FVD seems to get NullPointerExceptions for any// non-RMI types.// This uses the local class in the same way as// inputObjectField(ObjectStreamField) does.  REVISIT// inputObjectField(ObjectStreamField)'s loadStubClass// logic.  Assumption is that the given type cannot// evolve to become a CORBA abstract interface or// a RMI abstract interface.// Now that we have used the FVD of the field to determine the proper course// of action, it is ok to use the type (Class) from this point forward since// the rep. id for this read will also follow on the wire.// fields have an API to provide the actual class// corresponding to the data type// Class type = osc.forClass();// This may change if stub loaded.// Decide what method call to make based on the fieldType. If// IDL Object reference...// IDL Abstract Object reference...// RMI Abstract Object reference...// Must have this local variable since defaultReadObjectFVDMembers// may get mangled by recursion.// Backwards compatibility.  Older Sun ORBs sent// _tk_char even though they read and wrote wchars// correctly.// Fall through to the _tk_wchar case.// Handle the primitives first/* Read and set object fields from the input stream. */// check input field type is a declared field type// input field is a subclass of the declared field// reflective code: fields[i].getField().set( o, objectValue ) ;// end : for loop// REVISIT.  Convert to a log message.// This is a normal case when fields have// been added as part of evolution, but// silently skipping can make it hard to// debug if there's an error//                                 System.out.println("**** warning, not setting field: "//                                                    + fields[i].name//                                                    + " since not on class "//                                                    + osc.getName());// Read value// Decide what method call to make based on the type.// Since we are throwing this away, don't bother handling recursion.// A hash map is unsynchronized and allows// null valuesimport ObjectStreamExceptionimport NotSerializableExceptionimport Field/** IIOPOutputStream is ... ... */IIOPOutputStream$1UtilSystemException wrapper;OutputStream orbStream;int simpleWriteDepth;Stack<> classDescStack;...[] writeObjectArgList;// Used when calling an object's writeObject method// of the writeObject method.// begin a new valuetype to contain the optional data// the ORB stream (which must be a ValueOutputStream) to// If using RMI-IIOP stream format version 2, this tellsValueOutputStream voutgetRMIIIOPOptionalDataRepId(...)/** Override the actions of the final method "writeObject()" ... */writeData(...)writeAbstractObject(...)IOException pendingoutputObject(...)IOException ee// Required by the superclass./** Override the actions of the final method "defaultWriteObject()" ... */outputClassFields(...)/** Override the actions of the final method "enableReplaceObject()" ... */IOException ioexc/** Reset will disregard the state of any objects already written ... */b.lengthchar[] buftoCharArray(...)internalWriteUTF(...)/* Check for special cases of serializing objects. ... */// INTERNAL UTILITY METHODS/* Check for special cases of substitutable serializing objects. ... *//* Write out the object */new NotSerializableException(...)writeExternal(...)int stackMarkObjectStreamClass nextWriteObjectState oldStateinvokeObjectWriter(...)defaultWriteObjectDelegate(...)/* Invoke writer. ... */Class<> centerWriteObject(...)osc.writeObjectMethodexitWriteObject(...)writeObjectField(...)writeRemoteObject(...)/* Write the fields of the specified class by invoking the appropriate ... */getByte(...)getChar(...)getFloat(...)getDouble(...)getInt(...)getLong(...)getShort(...)IllegalAccessException excillegalFieldAccess(...)/* Copyright (c) 1998, 2013, Oracle and/or its affiliates. All rights reserved. ... *//* throws IOException */// if (!checkSpecialClasses(obj) && !checkSubstitutableSpecialClasses(obj))/* Restore state of previous call incase this is a nested call *//* If the recursion depth is 0, test for and clear the pending exception. ... */// XXX I18N, Logging needed.//orbStream.reset();/* If this is a class, don't allow substitution *///if (obj instanceof Class) {//    throw new IOException("Serialization of Class not supported");//if (obj.getClass().isArray()) {//    outputArray(obj);//    return true;/* Get the Class descriptor for this class, ... *//* If the object is externalizable, ... */// Write format version/* For currentClassDesc and all the pushed class descriptors ... */// writeObject(obj, c, this);// cannot happen// What to do if it's null?new DefaultState(...)new InReadObjectOptionalDataState(...)new InReadObjectNoMoreOptionalDataState(...)new InReadObjectDefaultsSentState(...)new NoReadObjectDefaultsSentState(...)new InReadObjectRemoteDidNotUseWriteObjectState(...)new InReadObjectPastDefaultsRemoteDidNotUseWOState(...)// These should be visible in all the nested classesInputStreamHook$HookGetFieldsObjectInputStream.GetFieldMap<> fields;this.fields/** Get the ObjectStreamClass that describes the fields in the stream. ... *//** Return true if the named field is defaulted and has no value ... *//** Get the value of the named boolean field from the persistent field. */defaulted(...)/** Get the value of the named char field from the persistent fields. *//** Get the value of the named byte field from the persistent fields. *//** Get the value of the named short field from the persistent fields. *//** Get the value of the named int field from the persistent fields. *//** Get the value of the named long field from the persistent fields. *//** Get the value of the named float field from the persistent fields. *//** Get the value of the named double field from the persistent field. *//** Get the value of the named Object field from the persistent field. */beginDefaultReadObject(...)defaultReadObjectDelegate(...)endDefaultReadObject(...)// in RMI-IIOP// Remember that this is equivalent to defaultReadObject// See java.io.ObjectInputStream.GetFieldHashMap<> fieldValueMapreadFields(...)new HookGetFields(...)// sender wrote default data// we have a readObject method and whether or not the// On the reader's side, the main factors are whether or not// state diagrams in the docs directory of the workspace.// RMI-IIOP stream format version 2.  Please see the// writeObject method.  This was especially necessary for// should be done when the sender's Serializable has a// The following is a State pattern implementation of what// Description of possible actionsReadObjectState readObjectState;ReadObjectState DEFAULT_STATE;ReadObjectState IN_READ_OBJECT_OPT_DATA;ReadObjectState IN_READ_OBJECT_NO_MORE_OPT_DATA;ReadObjectState IN_READ_OBJECT_DEFAULTS_SENT;ReadObjectState NO_READ_OBJECT_DEFAULTS_SENT;ReadObjectState IN_READ_OBJECT_REMOTE_NOT_CUSTOM_MARSHALED;ReadObjectState IN_READ_OBJECT_PAST_DEFAULTS_REMOTE_NOT_CUSTOM;// as in line 1492 in IIOPInputStream.// default data, we won't skip it.  This could be done automatically// REVISIT.  If a readObject exits here without readingbadBeginUnmarshalCustomValue(...)throwOptionalDataIncompatibleException(...)ORBVersion clientOrbVersiongetPEORB(...)/* Copyright (c) 1999, 2013, Oracle and/or its affiliates. All rights reserved. ... */// We were treating readFields same as defaultReadObject. It is// incorrect if the state is readOptionalData. If this line// is uncommented, it will throw a stream corrupted exception.// _REVISIT_: The ideal fix would be to add a new state. In// writeObject user may do one of the following// 1. Call defaultWriteObject()// 2. Put out optional fields// 3. Call writeFields// We have the state defined for (1) and (2) but not for (3), so// we should ideally introduce a new state for 3 and have the// beginDefaultReadObject do nothing.//readObjectState.beginDefaultReadObject(this);// This will happen for Big Integer which uses// writeFields in it's writeObject. We should be past// start_value by now.// NOTE: If we don't log any exception here we should// be fine. If there is an error, it will be caught// while reading the optional data.// XXX I18N and logging needed.// This should never happen.// In stream format version 2, we can skip over// the optional data this way.  In stream format version 1,// we will probably wind up with an error if we're// unmarshaling a superclass.// Read the fake valuetype header in stream format version 2// Fix Date interop bug. For older versions of the ORB don't do// anything for readData(). Before this used to throw// StreamCorruptedException for older versions of the ORB where// calledDefaultWriteObject always returns true.// Code should read default fields before calling thisimport AccessControlContextimport MessageDigestimport NoSuchAlgorithmExceptionimport DigestOutputStreamimport PermissionCollectionimport Permissionsimport ProtectionDomainimport Memberimport Proxyimport UndeclaredThrowableExceptionimport Comparatorimport HashSetimport Setimport JavaSecurityAccess/** A ObjectStreamClass describes a class that can be serialized to a stream ... */new Class<?>[]new PrivilegedAction<Bridge>(...) { ... }ObjectStreamClass$1new PersistentFieldsValue(...)Modifier.ABSTRACTModifier.INTERFACEModifier.PUBLICModifier.FINALModifier.VOLATILEModifier.TRANSIENTModifier.STATICModifier.PROTECTEDModifier.PRIVATEModifier.STRICTModifier.NATIVEModifier.SYNCHRONIZEDnew ObjectStreamClassEntry[]new ObjectStreamField[]new CompareClassByName(...)new CompareObjStrFieldsByName(...)new CompareMemberByName(...)boolean DEBUG_SVUID;long kDefaultUID;...[] noArgsList;...[] noTypesList;boolean isEnum;/** true if represents enum type *//** Find the descriptor for a class that can be serialized.  Null ... */ObjectStreamClass desclookupInternal(...)/* Find the class descriptor for the specified class. ... */findDescriptorFor(...)boolean serializableSerializable.classObjectStreamClass superdescboolean externalizableClass<?> superclassExternalizable.classnew ObjectStreamClass(...)/** The name of the class described by this descriptor. *//** Return the serialVersionUID for this class. ... */ObjectStreamClass theoscgetSerialVersionUID(...)/** Return the serialVersionUID string for this class. ... */toUpperCase(...)/** Return the actual (computed) serialVersionUID for this class. */getActualSerialVersionUID(...)/** Return the class in the local VM that this version is mapped to. ... *//** Return an array of the fields of this serializable class. ... */ObjectStreamField[] dupfield.name/* Avoid unnecessary allocations. *//** Get the field of this class by name. ... *//** Return a string describing this ObjectStreamClass. *//* Create a new ObjectStreamClass from a loaded class. ... */isProxyClass(...)insertDescriptorFor(...)ObjectStreamClass$PersistentFieldsValueField pfint modsisFinal(...)isPrivate(...)translateFields(...)...|...ObjectStreamField[] translationnew ObjectStreamField(...)PersistentFieldsValue persistentFieldsValue;/** Creates a PermissionDomain that grants no permission. */PermissionCollection permsnew Permissions(...)setReadOnly(...)new ProtectionDomain(...)/** Aggregate the ProtectionDomains of all the classes that separate ... */ProtectionDomain[] domainsClass<?> clsClass<?> fnsclgetDeclaringClass(...)Set<ProtectionDomain> pdsProtectionDomain pdgetProtectionDomain(...)new HashSet<ProtectionDomain>(...)noPermissionsDomain(...)toArray(...)new ProtectionDomain[]/* Initialize class descriptor.  This method is only invoked on class ... */Class<?> clObjectStreamClass$2ClassValue$VersionClassValue$EntryField[] actualfieldsgetDeclaredFields(...)int numFieldsObjectStreamField[] tempFieldsactualfields.lengthisTransient(...)Field reflFieldsetField(...)computeFieldInfo(...)isNonSerializable(...)ObjectStreamClass$3Field f_computeSerialVersionUID(...)NoSuchFieldException exIllegalAccessException exgetInheritableMethod(...)getExternalizableConstructor(...)getSerializableConstructor(...)getProtectionDomains(...)getPrivateMethod(...)ObjectOutputStream.classObjectInputStream.classcomputeStructuralUID(...)computeRMIIIOPOptionalDataRepId(...)/** Returns non-static private method with given signature defined by given ... */Method methNoSuchMethodException ex/** Java to IDL ptc-02-01-12 1.5.1 ... */// Specific to RMI-IIOPconvertToISOLatin1(...)getActualSerialVersionUIDStr(...)getSerialVersionUIDStr(...)/** This will return null if there is no writeObject method. *//* Create an empty ObjectStreamClass for a class about to be read. ... *//* Set the class this version descriptor matches. ... */ObjectStreamField[] destfieldlocalClassDesc.fieldsObjectStreamField[] srcfield<Label>: ...localClassDesc.suidboolean addedSerialOrExternboolean arraySUIDcompareClassNames(...)localClassDesc.serializablelocalClassDesc.externalizablesrcfield.lengthdestfield.lengthtypeEquals(...)localClassDesc.readObjectMethodlocalClassDesc.readResolveObjectMethod/* Compare the base class names of streamName and localName. ... */int streamNameIndexlastIndexOf(...)int localNameIndexregionMatches(...)/* Compare the types of two class descriptors. ... */other.suidother.name/* Return the superclass descriptor of this descriptor. *//** Return whether the class has a readObject method *//* Return whether the class has a writeObject method *//** Returns when or not this class should be custom ... *//* Return true if all instances of 'this' Externalizable class ... *//** Creates a new instance of the represented class.  If the class is ... */new InternalError(...)domains.lengthJavaSecurityAccess jsagetJavaSecurityAccess(...)PrivilegedAction<?> peaObjectStreamClass$4ReflectiveOperationException xnew UndeclaredThrowableException(...)doIntersectionPrivilege(...)getContext(...)new AccessControlContext(...)UndeclaredThrowableException xThrowable causegetCause(...)InternalError ie/** Returns public no-arg constructor of given class, or null if none found. ... */Constructor<> cons/** Returns subclass-accessible no-arg constructor of first non-serializable ... */Class<?> initClpackageEquals(...)newConstructorForSerialization(...)/* Return the ObjectStreamClass of the local class this one is based on. *//* Get the Serializability of the class. *//* Get the externalizability of the class. *//* Calculate the size of the array needed to store primitive data and the ... */int CLASS_MASK;/* JDK 1.5 has introduced some new modifier bits (such as SYNTHETIC) ... */int FIELD_MASK;int METHOD_MASK;/* Compute a hash for the specified class.  Incrementally add ... */ByteArrayOutputStream devnulllong hmsg(...)MessageDigest mdDigestOutputStream mdonew DigestOutputStream(...)DataOutputStream datanew DataOutputStream(...)int classaccessMethod[] methodgetDeclaredMethods(...)Field[] fieldMethodSignature[] constructorsremovePrivateAndSort(...)getDeclaredConstructors(...)MethodSignature[] methodsbyte[] hasharraydigest(...)...&=...~...method.lengthClass<?>[] interfacesgetInterfaces(...)interfaces.lengthfield.lengthint mhasStaticInitializer(...)constructors.lengthMethodSignature cString mnameString descc.signatureint modifierc.memberreplace(...)methods.lengthMethodSignature mm.signaturem.membermin(...)hasharray.lengthIOException ignoreNoSuchAlgorithmException complainSecurityException senew SecurityException(...)Class<?> parentObjectStreamField[] fieldgetFields(...)/** Compute the JVM signature for the class. */String typeint dimensions/* Compute the JVM method descriptor for the method. */Class<?>[] paramsgetParameterTypes(...)params.length/* Compute the JVM constructor descriptor for the constructor. */...[] descriptorFor;/* Cache of Class -> ClassDescriptor Mappings. *//* findDescriptorFor a Class.  This looks in the cache for a ... */int hashdescriptorFor.lengthObjectStreamClassEntry eObjectStreamClassEntry preve.nextprev.nextdesc.ofClass/* insertDescriptorFor a Class -> ObjectStreamClass mapping. */new ObjectStreamClassEntry(...)ObjectStreamClass$5/* The name of this descriptor */ObjectStreamClass superclass;/* The descriptor of the supertype. */boolean serializable;/* Flags for Serializable and Externalizable. */boolean externalizable;...[] fields;/* Array of persistent fields of this class, sorted by ... */Class<?> ofClass;/* Class that is a descriptor for in this virtual machine. */boolean forProxyClass;/* True if descriptor for a proxy class. */long suid;/* SerialVersionUID for this class. */String suidStr;long actualSuid;/* Actual (computed) SerialVersionUID for this class. */String actualSuidStr;int primBytes;/* The total number of bytes of primitive fields. ... */int objFields;boolean initialized;/** Flag indicating whether or not this instance has ... */Object lock;/* Internal lock object. */boolean hasExternalizableBlockData;/* In JDK 1.1, external data was not written in block mode. ... */Method writeObjectMethod;Method readObjectMethod;Method writeReplaceObjectMethod;Method readResolveObjectMethod;Constructor<?> cons;...[] domains;String rmiiiopOptionalDataRepId;/** Beginning in Java to IDL ptc/02-01-12, RMI-IIOP has a ... */ObjectStreamClass localClassDesc;/* ObjectStreamClass that this one was built from. */Method hasStaticInitializerMethod;/* Find out if the class has a static class initializer <clinit> *//** Returns true if the given class defines a static initializer method, ... */Class<?> classWithThisMethodObjectStreamClass.classClass<>.classBoolean retval/** use serialVersionUID from JDK 1.1. for interoperability */...[] NO_FIELDS;/** Set serialPersistentFields of a Serializable class to this value to ... */ObjectStreamClass$ObjectStreamClassEntry/* Entries held in the Cache of known ObjectStreamClass objects. ... */this.cObjectStreamClassEntry next;ObjectStreamClass c;Comparator<> compareClassByName;/* Comparator object for Classes and Interfaces */ObjectStreamClass$CompareClassByNameClass<?> c1Class<?> c2Comparator<> compareObjStrFieldsByName;/** Comparator for ObjectStreamFields by name */ObjectStreamClass$CompareObjStrFieldsByNameObjectStreamField osf1ObjectStreamField osf2Comparator<> compareMemberByName;/* Comparator object for Members, Fields, and Methods */ObjectStreamClass$CompareMemberByNameString s1String s2ObjectStreamClass$MethodSignature/* It is expensive to recompute a method or constructor signature ... */Member member;String signature;/* A better implementation would be to implement the returned data ... *//* Given an array of Method or Constructor members, ... */// cached parameter signatureint numNonPrivateMethodSignature[] cmnew MethodSignature[]int cmim.lengthnew MethodSignature(...)/* Assumes that o1 and o2 are either both methods ... */MethodSignature c1MethodSignature c2isConstructor(...)c1.signaturec2.signaturec1.memberc2.member/** Returns non-static, non-abstract method with given signature provided it ... */Class<?> defCl/** Returns true if classes are defined in the same package, false ... */Package pkg1getPackage(...)Package pkg2/* Copyright (c) 1998, 2014, Oracle and/or its affiliates. All rights reserved. ... *//* Synchronize on the hashtable so no two threads will do ... *//* Find the matching descriptor if it already known *//* Check if it's serializable *//* If the class is only Serializable, ... *//* Check if its' externalizable. ... *//* Create a new version descriptor, ... */// Must always call init.  See bug 4488137.  This code was// incorrectly changed to return immediately on a non-null// cache result.  That allowed threads to gain access to// unintialized instances.// History: Note, the following init() call was originally within// the synchronization block, as it currently is now. Later, the// init() call was moved outside the synchronization block, and// the init() method used a private member variable lock, to// avoid performance problems. See bug 4165204. But that lead to// a deadlock situation, see bug 5104239. Hence, the init() method// has now been moved back into the synchronization block. The// right approach to solving these problems would be to rewrite// this class, based on the latest java.io.ObjectStreamClass.// Return a copy so the caller can't change the fields.// Ignore this; all we want to do is return false// Note that ValueUtility.getSignature can throw checked exceptions./* Binary search of fields by name. *//* created from this class */// proxy classes are never externalizable/* Enter this class in the table of known descriptors. ... *//* The remainder of initialization occurs in init(), which is called ... */// that's not supposed to happen// make a ProtectionDomain with no permission.// should we throw instead?// See description at definition of initialized./* Ask for permission to override field access checks. *//* Fill in the list of persistent fields. ... *//* Get all of the declared fields for this ... */// For each declared persistent field, look for an actual// reflected Field. If there is one, make sure it's the correct// type and cache it in the ObjectStreamClass for that field.// Nothing to do/* Set up field data for use while writing using the API api. *//* Get the serialVersionUID from the class. ... */// Lookup special Serializable members using reflection.// proxy classes always have serialVersionUID of 0L// SerialBug 5:  static final SUID should be read// SerialBug 2: should be computed after writeObject// actualSuid = computeStructuralUID(cl);/* Look for the writeObject method ... */// This call depends on a lot of information computed above!// If we have a write object method, precompute the// RMI-IIOP stream format version 2 optional data// repository ID.// This must be done last.// XXX I18N, logging needed/* Check for exceptional cases that allow mismatched suid. *//* Allow adding Serializable or Externalizable ... *//* Disregard the serialVersionUID of an array ... *//* compare the class names, stripping off package names. *//* Test that both implement either serializable or externalizable. */// The next check is more generic, since it covers the// Proxy case, the JDK 1.3 serialization code has// both checks//if ((serializable && localClassDesc.externalizable) ||//    (externalizable && localClassDesc.serializable))//    throw new InvalidClassException(localCl.getName(),//            "Serializable is incompatible with Externalizable");/* Set up the reflected Fields in the class where the value of each ... *//* Find this field in the dest *//* found match *//* Skip over any fields in the dest that are not in the src */// go on to the next source field/* Set up field data for use while reading from the input stream. *//* Remember the class this represents *//* get the cache of these methods from the local class ... */// Can't use PrivilegedExceptionAction with jsa// not supposed to happen// should not occur, as access checks have been suppressed/* Workaround for javac bug that only set ABSTRACT for ... */// Mask out any post-1.4 attributes/* Get the list of interfaces supported, ... *//* In 1.2fcs, getInterfaces() was modified to return ... *//* Sort the field names to get a deterministic order *//* Include in the hash all fields except those that are ... */// Mask out any post-1.4 bits// TBD: what modifiers does it have/* Get the list of constructors including name and signature ... */// mask out post-1.4 modifiers/* Include in the hash all methods except those that are ... *//* Compute the hash value for this class. ... *//* can't happen, but be deterministic anyway. */// Get SUID of parent// SerialBug 1; acc. to spec the one for// java.lang.object// should be computed and put//     && (parent != java.lang.Object.class))//data.writeLong(computeSerialVersionUID(null,parent));// CORBA formal 00-11-03 10.6.2:  For each field of the// class that is mapped to IDL, sorted lexicographically// by Java field name, in increasing order...// ...Java field name in UTF encoding, field// descriptor, as defined by the JVM spec...// int minimum = Math.min(8, hasharray.length);// SerialBug 3: SHA computation is wrong; for loop reversed//for (int i = minimum; i > 0; i--)// avoid clone/* Free any initial entries whose refs have been cleared *//* Traverse the chain looking for a descriptor with ofClass == cl. ... */// This entry has been cleared,  unlink it// Make sure not already present// extends java.lang.ref.SoftReference//super(c);/* Arrays.sort calls compare when o1 and o2 are equal. */// is a Method.// class is package private for security reasons// java.io.ObjectStreamField.// to move to java.io.ObjectStreamClass, and// ObjectStreamClass.  Eventually the goal is// an attempt to eliminate redundant code from// here so that they can be factored out in// sense there, and hence have been put// code delivered by IBM.  They don't make// originally were in the OSC in the RMI-IIOP// This file contains some utility methods that/** Return true, iff, ... */Method[] methodsgetMethods(...)Class<>[] exceptionsboolean exceptionMatchexceptions.lengthRemoteException.classThrowable.classException.classIOException.class/* Returns TRUE if type is 'any'. */int isAnyObjectStreamClassCorbaExt$1// #1// #2import Comparable/** A description of a field in a serializable class. ... */Bridge.INVALID_FIELD_OFFSETObjectStreamField$1/** Create a named field with the specified type. */this.clazz/** Create an ObjectStreamField containing a reflected Field. *//** Get the name of this field. *//** Get the type of the field. */this.fieldthis.fieldID/* Default constructor creates an empty field. ... *//** test if this field is a primitive or not. *//** Compare this with another ObjectStreamField. ... */ObjectStreamField f2boolean thisprimthis.typeStringboolean otherprimf2.typeStringthis.namef2.name/** Compare the types of two class descriptors. ... */other.typeother.typeString/* Returns the signature of the Field. *//** Return a string describing this field. *//* Returns the Field ID */char type;// the name of the fieldField field;// type first byte of the type signatureString typeString;// Reflected fieldClass<> clazz;// iff object, typename// essentially we can use the java.io.ObjectStreamField as such.// to this.  Signature is esentially equal to typestring. Then// removed, if we can figure out all place where there are dependencies// the next 2 things are RMI-IIOP specific, it can be easily// the type of this field, if has been resolvedlong fieldID;// the signature of the field// Compute the typecode for easy switching/* Return true if the primitive types matched *//** Unexpected data appeared in an ObjectInputStream trying to read ... *//* Create an <code>OptionalDataException</code> with a length. *//* Create an <code>OptionalDataException</code> signifing no ... */int length;/** The number of bytes of primitive data available to be read ... */boolean eof;/** True if there is no more data in the buffered part of the stream. *//* Copyright (c) 1998, 2002, Oracle and/or its affiliates. All rights reserved. ... */import ObjectOutputnew InWriteObjectState(...)new WroteDefaultDataState(...)new WroteCustomDataState(...)HookPutFields putFields;OutputStreamHook$HookPutFields/** Since ObjectOutputStream.PutField methods specify no exceptions, ... */ObjectOutputStream.PutFieldnew HashMap<String,Object>(...)Map<String,Object> fields;/** Put the value of the named boolean field into the persistent field. *//** Put the value of the named char field into the persistent fields. *//** Put the value of the named byte field into the persistent fields. *//** Put the value of the named short field into the persistent fields. *//** Put the value of the named int field into the persistent fields. *//** Put the value of the named long field into the persistent fields. *//** Put the value of the named float field into the persistent fields. *//** Put the value of the named double field into the persistent field. *//** Put the value of the named Object field into the persistent field. *//** Write the data and fields to the specified ObjectOutput stream. */OutputStreamHook hookObjectStreamField[] osfieldsosfields.lengthwriteField(...)defaultWriteObject(...)new HookPutFields(...)// Stream format version, saved/restored during recursive calls// to serialize an object// See java.io.ObjectOutputStream.PutFields// User uses PutFields to simulate default data.WriteObjectState writeObjectState;// should be done when a Serializable has aWriteObjectState NOT_IN_WRITE_OBJECT;WriteObjectState IN_WRITE_OBJECT;WriteObjectState WROTE_DEFAULT_DATA;WriteObjectState WROTE_CUSTOM_DATA;beginOptionalCustomData(...)// the stream write the data.// We don't have to do anything special here, just let/* Copyright (c) 1999, 2015, Oracle and/or its affiliates. All rights reserved. ... */// Write the fields to the stream in the order// provided by the ObjectStreamClass.  (They should// be sorted appropriately already.)// We didn't write any data, so write the// called defaultWriteObject indicator as false// If we're in stream format verison 2, we must// put the "null" marker to say that there isn't// any optional data// The writeObject method called defaultWriteObject// or writeFields, so put the called defaultWriteObject// indicator as true// The writeObject method first called a direct// write operation.  Write the called defaultWriteObject// indicator as false, put the special stream format// version 2 header (if stream format version 2, of course),// and write the data// We only wrote default data, so if in stream format// version 2, put the null indicator to say that there// is no optional data// The writeObject method called a direct write operation.// If in stream format version 2, put the fake valuetype// header.// In stream format version 2, we must tell the ORB// stream to close the fake custom valuetype.getMaxStreamFormatVersion(...)String FORMAT_VERSION_PROPERTY;// Property to override our maximum stream format versionbyte MAX_SUPPORTED_FORMAT_VERSION;byte STREAM_FORMAT_VERSION_1;byte MAX_STREAM_FORMAT_VERSION;// set in a static initializer.// The ValueHandler's maximum stream format version to advertise,// a supported version (1 through MAX_STREAM_FORMAT_VERSION).// version.  Note that this still only allows them to pick// to allow the user to override our default stream format// Looks for the FORMAT_VERSION_PROPERTY system propertyString propValueValueHandlerImpl$1ValueHandlerImpl.FORMAT_VERSION_PROPERTYbyte resultparseByte(...)Error errshort kRemoteType;short kAbstractType;short kValueType;Hashtable<> inputStreamPairs;Hashtable<> outputStreamPairs;boolean useHashtables;boolean isInputStream;IIOPOutputStream outputStreamBridge;IIOPInputStream inputStreamBridge;// See javax.rmi.CORBA.ValueHandlerMultiFormatnotAValueoutputstream(...)invalidStreamFormatVersion(...)writeValueWithVersion(...)this.isInputStreamnew ValueHandlerImpl(...)/** Writes the value to the stream using java semantics. ... */IIOPOutputStream jdkToOrbOutputStreamBridgecreateOutputStream(...)setOrbStream(...)increaseRecursionDepth(...)writeValueInternal(...)decreaseRecursionDepth(...)write_Array(...)simpleWriteObject(...)/** Reads a value from the stream using java semantics. ... */CodeBase senderIIOPInputStream jdkToOrbInputStreamBridgeSerializable resultcreateInputStream(...)setSender(...)setValueHandler(...)readValueInternal(...)read_Array(...)simpleSkipObject(...)simpleReadObject(...)/** Returns the repository ID for the given RMI value Class. ... *//** Indicates whether the given Class performs custom or ... *//** Returns the CodeBase for this ValueHandler.  This is used by ... */FVDCodeBaseImpl fvdImplnew FVDCodeBaseImpl(...)/** Returns a boolean of whether or not RepositoryId indicates ... */// Rep-id calculations take place based on the ORB version// methods supported for backward compatability so that the appropriateRepositoryId repIDgetDefinedInId(...)getUnqualifiedName(...)/** If the value contains a writeReplace method then the result ... */int[] arrayarray.lengthbyte[] arraylong[] arrayfloat[] arraydouble[] arrayshort[] arraychar[] arraywriteCharArray(...)boolean[] arrayObject[] arrayClass<> componentTypenew float[]new double[]readCharArray(...)bridge.activeRecursionMgrgetOutputStreamClassName(...)IIOPOutputStream streamcreateOutputStreamBuiltIn(...)createCustom(...)IIOPOutputStream.class/** Construct a built in implementation with priveleges. ... */new PrivilegedExceptionAction<IIOPOutputStream>(...) { ... }ValueHandlerImpl$2createOutputStreamBuiltInNoPriv(...)PrivilegedActionException exc/** Returning null indicates a non-built is specified. */new IIOPOutputStream(...)getInputStreamClassName(...)IIOPInputStream streamcreateInputStreamBuiltIn(...)IIOPInputStream.classnew PrivilegedExceptionAction<IIOPInputStream>(...) { ... }ValueHandlerImpl$3createInputStreamBuiltInNoPriv(...)new IIOPInputStream(...)/** Create a custom implementation without privileges. */Class<?> clazzClass<? extends T> streamClassasSubclass(...)/* Copyright (c) 1998, 2012, Oracle and/or its affiliates. All rights reserved. ... */// The property wasn't set// REVISIT.  Just set to MAX_SUPPORTED_FORMAT_VERSION// or really let the system shutdown with this Error?// REVISIT.  Swallow this or really let// the system shutdown with this Error?// Must use narrow rather than a direct cast to a com.sun// class.  Fix for bug 4379539.// backward compatability 4365188// Indirections are resolved immediately since// the change to the active recursion manager,// so this will never happen.// clazz == null indicates an FVD situation for a nonexistant class// set the valueHandler so that correct/incorrect RepositoryID// calculations can be done based on the ORB version// Read length of coming array// The CDR stream had never seen the given offset// before, so check the recursion manager (it will// throw an IOException if it doesn't have a// reference, either).// Translate to a MARSHAL exception since// ValueHandlers aren't allowed to throw// IOExceptions// Decide what method call to make based on the componentType.// If it is a componentType for which we need to load a stub,// convert the componentType to the correct stub type.// String className = componentType.getName();// for better performance, load the stub class once// instead of for each element of the array// componentType = null;// Throw exception under the carpet.// Note: We use the thread context or system ClassLoader here// since we want to load classes outside of the// core JDK when running J2EE Pure ORB and// talking to Kestrel.// Since the ClassLoader should cache the class, this isn't// as expensive as it looks.import OperationDescriptionimport AttributeDescriptionimport Initializerimport IDLTypeimport _IDLTypeStubimport org.omg.CORBA.TypeCodePackage.*/** Holds utility methods for converting from ObjectStreamClass to ... */setJavaCorbaAccess(...)new JavaCorbaAccess(...) { ... }ValueUtility$1short PRIVATE_MEMBER;short PUBLIC_MEMBER;...[] primitiveConstants;member.typemember.idnew FullValueDescription(...)Class<> classNameValueHandlerImpl vhandlerIdentityKeyValueStack createdIDsnew IdentityKeyValueStack(...)Class<>[] interfacesint abstractCountClass<> superClassresult.nameresult.idresult.is_abstractresult.is_customresult.defined_inresult.versionresult.operationsnew OperationDescription[]result.attributesnew AttributeDescription[]result.memberstranslateMembers(...)result.initializersnew Initializer[]result.supported_interfacesint interfaceIndexresult.abstract_base_valuesresult.is_truncatableresult.base_valueresult.typeint fieldsLengthValueMember[] membersnew ValueMember[]String valRepIdnew ValueMember(...)...[...].defined_in...[...].version...[...].type_defnew _IDLTypeStub(...)getJavaCharTCKind(...)createTypeCodeForClassInternal(...)strs.lengthtype.supported_interfacestype.idtype.base_valueFullValueDescription parentcreateTypeCodeInternal(...)ValueUtility$IdentityKeyValueStack// Maintains a stack of key-value pairs. Compares elements using == operator.ValueUtility$IdentityKeyValueStack$KeyValuePairObject key;Object value;this.keypair.keyStack<> pairs;KeyValuePair pairpair.valuenew KeyValuePair(...)ObjectStreamClass oscTypeCode basecreate_value_tc(...)// tk_null         0// tk_void         1// tk_short        2// tk_long         3// tk_ushort       4// tk_ulong        5// tk_float        6// tk_double       7// tk_boolean      8// tk_char         9// tk_octet        10// tk_any          11// tk_typecode     12// tk_principal    13// tk_objref       14// tk_struct       15// tk_union        16// tk_enum         17// tk_string       18// tk_sequence     19// tk_array        20// tk_alias        21// tk_except       22// tk_longlong     23// tk_ulonglong    24// tk_longdouble   25// tk_wchar        26// tk_wstring      27// tk_fixed        28// tk_value        29// tk_value_box    30// tk_native       31// tk_abstract_interface 32// REVISIT.  Can the type be something that is// non-primitive yet not a value_box, value, or objref?// If so, should use ObjectStreamClass or throw// exception.// Create FullValueDescription// Set FVD name// Set FVD id _REVISIT_ : Manglings// Set FVD is_abstract// Set FVD is_custom// Set FVD defined_in _REVISIT_ : Manglings// Set FVD version// Skip FVD operations - N/A// Skip FVD attributed - N/A// Set FVD members// Maps classes to repositoryIDs strings. This is used to detect recursive types.// Stores all types created for resolving indirect types at the end.// Skip FVD initializers - N/A// Skip FVD supported_interfaces// Skip FVD abstract_base_values - N/A// Set FVD base_value// Set FVD type//result.type = createTypeCodeForClass(orb, osc.forClass());//11638// Note : fields come out of ObjectStreamClass in correct order for// writing.  So, we will create the same order in the members array.// _REVISIT_ : Manglings// _REVISIT_ : IDLType implementation missing// When using serialPersistentFields, the class may// no longer have an actual Field that corresponds// to one of the items.  The Java to IDL spec// ptc-00-01-06 1.3.5.6 says that the IDL field// should be private in this case.// 11638// case '['://      members[i].type = orb.get_primitive_tc(TCKind.tk_value_box); //11638//      members[i].id = RepositoryId.createForAnyType(fields[i].getType());//      break;// end switch// end for loop// This wrapper method is the protection against infinite recursion.// cache the rep id BEFORE creating a new typecode.// so that recursive tc can look up the rep id.// type modifier// REVISIT truncatable and abstract?// concrete base// members...[] elementData;/** The array buffer into which the components of the ByteBuffer are ... */int elementCount;/** The number of valid components in this <tt>ByteBuffer</tt> object. ... */int capacityIncrement;/** The amount by which the capacity of the ByteBuffer is automatically ... *//** Constructs an empty ByteBuffer with the specified initial capacity and ... */this.elementDatathis.capacityIncrement/** Constructs an empty ByteBuffer so that its internal data array ... *//** Trims the capacity of this ByteBuffer to be the ByteBuffer's current ... */int oldCapacityelementData.lengthbyte[] oldData/** This implements the unsynchronized semantics of ensureCapacity. ... */int newCapacity/** Returns the current capacity of this ByteBuffer. ... *//** Returns the number of components in this ByteBuffer. ... *//** Tests if this ByteBuffer has no components. ... */ensureCapacityHelper(...)doAppend(...)int currentbyte[] data/** Returns an array containing all of the elements in this ByteBuffer ... *//* Copyright (c) 2001, 2002, Oracle and/or its affiliates. All rights reserved. ... */import Identifiableimport IdentifiableFactoryFinderimport WriteContentsimport FreezableList/** This static utility class contains various utility methods for reading and ... *//** Read the count from is, then read count Identifiables from ... */Identifiable obj/** Write all Identifiables that we contain to os.  The total ... */Iterator<> iter/** Helper method that is used to extract data from an output ... *//** Helper method to read the octet array from is, deencapsulate it, ... */readOctets(...)EncapsInputStream result/** Helper method that reads an octet array from an input stream. ... */writeContents(...)writeOutputStream(...)import AbstractListimport ListIteratorimport MakeImmutable/** Simple class that delegates all List operations to ... */List<> delegate;boolean immutable;FreezableList otherother.delegateother.immutablethis.delegatethis.immutableMakeImmutable elementmakeImmutable(...)// Methods overridden from AbstractList// We also override subList so that the result is a FreezableList.subList(...)List<> resultnew FreezableList(...)...[] data;this.idGenericIdentifiable encapsgetData(...)this.datanew TaggedComponent(...)import ObjectIdEncapsOutputStream os// NO-OPimport StringWriterimport IORTemplateListimport IdentifiableContainerBaseimport RequestDispatcherRegistryimport HexOutputStreamimport IORSystemExceptionimport IIOPProfile/** An IOR is represented as a list of profiles. ... */String typeId;ORB factory;boolean isCachedHashValue;int cachedHashValue;IORSystemException wrapper;IORTemplateList iortemps;/* This variable is set directly from the constructors that take ... */IOR other/** Construct an empty IOR.  This is needed for null object references. */CORBALogDomains.OA_IORthis.typeId/** Construct an IOR from an IORTemplate by applying the same ... */this.iortempsmakeIORTemplateList(...)addTaggedProfiles(...)getObjectKeyTemplate(...)Iterator<> templateIteratorTaggedProfileTemplate ptempTaggedProfile profileIdentifiableFactoryFinder findergetTaggedProfileFactoryFinder(...)readIdentifiableSequence(...)writeIdentifiableSequence(...)StringWriter bsMarshalOutputStream snew StringWriter(...)new HexOutputStream(...)IOException exstringifyWriteError(...)ORBConstants.STRINGIFY_PREFIXmakeElementsImmutable(...)Iterator<> myIteratorIterator<> otherIteratorTaggedProfile myProfileTaggedProfile otherProfileisEquivalent(...)Map<> oktempToIORTemplateObjectId oidTaggedProfile profgetObjectId(...)badOidInIorTemplateList(...)/** Return the IORTemplateList for this IOR.  Will throw ... */initializeIORTemplateList(...)/** Return the first IIOPProfile in this IOR. ... */IIOPProfile iopTAG_INTERNET_IOP.valueiorMustHaveIiopProfile(...)// XXX remove this once getProfile is gone// The check for typeId length of 0 below is commented out// as a workaround for a bug in ORBs which send a// null objref with a non-empty typeId string./* && (typeId.length() == 0) */// Maps ObjectKeyTemplate to IORTemplate// used to check that all profiles have the same oid.// Check that all oids for all profiles are the same: if they are not,// throw exception.// Find or create the IORTemplate for oktemp.// if we come to this point then no IIOP Profile// is present.  Therefore, throw an exception.import IORFactory/** This class is a container of TaggedProfileTemplates. ... */IORTemplateImpl othernew IORImpl(...)IORTemplate listIterator<> thisIteratorIterator<> listIteratorTaggedProfileTemplate thisTemplateTaggedProfileTemplate listTemplate/** Ensure that this IORTemplate and all of its profiles can not be ... */getTaggedProfileTemplateFactoryFinder(...)createTemplate(...)getObjectKeyFactory(...)/* This class must override add( int, Object ) and set( int, Object ) ... */IORTemplateList tladdAll(...)IORTemplateList listIORTemplate thisTemplateIORTemplate listTemplateimport IORTypeCheckRegistryinitBuiltinIorTypeNames(...)Set<String> iorTypeNames;Set<String> builtinIorTypeNames;ORB theOrb;parseIorClassNameList(...)/* A note on the validation flow: ... */dprintTransport(...)validateIorTypeByName(...)boolean isValidTypecheckIorTypeNames(...)checkBuiltinClassNames(...)/* check if the class name corresponding to an IOR Type name ... */contains(...)/* Check the IOR interface class name against the set of ... */Set<String> _iorTypeNamesString[] tempIorClassNamessplit(...)unmodifiableSet(...)new HashSet<E>(...)asList(...)theOrb.orbInitDebugFlagdprintConfiguredIorTypeNames(...)Set<Class<?>> builtInCorbaStubTypesinitBuiltInCorbaStubTypes(...)String[] tempBuiltinIorTypeNamesClass<?> _stubClassClass<?>[] tempBuiltinCorbaStubTypesActivator.class_ServerStub.classBindingIterator.class_BindingIteratorStub.classNamingContextExt.class_NamingContextExtStub.classNamingContext.class_NamingContextStub.classDynAnyFactory.class_DynAnyFactoryStub.classDynAny.class_DynAnyStub.classDynArray.class_DynArrayStub.classDynEnum.class_DynEnumStub.classDynFixed.class_DynFixedStub.classDynSequence.class_DynSequenceStub.classDynStruct.class_DynStructStub.classDynUnion.class_DynUnionStub.class_DynValueStub.classDynValue.classServantActivator.class_ServantActivatorStub.classServantLocator.class_ServantLocatorStub.classnew HashSet<Class<?>>(...)String iorTypeNametheOrb.transportDebugFlag/* Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved. ... */import IdentifiableFactoryMap<> map;Integer identIdentifiableFactory factoryhandleMissingFactory(...)import OctetSeqHolderimport ObjectKeyFactoryimport ObjectKeyFactoryImpl/** This constructor reads the template ONLY from the stream. */setORBVersion(...)/** This constructor reads a complete ObjectKey (template and Id) ... */osh.valuereadObjectKey(...)ObjectKeyFactoryImpl.JAVAMAGIC_NEWERgetMagic(...)getSubcontractId(...)badMagic(...)ORBVersion version// subclass must set the version, since we don't have the object key here....[] objectAdapterId;this.objectAdapterId/** Special constructor used for OA IDs of length 2. */objectAdapterId.lengthObjectAdapterId theOtherIterator<> iter1Iterator<> iter2String str1String str2StringBuffer buffboolean firstgetNumLevels(...)/** ObjectAdapterIdNumber is used to represent pre-JDK 1.4 POA adapter ... */int poaid;this.poaid...[] id;ObjectIdImpl otherother.idid.lengthimport JIDLObjectKeyTemplateimport POAObjectKeyTemplateimport WireObjectKeyTemplateimport ObjectIdImplimport ObjectKeyImpl/** Based on the magic and scid, return the appropriate ... *//** Singleton used to manufacture ObjectKey and ObjectKeyTemplate ... */new Handler(...) { ... }ObjectKeyFactoryImpl$1ORBConstants.FIRST_POA_SCIDORBConstants.MAX_POA_SCIDnew POAObjectKeyTemplate(...)new OldPOAObjectKeyTemplate(...)new JIDLObjectKeyTemplate(...)new OldJIDLObjectKeyTemplate(...)ObjectKeyFactoryImpl$2int MAGIC_BASE;int JAVAMAGIC_OLD;// J2EE 1.0-1.2.1.// Magic used in our object keys for JDK 1.2, 1.3, RMI-IIOP OP,int JAVAMAGIC_NEW;// Magic used only in JDK 1.3.1.  No format changes in object keys.int JAVAMAGIC_NEWER;// is changed.// Format changes: all object keys have version string; POA key format// New magic used in our object keys for JDK 1.4, J2EE 1.3 and later.int MAX_MAGIC;byte JDK1_3_1_01_PATCH_LEVEL;// versions.  See OldJIDLObjectKeyTemplate.// the ability to distinguish between JDK 1.3.1 FCS and the patch// Beginning in JDK 1.3.1_01, we introduced changes which requiredHandler fullKey;/** This handler reads the full object key, both the oktemp ... *///      and similarly for getHandlerForObjectKeyTemplate.//          }//                  getObjectAdapterFactory( scid ).getHandlerForObjectKey() ;//              return orb.getRequestDispatcherRegistry().//          {//          ObjectKeyHandler get( int scid )//      new HandlerFinder() {//    to create an instance of HandlerFinder: something like:// 6. Modify create( byte[] ) and createTemplate( InputStream )//    to take a HandlerFinder instead of a Handler.//    and modify create(InputStream,Handler,OctetSeqHolder)//      }//          ObjectKeyHandler get( int scid ) ;//      interface HandlerFinder {// 5. Create an internal interface// 4. Move the ObjectKey impl classes into the impl/oa packages.//    oktempOnly handler into TOAFactory and POAFactory.// 3. Move the implementation of the fullKey handler and the//      ObjectKeyHandler getHandlerForObjectKeyTemplate( ) ;//      ObjectKeyHandler getHandlerForObjectKey( ) ;// 2. Add two methods to ObjectAdapterFactory:// 1. Move the Handler interface into the SPI as ObjectKeyHandler.// I think this can be done as follows:// XXX The handlers still need to be made pluggable.Handler oktempOnly;/** This handler reads only the oktemp. *//** Returns true iff magic is in the range of valid magic numbers ... *//** Creates an ObjectKeyTemplate from the InputStream.  Most of the ... */int magicvalidMagic(...)int scidhandle(...)MARSHAL mexcOctetSeqHolder oshnew OctetSeqHolder(...)EncapsInputStream iskey.lengthnew ObjectIdImpl(...)new WireObjectKeyTemplate(...)new ObjectKeyImpl(...)// XXX log this error// ignore this: error handled below because oktemp == null// If we did not successfully construct a oktemp, reset the// stream so that WireObjectKeyTemplate can correctly construct the// object key.// ignore thisimport CorbaServerRequestDispatcherObjectId id;ObjectKeyImpl otherother.oktempgetServerRequestDispatcher(...)new ObjectAdapterIdArray(...)String JIDL_ORB_ID;// Fixed constants for Java IDL object key template forms...[] JIDL_OAID_STRINGS;ObjectAdapterId JIDL_OAID;ORBVersion version;int magic;int scid;int serverid;String orbid;ObjectAdapterId oaid;ByteBuffer buffnew ByteBuffer(...)String comptrimToSize(...)this.magicthis.scidthis.serveridthis.orbidthis.oaidcomputeAdapterId(...)ObjectKeyTemplateBase otherother.magicother.scidother.serveridother.versionother.orbidother.oaidwriteTemplate(...)// Public so it can be used in a white-box test.// All subclasses should set the version in their constructors.this.versiongetRequestDispatcherRegistry(...)// write out serverid, orbid, oaidimport ObjectReferenceFactoryHelper/** This is an implementation of the ObjectReferenceFactory abstract value ... */IORTemplateList iorTemplates;ObjectReferenceFactoryImpl otherother.iorTemplatesString repositoryId;// of the abstract valuetype, should that become necessary.// class.  This allows for multiple independent implementations// repository ID of the org.omg.PortableInterceptor.ObjectReferenceFactory// of the abstract valuetype (that is, this class), not the// Note that this repository ID must reflect the implementation/** Read the data into a (presumably) empty ObjectReferenceFactoryImpl. ... */InputStream istr/** Write the state to the OutputStream. */OutputStream ostrmakeObjectId(...)getIORFactory(...)import ObjectReferenceTemplateHelper/** This is an implementation of the ObjectReferenceTemplate abstract value ... */IORTemplate iorTemplate;ObjectReferenceTemplateImpl otherother.iorTemplate// repository ID of the org.omg.PortableInterceptor.ObjectReferenceTemplate/** Read the data into a (presumably) empty ORTImpl.  This sets the ... */int valObjectAdapterId poaid/** Handles object keys created by JDK ORBs from before JDK 1.4.0. */OldJIDLObjectKeyTemplate.NULL_PATCH_VERSIONbyte NULL_PATCH_VERSION;/** JDK 1.3.1 FCS did not include a version byte at the end of ... */byte patchVersion;ObjectKeyFactoryImpl.JAVAMAGIC_NEWosh.value.lengthObjectKeyFactoryImpl.JDK1_3_1_01_PATCH_LEVELgetJDK1_3_1_01(...)invalidJdk131PatchLevel(...)/** Beginning with JDK 1.3.1_01, a byte was placed at the end of ... */ObjectKeyFactoryImpl.JAVAMAGIC_OLDgetOLD(...)getNEW(...)// set version based on magic// any other magic should not be here/** This constructor reads the template ONLY from the stream */new ObjectAdapterIdNumber(...)int orbidObjectAdapterIdNumber oaidint poaidgetOldPOAId(...)import POANameHelper/** This class implements a very simply IOR representation ... */int hashCode;// cached hash code...[] typeData;// IOR components...[] profileTags;...[] profileData;int typeLengthint numProfilesnew byte[][]typeData.lengthprofileTags.lengthcheckArray(...)getJavaOISAccess(...)int dataSize/** Returns a hash code value for the object which is the same for all stubs ... */data1.lengthdata2.lengthequalArrays(...)StubIORImpl otherother.typeDataother.profileTagsother.profileData/** Returns a string representation of this stub. Returns the same string ... */StringBuffer resultString repositoryIdappendByteArray(...)/* Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved. ... */// Be very careful: com.sun.corba imports must not depend on// PEORB internal classes in ways that prevent portability to// other vendor's ORBs.// write the IOR to an OutputStream and get an InputStream// read the IOR components back from the stream// write the IOR components to an org.omg.CORBA.portable.OutputStream// read the IOR back from the stream// read the IOR from the ObjectInputStream// write the IOR to the ObjectOutputStream// compute the hash codeimport GenericTaggedComponentimport IdentifiableFactoryFinderBasenew GenericTaggedComponent(...)comp.tag// Skip the component ID: we just wrote it out abovenew GenericTaggedProfile(...)taggedProfileTemplateFactoryNotFound(...)CDRInputStream cisinitORB(...)byte[] keyORBConstants.DEFAULT_SCID/** While it might make sense to throw an exception here, this causes ... */orbIdNotAvailable(...)objectAdapterIdNotAvailable(...)/** Adapter ID is not available, since our ... */adapterIdNotAvailable(...)byte[] bid// All WireObjectKeyTemplates are the same, so they should// have the same hashCode.// Does nothingimport TaggedComponentBaseimport AlternateIIOPAddressComponentimport TAG_ALTERNATE_IIOP_ADDRESSIIOPAddress addr;AlternateIIOPAddressComponentImpl otherother.addrthis.addrTAG_ALTERNATE_IIOP_ADDRESS.value// 3 in CORBA 2.3.1 13.6.3import CodeSetsComponentimport TAG_CODE_SETSCodeSetComponentInfo csci;CodeSetsComponentImpl otherother.cscigetCodeSetComponentInfo(...)TAG_CODE_SETS.value// Uses our default code sets (see CodeSetComponentInfo)// 1 in CORBA 2.3.1 13.6.3// for this purpose.// scaling conversion.  intToShort and shortToInt are provided// ints throught this code, except that marshalling requires a// in Java in the 32768-65536 range.  So, we treat ports as// type is unsigned short, which lacks a convenient representation// Ports are marshalled as shorts on the wire.  The IDLgetPort(...)getHost(...)intToShort(...)IIOPAddress otherimport ClosureClosure host;Closure port;this.hostthis.portevaluate(...)badIiopAddressPort(...)short thePortshortToInt(...)import TAG_JAVA_CODEBASEimport ObjectAdapterFactoryimport IdentifiableBaseimport JavaCodebaseComponentimport EncapsulationUtilityimport JDKBridgeObjectId oid;IIOPProfileTemplate proftemp;String codebase;// Cached lookupsboolean cachedCodebase;boolean checkedIsLocal;boolean cachedIsLocal;IIOPProfileImpl$LocalCodeBaseSingletonHolderString localCodebasegetLocalCodebase(...)makeJavaCodebaseComponent(...)JavaCodebaseComponent comp;IIOPProfileImpl otherother.oidother.proftempthis.oidthis.proftempEncapsInputStream istrprofile.profile_dataprofile.profile_data.lengthprofile.taginvalidTaggedProfile(...)GIOPVersion versionnew GIOPVersion(...)IIOPAddress primarynew IIOPAddressImpl(...)ObjectKey okeygetMinor(...)uncachedGetCodeBase(...)JavaCodebaseComponent jccLocalCodeBaseSingletonHolder.compgetURLs(...)IIOPProfile otherObjectKey resultmakeObjectKey(...)TAG_JAVA_CODEBASE.valueJavaCodebaseComponent jcbc/** @return */getPrimaryAddress(...)legacyIsLocalServerPort(...)isLocalHost(...)isLocalServerId(...)/** Return the servant for this IOR, if it is local AND if the OA that ... */RequestDispatcherRegistry scrObjectAdapterFactory oafgetObjectAdapterFactory(...)ObjectAdapter oabyte[] boidgetLocalServant(...)isLocal(...)find(...)SystemException excgetLocalServantFailure(...)/** Return GIOPVersion for this IOR. ... */// First, read all of the IIOP IOR data// Handle any tagged components (if applicable)// If there is no codebase in this IOR and there IS a// java.rmi.server.codebase property set, we need to// update the IOR with the local codebase.  Note that// there is only one instance of the local codebase, but it// can be safely shared in multiple IORs since it is immutable.// Whether codebase is null or not, we have it,// and so getCodebase ned never call uncachedGetCodebase.// Could not find the OA, so just return null.// This usually happens when POAs are being deleted,// and the POA always return null for getLocalServant anyway.import TaggedProfileTemplateBaseIIOPAddress primary;IIOPProfileTemplateImpl otherother.giopVersionother.primarymakeIIOPProfile(...)this.giopVersionthis.primarybyte majorbyte minorOutputStream encapsulatedOS/** Write out this IIOPProfileTemplateImpl only. */IIOPProfileTemplateImpl tempimptempimp.primary// Adding tagged components is not allowed for IIOP 1.0,// so this template is complete and should be made immutable.// Note that this is NOT an encapsulation: do not marshal// the endianness flag.  However, the length is required.// Note that this cannot be accomplished with a codec!// Use the byte order of the given streamString URLs;JavaCodebaseComponentImpl otherthis.URLs// 25 in CORBA 2.3.1 13.6.3/** Tagged component that contains a value that indicates the Java ... */byte version;JavaSerializationComponent singleton;JavaSerializationComponent.classnew JavaSerializationComponent(...)Message.JAVA_ENC_VERSIONORBConstants.TAG_JAVA_SERIALIZATION_IDJavaSerializationComponent otherimport TAG_RMI_CUSTOM_MAX_STREAM_FORMATimport MaxStreamFormatVersionComponent// TAG_RMI_CUSTOM_MAX_STREAM_FORMAT// Java to IDL ptc 02-01-12 1.4.11new MaxStreamFormatVersionComponentImpl(...)MaxStreamFormatVersionComponentImpl singleton;MaxStreamFormatVersionComponentImpl otherTAG_RMI_CUSTOM_MAX_STREAM_FORMAT.value/* Copyright (c) 2002, 2004, Oracle and/or its affiliates. All rights reserved. ... */import TAG_ORB_TYPEimport ORBTypeComponentint ORBType;ORBTypeComponentImpl otherother.ORBTypethis.ORBTypeTAG_ORB_TYPE.value// 0 in CORBA 2.3.1 13.6.3import RequestPartitioningComponentint partitionToUse;RequestPartitioningComponentImpl otherother.partitionToUseORBConstants.REQUEST_PARTITIONING_MIN_THREAD_POOL_IDORBConstants.REQUEST_PARTITIONING_MAX_THREAD_POOL_IDinvalidRequestPartitioningComponentValue(...)ORBConstants.TAG_REQUEST_PARTITIONING_IDimport RemoteExceptionimport StubIORImplimport StubConnectImpl/** Base class from which all static RMI-IIOP stubs must inherit. */CORBALogDomains.RMIIIOPStubIORImpl ior;/** Sets the IOR components if not already set. */new StubIORImpl(...)/** Compares two stubs for equality. Returns <code>true</code> when used to compare stubs ... */Stub otherStubDelegateImpl otherother.ior/** Connects this stub to an ORB. Required after the stub is deserialized ... *//** Serialization method to restore the IOR state. */doRead(...)/** Serialization method to save the IOR state. ... */doWrite(...)// If the Stub is not connected to an ORB, BAD_OPERATION exception// will be raised by the code below.// no need to call init() because of calls to hashCode() below// hashCodes being the same does not mean equality. The stubs still// could be pointing to different IORs. So, do a literal comparison.// Apparently the ONLY way to do this (other than using private// reflection)  toString, because it is not possible to directly// access the StubDelegateImpl from the Stub.import UnexpectedExceptionimport RMIClassLoaderimport NoSuchObjectExceptionimport AccessExceptionimport ServerErrorimport ServerExceptionimport ServerRuntimeExceptionimport TransactionRequiredExceptionimport TransactionRolledbackExceptionimport InvalidTransactionExceptionimport INV_OBJREFimport NO_PERMISSIONimport TRANSACTION_REQUIREDimport TRANSACTION_ROLLEDBACKimport INVALID_TRANSACTIONimport ACTIVITY_REQUIREDimport ACTIVITY_COMPLETEDimport INVALID_ACTIVITYimport UnknownExceptionimport ContactInfoListimport LocalClientRequestDispatcherimport ValueHandlerImplimport IdentityHashtable/** Provides utility methods that can be used by stubs and ties to ... */new IdentityHashtable(...)newValueHandlerImpl(...)KeepAlive keepAlive;// Runs as long as there are exportedServantsIdentityHashtable exportedServants;// Maps targets to ties.ValueHandlerImpl valueHandlerSingleton;Util instance;setInstance(...)assert ...// particular ORB.  This happens during ORB shutdown.// Used by TOAFactory.shutdown to unexport all targets for thisEnumeration<> eObject keyRemote targetgetTarget(...)getTie(...)unexportObject(...)NoSuchObjectException exBAD_OPERATION bad/** Maps a SystemException to a RemoteException. ... */String corbaNameString statusString messageex.minorThrowable orig(...).originalExnew ServerError(...)new ServerException(...)ex.completedCompletionStatus._COMPLETED_YESCompletionStatus._COMPLETED_NOCompletionStatus._COMPLETED_MAYBEnew MarshalException(...)RemoteException newExnew NoSuchObjectException(...)newEx.detailnew AccessException(...)new TransactionRequiredException(...)new TransactionRolledbackException(...)new InvalidTransactionException(...)Exception innerORBConstants.LEGACY_SUN_NOT_SERIALIZABLEOMGSystemException.NOT_SERIALIZABLEClass<>[] paramsConstructor<> crgetConstructor(...)classNotFound(...)new RemoteException(...)/** Writes any java.lang.Object as a CORBA any. ... */Object newObjcreateTypeCodeForNull(...)createTypeCode(...)/** When using our own ORB and Any implementations, we need to get ... */ORB ourORB/** This is used to create the TypeCode for a null reference. ... */String abstractBaseIDcreate_abstract_interface_tc(...)/** Reads a java.lang.Object as a CORBA any. ... *//** Writes a java.lang.Object as a CORBA Object. If <code>obj</code> is ... *//** Writes a java.lang.Object as either a value or a CORBA Object. ... *//** Registers a target for a tie. Adds the tie to an internal table and calls ... */lookupTie(...)setTarget(...)Util$1new KeepAlive(...)/** Removes the associated tie from an internal table and calls {@link Tie#deactivate} ... */Tie cachedTiepurgeStubForTie(...)purgeTieAndServant(...)cleanUpTie(...)OBJ_ADAPTER equit(...)deactivate(...)/** Returns the tie (if any) for a given target object. ... *//** An unsynchronized version of getTie() for internal use. */Tie result/** Returns a singleton instance of a class that implements the ... *//** Returns the codebase, if any, for the given class. ... */getClassAnnotation(...)/** Returns a class instance for the specified class. ... *//** The <tt>isLocal</tt> method has the same semantics as the ... */CorbaClientDelegate cdelContactInfoList cilCorbaContactInfoList ccilLocalClientRequestDispatcher lcsgetLocalClientRequestDispatcher(...)useLocalInvocation(...)is_local(...)mapSystemException(...)/** Wraps an exception thrown by an implementation ... */new UnexpectedException(...)/** Copies or connects an array of objects. Used by local stubs ... */Class<> compTypeRemote[] resultnew Remote[]obj.lengthcopyObject(...)/** Copies or connects an object. Used by local stubs to copy ... */ORB lorbmake(...)getCopierFactory(...)peekInvocationInfo(...)EmptyStackException excCopierManager cmgetCopierManager(...)ObjectCopier copiergetDefaultObjectCopierFactory(...)ReflectiveCopyException excRemoteException rexcboolean quit;// Util (sed marker, don't remove!)// This class must be able to function with non-Sun ORBs.// This means that any of the following com.sun.corba classes// must only occur in contexts that also handle the non-Sun case.// Bug 4476347: BAD_OPERATION is thrown if the ties delegate isn't set.// We can ignore this because it means the tie is not connected to an ORB.// We neglect this exception if at all if it is// raised. It is not harmful./* Ignore */// Build the message string...// Now map to the correct RemoteException type...// Pre-Merlin Sun ORBs used the incorrect minor code for// this case.  See Java to IDL ptc-00-01-08 1.4.8.// Just map to a generic RemoteException...// Create Any// Make sure we have a connected object...// Handle the null case, including backwards// compatibility issues// If they're our Any and ORB implementations,// we may want to do type code related versioning.// Preserve backwards compatibility with Kestrel and Ladybird// by not fully implementing interop issue resolution 3857,// and returning a null TypeCode with a tk_value TCKind.// If we're not talking to Kestrel or Ladybird, fall through// to the abstract interface case (also used for foreign ORBs).// Use tk_abstract_interface as detailed in the resolution// REVISIT: Define this in IDL and get the ID in generated code// Make sure we have a connected object, then// write it out...// Do we already have this target registered?// No, so register it and set the target...// Do we need to instantiate our keep-alive thread?// Yes. Instantiate our keep-alive thread and start// it up...// ignore// This can happen when the target was never associated with a POA.// We can safely ignore this case.// Is it time to shut down our keep alive thread?// For the Sun ORB// For a non-Sun ORB// Bug fix for 5018613: JCK test expects copyObjects to throw// NPE when obj==null.  This is actually not in the spec, since// obj is not really an RMI-IDL data type, but we follow our// test here, and force this error to be thrown.// obj is an array of remote impl types.  This// causes problems with stream copier, so we copy// it over to an array of Remotes instead.// This gets the copier for the current invocation, which was// previously set by preinvoke.// copyObject was invoked outside of an invocation, probably by// a test.  Get the default copier from the ORB.// XXX should we just make the default copier available directly// and avoid constructing one on each call?import UnicastRemoteObjectimport RemoteStubimport ExportExceptionimport URLimport GetPropertyAction/** Server implementation objects may either inherit from ... *//** Makes a server object ready to receive remote calls. Note ... */Tie theTieloadTie(...)new ExportException(...)registerTarget(...)exportObject(...)/** Returns a stub for the given server object. ... */Remote resulttoStub(...)/** Deregisters a server object from the runtime, allowing the object to become ... *//** Checks to ensure that an object of a remote or abstract interface type ... */Object narrowObjException error/** Makes a Remote object ready for remote communication. This normally ... */boolean targetIsIIOPTie targetTieTie tieORB existingOrb// Has this object already been exported to IIOP?// Yes, so this is an error...// Can we load a Tie?// Yes, so export it to IIOP...// No, so export to JRMP. If this is called twice for the// same object, it will throw an ExportException...// If the class is already an IIOP stub then return it.// If the class is already a JRMP stub then return it.// Has it been exported to IIOP?// Is narrowTo an interface that might be// implemented by a servant running on iiop?// Create an id from the narrowTo type...// Is this a servant that was exported to iiop?/* loadTie always succeeds for dynamic RMI-IIOP ... */// Yes. Do we have an ORB from the source object?// If not, we're done - there is nothing to do to// connect a JRMP object. If so, it is an error because// the caller mixed JRMP and IIOP...// The target object is IIOP. Make sure we have a// valid ORB from the source object...// And, finally, connect it up...// Is the tie already connected?// Yes. Is it the same orb?// Yes, so nothing to do...// No, so this is an error...// No, so do it...// The stub or tie was already connected...import InetSocketAddressimport ServerSocketimport Socketimport UnknownHostExceptionimport ServerSocketChannelimport SocketChannelimport GetEndPointInfoAgainExceptionimport ORBSocketFactoryimport EndPointInfoImplCORBALogDomains.RPC_TRANSPORTServerSocket serverSocketORBSocketFactory.IIOP_CLEAR_TEXTdefaultCreateServerSocketGivenNonIiopClearText(...)acceptorSocketType(...)ORBConstants.SOCKETCHANNELServerSocketChannel serverSocketChannelopen(...)socket(...)new ServerSocket(...)new InetSocketAddress(...)IIOPProfileTemplate tempnew EndPointInfoImpl(...)toLowerCase(...)Socket socketInetSocketAddress addressSocketChannel socketChannelnew Socket(...)setTcpNoDelay(...)// REVISIT - this is done in SocketOrChannelConnectionImplString type;int locatorPort;this.typethis.hostnamethis.locatorPortLegacyServerSocketEndPointInfo.NO_NAMEEndPointInfoImpl otherother.portother.hostnameimport ContactInfoimport Selectorimport LegacyServerSocketManagerimport USLPort// Only used in ServerManagerImpl.// LegacyServerSocketManager////////////////////////////////////////////////////legacyGetServerPort(...)// Only used by POAPolicyMediatorBase.getServerIsORBActivated(...)getPersistentPortInitialized(...)getPersistentServerPort(...)persistentServerportNotSet(...)// Only used by PI IORInfoImpl.// To get either default or bootnaming endpoint.// POAPolicyMediatorBase, TOAImpl.// Used in RepositoryImpl, ServerManagerImpl, POAImpl,Iterator<> iteratorgetAcceptorIterator(...)LegacyServerSocketEndPointInfo endPointcast(...)// Used in IIOPProfileImpl, ORBImpl.// XXX Does this need to change for the multi-homed case?// Check to see if the given port is equal to any of the ORB Server Ports.// Implementation.Iterator<> endpointsLegacyServerSocketEndPointInfo epgetLocatorPort(...)Collection<> acceptorsgetAcceptors(...)getServerPortCalledBeforeEndpointsInitialized(...)// this server is activated by orbd// this is a user-activated serverimport SocketOrChannelContactInfoImpl// pept AcceptorcreateServerSocket(...)internalInitialize(...)createListenerFailed(...)toStringName(...)/* Copyright (c) 2003, 2004, Oracle and/or its affiliates. All rights reserved. ... */import SocketOrChannelConnectionImpl// Socket-factory client constructor.boolean isBlockingSocketInfo socketInfo(...).socketInfothis.contactInfocreateSocket(...)getChannel(...)configureBlocking(...)setUseSelectThreadToWait(...)GetEndPointInfoAgainException exconnectFailure(...)shouldUseWorkerThreadForEvent(...)shouldUseSelectThreadToWait(...)getStateString(...)// Note: public to override parent.// REVISIT - probably need a contact info for both// client and server for removing connections from cache?// REVISIT - case - needs interface method// IMPORTANT: non-channel-backed sockets must use// dedicated reader threads.SocketInfo socketInfo;// See SocketOrChannelContactInfoImpl.constructor()// See SocketFactoryContactInfoImpl.constructor()// See SocketOrChannelAcceptorImpl.createMessageMediatorthis.effectiveTargetIORthis.addressingDispositiongetEndPointInfo(...)// pept.transport.ContactInfoConnection connectionnew SocketFactoryConnectionImpl(...)connectionSocketUseSelectThreadToWait(...)connectionSocketUseWorkerThreadForEvent(...)// java.lang.Objectimport CorbaContactInfoListImplimport CorbaContactInfoListIteratorImpl// XREVISIT - is this used?// pept.transport.ContactInfoListnew SocketFactoryContactInfoListIteratorImpl(...)import SharedCDRContactInfoImplSocketInfo socketInfoCookie;// java.util.Iteratornew SharedCDRContactInfoImpl(...)getGIOPAddressDisposition(...)new SocketFactoryContactInfoImpl(...)// pept.ContactInfoListIteratorthis.failureContactInfothis.failureExceptionse.completedsetEffectiveTargetIOR(...)// REVISIT:// on comm_failure maybe need to give IOR instead of located.// retry from root iorimport OMGVMCIDimport SUNVMCIDimport LogWrapperFactoryimport LogWrapperBasenew LogWrapperFactory(...) { ... }ActivationSystemException$1new ActivationSystemException(...)SUNVMCID.valueLogWrapperFactory factory;ActivationSystemException wrappergetLogWrapper(...)staticGetLogWrapper(...)int CANNOT_READ_REPOSITORY_DB;///////////////////////////////////////////////////////////// INITIALIZEINITIALIZE excnew INITIALIZE(...)isLoggable(...)Level.WARNINGObject[] parametersdoLog(...)ActivationSystemException.classint CANNOT_ADD_INITIAL_NAMING;cannotAddInitialNaming(...)int CANNOT_WRITE_REPOSITORY_DB;// INTERNALINTERNAL excint SERVER_NOT_EXPECTED_TO_REGISTER;int UNABLE_TO_START_PROCESS;int SERVER_NOT_RUNNING;int ERROR_IN_BAD_SERVER_ID_HANDLER;// OBJECT_NOT_EXISTOBJECT_NOT_EXIST excnew OBJECT_NOT_EXIST(...)// Log wrapper class for Sun private system exceptions in group ACTIVATION// Generated by MC.java version 1.0, DO NOT EDIT BY HAND!// Generated from input file /jenkins/workspace/8-2-build-macosx-x86_64/jdk8u251/737/corba/src/share/classes/com/sun/corba/se/spi/logging/data/Activation.mc on Thu Mar 12 02:38:09 PDT 2020IORSystemException$1new IORSystemException(...)IORSystemException wrapperint ORT_NOT_INITIALIZED;IORSystemException.classortNotInitialized(...)int NULL_POA;nullPoa(...)int BAD_MAGIC;int STRINGIFY_WRITE_ERROR;int TAGGED_PROFILE_TEMPLATE_FACTORY_NOT_FOUND;int INVALID_JDK1_3_1_PATCH_LEVEL;int GET_LOCAL_SERVANT_FAILURE;Level.FINEint ADAPTER_ID_NOT_AVAILABLE;// BAD_OPERATIONBAD_OPERATION excint SERVER_ID_NOT_AVAILABLE;serverIdNotAvailable(...)int ORB_ID_NOT_AVAILABLE;int OBJECT_ADAPTER_ID_NOT_AVAILABLE;int BAD_OID_IN_IOR_TEMPLATE_LIST;// BAD_PARAMBAD_PARAM excint INVALID_TAGGED_PROFILE;int BAD_IIOP_ADDRESS_PORT;int IOR_MUST_HAVE_IIOP_PROFILE;// INV_OBJREFINV_OBJREF excnew INV_OBJREF(...)// Log wrapper class for Sun private system exceptions in group IOR// Generated from input file /jenkins/workspace/8-2-build-macosx-x86_64/jdk8u251/737/corba/src/share/classes/com/sun/corba/se/spi/logging/data/IOR.mc on Thu Mar 12 02:38:09 PDT 2020InterceptorsSystemException$1new InterceptorsSystemException(...)InterceptorsSystemException wrapperint TYPE_OUT_OF_RANGE;InterceptorsSystemException.classint NAME_NULL;int RIR_INVALID_PRE_INIT;// BAD_INV_ORDERBAD_INV_ORDER excnew BAD_INV_ORDER(...)int BAD_STATE1;int BAD_STATE2;int IOEXCEPTION_DURING_CANCEL_REQUEST;// COMM_FAILURECOMM_FAILURE excnew COMM_FAILURE(...)ioexceptionDuringCancelRequest(...)int EXCEPTION_WAS_NULL;int OBJECT_HAS_NO_DELEGATE;objectHasNoDelegate(...)int DELEGATE_NOT_CLIENTSUB;delegateNotClientsub(...)int OBJECT_NOT_OBJECTIMPL;objectNotObjectimpl(...)int EXCEPTION_INVALID;int REPLY_STATUS_NOT_INIT;int EXCEPTION_IN_ARGUMENTS;int EXCEPTION_IN_EXCEPTIONS;int EXCEPTION_IN_CONTEXTS;int EXCEPTION_WAS_NULL_2;int SERVANT_INVALID;int CANT_POP_ONLY_PICURRENT;int CANT_POP_ONLY_CURRENT_2;cantPopOnlyCurrent2(...)int PI_DSI_RESULT_IS_NULL;int PI_DII_RESULT_IS_NULL;int EXCEPTION_UNAVAILABLE;int CLIENT_INFO_STACK_NULL;int SERVER_INFO_STACK_NULL;int MARK_AND_RESET_FAILED;int SLOT_TABLE_INVARIANT;int INTERCEPTOR_LIST_LOCKED;int SORT_SIZE_MISMATCH;int PI_ORB_NOT_POLICY_BASED;// NO_IMPLEMENTNO_IMPLEMENT excint ORBINITINFO_INVALID;int UNKNOWN_REQUEST_INVOKE;// UNKNOWNUNKNOWN excnew UNKNOWN(...)// Log wrapper class for Sun private system exceptions in group INTERCEPTORS// Generated from input file /jenkins/workspace/8-2-build-macosx-x86_64/jdk8u251/737/corba/src/share/classes/com/sun/corba/se/spi/logging/data/Interceptors.mc on Thu Mar 12 02:38:09 PDT 2020NamingSystemException$1new NamingSystemException(...)NamingSystemException wrapperint TRANSIENT_NAME_SERVER_BAD_PORT;NamingSystemException.classtransientNameServerBadPort(...)int TRANSIENT_NAME_SERVER_BAD_HOST;transientNameServerBadHost(...)int OBJECT_IS_NULL;objectIsNull(...)int INS_BAD_ADDRESS;insBadAddress(...)int BIND_UPDATE_CONTEXT_FAILED;bindUpdateContextFailed(...)int BIND_FAILURE;bindFailure(...)int RESOLVE_CONVERSION_FAILURE;resolveConversionFailure(...)int RESOLVE_FAILURE;resolveFailure(...)int UNBIND_FAILURE;unbindFailure(...)int TRANS_NS_CANNOT_CREATE_INITIAL_NC_SYS;transNsCannotCreateInitialNcSys(...)int TRANS_NS_CANNOT_CREATE_INITIAL_NC;transNsCannotCreateInitialNc(...)int NAMING_CTX_REBIND_ALREADY_BOUND;namingCtxRebindAlreadyBound(...)int NAMING_CTX_REBINDCTX_ALREADY_BOUND;namingCtxRebindctxAlreadyBound(...)int NAMING_CTX_BAD_BINDINGTYPE;namingCtxBadBindingtype(...)int NAMING_CTX_RESOLVE_CANNOT_NARROW_TO_CTX;namingCtxResolveCannotNarrowToCtx(...)int NAMING_CTX_BINDING_ITERATOR_CREATE;namingCtxBindingIteratorCreate(...)int TRANS_NC_BIND_ALREADY_BOUND;transNcBindAlreadyBound(...)int TRANS_NC_LIST_GOT_EXC;transNcListGotExc(...)int TRANS_NC_NEWCTX_GOT_EXC;transNcNewctxGotExc(...)int TRANS_NC_DESTROY_GOT_EXC;transNcDestroyGotExc(...)int INS_BAD_SCHEME_NAME;insBadSchemeName(...)int INS_BAD_SCHEME_SPECIFIC_PART;insBadSchemeSpecificPart(...)int INS_OTHER;insOther(...)// Log wrapper class for Sun private system exceptions in group NAMING// Generated from input file /jenkins/workspace/8-2-build-macosx-x86_64/jdk8u251/737/corba/src/share/classes/com/sun/corba/se/spi/logging/data/Naming.mc on Thu Mar 12 02:38:09 PDT 2020import BAD_CONTEXTimport DATA_CONVERSIONimport IMP_LIMITimport INTF_REPOSimport TRANSIENTimport OBJ_ADAPTEROMGSystemException$1new OMGSystemException(...)OMGVMCID.valueOMGSystemException wrapperint IDL_CONTEXT_NOT_FOUND;// BAD_CONTEXTBAD_CONTEXT excnew BAD_CONTEXT(...)OMGSystemException.classidlContextNotFound(...)int NO_MATCHING_IDL_CONTEXT;noMatchingIdlContext(...)int DEP_PREVENT_DESTRUCTION;depPreventDestruction(...)int DESTROY_INDESTRUCTIBLE;destroyIndestructible(...)int SHUTDOWN_WAIT_FOR_COMPLETION_DEADLOCK;shutdownWaitForCompletionDeadlock(...)int BAD_OPERATION_AFTER_SHUTDOWN;badOperationAfterShutdown(...)int BAD_INVOKE;badInvoke(...)int BAD_SET_SERVANT_MANAGER;badSetServantManager(...)int BAD_ARGUMENTS_CALL;badArgumentsCall(...)int BAD_CTX_CALL;badCtxCall(...)int BAD_RESULT_CALL;badResultCall(...)int BAD_SEND;badSend(...)int BAD_POLL_BEFORE;badPollBefore(...)int BAD_POLL_AFTER;badPollAfter(...)int BAD_POLL_SYNC;badPollSync(...)int INVALID_PI_CALL1;int INVALID_PI_CALL2;int INVALID_PI_CALL3;int INVALID_PI_CALL4;int SERVICE_CONTEXT_ADD_FAILED;int POLICY_FACTORY_REG_FAILED;int CREATE_POA_DESTROY;createPoaDestroy(...)int PRIORITY_REASSIGN;priorityReassign(...)int XA_START_OUTSIZE;xaStartOutsize(...)int XA_START_PROTO;xaStartProto(...)int BAD_SERVANT_MANAGER_TYPE;badServantManagerType(...)int OPERATION_UNKNOWN_TO_TARGET;operationUnknownToTarget(...)int UNABLE_REGISTER_VALUE_FACTORY;unableRegisterValueFactory(...)int RID_ALREADY_DEFINED;ridAlreadyDefined(...)int NAME_USED_IFR;nameUsedIfr(...)int TARGET_NOT_CONTAINER;targetNotContainer(...)int NAME_CLASH;nameClash(...)int NOT_SERIALIZABLE;notSerializable(...)int SO_BAD_SCHEME_NAME;soBadSchemeName(...)int SO_BAD_ADDRESS;soBadAddress(...)int SO_BAD_SCHEMA_SPECIFIC;soBadSchemaSpecific(...)int SO_NON_SPECIFIC;soNonSpecific(...)int IR_DERIVE_ABS_INT_BASE;irDeriveAbsIntBase(...)int IR_VALUE_SUPPORT;irValueSupport(...)int INCOMPLETE_TYPECODE;incompleteTypecode(...)int INVALID_OBJECT_ID;invalidObjectId(...)int TYPECODE_BAD_NAME;typecodeBadName(...)int TYPECODE_BAD_REPID;typecodeBadRepid(...)int TYPECODE_INV_MEMBER;typecodeInvMember(...)int TC_UNION_DUP_LABEL;tcUnionDupLabel(...)int TC_UNION_INCOMPATIBLE;tcUnionIncompatible(...)int TC_UNION_BAD_DISC;tcUnionBadDisc(...)int SET_EXCEPTION_BAD_ANY;setExceptionBadAny(...)int SET_EXCEPTION_UNLISTED;setExceptionUnlisted(...)int NO_CLIENT_WCHAR_CODESET_CTX;int ILLEGAL_SERVICE_CONTEXT;illegalServiceContext(...)int ENUM_OUT_OF_RANGE;enumOutOfRange(...)int INVALID_SERVICE_CONTEXT_ID;int RIR_WITH_NULL_OBJECT;int INVALID_COMPONENT_ID;int INVALID_PROFILE_ID;int POLICY_TYPE_DUPLICATE;policyTypeDuplicate(...)int BAD_ONEWAY_DEFINITION;badOnewayDefinition(...)int DII_FOR_IMPLICIT_OPERATION;diiForImplicitOperation(...)int XA_CALL_INVAL;xaCallInval(...)int UNION_BAD_DISCRIMINATOR;unionBadDiscriminator(...)int CTX_ILLEGAL_PROPERTY_NAME;ctxIllegalPropertyName(...)int CTX_ILLEGAL_SEARCH_STRING;ctxIllegalSearchString(...)int CTX_ILLEGAL_NAME;ctxIllegalName(...)int CTX_NON_EMPTY;ctxNonEmpty(...)int INVALID_STREAM_FORMAT_VERSION;int NOT_A_VALUEOUTPUTSTREAM;int NOT_A_VALUEINPUTSTREAM;int MARSHALL_INCOMPLETE_TYPECODE;// BAD_TYPECODEBAD_TYPECODE excnew BAD_TYPECODE(...)marshallIncompleteTypecode(...)int BAD_MEMBER_TYPECODE;badMemberTypecode(...)int ILLEGAL_PARAMETER;illegalParameter(...)int CHAR_NOT_IN_CODESET;// DATA_CONVERSIONDATA_CONVERSION excnew DATA_CONVERSION(...)int PRIORITY_MAP_FAILRE;priorityMapFailre(...)int NO_USABLE_PROFILE;// IMP_LIMITIMP_LIMIT excnew IMP_LIMIT(...)noUsableProfile(...)int PRIORITY_RANGE_RESTRICT;priorityRangeRestrict(...)int NO_SERVER_WCHAR_CODESET_CMP;int CODESET_COMPONENT_REQUIRED;codesetComponentRequired(...)int IOR_POLICY_RECONCILE_ERROR;// INV_POLICYINV_POLICY excnew INV_POLICY(...)iorPolicyReconcileError(...)int POLICY_UNKNOWN;policyUnknown(...)int NO_POLICY_FACTORY;noPolicyFactory(...)int XA_RMERR;xaRmerr(...)int XA_RMFAIL;xaRmfail(...)int NO_IR;// INTF_REPOSINTF_REPOS excnew INTF_REPOS(...)noIr(...)int NO_INTERFACE_IN_IR;noInterfaceInIr(...)int UNABLE_LOCATE_VALUE_FACTORY;// MARSHALMARSHAL excunableLocateValueFactory(...)int SET_RESULT_BEFORE_CTX;setResultBeforeCtx(...)int BAD_NVLIST;badNvlist(...)int NOT_AN_OBJECT_IMPL;notAnObjectImpl(...)int WCHAR_BAD_GIOP_VERSION_SENT;wcharBadGiopVersionSent(...)int WCHAR_BAD_GIOP_VERSION_RETURNED;wcharBadGiopVersionReturned(...)int UNSUPPORTED_FORMAT_VERSION;int RMIIIOP_OPTIONAL_DATA_INCOMPATIBLE1;int RMIIIOP_OPTIONAL_DATA_INCOMPATIBLE2;int RMIIIOP_OPTIONAL_DATA_INCOMPATIBLE3;int MISSING_LOCAL_VALUE_IMPL;int INCOMPATIBLE_VALUE_IMPL;int NO_USABLE_PROFILE_2;noUsableProfile2(...)int DII_LOCAL_OBJECT;diiLocalObject(...)int BIO_RESET;bioReset(...)int BIO_META_NOT_AVAILABLE;bioMetaNotAvailable(...)int BIO_GENOMIC_NO_ITERATOR;bioGenomicNoIterator(...)int PI_OPERATION_NOT_SUPPORTED1;// NO_RESOURCESNO_RESOURCES excnew NO_RESOURCES(...)int PI_OPERATION_NOT_SUPPORTED2;int PI_OPERATION_NOT_SUPPORTED3;int PI_OPERATION_NOT_SUPPORTED4;int PI_OPERATION_NOT_SUPPORTED5;int PI_OPERATION_NOT_SUPPORTED6;int PI_OPERATION_NOT_SUPPORTED7;int PI_OPERATION_NOT_SUPPORTED8;int NO_CONNECTION_PRIORITY;noConnectionPriority(...)int XA_RB;// TRANSACTION_ROLLEDBACKTRANSACTION_ROLLEDBACK excnew TRANSACTION_ROLLEDBACK(...)xaRb(...)int XA_NOTA;xaNota(...)int XA_END_TRUE_ROLLBACK_DEFERRED;xaEndTrueRollbackDeferred(...)int POA_REQUEST_DISCARD;// TRANSIENTTRANSIENT excnew TRANSIENT(...)poaRequestDiscard(...)int NO_USABLE_PROFILE_3;noUsableProfile3(...)int REQUEST_CANCELLED;requestCancelled(...)int POA_DESTROYED;int UNREGISTERED_VALUE_AS_OBJREF;unregisteredValueAsObjref(...)int NO_OBJECT_ADAPTOR;noObjectAdaptor(...)int BIO_NOT_AVAILABLE;bioNotAvailable(...)int OBJECT_ADAPTER_INACTIVE;objectAdapterInactive(...)int ADAPTER_ACTIVATOR_EXCEPTION;// OBJ_ADAPTEROBJ_ADAPTER excnew OBJ_ADAPTER(...)adapterActivatorException(...)int BAD_SERVANT_TYPE;badServantType(...)int NO_DEFAULT_SERVANT;noDefaultServant(...)int NO_SERVANT_MANAGER;noServantManager(...)int BAD_POLICY_INCARNATE;badPolicyIncarnate(...)int PI_EXC_COMP_ESTABLISHED;piExcCompEstablished(...)int NULL_SERVANT_RETURNED;nullServantReturned(...)int UNKNOWN_USER_EXCEPTION;int UNSUPPORTED_SYSTEM_EXCEPTION;unsupportedSystemException(...)int PI_UNKNOWN_USER_EXCEPTION;piUnknownUserException(...)// Log wrapper class for standard exceptions// Generated from input file /jenkins/workspace/8-2-build-macosx-x86_64/jdk8u251/737/corba/src/share/classes/com/sun/corba/se/spi/logging/data/OMG.mc on Thu Mar 12 02:38:10 PDT 2020ORBUtilSystemException$1new ORBUtilSystemException(...)ORBUtilSystemException.classint CONNECTING_SERVANT;connectingServant(...)int EXTRACT_WRONG_TYPE;int EXTRACT_WRONG_TYPE_LIST;int BAD_STRING_BOUNDS;int INSERT_OBJECT_INCOMPATIBLE;int INSERT_OBJECT_FAILED;int EXTRACT_OBJECT_INCOMPATIBLE;int FIXED_NOT_MATCH;int FIXED_BAD_TYPECODE;int SET_EXCEPTION_CALLED_NULL_ARGS;int SET_EXCEPTION_CALLED_BAD_TYPE;int CONTEXT_CALLED_OUT_OF_ORDER;int BAD_ORB_CONFIGURATOR;badOrbConfigurator(...)int ORB_CONFIGURATOR_ERROR;orbConfiguratorError(...)int ORB_DESTROYED;orbDestroyed(...)int NEGATIVE_BOUNDS;int EXTRACT_NOT_INITIALIZED;int EXTRACT_OBJECT_FAILED;int METHOD_NOT_FOUND_IN_TIE;methodNotFoundInTie(...)int CLASS_NOT_FOUND1;classNotFound1(...)int CLASS_NOT_FOUND2;classNotFound2(...)int CLASS_NOT_FOUND3;classNotFound3(...)int GET_DELEGATE_SERVANT_NOT_ACTIVE;getDelegateServantNotActive(...)int GET_DELEGATE_WRONG_POLICY;getDelegateWrongPolicy(...)int SET_DELEGATE_REQUIRES_STUB;setDelegateRequiresStub(...)int GET_DELEGATE_REQUIRES_STUB;getDelegateRequiresStub(...)int GET_TYPE_IDS_REQUIRES_STUB;getTypeIdsRequiresStub(...)int GET_ORB_REQUIRES_STUB;getOrbRequiresStub(...)int CONNECT_REQUIRES_STUB;connectRequiresStub(...)int IS_LOCAL_REQUIRES_STUB;isLocalRequiresStub(...)int REQUEST_REQUIRES_STUB;requestRequiresStub(...)int BAD_ACTIVATE_TIE_CALL;badActivateTieCall(...)int IO_EXCEPTION_ON_CLOSE;ioExceptionOnClose(...)int NULL_PARAM;int UNABLE_FIND_VALUE_FACTORY;unableFindValueFactory(...)int ABSTRACT_FROM_NON_ABSTRACT;abstractFromNonAbstract(...)int OBJREF_FROM_FOREIGN_ORB;objrefFromForeignOrb(...)int LOCAL_OBJECT_NOT_ALLOWED;localObjectNotAllowed(...)int NULL_OBJECT_REFERENCE;nullObjectReference(...)int COULD_NOT_LOAD_CLASS;couldNotLoadClass(...)int BAD_URL;badUrl(...)int FIELD_NOT_FOUND;fieldNotFound(...)int ERROR_SETTING_FIELD;errorSettingField(...)int BOUNDS_ERROR_IN_DII_REQUEST;int PERSISTENT_SERVER_INIT_ERROR;persistentServerInitError(...)int COULD_NOT_CREATE_ARRAY;couldNotCreateArray(...)int COULD_NOT_SET_ARRAY;couldNotSetArray(...)int ILLEGAL_BOOTSTRAP_OPERATION;illegalBootstrapOperation(...)int BOOTSTRAP_RUNTIME_EXCEPTION;bootstrapRuntimeException(...)int BOOTSTRAP_EXCEPTION;bootstrapException(...)int STRING_EXPECTED;stringExpected(...)int INVALID_TYPECODE_KIND;invalidTypecodeKind(...)int SOCKET_FACTORY_AND_CONTACT_INFO_LIST_AT_SAME_TIME;socketFactoryAndContactInfoListAtSameTime(...)int ACCEPTORS_AND_LEGACY_SOCKET_FACTORY_AT_SAME_TIME;acceptorsAndLegacySocketFactoryAtSameTime(...)int BAD_ORB_FOR_SERVANT;badOrbForServant(...)int INVALID_REQUEST_PARTITIONING_POLICY_VALUE;invalidRequestPartitioningPolicyValue(...)int INVALID_REQUEST_PARTITIONING_COMPONENT_VALUE;int INVALID_REQUEST_PARTITIONING_ID;invalidRequestPartitioningId(...)int ERROR_IN_SETTING_DYNAMIC_STUB_FACTORY_FACTORY;errorInSettingDynamicStubFactoryFactory(...)int DSIMETHOD_NOTCALLED;int ARGUMENTS_CALLED_MULTIPLE;int ARGUMENTS_CALLED_AFTER_EXCEPTION;int ARGUMENTS_CALLED_NULL_ARGS;int ARGUMENTS_NOT_CALLED;int SET_RESULT_CALLED_MULTIPLE;int SET_RESULT_AFTER_EXCEPTION;int SET_RESULT_CALLED_NULL_ARGS;int BAD_REMOTE_TYPECODE;int UNRESOLVED_RECURSIVE_TYPECODE;int CONNECT_FAILURE;int CONNECTION_CLOSE_REBIND;connectionCloseRebind(...)int WRITE_ERROR_SEND;writeErrorSend(...)int GET_PROPERTIES_ERROR;getPropertiesError(...)int BOOTSTRAP_SERVER_NOT_AVAIL;bootstrapServerNotAvail(...)int INVOKE_ERROR;invokeError(...)int DEFAULT_CREATE_SERVER_SOCKET_GIVEN_NON_IIOP_CLEAR_TEXT;int CONNECTION_ABORT;connectionAbort(...)int CONNECTION_REBIND;connectionRebind(...)int RECV_MSG_ERROR;recvMsgError(...)int IOEXCEPTION_WHEN_READING_CONNECTION;ioexceptionWhenReadingConnection(...)int SELECTION_KEY_INVALID;selectionKeyInvalid(...)int EXCEPTION_IN_ACCEPT;exceptionInAccept(...)int SECURITY_EXCEPTION_IN_ACCEPT;securityExceptionInAccept(...)int TRANSPORT_READ_TIMEOUT_EXCEEDED;transportReadTimeoutExceeded(...)int CREATE_LISTENER_FAILED;Level.SEVEREint BUFFER_READ_MANAGER_TIMEOUT;int BAD_STRINGIFIED_IOR_LEN;badStringifiedIorLen(...)int BAD_STRINGIFIED_IOR;badStringifiedIor(...)int BAD_MODIFIER;badModifier(...)int CODESET_INCOMPATIBLE;codesetIncompatible(...)int BAD_HEX_DIGIT;badHexDigit(...)int BAD_UNICODE_PAIR;int BTC_RESULT_MORE_THAN_ONE_CHAR;int BAD_CODESETS_FROM_CLIENT;badCodesetsFromClient(...)int INVALID_SINGLE_CHAR_CTB;int BAD_GIOP_1_1_CTB;int BAD_SEQUENCE_BOUNDS;int ILLEGAL_SOCKET_FACTORY_TYPE;illegalSocketFactoryType(...)int BAD_CUSTOM_SOCKET_FACTORY;badCustomSocketFactory(...)int FRAGMENT_SIZE_MINIMUM;fragmentSizeMinimum(...)int FRAGMENT_SIZE_DIV;fragmentSizeDiv(...)int ORB_INITIALIZER_FAILURE;orbInitializerFailure(...)int ORB_INITIALIZER_TYPE;orbInitializerType(...)int ORB_INITIALREFERENCE_SYNTAX;orbInitialreferenceSyntax(...)int ACCEPTOR_INSTANTIATION_FAILURE;acceptorInstantiationFailure(...)int ACCEPTOR_INSTANTIATION_TYPE_FAILURE;acceptorInstantiationTypeFailure(...)int ILLEGAL_CONTACT_INFO_LIST_FACTORY_TYPE;illegalContactInfoListFactoryType(...)int BAD_CONTACT_INFO_LIST_FACTORY;badContactInfoListFactory(...)int ILLEGAL_IOR_TO_SOCKET_INFO_TYPE;illegalIorToSocketInfoType(...)int BAD_CUSTOM_IOR_TO_SOCKET_INFO;badCustomIorToSocketInfo(...)int ILLEGAL_IIOP_PRIMARY_TO_CONTACT_INFO_TYPE;illegalIiopPrimaryToContactInfoType(...)int BAD_CUSTOM_IIOP_PRIMARY_TO_CONTACT_INFO;badCustomIiopPrimaryToContactInfo(...)int BAD_CORBALOC_STRING;badCorbalocString(...)int NO_PROFILE_PRESENT;noProfilePresent(...)int CANNOT_CREATE_ORBID_DB;cannotCreateOrbidDb(...)int CANNOT_READ_ORBID_DB;cannotReadOrbidDb(...)int CANNOT_WRITE_ORBID_DB;cannotWriteOrbidDb(...)int GET_SERVER_PORT_CALLED_BEFORE_ENDPOINTS_INITIALIZED;int PERSISTENT_SERVERPORT_NOT_SET;int PERSISTENT_SERVERID_NOT_SET;persistentServeridNotSet(...)int NON_EXISTENT_ORBID;nonExistentOrbid(...)int NO_SERVER_SUBCONTRACT;noServerSubcontract(...)int SERVER_SC_TEMP_SIZE;serverScTempSize(...)int NO_CLIENT_SC_CLASS;noClientScClass(...)int SERVER_SC_NO_IIOP_PROFILE;serverScNoIiopProfile(...)int GET_SYSTEM_EX_RETURNED_NULL;getSystemExReturnedNull(...)int PEEKSTRING_FAILED;peekstringFailed(...)int GET_LOCAL_HOST_FAILED;getLocalHostFailed(...)int BAD_LOCATE_REQUEST_STATUS;badLocateRequestStatus(...)int BAD_GIOP_REQUEST_TYPE;badGiopRequestType(...)int ERROR_UNMARSHALING_USEREXC;errorUnmarshalingUserexc(...)int RequestDispatcherRegistry_ERROR;requestdispatcherregistryError(...)int LOCATIONFORWARD_ERROR;locationforwardError(...)int WRONG_CLIENTSC;wrongClientsc(...)int BAD_SERVANT_READ_OBJECT;int MULT_IIOP_PROF_NOT_SUPPORTED;multIiopProfNotSupported(...)int GIOP_MAGIC_ERROR;giopMagicError(...)int GIOP_VERSION_ERROR;int ILLEGAL_REPLY_STATUS;illegalReplyStatus(...)int ILLEGAL_GIOP_MSG_TYPE;illegalGiopMsgType(...)int FRAGMENTATION_DISALLOWED;fragmentationDisallowed(...)int BAD_REPLYSTATUS;badReplystatus(...)int CTB_CONVERTER_FAILURE;int BTC_CONVERTER_FAILURE;int WCHAR_ARRAY_UNSUPPORTED_ENCODING;wcharArrayUnsupportedEncoding(...)int ILLEGAL_TARGET_ADDRESS_DISPOSITION;illegalTargetAddressDisposition(...)int NULL_REPLY_IN_GET_ADDR_DISPOSITION;nullReplyInGetAddrDisposition(...)int ORB_TARGET_ADDR_PREFERENCE_IN_EXTRACT_OBJECTKEY_INVALID;orbTargetAddrPreferenceInExtractObjectkeyInvalid(...)int INVALID_ISSTREAMED_TCKIND;int SVCCTX_UNMARSHAL_ERROR;svcctxUnmarshalError(...)int NULL_IOR;nullIor(...)int UNSUPPORTED_GIOP_VERSION;int APPLICATION_EXCEPTION_IN_SPECIAL_METHOD;applicationExceptionInSpecialMethod(...)int STATEMENT_NOT_REACHABLE1;statementNotReachable1(...)int STATEMENT_NOT_REACHABLE2;statementNotReachable2(...)int STATEMENT_NOT_REACHABLE3;statementNotReachable3(...)int STATEMENT_NOT_REACHABLE4;statementNotReachable4(...)int STATEMENT_NOT_REACHABLE5;statementNotReachable5(...)int STATEMENT_NOT_REACHABLE6;statementNotReachable6(...)int UNEXPECTED_DII_EXCEPTION;unexpectedDiiException(...)int METHOD_SHOULD_NOT_BE_CALLED;methodShouldNotBeCalled(...)int CANCEL_NOT_SUPPORTED;cancelNotSupported(...)int EMPTY_STACK_RUN_SERVANT_POST_INVOKE;emptyStackRunServantPostInvoke(...)int PROBLEM_WITH_EXCEPTION_TYPECODE;problemWithExceptionTypecode(...)int ILLEGAL_SUBCONTRACT_ID;illegalSubcontractId(...)int BAD_SYSTEM_EXCEPTION_IN_LOCATE_REPLY;badSystemExceptionInLocateReply(...)int BAD_SYSTEM_EXCEPTION_IN_REPLY;badSystemExceptionInReply(...)int BAD_COMPLETION_STATUS_IN_LOCATE_REPLY;badCompletionStatusInLocateReply(...)int BAD_COMPLETION_STATUS_IN_REPLY;badCompletionStatusInReply(...)int BADKIND_CANNOT_OCCUR;int ERROR_RESOLVING_ALIAS;int TK_LONG_DOUBLE_NOT_SUPPORTED;int TYPECODE_NOT_SUPPORTED;int BOUNDS_CANNOT_OCCUR;int NUM_INVOCATIONS_ALREADY_ZERO;numInvocationsAlreadyZero(...)int ERROR_INIT_BADSERVERIDHANDLER;errorInitBadserveridhandler(...)int NO_TOA;noToa(...)int NO_POA;noPoa(...)int INVOCATION_INFO_STACK_EMPTY;invocationInfoStackEmpty(...)int BAD_CODE_SET_STRING;int UNKNOWN_NATIVE_CODESET;int UNKNOWN_CONVERSION_CODE_SET;int INVALID_CODE_SET_NUMBER;int INVALID_CODE_SET_STRING;int INVALID_CTB_CONVERTER_NAME;int INVALID_BTC_CONVERTER_NAME;int COULD_NOT_DUPLICATE_CDR_INPUT_STREAM;int BOOTSTRAP_APPLICATION_EXCEPTION;bootstrapApplicationException(...)int DUPLICATE_INDIRECTION_OFFSET;duplicateIndirectionOffset(...)int BAD_MESSAGE_TYPE_FOR_CANCEL;badMessageTypeForCancel(...)int DUPLICATE_EXCEPTION_DETAIL_MESSAGE;duplicateExceptionDetailMessage(...)int BAD_EXCEPTION_DETAIL_MESSAGE_SERVICE_CONTEXT_TYPE;badExceptionDetailMessageServiceContextType(...)int UNEXPECTED_DIRECT_BYTE_BUFFER_WITH_NON_CHANNEL_SOCKET;unexpectedDirectByteBufferWithNonChannelSocket(...)int UNEXPECTED_NON_DIRECT_BYTE_BUFFER_WITH_CHANNEL_SOCKET;unexpectedNonDirectByteBufferWithChannelSocket(...)int INVALID_CONTACT_INFO_LIST_ITERATOR_FAILURE_EXCEPTION;invalidContactInfoListIteratorFailureException(...)int REMARSHAL_WITH_NOWHERE_TO_GO;remarshalWithNowhereToGo(...)int EXCEPTION_WHEN_SENDING_CLOSE_CONNECTION;exceptionWhenSendingCloseConnection(...)int INVOCATION_ERROR_IN_REFLECTIVE_TIE;invocationErrorInReflectiveTie(...)int BAD_HELPER_WRITE_METHOD;badHelperWriteMethod(...)int BAD_HELPER_READ_METHOD;badHelperReadMethod(...)int BAD_HELPER_ID_METHOD;badHelperIdMethod(...)int WRITE_UNDECLARED_EXCEPTION;writeUndeclaredException(...)int READ_UNDECLARED_EXCEPTION;readUndeclaredException(...)int UNABLE_TO_SET_SOCKET_FACTORY_ORB;unableToSetSocketFactoryOrb(...)int UNEXPECTED_EXCEPTION;unexpectedException(...)int NO_INVOCATION_HANDLER;noInvocationHandler(...)int INVALID_BUFF_MGR_STRATEGY;int JAVA_STREAM_INIT_FAILED;int DUPLICATE_ORB_VERSION_SERVICE_CONTEXT;duplicateOrbVersionServiceContext(...)int DUPLICATE_SENDING_CONTEXT_SERVICE_CONTEXT;duplicateSendingContextServiceContext(...)int WORK_QUEUE_THREAD_INTERRUPTED;workQueueThreadInterrupted(...)int WORKER_THREAD_CREATED;workerThreadCreated(...)int WORKER_THREAD_THROWABLE_FROM_REQUEST_WORK;workerThreadThrowableFromRequestWork(...)int WORKER_THREAD_NOT_NEEDED;workerThreadNotNeeded(...)int WORKER_THREAD_DO_WORK_THROWABLE;workerThreadDoWorkThrowable(...)int WORKER_THREAD_CAUGHT_UNEXPECTED_THROWABLE;workerThreadCaughtUnexpectedThrowable(...)int WORKER_THREAD_CREATION_FAILURE;workerThreadCreationFailure(...)int WORKER_THREAD_SET_NAME_FAILURE;workerThreadSetNameFailure(...)int WORK_QUEUE_REQUEST_WORK_NO_WORK_FOUND;workQueueRequestWorkNoWorkFound(...)int THREAD_POOL_CLOSE_ERROR;threadPoolCloseError(...)int THREAD_GROUP_IS_DESTROYED;threadGroupIsDestroyed(...)int THREAD_GROUP_HAS_ACTIVE_THREADS_IN_CLOSE;threadGroupHasActiveThreadsInClose(...)int THREAD_GROUP_HAS_SUB_GROUPS_IN_CLOSE;threadGroupHasSubGroupsInClose(...)int THREAD_GROUP_DESTROY_FAILED;threadGroupDestroyFailed(...)int INTERRUPTED_JOIN_CALL_WHILE_CLOSING_THREAD_POOL;interruptedJoinCallWhileClosingThreadPool(...)int CHUNK_OVERFLOW;int UNEXPECTED_EOF;int READ_OBJECT_EXCEPTION;int CHARACTER_OUTOFRANGE;characterOutofrange(...)int DSI_RESULT_EXCEPTION;int IIOPINPUTSTREAM_GROW;iiopinputstreamGrow(...)int END_OF_STREAM;int INVALID_OBJECT_KEY;invalidObjectKey(...)int MALFORMED_URL;int VALUEHANDLER_READ_ERROR;int VALUEHANDLER_READ_EXCEPTION;int BAD_KIND;int CNFE_READ_CLASS;int BAD_REP_ID_INDIRECTION;int BAD_CODEBASE_INDIRECTION;int UNKNOWN_CODESET;int WCHAR_DATA_IN_GIOP_1_0;int NEGATIVE_STRING_LENGTH;int EXPECTED_TYPE_NULL_AND_NO_REP_ID;int READ_VALUE_AND_NO_REP_ID;readValueAndNoRepId(...)int UNEXPECTED_ENCLOSING_VALUETYPE;int POSITIVE_END_TAG;int NULL_OUT_CALL;nullOutCall(...)int WRITE_LOCAL_OBJECT;int BAD_INSERTOBJ_PARAM;int CUSTOM_WRAPPER_WITH_CODEBASE;int CUSTOM_WRAPPER_INDIRECTION;int CUSTOM_WRAPPER_NOT_SINGLE_REPID;int BAD_VALUE_TAG;int BAD_TYPECODE_FOR_CUSTOM_VALUE;int ERROR_INVOKING_HELPER_WRITE;int BAD_DIGIT_IN_FIXED;int REF_TYPE_INDIR_TYPE;int BAD_RESERVED_LENGTH;badReservedLength(...)int NULL_NOT_ALLOWED;nullNotAllowed(...)int UNION_DISCRIMINATOR_ERROR;int CANNOT_MARSHAL_NATIVE;int CANNOT_MARSHAL_BAD_TCKIND;int INVALID_INDIRECTION;int INDIRECTION_NOT_FOUND;int RECURSIVE_TYPECODE_ERROR;int INVALID_SIMPLE_TYPECODE;int INVALID_COMPLEX_TYPECODE;int INVALID_TYPECODE_KIND_MARSHAL;int UNEXPECTED_UNION_DEFAULT;unexpectedUnionDefault(...)int ILLEGAL_UNION_DISCRIMINATOR_TYPE;int COULD_NOT_SKIP_BYTES;int BAD_CHUNK_LENGTH;int UNABLE_TO_LOCATE_REP_ID_ARRAY;int BAD_FIXED;int READ_OBJECT_LOAD_CLASS_FAILURE;readObjectLoadClassFailure(...)int COULD_NOT_INSTANTIATE_HELPER;int BAD_TOA_OAID;badToaOaid(...)int COULD_NOT_INVOKE_HELPER_READ_METHOD;int COULD_NOT_FIND_CLASS;int BAD_ARGUMENTS_NVLIST;int STUB_CREATE_ERROR;int JAVA_SERIALIZATION_EXCEPTION;int GENERIC_NO_IMPL;genericNoImpl(...)int CONTEXT_NOT_IMPLEMENTED;int GETINTERFACE_NOT_IMPLEMENTED;getinterfaceNotImplemented(...)int SEND_DEFERRED_NOTIMPLEMENTED;sendDeferredNotimplemented(...)int LONG_DOUBLE_NOT_IMPLEMENTED;int NO_SERVER_SC_IN_DISPATCH;noServerScInDispatch(...)int ORB_CONNECT_ERROR;orbConnectError(...)int ADAPTER_INACTIVE_IN_ACTIVATION;adapterInactiveInActivation(...)int LOCATE_UNKNOWN_OBJECT;locateUnknownObject(...)int BAD_SERVER_ID;badServerId(...)int BAD_SKELETON;badSkeleton(...)int SERVANT_NOT_FOUND;servantNotFound(...)int NO_OBJECT_ADAPTER_FACTORY;noObjectAdapterFactory(...)int BAD_ADAPTER_ID;badAdapterId(...)int DYN_ANY_DESTROYED;int REQUEST_CANCELED;requestCanceled(...)int UNKNOWN_CORBA_EXC;unknownCorbaExc(...)int RUNTIMEEXCEPTION;runtimeexception(...)int UNKNOWN_SERVER_ERROR;unknownServerError(...)int UNKNOWN_DSI_SYSEX;unknownDsiSysex(...)int UNKNOWN_SYSEX;unknownSysex(...)int WRONG_INTERFACE_DEF;wrongInterfaceDef(...)int NO_INTERFACE_DEF_STUB;noInterfaceDefStub(...)int UNKNOWN_EXCEPTION_IN_DISPATCH;unknownExceptionInDispatch(...)// Log wrapper class for Sun private system exceptions in group ORBUTIL// Generated from input file /jenkins/workspace/8-2-build-macosx-x86_64/jdk8u251/737/corba/src/share/classes/com/sun/corba/se/spi/logging/data/ORBUtil.mc on Thu Mar 12 02:38:10 PDT 2020POASystemException$1new POASystemException(...)POASystemException wrapperint SERVANT_MANAGER_ALREADY_SET;POASystemException.classservantManagerAlreadySet(...)int DESTROY_DEADLOCK;destroyDeadlock(...)int SERVANT_ORB;servantOrb(...)int BAD_SERVANT;badServant(...)int ILLEGAL_FORWARD_REQUEST;illegalForwardRequest(...)int BAD_TRANSACTION_CONTEXT;badTransactionContext(...)int BAD_REPOSITORY_ID;badRepositoryId(...)int INVOKESETUP;invokesetup(...)int BAD_LOCALREPLYSTATUS;badLocalreplystatus(...)int PERSISTENT_SERVERPORT_ERROR;persistentServerportError(...)int SERVANT_DISPATCH;servantDispatch(...)int CANT_CLONE_TEMPLATE;cantCloneTemplate(...)int POACURRENT_UNBALANCED_STACK;poacurrentUnbalancedStack(...)int POACURRENT_NULL_FIELD;poacurrentNullField(...)int POA_INTERNAL_GET_SERVANT_ERROR;poaInternalGetServantError(...)int MAKE_FACTORY_NOT_POA;makeFactoryNotPoa(...)int DUPLICATE_ORB_VERSION_SC;duplicateOrbVersionSc(...)int PREINVOKE_CLONE_ERROR;preinvokeCloneError(...)int PREINVOKE_POA_DESTROYED;preinvokePoaDestroyed(...)int PMF_CREATE_RETAIN;pmfCreateRetain(...)int PMF_CREATE_NON_RETAIN;pmfCreateNonRetain(...)int POLICY_MEDIATOR_BAD_POLICY_IN_FACTORY;policyMediatorBadPolicyInFactory(...)int SERVANT_TO_ID_OAA;servantToIdOaa(...)int SERVANT_TO_ID_SAA;servantToIdSaa(...)int SERVANT_TO_ID_WP;servantToIdWp(...)int CANT_RESOLVE_ROOT_POA;cantResolveRootPoa(...)int SERVANT_MUST_BE_LOCAL;servantMustBeLocal(...)int NO_PROFILES_IN_IOR;noProfilesInIor(...)int AOM_ENTRY_DEC_ZERO;aomEntryDecZero(...)int ADD_POA_INACTIVE;addPoaInactive(...)int ILLEGAL_POA_STATE_TRANS;illegalPoaStateTrans(...)int SINGLE_THREAD_NOT_SUPPORTED;singleThreadNotSupported(...)int METHOD_NOT_IMPLEMENTED;methodNotImplemented(...)int POA_LOOKUP_ERROR;poaLookupError(...)int POA_INACTIVE;poaInactive(...)int POA_NO_SERVANT_MANAGER;poaNoServantManager(...)int POA_NO_DEFAULT_SERVANT;poaNoDefaultServant(...)int POA_SERVANT_NOT_UNIQUE;poaServantNotUnique(...)int POA_WRONG_POLICY;poaWrongPolicy(...)int FINDPOA_ERROR;findpoaError(...)int POA_SERVANT_ACTIVATOR_LOOKUP_FAILED;poaServantActivatorLookupFailed(...)int POA_BAD_SERVANT_MANAGER;poaBadServantManager(...)int POA_SERVANT_LOCATOR_LOOKUP_FAILED;poaServantLocatorLookupFailed(...)int POA_UNKNOWN_POLICY;poaUnknownPolicy(...)int POA_NOT_FOUND;poaNotFound(...)int SERVANT_LOOKUP;servantLookup(...)int LOCAL_SERVANT_LOOKUP;localServantLookup(...)int SERVANT_MANAGER_BAD_TYPE;servantManagerBadType(...)int DEFAULT_POA_NOT_POAIMPL;defaultPoaNotPoaimpl(...)int WRONG_POLICIES_FOR_THIS_OBJECT;wrongPoliciesForThisObject(...)int THIS_OBJECT_SERVANT_NOT_ACTIVE;thisObjectServantNotActive(...)int THIS_OBJECT_WRONG_POLICY;thisObjectWrongPolicy(...)int NO_CONTEXT;noContext(...)int INCARNATE_RETURNED_NULL;incarnateReturnedNull(...)int JTS_INIT_ERROR;jtsInitError(...)int ORBD_ERROR;orbdError(...)int BOOTSTRAP_ERROR;bootstrapError(...)int POA_DISCARDING;poaDiscarding(...)int OTSHOOKEXCEPTION;otshookexception(...)int UNKNOWN_SERVER_EXCEPTION;unknownServerException(...)int UNKNOWN_SERVERAPP_EXCEPTION;unknownServerappException(...)int UNKNOWN_LOCALINVOCATION_ERROR;unknownLocalinvocationError(...)int ADAPTER_ACTIVATOR_NONEXISTENT;adapterActivatorNonexistent(...)int ADAPTER_ACTIVATOR_FAILED;adapterActivatorFailed(...)int NULL_SERVANT;nullServant(...)int ADAPTER_DESTROYED;adapterDestroyed(...)// Log wrapper class for Sun private system exceptions in group POA// Generated from input file /jenkins/workspace/8-2-build-macosx-x86_64/jdk8u251/737/corba/src/share/classes/com/sun/corba/se/spi/logging/data/POA.mc on Thu Mar 12 02:38:10 PDT 2020UtilSystemException$1new UtilSystemException(...)UtilSystemException wrapperint STUB_FACTORY_COULD_NOT_MAKE_STUB;UtilSystemException.classstubFactoryCouldNotMakeStub(...)int ERROR_IN_MAKE_STUB_FROM_REPOSITORY_ID;errorInMakeStubFromRepositoryId(...)int CLASS_CAST_EXCEPTION_IN_LOAD_STUB;classCastExceptionInLoadStub(...)int EXCEPTION_IN_LOAD_STUB;exceptionInLoadStub(...)int CONNECT_WRONG_ORB;connectWrongOrb(...)int CONNECT_NO_TIE;connectNoTie(...)int CONNECT_TIE_WRONG_ORB;connectTieWrongOrb(...)int CONNECT_TIE_NO_SERVANT;connectTieNoServant(...)int LOAD_TIE_FAILED;loadTieFailed(...)int UNABLE_LOCATE_VALUE_HELPER;unableLocateValueHelper(...)int OBJECT_NOT_CONNECTED;objectNotConnected(...)int COULD_NOT_LOAD_STUB;couldNotLoadStub(...)int OBJECT_NOT_EXPORTED;objectNotExported(...)int ERROR_SET_OBJECT_FIELD;int ERROR_SET_BOOLEAN_FIELD;int ERROR_SET_BYTE_FIELD;int ERROR_SET_CHAR_FIELD;int ERROR_SET_SHORT_FIELD;int ERROR_SET_INT_FIELD;int ERROR_SET_LONG_FIELD;int ERROR_SET_FLOAT_FIELD;int ERROR_SET_DOUBLE_FIELD;int ILLEGAL_FIELD_ACCESS;int BAD_BEGIN_UNMARSHAL_CUSTOM_VALUE;int CLASS_NOT_FOUND;// Log wrapper class for Sun private system exceptions in group UTIL// Generated from input file /jenkins/workspace/8-2-build-macosx-x86_64/jdk8u251/737/corba/src/share/classes/com/sun/corba/se/spi/logging/data/Util.mc on Thu Mar 12 02:38:10 PDT 2020import MonitoredAttributeInfoFactoryimport MonitoredAttributeInfonew MonitoredAttributeInfoImpl(...)String description;Class<> type;boolean writableFlag, ...;this.descriptionthis.writableFlagthis.statisticFlagimport MonitoredObjectFactoryimport MonitoredObjectnew MonitoredObjectImpl(...)import MonitoredAttributeMap<> children;// List of all child Monitored ObjectsMap<> monitoredAttributes;// All the Attributes of this Monitored Object instanceMonitoredObject parent;// Constructor/** calls clearState() on all the registered children MonitoredObjects and ... */clearState(...)// First call clearState on all the local attributes// next call clearState on all the children MonitoredObjectsimport MonitoringManagerFactoryimport MonitoringManagerHashMap<> monitoringManagerTable;MonitoringManagerImpl mnew MonitoringManagerImpl(...)import MonitoringFactoriesMonitoredObject rootMonitoredObject;MonitoredObjectFactory fgetMonitoredObjectFactory(...)createMonitoredObject(...)MonitoringManagerFactory fgetMonitoringManagerFactory(...)import Bindingimport BindingTypeimport BindingHolderimport BindingListHolderimport BindingIteratorHolderimport BindingIteratorPOA/** Class BindingIteratorImpl implements the org.omg.CosNaming::BindingIterator ... *//** Create a binding iterator servant. ... *//** Return the next binding. It also returns true or false, indicating ... */NextOne(...)/** Return the next n bindings. It also returns true or false, indicating ... */list(...)/** lists next n bindings. It returns true or false, indicating ... */int numberToGetRemainingElements(...)Binding[] blnew Binding[]BindingHolder bhnew BindingHolder(...)bh.valueblh.value/** Destroy this BindingIterator object. The object corresponding to this ... */Destroy(...)/** Abstract method for returning the next binding in the NamingContext ... *//** Abstract method for destroying this BindingIterator. ... *//** Abstract method for returning the remaining number of elements. ... */// Import general CORBA classes// Import org.omg.CosNaming classes// NextOne actually returns the next one// Take the smallest of what's left and what's being asked for// Create a resulting BindingList// Keep iterating as long as there are entries// Found any at all?// No// Set into holder// Destroy actually destroysimport org.omg.CosNaming.NamingContextExtPackage.*import NameComponent/** Class InteroperableNamingImpl implements the methods defined ... *//** Method which stringifies the Name Components given as the input ... */String theConvertedStringconvertNameComponentToString(...)String temptheNameComponents.length/** This method converts a single Namecomponent to String, By adding Escapes ... */theNameComponent.idtheNameComponent.kindString kindaddEscape(...)/** This method adds escape '\' for the Namecomponent if neccessary */StringBuffer theNewValuechar c/** Method which converts the Stringified name into Array of Name Components. ... */String[] theStringifiedNameComponentsbreakStringToNameComponents(...)NameComponent[] theNameComponentsnew NameComponent[]theStringifiedNameComponents.lengthcreateNameComponentFromString(...)/** Step1 in converting Stringified name into  array of Name Component ... */int[] theIndicesint theIndicesIndexString[] tempStringStringComponentsFromIndices(...)/** This method breaks one big String into multiple substrings based ... */String[] theStringComponentsint firstIndexint lastIndextheIndices.length/** Step 2: After Breaking the Stringified name into set of NameComponent ... */endsWith(...)boolean kindfoundcleanEscapeCharacter(...)new NameComponent(...)/** This method cleans the escapes in the Stringified name and returns the ... */StringBuffer srcStringBuffer destchar disLetterOrDigit(...)/** Method which converts the Stringified name  and Host Name Address into ... */String theurlnew InvalidAddress(...)/** Encodes the string according to RFC 2396 IETF spec required by INS. */StringWriter theStringAfterEscapeint byteCountString hexString// Import org.omg.CosNaming types// Adding escape for the "."// This is the end of all the occurence of '/' and hence come// out of the loop// If the '/' is found, first check whether it is// preceded by escape '\'// If not then set theIndices and increment theIndicesIndex// and also set the index else just ignore the '/'// This is done for the last component// If any of the above is true, then we create an invalid Name// Component to indicate that it is an invalid name.// The format could be XYZ (Without kind)// The format is .XYZ (Without ID)// This check is for the Namecomponent which is just "." meaning Id// and Kinds are null// No more '.', which means there is no Kind// If there is a AlphaNumeric character after a \// then include slash, as it is not intended as an// escape character.// Do no Escape for characters in this list// RFC 2396// Add escape/** Class InternalBindingKey implements the necessary wrapper code ... */NameComponent name;// A key contains a nameint idLen;int kindLen;int hashVal;// Default Constructor// Normal constructorsetup(...)// Setup the objectthis.name.idthis.name.kind// Compare the keys by comparing name's id and kindInternalBindingKey thatthis.idLenthat.idLenthis.kindLenthat.kindLenthat.name.idthat.namethat.name.kind// Return precomputed valuethis.hashVal// Precompute lengths and values since they will not change// Both lengths must match// If id is set is must be equal// If kind is set it must be equal// Must be the same/** Class InternalBindingKey acts as a container for two objects, namely ... */Binding theBinding;String strObjectRef;Object theObjectRef;// Default constructorimport BindingTypeHolder/** This interface defines a set of methods that must be implemented by the ... *//** Method which implements binding a name to an object as ... *//** Method which implements resolving the specified name, ... *//** Method which implements unbinding a name. ... *//** Method which implements listing the contents of this ... *//** Method which implements creating a new NamingContext. ... *//** Method which implements destroying this NamingContext. ... *//** Method which returns whether this NamingContext is empty ... */import LogKeywordsimport NamingContextHelperimport org.omg.CosNaming.NamingContextPackage.*import _NamingContextImplBaseimport NamingContextExtHelperimport NamingContextExtimport NamingContextExtPOAimport NotFoundimport NamingContextDataStoreimport INSURLHandlerimport NamingSystemException/** Class NamingContextImpl implements the org.omg.CosNaming::NamingContext ... */CORBALogDomains.NAMING_UPDATEPOA nsPOA;Logger readLogger, ...;NamingSystemException wrapper;NamingSystemException staticWrapper;InterOperableNamingImpl insImpl;// are implemented in this class// The grammer for Parsing and Building Interoperable Stringified Names/** Create a naming context servant. ... */new InterOperableNamingImpl(...)this.nsPOAgetLogger(...)CORBALogDomains.NAMING_READCORBALogDomains.NAMING_LIFECYCLE/** Bind an object under a name in this NamingContext. If the name ... */NamingContextDataStore implwarning(...)LogKeywords.NAMING_BINDdoBind(...)BindingType.nobjectfine(...)getDirectoryStructuredName(...)LogKeywords.NAMING_BIND_SUCCESS/** Bind a NamingContext under a name in this NamingContext. If the name ... */LogKeywords.NAMING_BIND_FAILUREBindingType.ncontextLogKeywords.NAMING_REBIND_FAILUREAlreadyBound exLogKeywords.NAMING_REBIND_SUCCESS/** Resolve a name in this NamingContext and return the object reference ... */doResolve(...)LogKeywords.NAMING_RESOLVE_SUCCESSLogKeywords.NAMING_RESOLVE_FAILURE/** Remove a binding from this NamingContext. If the name contains ... */doUnbind(...)LogKeywords.NAMING_UNBIND_SUCCESS/** List the contents of this NamingContest. A sequence of bindings ... */List(...)bl.valuebi.valuebl.value.lengthLogKeywords.NAMING_LIST_SUCCESS/** Create a NamingContext object and return its object reference. ... */NamingContext nctxNewContext(...)LogKeywords.LIFECYCLE_CREATE_SUCCESSsevere(...)LogKeywords.LIFECYCLE_CREATE_FAILURE/** Create a new NamingContext, bind it in this Naming Context and return ... */NamingContext ncNamingContext rncnameToString(...)new_context(...)bind_context(...)NotEmpty e/** Destroy this NamingContext object. If this NamingContext contains ... */IsEmpty(...)LogKeywords.LIFECYCLE_DESTROY_SUCCESSLogKeywords.LIFECYCLE_DESTROY_FAILUREnew NotEmpty(...)/** Implements all four flavors of binding. It uses Resolve() to ... */n.length...[...].kindBindingTypeHolder bthnew BindingTypeHolder(...)Resolve(...)bth.valuenew NotFound(...)NotFoundReason.not_contextNotFoundReason.not_objectUnbind(...)new AlreadyBound(...)Bind(...)NamingContext contextresolveFirstAsContext(...)NameComponent[] tailBindingType._nobjectrebind(...)BindingType._ncontextNamingContext objContextrebind_context(...)/** Implements resolving names in this NamingContext. The first component ... */NotFoundReason.missing_nodeServant servantreference_to_servant(...)getNSPOA(...)resolve(...)/** Implements unbinding bound names in this NamingContext. If the ... */unbind(...)/** Implements resolving a NameComponent in this context and ... */Object topRefBAD_PARAM ex/** This operation creates a stringified name from the array of Name ... */String theStringifiedNameconvertToString(...)/** This operation  converts a Stringified Name into an  equivalent array ... */convertToNameComponent(...)/** This operation creates a URL based "iiopname://" format name ... */String urlBasedAddresscreateURLBasedAddress(...)parseURL(...)getINSURLHandler(...)BAD_PARAM e/** This operation resolves the Stringified name into the object ... */StringBuffer sname.length// Debugging aids.currentTimeMillis(...)// Imports for Logging// doBind implements all four flavors of binding// isLoggable call to make sure that we save some precious// processor cycles, if there is no need to log.// This should not happen// doResolve actually resolves// doUnbind actually unbinds// List actually generates the list// Create actually creates a new naming context// If naming context is null, then that must be a serious// error.// The obvious solution:// The context is empty so it can be destroyed// This context is not empty!// Not a fatal error, warning should do.// Valid name?// At bottom level?// The identifier must be set// Ensure synchronization of backend// Yes: bind object in this context under the name// Refer Naming Service Doc:00-11-01 section 2.2.3.4// If there is an object already bound with the name// and the binding type is not ncontext a NotFound// Exception with a reason of not a context has to be// raised.// Fix for bug Id: 4384628// Previously a Context was bound and now trying to// bind Object. It is invalid.// "Resistence is futile." [Borg pickup line]// Now there are no other bindings under this name// No: bind in a different context// Compute tail// How should we propagate the bind// Bind as object// Narrow to a naming context using Java casts. It must// work.// Bind as context// Length must be greater than 0// Resolve first level in this context// Object was not found// n.length > 1// Compute restOfName = name[1..length]// Resolve rest of name in context// First try to resolve using the local call, this should work// most of the time unless there are federated naming contexts.// Name valid?// Unbind here?// Yes: unbind in this context// It was not bound// Done// No: unbind in a different context// Resolve first  - must be resolveable// Propagate unbind to this context// Was it bound as a context?// It was not a context// Narrow to a naming context// Hmm. must be ok// If there is a name component whose id and kind null or// zero length string, then an invalid name exception needs to be// Extra check to see that corba name url created is valid as per// INS spec grammer.// Do not instantiate this class/** Debug flag which must be true for debug streams to be created and ... *//** Prints the message to the debug stream if debugging is enabled. ... *//** Prints the message to the error stream (System.err is default). ... *//** Prints the stacktrace of the supplied exception to the error stream. ... *//** Create a debug print stream to the supplied log file. ... */OutputStream logOStreamDataOutputStream logDStream/** Create a error print stream to the supplied file. ... */OutputStream errOStreamDataOutputStream errDStream/** A utility method that takes Array of NameComponent and converts ... */StringBuffer directoryStructuredNamePrintStream debugStream;/** The debug printstream. */PrintStream errStream;/** The error printstream. */// Create an outputstream for debugging// Emit first message// Create an outputstream for errorsimport NamingContextImplimport InternalBindingValue/** Class TransientBindingIterator implements the abstract methods ... */// TransientBindingIteraor servants.// There is only one POA used for both TransientNamingContext and/** Constructs a new TransientBindingIterator object. ... */this.theHashtable/** Returns the next binding in the NamingContext. Uses the enumeration ... */boolean hasMoreb.value(...).theBindingnew Binding(...)/** Destroys this BindingIterator by disconnecting from the ORB ... */byte[] objectIdservant_to_id(...)deactivate_object(...)errprint(...)printException(...)/** Returns the remaining number of elements in the iterator. ... */int currentSize;Hashtable<> theHashtable;Enumeration<> theEnumeration;// Get org.omg.CosNaming Types// Get base implementation// Get a hash table// If there are more elements get the next element// Return empty but marshalable binding// Remove the object from the Active Object Map.import InetAddress/** Class TransientNameServer is a standalone application which ... */CORBALogDomains.NAMINGequalsIgnoreCase(...)Object rootContextORB coreORBTransientNameService tns/** Main startup routine. It instantiates a TransientNameService ... */boolean invalidHostOptionboolean orbInitialPort0int initialPortinitDebug(...)ORB corbObject nsinitializeRootNamingContext(...)String stringifiedIORObject synctrace(...)ORBConstants.NAME_SERVICE_SERVER_IDString ipsString hostNameORBConstants.INITIAL_HOST_PROPERTYNumberFormatException eORBConstants.DEFAULT_INITIAL_PORT/** Private constructor since no object of this type should be instantiated. */// If debug was compiled to be true for testing purposes,// don't change it.// Determine the initial bootstrap port to use// Create an ORB object// Try environment// -Dorg.omg.CORBA.ORBInitialPort=0 is invalid// do nothing// Let arguments override// Was the initial port specified?// -ORBInitialPort 0 is invalid// If initialPort is not set, then we need to set the Default// Initial Port Property for the ORB// Set -ORBInitialPort = Persistent Server Port so that ORBImpl// will start Boot Strap.// This is used for handshaking by the IBM test framework!// Do not modify, unless another synchronization protocol is// used to replace this hack!// Serve objects.// Let the User Know that -ORBInitialHost is not valid for// tnameserver// Let the User Know that -ORBInitialPort 0 is not valid forimport LifespanPolicyValueimport RequestProcessingPolicyValueimport IdAssignmentPolicyValueimport ServantRetentionPolicyValueimport TransientNamingContext/** Class TransientNameService implements a transient name service ... *//** Constructs a new TransientNameService, and creates an initial ... */initialize(...)/** This method initializes Transient Name Service by associating Root ... */POA rootPOAORBConstants.ROOT_POA_NAMEPolicy[] poaPolicynew Policy[]POA nsPOAcreate_POA(...)TransientNamingContext initialContextnew TransientNamingContext(...)byte[] rootContextIdactivate_object(...)the_POAManager(...)create_lifespan_policy(...)LifespanPolicyValue.TRANSIENTcreate_id_assignment_policy(...)IdAssignmentPolicyValue.SYSTEM_IDcreate_servant_retention_policy(...)ServantRetentionPolicyValue.RETAINinitialContext.localRootid_to_reference(...)/** Return the initial NamingContext. ... */Object theInitialNamingContext;// The initial naming context for this name service// Get CORBA type// Get org.omg.CosNaming types// Import transient naming context// Default constructor uses "NameService" as the key for the Root Naming// Context. If default constructor is used then INS's object key for// Transient Name Service is "NameService"// This constructor gives the flexibility of providing the Object Key// for the Root Naming Context that is registered with INS.// Create an initial context/** Class TransientNamingContext implements the methods defined ... */// for read, update, and lifecycl.// These can be combined, and then we simply use 3 NamingSystemException wrappers,// XXX: the wrapper calls are all preceded by logger updates./** Constructs a new TransientNamingContext object. ... */this.localRoot/** Binds the object to the name component as the specified binding type. ... */InternalBindingKey keynew InternalBindingKey(...)NameComponent[] nameBinding bInternalBindingValue valuenew InternalBindingValue(...)InternalBindingValue oldValuevalue.theObjectRefn.kindn.id/** Resolves the supplied name to an object reference and returns ... */value.theBinding.binding_typevalue.theBinding/** Deletes the binding with the supplied name. It creates a ... */LogKeywords.NAMING_UNBIND_FAILURE/** List the contents of this NamingContext. It creates a new ... */TransientBindingIterator bindingIteratornew TransientBindingIterator(...)BindingIterator bindingRefLogKeywords.NAMING_LIST_FAILURE/** Create a new NamingContext. It creates a new TransientNamingContext ... */TransientNamingContext transContextlog(...)/** Destroys this NamingContext by disconnecting from the ORB. ... *//** A Utility Method For Logging.. *//** Return whether this NamingContext contains any bindings. It forwards ... */// A hashtable to store the bindingsObject localRoot;/** The local root naming context. */// Create a key and a value// insert it// Is the initial naming context requested?// Create a key and lookup the value// Copy out binding type and object reference// Create a key and remove it from the hashtable// Return what was found// Create a new binding iterator servant with a copy of this// hashtable. nsPOA is passed to the object so that it can// de-activate itself from the Active Object Map when// Binding Iterator.destroy is called.// Have it set the binding list// Get the object reference for the binding iterator servant// Convert to a CORBA system exception// Create a new servant// Destroy the object reference by disconnecting from the ORB/** The corbaloc: URL definitions from the -ORBInitDef and -ORBDefaultInitDef's ... *//** This constructor parses the URL and initializes all the variables. Once ... */String urlint endIndexStringTokenizer endpointscleanEscapes(...)badAddress(...)String endpointInfoIIOPEndpointInfo iiopEndpointInfostartsWith(...)handleIIOPColon(...)handleRIRColon(...)handleColon(...)/** A Utility method to throw BAD_PARAM exception to signal malformed ... *//** If there is 'iiop:' token in the URL, this method will parses ... */NamingConstants.IIOP_LENGTH/** This is to handle the case of host information with no 'iiop:' prefix. ... */String hostandportStringTokenizer tokenizernew IIOPEndpointInfo(...)int tokenCountString versionint dotsetVersion(...)int squareBracketBeginIndexString ipv6PortgetIPV6Port(...)setPort(...)setHost(...)getIPV6Host(...)validateGIOPVersion(...)/** Validate 'rir:' case. */NamingConstants.RIRCOLON_LENGTH/** Returns an IPV6 Port that is after [<ipv6>]:. There is no validation ... */int squareBracketEndIndex/** Returns an IPV6 Host that is inside [ ] tokens. There is no validation ... */String ipv6Host/** Will be true only in CorbanameURL class. */// First Clean the URL Escapes if there are any// There is something wrong with the URL escapes used// so throw an exception// If there is no '/' then the endIndex is at the end of the URL// _REVISIT_: Add a testcase to check 'corbaloc:/'// The url starts with a '/', it's an error// Anything between corbaloc: and / is the host,port information// of the server where the Service Object is located// There should be atleast one token, because there are checks// to make sure that there is host information before the// delimiter '/'. So no need to explicitly check for number of// tokens != 0// Right now we are not allowing any other protocol// other than iiop:, rir: so raise exception indicating// that the URL is malformed// Add the Host information if RIR flag is set,// If RIR is set then it means use the internal Boot// Strap protocol for Key String resolution// If there is something after corbaloc:endpointInfo/// then that is the keyString// Check the iiop syntax// String after ":"// The format can be 1.2@<host>:<port>// There can be 1 or 2 tokens with '@' as the delimiter//  - if there is only 1 token then there is no GIOP version//    information.  A Default GIOP version of 1.2 is used.//  - if there are 2 tokens then there is GIOP version is specified//  - if there are no tokens or more than 2 tokens, then that's an//    error// There is VersionInformation after iiop:// There is a version without ., which means// Malformed list// A Hack to differentiate IPV6 address// from IPV4 address, Current Resolution// is to use [ ] to differentiate ipv6 host// ipv6Host should be enclosed in// [ ], if not it will result in a// BAD_PARAM exception// There are three possible cases here// 1. Host and Port is explicitly specified by using ":" as a//    a separator// 2. Only Host is specified without the port// 3. HostAndPort info is null// Case 1: There is Host and Port Info// Case 2: Only Host is specified. iiopEndpointInfo is// initialized to use the default INS port, if no port is// specified// Case 3: If no Host and Port info is provided then we use the// the default LocalHost and INSPort. iiopEndpointInfo is// already initialized with this info.// Any kind of Exception is bad here.// Possible causes: A Number Format exception because port info is// malformed// If there is port information, then it has to be after ] bracket// indexOf returns the count from the index of zero as the base, so// equality check requires squareBracketEndIndex + 1.// PortInformation  should be after ']:' delimiter// If there is an exception then it will be caught in// checkcorbaGrammer method and rethrown as BAD_PARAM// get the host between [ ]/** The corbaname: URL definitions from the -ORBInitDef and -ORBDefaultInitDef's ... *//** This constructor takes a corbaname: url with 'corbaname:' prefix stripped ... */int delimiterIndexString corbalocStringINSURL insURLcopyINSURL(...)int start/** A Utility method to throw BAD_PARAM exception. *//** A Utility method to copy all the variables from CorbalocURL object to ... */getRIRFlag(...)getEndpointInfo(...)getKeyString(...)getStringifiedName(...)// Append corbaloc: for Grammar check, Get the string between// corbaname: and # which forms the corbaloc string// Build a corbaloc string to check the grammar.// 10 is the length of corbaname:// If the string doesnot end with a / then add one to end the// URL correctly// Check the corbaloc grammar and set the returned corbaloc// object to the CorbaName Object// String after '#' is the Stringified name used to resolve// the Object reference from the rootnaming context. If// the String is null then the Root Naming context is passed// back/** EndpointInfo is used internally by CorbaLoc object to store the ... */int major, ...;// Version information// Host Name and Port NumberORBConstants.DEFAULT_INS_GIOP_MAJOR_VERSIONORBConstants.DEFAULT_INS_GIOP_MINOR_VERSIONORBConstants.DEFAULT_INS_HOSTORBConstants.DEFAULT_INS_PORT/** Internal Debug Method. */// Default IIOP Version// Default host is localhost// Default INS Port/** INS URL is a generic interface for two different types of URL's specified ... */// a List// There can be one or more Endpoint's in the URL, so the return value is// corbaname: URL needs special handling.// This method will return true only in CorbanameURL, It is provided because// A debug method, which is not required for normal operationboolean rirFlag;// Service Object reference.// false then the EndpointInfo will be used to create the// boot strapping technique will be used. If set to// If rirFlag is set to true that means internalArrayList<> theEndpointInfo;String theKeyString;String theStringifiedName;isCorbanameURL(...)dump(...)/** This class is the entry point to parse different types of INS URL's. ... */INSURLHandler insURLHandler;int CORBALOC_PREFIX_LENGTH;// Length of corbaloc:int CORBANAME_PREFIX_LENGTH;// Length of corbaname:new INSURLHandler(...)new CorbalocURL(...)new CorbanameURL(...)/** Constants specific to INS parsing and validation. */int IIOP_LENGTH;// iiop lengthint RIRCOLON_LENGTH;// rir: lengthint MAJORNUMBER_SUPPORTED;int MINORNUMBERMAX;/** Utility methods for Naming. ... *//** cleanEscapes removes URL escapes as per IETF 2386 RFP. */StringWriter theStringWithoutEscapeint Hex1hexOf(...)int Hex2/** Converts an Ascii Character into Hexadecimal digit ... *//** If GIOP Version is not correct, This method throws a BAD_PARAM ... */getMajor(...)NamingConstants.MAJORNUMBER_SUPPORTEDNamingConstants.MINORNUMBERMAX// Get the two hexadecimal digits and convert that into int// Convert the integer to ASCII// computed by serialver toolString id;String kind;this.kindthat.idthat.kindint hashVal// If One is Null and the other is not then it's a mismatch// So, return false// We have checked all the possibilities, so return trueBindingType theBindingType;// will be set once and then the result will be used everytime.// calling orb.string_to_object( ) everytime. Instead it// Non-Stringified Object Reference. This is done to avoid// The value stores both Stringified Object Reference and// Objectreference or Contextimport InitialNameServiceimport InitialNameServiceHelper/** Class NameServer is a standalone application which ... */String dbName;// name server database directoryNameServer nsnew NameServer(...)String dbDirNameNameService nsInitialNameService insORBConstants.INITIAL_NAME_SERVICE_NAME// create the ORB Object// set up the database directory// create the persistent name service// add root naming context to initial naming// wait for invocationsimport org.omg.PortableServer.*NamingContext rootContext;ServantManagerImpl contextMgr;ORB theorb;/** Create NameService which starts the Root Naming Context in Persistent CosNaming ... */String rootKeygetRootObjectKey(...)NamingContextImpl ncnew NamingContextImpl(...)LifespanPolicyValue.PERSISTENTcreate_request_processing_policy(...)RequestProcessingPolicyValue.USE_SERVANT_MANAGERIdAssignmentPolicyValue.USER_IDServantRetentionPolicyValue.NON_RETAINnew ServantManagerImpl(...)addContext(...)setServantManagerImpl(...)setORB(...)setRootNameService(...)set_servant_manager(...)create_reference_with_id(...)/** This method returns the Root Naming Context *//** This method returns nsPOA which is the only POA that we use for ... *//** This method  creates a NewContext, This will internally invoked from ... */String newKeygetNewObjectKey(...)NamingContextImpl theContextNamingContextImpl tempContextNamingContext theNewContext/** getObjectReferenceFromKey returns the Object reference from the objectkey using POA.create_reference_with_id method ... *//** getObjectKey gets the Object Key from the reference using POA.reference_to_id method ... */byte[] theIdString theKeyreference_to_id(...)WrongAdapter eWrongPolicy e// Moved this to the creation of the ORB that is passed into this// constructor.// This is required for creating Persistent Servants under this ORB// Right now the Persistent NameService and ORBD are launched together// Find out a better way of doing this, Since ORBD is an important// process which should not be killed because of some external process// orb.setPersistentServerId( (int) 1000 );// get and activate the root naming POA// create a new POA for persistent Naming Contexts// With Non-Retain policy, So that every time Servant Manager// will be contacted when the reference is made for the context// The id assignment is made by the NameServer, The Naming Context// id's will be in the format NC<Index>// create and set the servant manager// The RootObject key will be NC0// initialize the root Naming Context// Get the new Naming Context Key from// the ServantManager// Create the new Naming context and create the Persistent// reference// If the context is read from the File, The following three entries// will be null. So a fresh setup may be required.//throw e;import org.omg.CosNaming.*import NamingUtils/** Class NamingContextImpl implements the org.omg.CosNaming::NamingContext and ... */// All the references are stored in the files in the form of IOR strings// The ORB is required to do string_to_object() operationsString objKey;// The NamingContext internaly// The ObjectKey will be in the format NC<Index> which uniquely identifies// on this context.// table. This table is written into File everytime an update is made// and the Child Naming Contexts will have it's key as the entry in the// CORBA.Object references will be stored in the form of IOR strings// Hash table contains all the entries in the NamingContexts. TheNameService theNameServiceHandle;// POA in the NameService.// NamingContext's references. These references are created using// The NameServiceHandle is required to get the ObjectId from theServantManagerImpl theServantManagerImplHandle;// Update the NamingContextFile// ServantManager is the single point of contact to Read, Write and// All the calls to INS will be delegated to this class.// All the INS (Interoperable Naming Service) methods are defined in this classNamingSystemException readWrapper;NamingSystemException updateWrapper;POA biPOA;this.objKey/** Implements all flavors of binding( bind and bindcontext) ... */setObjectRef(...)String theNCKeygetObjectKey(...)updateContext(...)/** This method resolves the NamingContext or Object Reference for one level ... */Object theObjectFromStringifiedReferencegetObjectReferenceFromKey(...)value.theBindingTypevalue.strObjectRefgetObjectRef(...)/** This method Unbinds the NamingContext or Object Reference for one level ... */Object theObjectFromStringfiedReferencereadInContext(...)createbiPOA(...)PersistentBindingIterator bindingIteratornew PersistentBindingIterator(...)/** Destroys the NamingContext. */getINSImpl(...)/** This is a Debugging Method */InternalBindingValue thevaluethevalue.strObjectRef// orb.namingDebugFlag ;// insImpl will be null if the NamingContext graph is rebuilt from// the persistence store.// Narrow to a naming context using Java casts. It must work.// Raise a Valid Exception and Return// If the BindingType is an ObjectRef then Stringify this ref and// Store it in InternalBindingValue instance. This is required// because the Object References has to be stored in file// If the BindingType is a NamingContext then get it's object key// from the NameService and store it in the Internal Binding Value instance// There was an entry with this name in the Hashtable and hence throw CTX_ALREADY_BOUND// exception// Everything went smooth so update the NamingContext file with the// latest Hashtable image// Something went wrong while updating the context// so speak the error// Something went wrong while Binding the Object Reference// Speak the error again.// If the NameComponent list has no entry then it means the current// context was requested// No entry was found for the given name and hence return NULL// NamingContextDataStore throws appropriate exception if// required.// Check whether the entry found in the Hashtable starts with NC// Which means it's a name context. So get the NamingContext reference// from ServantManager, which would either return from the cache or// read it from the File.// Else, It is a Object Reference. Check whether Object Reference// can be obtained directly, If not then convert the stringified// reference to object and return.// Ignore the exception in Hashtable.remove// XXX note that orb.disconnect is illegal here, since the// POA is used.  However, there may be some associated state// that needs to be cleaned up in ServerManagerImpl which we will// look into further at another time./* // XXX This needs to be replaced by cleaning up the ... */import BindingIteratorImpl/** Constructs a new PersistentBindingIterator object. ... */InternalBindingKey theBindingKeyInternalBindingValue theElementNameComponent ntheBindingKey.idtheBindingKey.kindNameComponent[] nlistBindingType theTypetheElement.theBindingTypeimport ServantLocatorimport CookieHolder// computed using serialver toolNameService theNameService;File logDir;Hashtable<> contexts;CounterDB counterDb;int counter;String objKeyPrefix;this.logDirnew CounterDB(...)String objKeyNamingContextImpl contextFile contextFileCounterDB.rootCountergetNextCounter(...)writeCounter(...)readCounter(...)int counterValInteger counter;String counterFileName;File counterFile;int rootCounter;// initialize the counter database// nada// Returning Context from Cacheimport NullServantSystemException sysex;this.syseximport Actionimport ActionBaseimport Guardimport GuardBaseimport Stateimport StateImplimport Inputimport InputImplimport FSMimport FSMImplimport StateEngineimport StateEngineFactoryimport Muteximport CondVarimport ObjectAlreadyActive/** AOMEntry represents a Servant or potential Servant in the ActiveObjectMap. ... */new StateImpl(...)new StateImpl(...) { ... }AOMEntry$1AOMEntry entrybroadcast(...)entry.waitAOMEntry$2Thread etherealizerentry.etherealizernew InputImpl(...)new ActionBase(...) { ... }AOMEntry$3entry.counterAOMEntry$4lifecycleWrapper(...)entry.poaAOMEntry$5new IllegalStateException(...)AOMEntry$6new ObjectAlreadyActive(...)new GuardBase(...) { ... }AOMEntry$7Guard.Resultawait(...)InterruptedException excGuard.Result.DEFEREDnew CounterGuard(...)new Complement(...)Guard.ComplementsetDefault(...)...[] etherealizer;...[] counter;// waits for the completion.// the POA.deactivate_object never// represented as a Thread because// for this entry.  It is// The actual etherealize operationCondVar wait;// accessed in actions// single element holder for counterPOAImpl poa;State INVALID;State INCARN;State VALID;State ETHP;State ETH;State DESTROYED;Input START_ETH;Input ETH_DONE;Input INC_DONE;Input INC_FAIL;Input ACTIVATE;Input ENTER;Input EXIT;Action incrementAction;Action decrementAction;Action throwIllegalStateExceptionAction;Action oaaAction;Guard waitGuard;AOMEntry$CounterGuardGuardBase greaterZeroGuard;Guard zeroGuard;GuardBase greaterOneGuard;Guard oneGuard;StateEngine engine;(...).poaFSMDebugFlagthis.poanew Thread[]new CondVar(...)poa.poaMutex(...).poaConcurrencyDebugFlag// the etherealizer.// Most just call the doIt method, but startEtherealize needs// Methods that drive the FSM: the real interface to this classthis.etherealizerdoIt(...)RuntimeException excThrowable thr/* Copyright (c) 2002, 2010, Oracle and/or its affiliates. All rights reserved. ... */// XXX Log this//          State,   Input,     Guard,                  Action,             new Stateimport WrongPolicy/** The ActiveObjectMap maintains associations between servants and ... */ActiveObjectMap$KeyKey kk.id.lengththis.id.lengthk.id// Use the same hash function as for Stringint hnew MultipleObjectMap(...)new SingleObjectMap(...)Map<> keyToEntry;Map<> entryToServant;// Map< Key, AOMEntry >Map<> servantToEntry;// Map< AOMEntry, Servant >// Map< Servant, AOMEntry >/** get Returbs the entry assigned to the key, or creates a new ... */AOMEntry resultnew AOMEntry(...)putEntry(...)removeEntry(...)Map<> entryToKey;// Map< AOMEntry, Key >// This case does not need the key.Map<> entryToKeys;// Map< AOMEntry, Set< Key > >new WrongPolicy(...)Set<> setnew HashSet<>(...)Set<> keys/** The bad server id handler is used to locate persistent objects. ... */import EmptyStackExceptionimport POASystemExceptionPOASystemException wrapper;POAFactory factory;CORBALogDomains.OAthis.factorybyte[] oidPOA poa_all_interfaces(...)oa(...)EmptyStackException notInInvocationEPOAImpl defaultPOA_default_POA(...)ClassCastException exceptionisImplicitlyActivated(...)getPolicies(...)isUniqueIds(...)retainServants(...)servant_to_reference(...)ServantNotActive eClassCastException eEmptyStackException exceptionPOA returnValuelookupPOA(...)getRootPOA(...)String[] repositoryIdspoa(...)object_id(...)repositoryIds.length// The get_interface() method has been replaced by get_interface_def()//Not within an invocation context//REVISITimport org.omg.CORBA.*ID_ASSIGNMENT_POLICY_ID.valuenew IdAssignmentPolicyImpl(...)IdAssignmentPolicyValue value;IdAssignmentPolicyValue._USER_IDID_UNIQUENESS_POLICY_ID.valuenew IdUniquenessPolicyImpl(...)IdUniquenessPolicyValue value;IdUniquenessPolicyValue._UNIQUE_IDIMPLICIT_ACTIVATION_POLICY_ID.valuenew ImplicitActivationPolicyImpl(...)ImplicitActivationPolicyValue value;ImplicitActivationPolicyValue._IMPLICIT_ACTIVATIONLIFESPAN_POLICY_ID.valuenew LifespanPolicyImpl(...)LifespanPolicyValue value;LifespanPolicyValue._TRANSIENTimport NoContextimport OAInvocationInfo// XXX Needs to be turned into LocalObjectImpl.// Standard OMG operations.peekThrowNoContext(...)throwNoContextIfNull(...)byte[] objectid// Implementation operations used by POA package.peekThrowInternal(...)throwInternalIfNull(...)getServantContainer(...)CookieHolder cookieHoldergetCookieHolder(...)// PortableInterceptors.// It is not a security hole since this same info can be obtained from// This is public so we can test the stack balance.String operationgetOperation(...)setServant(...)// Class utilities.OAInvocationInfo invocationInfoEmptyStackException enew NoContext(...)// If is OK for the servant to be null.// This could happen if POAImpl.getServant is called but// POAImpl.internalGetServant throws an exception.// The completion status is maybe because this could happen// after the servant has been invoked.import POAManagerimport POAManagerImplMap<> exportedServantsToPOA;// Maintained by POAs activate_object and deactivate_object.// Maps servants to POAs for deactivating servants when unexportObject is called.Set<> poaManagers;int poaManagerId;int poaId;POAImpl rootPOA;DelegateImpl delegateImpl;boolean isShuttingDown;/** All object adapter factories must have a no-arg constructor. */synchronizedSet(...)// Implementation of ObjectAdapterFactory interfacePOACurrent poaCurrentnew POACurrent(...)CORBALogDomains.OA_LIFECYCLEnew DelegateImpl(...)registerRootPOA(...)ORBConstants.POA_CURRENT_NAMEfind_POA(...)AdapterNonExistent exOBJECT_NOT_EXIST exTRANSIENT exIterator<> managersAdapterInactive e// Special methods used to manipulate global POA related stateClosure rpClosurenew Closure(...) { ... }POAFactory$1makeRootPOA(...)makeFuture(...)InvalidName inv/* Copyright (c) 2002, 2009, Oracle and/or its affiliates. All rights reserved. ... */// It is important to copy the list of POAManagers first because// pm.deactivate removes itself from poaManagers!// We delay the evaluation of makeRootPOA until// a call to resolve_initial_references( "RootPOA" ).// The Future guarantees that makeRootPOA is only called once.// See if we are trying to getRootPOA while shutting down the ORB.import AdapterActivatorimport ServantManagerimport ThreadPolicyimport LifespanPolicyimport IdUniquenessPolicyimport IdAssignmentPolicyimport ImplicitActivationPolicyimport ServantRetentionPolicyimport RequestProcessingPolicyimport ThreadPolicyValueimport IdUniquenessPolicyValueimport ImplicitActivationPolicyValueimport AdapterAlreadyExistsimport AdapterNonExistentimport InvalidPolicyimport WrongAdapterimport NoServantimport ServantAlreadyActiveimport ServantNotActiveimport ObjectNotActiveimport NON_EXISTENTimport OADestroyedimport ObjectAdapterBaseimport ObjectAdapterIdArrayimport Syncimport SyncUtilimport ReentrantMutex/** POAImpl is the implementation of the Portable Object Adapter. It ... */int STATE_START;// STATE_DESTROYING to STATE_DESTROYED  after destruction completes.// STATE_RUN to STATE_DESTROYING        after start of destruction// INIT_DONE to RUN                     after successful unknown_adapter// INIT to DESTROYED                    after failed unknown_adapter// INIT to INIT_DONE                    after initialize completes// START to RUN                         after initialize completes// START to INIT                        after find_POA constructor call// Valid state transitions:// POA is created in STATE_START// initialization related states must be lower than STATE_RUN.// DO NOT CHANGE THE VALUES OF THE STATE CONSTANTS!!!  In particular, the// this order so that ordered comparison is possible.// Note that ordering is important here: we must have the state defined in// POA state constants// J2SE 1.5.// 166 concurrency primitives in J2SE 1.5 and later once the ORB moves to// mutexes to handle the locking.  This will all be replaced by the new JSR// util.concurrent (version 1.3.0) that supports reentrant// This implementation uses a modified version of Doug Lea's// we cannot simply use the standard Java synchronized primitive.// adapterActivatorCV.  This means that (for this reason as well as others)// in the POA, as defined by invokeCV, beingDestroyedCV, and// Also note that there are 3 separate conditions on which threads may wait// 2. Lock a POA before locking its child POA// 1. Lock POAs before POAManagers// locks must respect the following locking hierarchy:// implement the specification and avoid deadlocks.  The order of acquiring// The POA requires careful design for concurrency management to correctly// Notes on concurrency./* POA creation takes place in 2 stages: first, the POAImpl constructor is ... */int STATE_INIT;// constructor completeint STATE_INIT_DONE;// waiting for adapter activatorint STATE_RUN;// adapter activator called create_POAint STATE_DESTROYING;// initialized and runningint STATE_DESTROYED;// being destroyed// destruction complete// Current state of the POAPOAPolicyMediator mediator;// unsynchronized.// Note that POAImpl handles all synchronization, so mediator is (mostly)// The POA request handler that performs all policy specific operationsint numLevels;// Representation of object adapter IDObjectAdapterId poaId;// counts depth of tree.  Root = 1.// the actual object adapter ID for this POAPOAManagerImpl manager;// the name of this POAint uniquePOAId;// This POA's POAManagerPOAImpl parent;// lifetime as the ORB.// to the POAFactory, which has the same// ID for this POA that is unique relative// The POA that created this POA.AdapterActivator activator;// this POA.// Map from name to POA of POAs created byint invocationCount;Sync poaMutex;// package private for access by AOMEntry.// Master lock for all POA synchronization.  See lock and unlock.// XXX revisit for JSR 166// Data used to control POA concurrency// pending invocations on this POA.CondVar adapterActivatorCV;// Wait on this CV for AdapterActivator upcalls to completeCondVar invokeCV;// Wait on this CV for all active invocations to completeCondVar beingDestroyedCV;// Wait on this CV for the destroy method to complete doing its workThreadLocal<> isDestroying;// POA.destroy().// thread local variable to store a boolean to detect deadlock in// POA problems.// This includes the most important information for debuggingstateToString(...)// package private for mediator implementations.// package private for access to servant to POA mapORBConstants.TRANSIENT_SCID// package private so that POAFactory can access it.POAManagerImpl poaManagernew POAManagerImpl(...)getPOAFactory(...)POAImpl resultnew POAImpl(...)Policies.rootPOAPolicies// package private so that POAPolicyMediatorBase can access it.// package private so that POAPolicyMediator can access it.acquire(...)release(...)// package private so that DelegateImpl can access it.// Note that the parent POA must be locked when this constructor is called.String[] namesPOAImpl poaImplorb.poaDebugFlagthis.statenewPOAId(...)parent.numLevelsparent.childrenpoaImpl.namepoaImpl.parentnew ReentrantMutex(...)orb.poaConcurrencyDebugFlagPOAImpl$1Boolean.FALSE// The POA lock must be held when this method is called.getScid(...)boolean objectAdapterCreatedthis.manageraddPOA(...)initializeTemplate(...)// The poaMutex must be held when this method is called// The poaMutex must NOT be held when this method is called.// errors to their client.// activator, either to continue their invocations, or to return// In any case, we must wake up all threads waiting for the adapter// partially created and return false.  Otherwise, we return true.// inialization.  In this case, we destroy the POA that was// STATE_INIT, the AdapterActivator did not complete the// determined by checking the state of the POA.  If the state is// initialization of a POA activated in find_POA.  This is// This method checks that the AdapterActivator finished theboolean successlock(...)DestroyThread destroyernew DestroyThread(...)unlock(...)IORTemplateList thisTemplategetIORTemplates(...)ObjectReferenceFactory orfIORTemplateList poaTemplategetIORTemplateList(...)new WrongAdapter(...)iorWrapper(...)POAImpl$DestroyThread// so that we can call performDestroy() directly.// Converted from anonymous class to local classboolean wait;boolean etherealize;POAImpl thePoa;this.etherealizethis.thePoathis.waitSet<> destroyedPOATemplatesObjectReferenceTemplate[] ortsnew ObjectReferenceTemplate[]performDestroy(...)NON_EXISTENT.value// destroying poa.// if not, which means that another thread is already// Returns true if destruction must be completed, falsePOAImpl[] childPoaspoa.statepoa.beingDestroyedCVpoa.isDestroyingnew POAImpl[]poa.childrenchildPoas.lengthPOAImpl parentpoa.parentboolean isRootprepareForDestruction(...)completeDestruction(...)poa.managerpoa.invocationCountpoa.invokeCVInterruptedException expoa.mediatoretherealizeAll(...)clearAOM(...)removePOA(...)poa.name/** <code>create_POA</code> ... *///*******************************************************************// Public POA APIPOAImpl poaomgLifecycleWrapper(...)POAManagerImpl newManagerint defaultCopierIdgetDefaultId(...)Policies POAPoliciesnew Policies(...)new AdapterAlreadyExists(...)/** <code>find_POA</code> ... */POAImpl foundAdapterActivator actwaitUntilRunning(...)new AdapterNonExistent(...)boolean statusboolean adapterResultunknown_adapter(...)destroyIfNotInitDone(...)/** <code>destroy</code> ... */isDuringDispatch(...)/** <code>create_thread_policy</code> ... */new ThreadPolicyImpl(...)/** <code>create_lifespan_policy</code> ... *//** <code>create_id_uniqueness_policy</code> ... *//** <code>create_id_assignment_policy</code> ... *//** <code>create_implicit_activation_policy</code> ... *//** <code>create_servant_retention_policy</code> ... */new ServantRetentionPolicyImpl(...)/** <code>create_request_processing_policy</code> ... */new RequestProcessingPolicyImpl(...)/** <code>the_name</code> ... *//** <code>the_parent</code> ... *//** <code>the_children</code> */Collection<> collPOA[] resultnew POA[]/** <code>the_POAManager</code> ... *//** <code>the_activator</code> ... */this.activator/** <code>get_servant_manager</code> ... */getServantManager(...)/** <code>set_servant_manager</code> ... */setServantManager(...)/** <code>get_servant</code> ... */getDefaultServant(...)/** <code>set_servant</code> ... */setDefaultServant(...)/** <code>activate_object</code> ... */byte[] idnewSystemId(...)activateObject(...)ObjectAlreadyActive oaa/** <code>activate_object_with_id</code> ... */byte[] idClone/** <code>deactivate_object</code> ... */deactivateObject(...)/** <code>create_reference</code> ... */makeObject(...)/** <code>create_reference_with_id</code> ... *//** <code>servant_to_id</code> ... */servantToId(...)/** <code>servant_to_reference</code> ... *//** <code>reference_to_servant</code> ... */internalReferenceToId(...)idToServant(...)/** <code>reference_to_id</code> ... *//** <code>id_to_servant</code> ... *//** <code>id_to_reference</code> ... */Servant s/** <code>id</code> ... *///***************************************************************//Implementation of ObjectAdapter interfaceget_effective_policy(...)getORTState(...)Servant servint copierIdgetCopierId(...)getObjectCopierFactory(...)new OADestroyed(...)enter(...)getInvocationServant(...)ForwardRequest freqfreq.forward_reference/** Called from the subcontract to let this POA cleanup after an ... */returnServant(...)// This was done in initialize, but I moved it here// to get better searchability when tracing.// This is the root POA, which counts as 1 level// My level is one more than that of my parent// Get an array of all of the POA names in order to// create the poaid.// Construct the object key template// Note that parent == null iff this is the root POA.// This was used to avoid executing interceptors on the RootPOA.// That is no longer necessary.// parent != null ;// XXX extract codebase from policies and pass into initializeTemplate// after the codebase policy change is finalized.// codebase// manager id// Note that a POA could be destroyed while in STATE_INIT due to a// failure in the AdapterActivator upcall.// Don't just use destroy, because the check for// deadlock is too general, and can prevent this from// functioning properly.// Extract the ObjectId from the first TaggedProfile in the IOR.// If ior was created in this POA, the same ID was used for// every profile through the profile templates in the currentFactory,// so we will get the same result from any profile.// Catch exceptions since setDaemon can cause a// security exception to be thrown under netscape// in the Applet mode// Note that we do not synchronize on this, since this is// the PerformDestroy instance, not the POA.// destroy may be called multiple times, and each call// is allowed to proceed with its own setting of the wait// flag, but the etherealize value is used from the first// call to destroy.  Also all children should be destroyed// before the parent POA.  If the poa is already destroyed,// we can just return.  If the poa has started destruction,// but not completed, and wait is true, we need to wait// until destruction is complete, then just return.// Make a copy since we can't hold the lock while destroying// the children, and an iterator is not deletion-safe.// We are not holding the POA mutex here to avoid holding it// while destroying the POA's children, since this may involve// upcalls to etherealize methods.// NOTE: If we are here, poa is in STATE_DESTROYING state. All// other state checks are taken care of in prepareForDestruction.// No other threads may either be starting new invocations// by calling enter or starting to destroy poa.  There may// still be pending invocations.// Note that we must lock the parent before the child.// The parent lock is required (if poa is not the root)// to safely remove poa from parent's children Map.// We have just destroyed the root POA, so we need to// make sure that the next call to// resolve_initial_reference( "RootPOA" )// will recreate a valid root POA.// We cannot create children of a POA that is (being) destroyed.// This has been added to the CORBA 3.0 spec.// Do not hold the parent POA lock while// waiting for child to complete initialization.// Make sure that the child has completed its initialization,// if it was created by an AdapterActivator, otherwise throw// a standard TRANSIENT exception with minor code 4 (see// CORBA 3.0 11.3.9.3, in reference to unknown_adapter)// Note that found may be in state DESTROYING or DESTROYED at// this point.  That's OK, since destruction could start at// any time.// Create a child, but don't initialize it.  The newly// created POA will be in state STATE_START, which will// cause other calls to find_POA that are creating the same// POA to block on the waitUntilRunning call above.// Initialization must be completed by a call to create_POA// inside the unknown_adapter upcall.  Note that// this.poaMutex must be held here so that this.children// can be safely updated.  The state is set to STATE_INIT// so that initialize can make the correct state transition// when create_POA is called inside the AdapterActivator.// This avoids activating the new POA too soon// by transitioning to STATE_RUN after unknown_adapter// returns.// assert (found != null)// assert not holding this.poaMutex OR found.poaMutex// We must not hold either this.poaMutex or found.poaMutex here while// waiting for intialization of found to complete to prevent possible// deadlocks.// Prevent more than one thread at a time from executing in act// in case act is shared between multiple POAs.// ignore most non-system exceptions, but log them for// diagnostic purposes.// At this point, we have completed adapter activation.// Whether this was successful or not, we must call// destroyIfNotInitDone so that calls to enter() and create_POA()// that are waiting can execute again.  Failing to do this// will cause the system to hang in complex tests.// OMG Issue 3740 is resolved to throw AdapterNonExistent if// unknown_adapter() returns false.// This is to avoid deadlock// Allocate a new system-generated object-id.// This will throw WrongPolicy if not SYSTEM_ID// policy.// This exception can not occur in this case,// since id is always brand new.// Clone the id to avoid possible errors due to aliasing// (e.g. the client passes the id in and then changes it later).// reference_to_id should throw WrongAdapter// if the objref was not created by this POA// Avoid deadlock if this is the thread that is processing the// POA.destroy because this is the only thread that can notify// waiters on beingDestroyedCV.  This can happen if an// etherealize upcall invokes a method on a colocated object// served by this POA.import DISCARDINGimport ACTIVEimport HOLDINGimport INACTIVE/** POAManagerImpl is the implementation of the POAManager interface. ... */PIHandler pihandler;// for all POAManagers// factory which contains global stateState state;// for adapterManagerStateChangedSet<> poas;// current state of this POAManagerint nInvocations;// all poas controlled by this POAManagerint nWaiters;// Number of invocations in progressint myId;// invocations to complete// Number of threads waiting for// This POAManager's IDboolean explicitStateChange;// discard_request, or deactivate is called.// one of activate, hold_request,// initially false, set true as soon asState._HOLDINGState._ACTIVEState._DISCARDINGState._INACTIVEaddPoaManager(...)this.pihandlernewPOAManagerId(...)State.HOLDINGgetORB(...).poaDebugFlaggetWrapper(...)removePoaManager(...)HOLDING.valueACTIVE.valueINACTIVE.valueDISCARDING.value/** <code>activate</code> ... *//** ************************************************************************** ... */new AdapterInactive(...)State.ACTIVEnotifyWaiters(...)/** <code>hold_requests</code> ... */countedWait(...)/** <code>discard_requests</code> ... */State.DISCARDING/** <code>deactivate</code> ... */POAManagerDeactivator deactivatornew POAManagerDeactivator(...)State.INACTIVEThread thrPOAManagerImpl$POAManagerDeactivatorboolean etherealize_objects;POAManagerImpl pmi;this.etherealize_objectsthis.pmipmi.nInvocationspmi.poas/** Added according to the spec CORBA V2.3; this returns the ... */// AdapterActivator.unknown_adapter.// called from POA.find_POA before calling/** Activate the POAManager if no explicit state change has ever been ... */AdapterInactive ai// NOP// XXX This is probably not the correct error// set the state to ACTIVE// Notify any invocations that were waiting because the previous// state was HOLDING, as well as notify any threads that were waiting// inside hold_requests() or discard_requests().// set the state to HOLDING// Notify any threads that were waiting in the wait() inside// discard_requests. This will cause discard_requests to return// (which is in conformance with the spec).// set the state to DISCARDING// state was HOLDING. Those invocations will henceforth be rejected with// a TRANSIENT exception. Also notify any threads that were waiting// inside hold_requests().// state was HOLDING. Those invocations will then be rejected with// an OBJ_ADAPTER exception. Also notify any threads that were waiting// Make sure that poas cannot change while we copy it!// Each RETAIN+USE_SERVANT_MGR poa// must call etherealize for all its objects// This notifies any threads that were in the// wait_for_completion loop in hold/discard/deactivate().// ignore the exception./** POAPolicyMediator defines an interface to which the POA delegates all ... *//** Return the policies object that was used to create this ... *//** Return the subcontract ID to use in the IIOP profile in IORs ... *//** Return the server ID to use in the IIOP profile in IORs ... *//** Get the servant to use for an invocation with the ... *//** Release a servant that was obtained from getInvocationServant. *//** Etherealize all servants associated with this POAPolicyMediator. ... *//** Delete everything in the active object map. *//** Return the servant manager.  Will throw WrongPolicy ... *//** Set the servant manager.  Will throw WrongPolicy ... *//** Return the default servant.   Will throw WrongPolicy ... *//** Set the default servant.   Will throw WrongPolicy ... *//** Deactivate the object that is associated with the given id. ... *//** Allocate a new, unique system ID.  Requires the ID assignment policy ... */import ServantCachingPolicy/** Implementation of POARequesHandler that provides policy specific ... */int sysIdCounter;Policies policies;boolean isImplicit;boolean isUnique;boolean isSystemId;POAManagerImpl poamPOAFactory poafisSingleThreaded(...)invocationWrapper(...)getDelegateImpl(...)this.policiesservantCachingLevel(...)ServantCachingPolicy.NO_SERVANT_CACHINGServantCachingPolicy.FULL_SEMANTICSORBConstants.SC_TRANSIENT_SCIDServantCachingPolicy.INFO_ONLY_SEMANTICSORBConstants.IISC_TRANSIENT_SCIDServantCachingPolicy.MINIMAL_SEMANTICSORBConstants.MINSC_TRANSIENT_SCIDgetTransientServerId(...)getPersistentServerId(...)makePersistent(...)isSystemAssignedIds(...)internalGetServant(...)// method to work.// This delegate is needed during dispatch for the ObjectImpl._orb()// Create a delegate and stick it in the servant.intToBytes(...)getPOAId(...)//This new servant delegate no longer needs the id for// its initialization.import NullServantImplActiveObjectMap activeObjectMap;ActiveObjectMap.KeyKey keynew Key(...)internalKeyToServant(...)key.idorb.shutdownDebugFlagputServant(...)isInstanceDefined(...)POAManagerImpl pmPOAFactory factoryregisterPOAForServant(...)new ServantAlreadyActive(...)activateServant(...)unregisterPOAForServant(...)new ObjectNotActive(...)deactivateHelper(...)ServantAlreadyActive sWrongPolicy wnew ServantNotActive(...)/* Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved. ... */// assert policies.retainServants() && policies.useActiveObjectMapOnly()// Check for an ObjectAlreadyActive error// Default does nothing, but the USE_SERVANT_MANAGER case// must handle etherealization// XXX needs to handle call from an invocation on this POA// assert !isUnique || (servant not in activateObjectMap)// This can't occur here, since id is always brand new.// this call, so it can only contain valid combinations of POA policies.// Note that the policies object has already been validated before// create an appropriate policy mediator based on the policies.useActiveMapOnly(...)new POAPolicyMediatorImpl_R_AOM(...)useDefaultServant(...)new POAPolicyMediatorImpl_R_UDS(...)useServantManager(...)new POAPolicyMediatorImpl_R_USM(...)new POAPolicyMediatorImpl_NR_UDS(...)new POAPolicyMediatorImpl_NR_USM(...)/** Implementation of POAPolicyMediator that provides policy specific ... */Servant defaultServant;new NoServant(...)this.defaultServant// assert !policies.retainServants() && policies.useDefaultServant()ServantLocator locator;preinvoke(...)new NullServantImpl(...)omgInvocationWrapper(...)OAInvocationInfo infopostinvoke(...)getCookieHolder(...).value// assert !policies.retainServants() && policies.useServantManager()// Try - finally is J2EE requirement.internalIdToServant(...)// assert policies.retainServants()// policies.useActiveObjectMapOnly()// policies.useDefaultServant()import ServantActivatorServantActivator activator;/* This handles a rather subtle bug (4939892).  The problem is that ... */boolean failedgetDebug(...)enterEntry(...)incarnateFailure(...)incarnate(...)Throwable excincarnateComplete(...)Set<> keySetKey[] keysnew Key[]boolean remainingActivationshasMultipleIDs(...)startEtherealize(...)etherealize(...)etherealizeComplete(...)POAPolicyMediatorImpl_R_USM$EtherealizerPOAPolicyMediatorImpl_R_USM mediator;ActiveObjectMap.Key key;AOMEntry entry;Servant servant;this.mediatorthis.entrymediator.activatormediator.poamediator.activeObjectMapEtherealizer ethnew Etherealizer(...)// Drop the POA lock during the incarnate call and// re-acquire it afterwards.  The entry state machine// prevents more than one thread from executing the// incarnate method at a time within the same POA.// servant == null means incarnate threw an exception,// while servant instanceof NullServant means incarnate returned a// null servant.  Either case is an incarnate failure to the// entry state machine.// XXX Does the AOM leak in this case? Yes,// but the problem is hard to fix.  There may be// a number of threads waiting for the state to change// from INCARN to something else, which is VALID or// INVALID, depending on the incarnate result.// The activeObjectMap.get() call above creates an// ActiveObjectMap.Entry if one does not already exist,// and stores it in the keyToEntry map in the AOM.// here check for unique_id policy, and if the servant// is already registered for a different ID, then throw// OBJ_ADAPTER exception, else activate it. Section 11.3.5.1// 99-10-07.pdf// check if the servant already is associated with some id// Copy the elements in the set to an array to avoid// changes in the set due to concurrent modification// Here we etherealize in the thread that called this// method, rather than etherealizing in a new thread// as in the deactivate case.  We still inform the// entry state machine so that only one thread at a// time can call the etherealize method.// ignore all exceptionsimport BitSetimport ZeroPortPolicyimport CopyObjectPolicyimport org.omg.PortableServer.POAPackage.*THREAD_POLICY_ID.valueREQUEST_PROCESSING_POLICY_ID.valueThreadPolicyValue._ORB_CTRL_MODELIdAssignmentPolicyValue._SYSTEM_IDServantRetentionPolicyValue._RETAINRequestProcessingPolicyValue._USE_ACTIVE_OBJECT_MAP_ONLYint MIN_POA_POLICY_ID;/* Order of *POLICY_ID : ... */int MAX_POA_POLICY_ID;int POLICY_TABLE_SIZE;int defaultObjectCopierFactoryId;HashMap<> policyMap;Policies defaultPolicies;// Maps Integer(policy type) to PolicyPolicies rootPOAPolicies;...[] poaPolicyValues;ImplicitActivationPolicyValue._NO_IMPLICIT_ACTIVATION/* Returns the integer value of the POA policy, if this is a ... *//** If any errors were found, throw INVALID_POLICY with the smallest ... */short ctrnew InvalidPolicy(...)/** Add the first index in policies at which the policy is of type ... */policies.lengthpolicy_type(...)/** Main constructor used from POA::create_POA.  This need only be visible ... */BitSet errorSetnew BitSet(...)short iint POAPolicyValuegetPOAPolicyValue(...)Policy prevsetPolicyValue(...)addToErrorSet(...)SERVANT_RETENTION_POLICY_ID.valuecheckForPolicyError(...)/* Thread Policies */getPolicyValue(...)ThreadPolicyValue._SINGLE_THREAD_MODEL/* Lifespan */LifespanPolicyValue._PERSISTENT/* ID Uniqueness */IdUniquenessPolicyValue._MULTIPLE_ID/* ID Assignment *//* Servant Rentention *//* Request Processing */RequestProcessingPolicyValue._USE_DEFAULT_SERVANTRequestProcessingPolicyValue._USE_SERVANT_MANAGER/* Implicit Activation *//* proprietary servant caching policy */ORBConstants.SERVANT_CACHING_POLICYServantCachingPolicy policyORBConstants.ZERO_PORT_POLICYZeroPortPolicy policyforceZeroPort(...)ORBConstants.COPY_OBJECT_POLICYCopyObjectPolicy policygetValue(...)// Make sure the defaults are set according to the POA spec// Set to record all indices in policies for which errors// were observed.// Save the policy in policyMap to support// POA.get_effective_policy, if it was not already saved// in policyMap.// if the value of this POA policy was previously set to a// different value than the current value given in// POAPolicyValue, record an error.// Check for bad policy combinations// NON_RETAIN requires USE_DEFAULT_SERVANT or USE_SERVANT_MANAGER// IMPLICIT_ACTIVATION requires SYSTEM_ID and RETAINRequestProcessingPolicyValue value;ServantRetentionPolicyValue value;ThreadPolicyValue value;/** The Transient Object Adapter is used for standard RMI-IIOP and Java-IDL ... *//** Connect the given servant to the ORB by allocating a transient object key ... *//** Disconnect the object from this ORB. */import TOAImplimport TransientObjectManagerimport ObjectKeyTemplateBaseTOAImpl toa;Map<> codebaseToTOA;TransientObjectManager tom;ObjectKeyTemplateBase.JIDL_OAIDgetTOA(...)new TransientObjectManager(...)unregisterTargetsForORB(...)TOA toanew TOAImpl(...)// Return the dispatch-only TOA, which can dispatch// request for objects created by any TOA.// The dispatch-only TOA is not used for creating// objrefs, so its codebase can be null (and must// be, since we do not have a servant at this point)import ClientDelegateimport Policiesimport JIDLLocalCRDImpl/** The Transient Object Adapter (TOA) represents the OA for purely transient ... */TransientObjectManager servants;ORBConstants.TOA_SCIDPolicies policiesPolicies.defaultPolicies// Methods required for dispatching requestslookupServant(...)/** Get the servant for the request given by the parameters. ... *//** Return the most derived interface for the given servant and objectId. */// getEffectivePolicy must always return null.// but for now, there is no way to associate policies with the TOA, so// This will need fixing once we support ORB and thread level policies,// XXX For now, this does nothing.// Methods unique to the TOAstoreServant(...)make_object(...)JIDLLocalCRDImpl jlcsDelegate deldeleteServant(...)unexport(...)// Make the object key template// REVISIT - POA specific// REVISIT - absorb codebase into a policy// This is expected to result in an RMI-IIOP NoSuchObjectException.// See bug 4973160.// Store the objref and get a userkey allocated by the transient// object manager.// Find out the repository ID for this objref.// Create the new objref// Copy the delegate from the new objref to the argument// XXX handle the case of an attempt to connect a local object.// Get the delegate, then ior, then transientKey, then delete servantint maxSize;...[] elementArray;Element freeList;new Element[]new Element(...)Element elemdoubleSize(...)freeList.servantorb.transientObjectManagerDebugFlagbytesToInt(...)int counter...[...].valid...[...].counter...[...].servant...[...].servantDatatoBytes(...)Element[] old...*=...Object servantData;// also stores "next pointer" in free listboolean valid;// a valid servant// valid=true if this Element containsthis.servantDatathis.valid// servant not found// if we come here Object does not exist// Assume caller is synchronized// Convert the index+counter into an 8-byte (big-endian) key.// prevent double deletion// add this to freeListimport AppletApplet applet;this.appletcheckPropertyDefaults(...)findPropertiesFromFile(...)findPropertiesFromProperties(...)findPropertiesFromApplet(...)/* Copyright (c) 2002, Oracle and/or its affiliates. All rights reserved. ... */// We do not use system properties for applets in order to// avoid security exceptions.import DataCollectorimport PropertyParserPropertyParser parser;Set<> propertyNames;Set<> propertyPrefixes;Set<> URLPropertyNames;String localHostName;String configurationHostName;boolean setParserCalled;Properties originalProps;Properties resultProps;ORBConstants.INITIAL_SERVICES_PROPERTYORBConstants.ORB_INIT_REF_PROPERTYthis.originalPropsthis.localHostNamethis.configurationHostName//////////////////////////////////////////////////////////// Public interface defined in DataCollectorcheckSetParserCalled(...)ParserAction paisPrefix(...)getPropertyName(...)collect(...)// in subclasses// public interface from DataCollector that must be defined// Implementation methods needed in subclasses// methods for use by subclassesString serverHostORBConstants.SERVER_HOST_PROPERTYsetProperty(...)ORBConstants.LISTEN_ON_ALL_INTERFACESString argNamefindMatchingPropertyName(...)PropertyCallback callbacknew PropertyCallback(...) { ... }DataCollectorBase$1getParameter(...)PropertyCallback URLCallbackDataCollectorBase$2URL urlnew URL(...)getDocumentBase(...)toExternalForm(...)MalformedURLException excfindPropertiesByName(...)DataCollectorBase$3findPropertiesByPrefix(...)makeIterator(...)propertyNames(...)Properties filePropsgetFileProperties(...)doProperties(...)// system properties that should impose a restriction.// Note that other prefixes are fine in other contexts; it is only// Previously a malicious subclass was able to read ANY system property.// Only allow reading of system properties with ORB prefixes.// Security bug fix 4278205:// Map System properties to ORB properties.Set<> normalNamesgetCORBAPrefixes(...)Set<> prefixNamesDataCollectorBase$4getSystemProperty(...)getSystemPropertyNames(...)// must happen through this method.// treatment of ORBInitRef.  All updates to resultProps// Store name, value in resultProps, with special// internal implementationString refNameString refValue// setProperty (name, value).// if (prefix is a prefix of name) get value from getProperties and// For each prefix in prefixes, For each name in propertyNames,String prefix// the result.// value from the callback, and store the name/value pair in// For each prefix in names, get the corresponding propertynew GetPropertyAction(...)// Map command-line arguments to ORB properties.new Iterator<>(...) { ... }DataCollectorBase$5DataCollectorBase$6File fileFileInputStream inload(...)Properties defaultsString javaHomeString fileNameFile.separatorProperties resultsString userHomegetPropertiesFromFile(...)ORBConstants.ORG_OMG_PREFIXORBConstants.SUN_PREFIXORBConstants.SUN_LC_PREFIXORBConstants.SUN_LC_VERSION_PREFIX// is true.// Return only those element of prefixes for which hasCORBAPrefixSet<> resultString elementhasCORBAPrefix(...)// Used to collect properties from various sources.// XXX This is fully initialized here.  So do we ever want to// generalize this (or perhaps this is the wrong place for this?)// Make sure that we are ready to handle -ORBInitRef.  This is special// due to the need to handle multiple -ORBInitRef args as prefix// parsing.// All command-line args are of the form "-ORBkey value".// The key is mapped to <prefix>.ORBkey.// Cannot use propertyPrefixes here, since there is no// way to fetch properties by prefix from an Applet.// Special Case:// Convert any applet parameter relative URLs to an// absolute URL based on the Document Root. This is so HTML// URLs can be kept relative which is sometimes useful for// managing the Document Root layout.// Just preserve the original (malformed) value:// the error will be handled later.// Value is <name>=<URL>// Note: do a put even if value is null since just// the presence of the property may be significant.// This will not throw a SecurityException because this// class was loaded from rt.jar using the bootstrap classloader.// if (ORBInitDebug)// dprint( "ORB properties file " + fileName + " not found: " +// exc) ;String appletHostURL appletCodeBasenew AppletDataCollector(...)new NormalDataCollector(...)new PropertyOnlyDataCollector(...)findPropertiesFromSystem(...)findPropertiesFromArgs(...)import Operation/** Create a String[] of all suffixes of property names that ... */operate(...)String testData;this.testDatagetFieldName(...)import ClientRequestDispatcherimport CopyobjectDefaultsimport OADefaultimport OperationFactoryimport ORBConfiguratorimport ParserImplBaseimport RequestDispatcherDefaultimport LocalClientRequestDispatcherFactoryimport LocalResolverimport Resolverimport ResolverDefaultimport CorbaContactInfoListFactoryimport TransportDefaultimport ServiceContextRegistryimport UEInfoServiceContextimport CodeSetServiceContextimport SendingContextServiceContextimport ORBVersionServiceContextimport MaxStreamFormatVersionServiceContextimport SocketFactoryContactInfoListImplimport DynAnyFactoryImpl...[] userConfigurators;PropertyParser parsernew PropertyParser(...)Operation actioncompose(...)suffixAction(...)classAction(...)addPrefix(...)ORB theOrbCORBALogDomains.ORB_LIFECYCLEinitObjectCopiers(...)initIORFinders(...)setClientDelegateFactory(...)makeClientDelegateFactory(...)initializeTransport(...)initializeNaming(...)initServiceContextRegistry(...)initRequestDispatcherRegistry(...)registerInitialReferences(...)persistentServerInitialization(...)runUserConfigurators(...)ConfigParser parsernew ConfigParser(...)parser.userConfiguratorsparser.userConfigurators.lengthORBConfigurator configconfigure(...)ORBData dataCollection<> serverEndpointsEndPointInfo[] endpointListObject nsetLocatorPort(...)registerEndpoints(...)/** This is made somewhat complex because we are currently supporting ... */ORBData odCorbaContactInfoListFactory contactInfoListFactorygetCorbaContactInfoListFactory(...)Acceptor[] acceptorsORBSocketFactory legacySocketFactoryUSLPort[] uslPortsgetUserSpecifiedListenPorts(...)USLPort[] portssetLegacySocketFactoryORB(...)acceptors.lengthgetSocketFactory(...)new CorbaContactInfoListFactory(...) { ... }ORBConfiguratorImpl$1new SocketFactoryContactInfoListImpl(...)makeCorbaContactInfoListFactory(...)setCorbaContactInfoListFactory(...)getORBServerPort(...)createAndRegisterAcceptor(...)ports.length// REVISIT: see ORBD. make factory in TransportDefault./* Legacy: name. */getTransportManager(...)ORBConfiguratorImpl$2RuntimeException rteLocalResolver localResolvermakeLocalResolver(...)Resolver bootResolvermakeBootstrapResolver(...)getORBInitialHost(...)Operation urlOperationmakeINSURLOperation(...)Resolver irResolvermakeORBInitRefResolver(...)getORBInitialReferences(...)Resolver dirResolvermakeORBDefaultInitRefResolver(...)getORBDefaultInitialReference(...)Resolver resolvermakeCompositeResolver(...)setLocalResolver(...)setURLOperation(...)setResolver(...)ServiceContextRegistry scrgetServiceContextRegistry(...)UEInfoServiceContext.classCodeSetServiceContext.classSendingContextServiceContext.classORBVersionServiceContext.classMaxStreamFormatVersionServiceContext.classClosure closureORBConfiguratorImpl$3new DynAnyFactoryImpl(...)Closure futureint ORB_STREAM;ObjectCopierFactory orbStreammakeORBStreamObjectCopierFactory(...)setDefaultId(...)registerObjectCopierFactory(...)IdentifiableFactoryFinder profFinderIdentifiableFactoryFinder profTempFinderIdentifiableFactoryFinder compFinderregisterFactory(...)makeIIOPProfileFactory(...)makeIIOPProfileTemplateFactory(...)makeCodeSetsComponentFactory(...)makeJavaCodebaseComponentFactory(...)makeORBTypeComponentFactory(...)makeMaxStreamFormatVersionComponentFactory(...)makeAlternateIIOPAddressComponentFactory(...)makeRequestPartitioningComponentFactory(...)makeJavaSerializationComponentFactory(...)registerValueFactories(...)setObjectKeyFactory(...)makeObjectKeyFactory(...)ClientRequestDispatcher csubmakeClientRequestDispatcher(...)CorbaServerRequestDispatcher sdmakeServerRequestDispatcher(...)LocalClientRequestDispatcherFactory lcsfmakeJIDLLocalClientRequestDispatcherFactory(...)CorbaServerRequestDispatcher bootsdmakeBootstrapServerRequestDispatcher(...)makeTOAFactory(...)registerClientRequestDispatcher(...)ORBConstants.PERSISTENT_SCIDORBConstants.SC_PERSISTENT_SCIDORBConstants.IISC_PERSISTENT_SCIDORBConstants.MINSC_PERSISTENT_SCIDregisterServerRequestDispatcher(...)setINSDelegate(...)makeINSServerRequestDispatcher(...)registerLocalClientRequestDispatcherFactory(...)makePOALocalClientRequestDispatcherFactory(...)makeFullServantCacheLocalClientRequestDispatcherFactory(...)makeInfoOnlyServantCacheLocalClientRequestDispatcherFactory(...)makeMinimalServantCacheLocalClientRequestDispatcherFactory(...)registerObjectAdapterFactory(...)makePOAFactory(...)// XXX This should go away once we get rid of the port exchange for ORBD// XXX These should move to SPI// XXX This needs an SPI// REVISIT: this should be ProtocolDefault.// Run any pluggable configurators.  This is a lot like// ORBInitializers, only it uses the internal ORB and has// access to all data for parsing.// XXX Log this exception// ignore this for now: a bad user configurator does nothing// determine the ORBD port so that persistent objrefs can be// REVISIT - use exception instead of -1.// BEGIN Legacy// END Legacy// Check for incorrect configuration.// Client and Server side setup.// Set up client side.// Since the user specified a legacy socket factory we need to// use a ContactInfoList that will use the legacy socket factory.// The user specified an explicit ContactInfoListFactory.// Use the default.// Set up server side.// Maybe allocate the Legacy default listener.// If old legacy properties set, or there are no explicit// acceptors then register a default listener.  Type of// default listener depends on presence of legacy socket factory.// Note: this must happen *BEFORE* registering explicit acceptors.// Allocate user listeners.// Note: the createServerSocket and createSocket methods on the// DefaultSocketFactory need to get data from the ORB but// we cannot change the interface.  So set the ORB (if it's ours)// by reflection.// NOTE: If there is no method then it// is not ours - so ignore it.// Register the Dynamic Any factory// No optimization or policy selection here.// Register the ValueFactory instances for ORT// Register an ObjectKeyFactory// register client subcontracts// register server delegates// register local client subcontracts/* Register the server delegate that implements the ancient bootstrap ... */// Register object adapter factoriesimport ParserImplTableBaseimport StringPairimport IORToSocketInfoimport IIOPPrimaryToContactInfoimport ReadTimeoutsString ORBInitialHost;int ORBInitialPort;String ORBServerHost;int ORBServerPort;String listenOnAllInterfaces;ORBSocketFactory legacySocketFactory;ORBSocketFactory socketFactory;...[] userSpecifiedListenPorts;IORToSocketInfo iorToSocketInfo;IIOPPrimaryToContactInfo iiopPrimaryToContactInfo;boolean orbServerIdPropertySpecified;URL servicesURL;String propertyInitRef;boolean allowLocalOptimization;int highWaterMark;int lowWaterMark;int numberToReclaim;int giopFragmentSize;int giopBufferSize;int giop11BuffMgr;int giop12BuffMgr;short giopTargetAddressPreference;short giopAddressDisposition;boolean useByteOrderMarkers;boolean useByteOrderMarkersInEncaps;boolean alwaysSendCodeSetCtx;boolean persistentPortInitialized;int persistentServerPort;boolean persistentServerIdInitialized;int persistentServerId;boolean serverIsORBActivated;Class<> badServerIdHandlerClass;CodeSetComponentInfo.CodeSetComponent charData;CodeSetComponentInfo.CodeSetComponent wcharData;...[] orbInitializers;...[] orbInitialReferences;String defaultInitRef;...[] debugFlags;...[] acceptors;CorbaContactInfoListFactory corbaContactInfoListFactory;String acceptorSocketType;boolean acceptorSocketUseSelectThreadToWait;boolean acceptorSocketUseWorkerThreadForEvent;String connectionSocketType;boolean connectionSocketUseSelectThreadToWait;boolean connectionSocketUseWorkerThreadForEvent;ReadTimeouts readTimeouts;boolean disableDirectByteBufferUse;boolean enableJavaSerialization;boolean useRepId;CodeSetComponentInfo codesets;// This is not initialized from ParserTable.// Public accessor methods ========================================================================//persistentPortInitialized = true;//persistentServerPort = sp;//{//public void setPersistentServerPort(int sp)/** Return the persistent-server-id of this server. This id is the same ... *///persistentServerIdInitialized = true;//persistentServerId = id;//public void setPersistentServerId(int id)/** Set the persistent-server-id of this server. This id is the same ... *//** Get the prefered code sets for connections. Should the client send the code set service context on every ... */// Methods for constructing and initializing this object ===========================================getParserData(...)complete(...)//Always grow for 1.0//If a "faulty" GIOPVersion is passed, it's going to return 0;import Securityimport ClientInvocationInfoimport TransportManagerimport ThreadPoolManagerimport ClientDelegateFactoryimport NVListImplimport ExceptionListImplimport ContextListImplimport NamedValueImplimport EnvironmentImplimport CachedCodeBaseimport PIHandlerImplimport PINoOpHandlerImplimport TaggedComponentFactoryFinderImplimport TaggedProfileFactoryFinderImplimport TaggedProfileTemplateFactoryFinderImplimport TOAFactoryimport POAFactoryimport ThreadPoolManagerImplimport RequestDispatcherRegistryImplimport CorbaTransportManagerImplimport LegacyServerSocketManagerImplimport CopierManagerImplimport IORTypeCheckRegistryImpl/** The JavaIDL ORB implementation. */ORBImpl$1TransportManager transportManager;LegacyServerSocketManager legacyServerSocketManager;ThreadLocal<> OAInvocationInfoStack;ThreadLocal<> clientInvocationInfoStack;IOR codeBaseIOR;// pure java orb, caching the servant IOR per ORBVector<> dynamicRequests;// Vector holding deferred RequestsSynchVariable svResponseReceived;Object runObj;Object shutdownObj;Object waitForCompletionObj;byte STATUS_OPERATING;byte STATUS_SHUTTING_DOWN;byte STATUS_SHUTDOWN;Object invocationObj;// XXX Should we move invocation tracking to the first level server dispatcher?int numInvocations;ThreadLocal<> isProcessingInvocation;// ORB.shutdown(true).Map<> typeCodeForClassMap;// and is used in Util.writeAny()// This map is caching TypeCodes created for a certain class (key)Hashtable<> valueFactoryCache;// Cache to hold ValueFactories (Helper classes) keyed on repository idsThreadLocal<> orbVersionThreadLocal;// changes// default ORB version is the version of ORB with correct Rep-id// thread local variable to store the current ORB version.RequestDispatcherRegistry requestDispatcherRegistry;CopierManager copierManager;int transientServerId;ServiceContextRegistry serviceContextRegistry;IORTypeCheckRegistry iorTypeCheckRegistry;TOAFactory toaFactory;// Needed here to implement connect/disconnectPOAFactory poaFactory;// Needed here for set_delegate// subcontracts and object adapters.// The interceptor handler, which provides portable interceptor services forORBData configData;BadServerIdHandler badServerIdHandler;ClientDelegateFactory clientDelegateFactory;Resolver resolver;// Used for resolver_initial_references and list_initial_services// same lock to access the localResolver.// and the server thread handling the client is_a request waiting on the// client thread holding the single lock for access to the urlOperation,// ORB making the call to string_to_object.  This caused a deadlock between the// corbaname: URL that contained a reference to the same ORB as the// to bug 6980681 and 6238477, which was caused by a deadlock while resolving a// Note that we now have separate locks for each resolver type.  This is due// resolver, or deadlocks may occur.// resolverLock.  Do not hold the ORBImpl lock while accessing// All access to resolver, localResolver, and urlOperation must be protected usingLocalResolver localResolver;// Used for register_initial_referencesOperation urlOperation;// Converts strings to object references for resolvers and string_to_objectObject urlOperationLock;CorbaServerRequestDispatcher insNamingDelegate;Object resolverLock;// insNamingDelegate.// refer to the localResolver.  Also used to protect access to// localResolver, since it is possible for the resolver to indirectly// resolverLock must be used for all access to either resolver orString IORTYPECHECKREGISTRY_FILTER_PROPNAME;TaggedComponentFactoryFinder taggedComponentFactoryFinder;IdentifiableFactoryFinder taggedProfileFactoryFinder;IdentifiableFactoryFinder taggedProfileTemplateFactoryFinder;ObjectKeyFactory objectKeyFactory;boolean orbOwnsThreadPoolManager;ThreadPoolManager threadpoolMgr;// starting/FinishDispatch and Shutdown// checkShutDownState - lock on different object - and normalize usage.// Methods that are NOT synchronized must stay that way to avoid deadlock.// Methods that are synchronized MUST stay synchronized./** Create a new ORB. Should be followed by the appropriate ... */checkShutdownState(...)// of the property parsing.// preInit initializes all non-pluggable ORB data that is independentnew PINoOpHandlerImpl(...)ORBImpl$2new RequestDispatcherRegistryImpl(...)new CopierManagerImpl(...)new TaggedComponentFactoryFinderImpl(...)new TaggedProfileFactoryFinderImpl(...)new TaggedProfileTemplateFactoryFinderImpl(...)new SynchVariable(...)ORBImpl$3new StackImpl(...)ORBImpl$4new ServiceContextRegistry(...)String filterPropsnew PrivilegedAction<String>(...) { ... }ORBImpl$5String propsnew IORTypeCheckRegistryImpl(...)this.orbInitDebugFlagString tokenint modboolean.classsetBoolean(...)ORBImpl$ConfigParser// ORBConfigurator class.// Class that defines a parser that gets the name of theORBConfiguratorImpl.classClass<> configurator;// but this can be replaced.// The default here is the ORBConfiguratorImpl that we define,ORBConfigurator configuratornew ORBDataParserImpl(...)setDebugFlags(...)getORBDebugFlags(...)parser.configuratorException iexcnew PIHandlerImpl(...)getThreadPoolManager(...)initIORTypeCheckRegistry(...)DataCollector dataCollectorgetLocalHostName(...)preInit(...)postInit(...)/** Get a Current pseudo-object. ... *//** Create an NVList ... *//** Create an NVList corresponding to an OperationDef ... *//** Create a NamedValue ... *//** Create an ExceptionList ... *//** Create a ContextList ... *//** Get the default Context object ... *//** Create an Environment ... */req.lengthsend_oneway(...)/** Send multiple dynamic requests asynchronously. ... *//** Find out if any of the deferred invocations have a response yet. */Request currRequestEnumeration<> vepoll_response(...)/** Get the next request that has gotten a response. ... */Enumeration<> elemsget_response(...)removeElement(...)this.svResponseReceived/** Notify response to ORB for get_next_response *//** Convert an object ref to a string. ... */stringify(...)BAD_PARAM bpbp.minorORBUtilSystemException.LOCAL_OBJECT_NOT_ALLOWED/** Convert a stringified object reference to the object it represents. ... */Operation op// Note that we connect this if we have not already done so.// pure java orb support, moved this method from FVDCodeBaseImpl.CodeBase cbValueHandler vhgetRunTimeCodeBase(...)/** Get the TypeCode for a primitive type. ... *//** Create a TypeCode for a structure. ... *//** Create a TypeCode for a union. ... *//** Create a TypeCode for an enum. ... *//** Create a TypeCode for an alias. ... *//** Create a TypeCode for an exception. ... *//** Create a TypeCode for an interface. ... *//** Create a TypeCode for a string. ... *//** Create a TypeCode for a wide string. ... *//** Create a TypeCode for a sequence. ... *//** Create a recursive TypeCode in a sequence. ... *//** Create a TypeCode for an array. ... *//** Create a new Any ... */// they got created from in Util.writeAny().// Keeping a cache of TypeCodes associated with the class// Keeping track of type codes by repository id.// TypeCodeFactory interface methods.synchronizedMap(...)/** Get a list of the initially available CORBA services. ... */Resolver res/** Resolve the stringified reference of one of the initially ... *//** If this operation is called with an id, <code>"Y"</code>, and an ... */CorbaServerRequestDispatcher insndObject obj2boolean waitshutdownServants(...)// complete in order to shutdown.  This will cause new request to be rejected.// may include activated objects that have associated state and callbacks that must// Cause all ObjectAdapaterFactories to clean up all of their internal state, whichSet<ObjectAdapterFactory> oasetnew HashSet<ObjectAdapterFactory>(...)getObjectAdapterFactories(...)// Note that the caller must hold the ORBImpl lock.Boolean valueCompletionStatus.COMPLETED_YES/** formal/99-10-07 p 159: "If destroy is called on an ORB that has ... */boolean shutdownFirstdestroyInterceptors(...)cleanCache(...)/** Registers a value factory for a particular repository ID. ... *//** Unregisters a value factory for a particular repository ID. ... *//** Finds and returns a value factory for the given repository ID. ... */StackImpl stackObject badServerIdHandlerAccessLock;/** The bad server id handler is used by the Locator to ... *//** This is the implementation of the public API used to connect ... */getTOAFactory(...)disconnect(...)getORBServerIdPropertySpecified(...)// XXX What about multi-homed host?// LocalClientRequestDispatcher as well.  Bottom line: this code needs to move.// local, the IOR is local, and we can pick one to create the// the IOR, then iterator over ContactInfo.  If any ContactInfo is// This level should probably just get the CorbaContactInfoList from// to determine this more abstractly at the ContactInfo level.// A possible strategy: like the LocalClientRequestDispatcher, we need// both with multi-homed hosts and with multi-profile IORs.// only one place in impl.ior.IORImpl.  Second, we have problems// First of all, all three of these methods are called from// XXX All of the isLocalXXX checking needs to be revisited.getORBServerHost(...)getPersistentServerIdInitialized(...)/** *********************************************************************** ... */getHostAddress(...)getByName(...)String localHostString;/* keeping a copy of the getLocalHostName so that it can only be called ... */getLocalHost(...)/** This method always returns false because the ORB never needs the ... *//** **************************************************************************** ... *//** This method does nothing. It is not required by the spec to do anything! */POAFactory poaFactory// pept.broker.BrokerStackImpl invocationInfoStackClientInvocationInfo clientInvocationInfoisRetryInvocation(...)new CorbaInvocationInfo(...)startingDispatch(...)setIsRetryInvocation(...)int entryCountfinishedDispatch(...)Object clientDelegateFactoryAccessorLock;Object corbaContactInfoListFactoryAccessLock;/** Set the resolver used in this ORB.  This resolver will be used for list_initial_services ... */this.resolver/** Get the resolver used in this ORB.  This resolver will be used for list_initial_services ... *//** Set the LocalResolver used in this ORB.  This LocalResolver is used for ... */this.localResolver/** Get the LocalResolver used in this ORB.  This LocalResolver is used for ... *//** Set the operation used in string_to_object calls.  The Operation must expect a ... *//** Get the operation used in string_to_object calls.  The Operation must expect a ... */Object objectKeyFactoryAccessLock;Object transportManagerAccessorLock;new CorbaTransportManagerImpl(...)Object legacyServerSocketManagerAccessLock;new LegacyServerSocketManagerImpl(...)Object threadPoolManagerAccessLock;new ThreadPoolManagerImpl(...)isValidIORType(...)/// Helper class for a Synchronization Variable// Class ORBImplboolean _flag;// Synchronization Variable// set Flag to true// get value// reset Flag to true/* Copyright (c) 2002, 2017, Oracle and/or its affiliates. All rights reserved. ... */// All initialization is done through set_parameters().// Before ORBConfiguration we need to set a PINoOpHandlerImpl,// because PersisentServer Initialization inside configurator will// invoke orb.resolve_initial_references( ) which will result in a// check on piHandler to invoke Interceptors. We do not want any// Interceptors to be invoked before the complete ORB initialization.// piHandler will be replaced by a real PIHandler implementation at the// end of this method.// This is the unique id of this server (JVM). Multiple incarnations// of this server will get different ids.// Compute transientServerId = milliseconds since Jan 1, 1970// Note: transientServerId will wrap in about 2^32 / 86400000 = 49.7 days.// If two ORBS are started at the same time then there is a possibility// of having the same transientServerId. This may result in collision// and may be a problem in ior.isLocal() check to see if the object// belongs to the current ORB. This problem is taken care of by checking// to see if the IOR port matches ORB server port in legacyIsLocalServerPort()// XXX need to move server ID to a string for CORBA 3.0.  At that point,// make this more unique (possibly use java.rmi.server.UID).// set default to version of the ORB with correct Rep-ids// If there is a public boolean data member in this class// named token + "DebugFlag", set it to true.// ignore it XXX log this as info// First, create the standard ORB config data.// This must be initialized before the ORBConfigurator// is executed.// Set the debug flags early so they can be used by other// parts of the initialization.// REVISIT: this should go away after more transport init cleanup// and going to ORT based ORBD.// Create a parser to get the configured ORBConfigurator.// Finally, run the configurator.  Note that the default implementation allows// other configurators with their own parsers to run,// using the same DataCollector.// Last of all, create the PIHandler and run the ORB initializers.// Initialize the thread manager pool and byte buffer pool// so they may be initialized & accessed without synchronization/* _REVISIT_ ... */// Invoke the send_oneway on each new Request// add the new Requests to pending dynamic Requests// Invoke the send_deferred on each new Request// poll on each pending request// check if there already is a response// get the response for this successfully polled Request// wait for a response// reinitialize the response flag// Handle the null objref case// Throw MARSHAL instead if this is a LOCAL_OBJECT_NOT_ALLOWED error.// Not a local object problem: just rethrow the exception.// Do not wrap and log this, since it was already logged at its// point of origin.// i.e. We are already connected to it// Store only one TypeCode per class.// Make all remote object references available for INS.// This is to avoid deadlock: don't allow a thread that is// processing a request to call shutdown( true ), because// the shutdown would block waiting for the request to complete,// while the request would block waiting for shutdown to complete.// Avoid more than one thread performing shutdown at a time.// At this point, the ORB status is certainly STATUS_SHUTTING_DOWN.// If wait is true, another thread already called shutdown( true ),// and so we wait for completion// NOP: just loop and wait until state is changed// perform the actual shutdown// ORBServerId is specified then use that value// XXX isTransient info should be stored in subcontract registry// This is a new call - not a retry.// Reset retry so recursive calls will get a new info object.// 6763340: don't pop if this is a retry!import ConnectionCache/* The restricted singleton ORB implementation. ... */getStaticStubFactoryFactory(...)ORB fullORB;// This is used to support read_Object.PresentationManager.StubFactoryFactory staticStubFactoryFactory;// orbos 98-01-18: Objects By Value -- begin/* Not strictly needed for TypeCode factory duty but these seem ... *//* Things that aren't allowed. */new ORBImpl(...)set_parameters(...)getFullORB(...)/** Return the service context registry *//** Get the transient server ID *//** Return the bootstrap naming port specified in the ORBInitialPort param. *//** Return the bootstrap naming host specified in the ORBInitialHost param. *//* Things from corba.ORB. */getClientDelegateFactory(...)// NOTE: REMOVE THIS METHOD ONCE WE HAVE A ORT BASED ORBD// To enable read_Object.// Always use our latest ORB version (latest fixes, etc)new ORBVersionImpl(...)ORBVersion.FOREIGNORBVersion.OLDORBVersion.NEWORBVersion.JDK1_3_1_01ORBVersion.NEWERORBVersion.PEORBbyte orbType;this.orbTypeORBVersion FOREIGN;ORBVersion OLD;ORBVersion NEW;ORBVersion JDK1_3_1_01;ORBVersion NEWER;ORBVersion PEORB;getORBType(...)// The Comparable interface says that this// method throws a ClassCastException if the// given object's type prevents it from being// compared./** Return the property name or prefix for which this action ... *//** Return whether this action is for an exact match or a prefix ... *//** Return the field name in an object that is set with the result *//** Apply this action to props and return the result. */String propertyName;boolean prefix;Operation operation;String fieldName;ParserActionBase otherother.propertyNameother.prefixother.operationother.fieldNamethis.propertyNamethis.prefixthis.operationthis.fieldNamenew NormalParserAction(...)new PrefixParserAction(...)import ParserDataObject defaultValue;Object testValue;this.defaultValuethis.testValueimport Brokerimport EventHandlerimport InboundConnectionCacheimport ParserDataFactoryimport KeyAddrimport ProfileAddrimport ReferenceAddrimport DefaultIORToSocketInfoImplimport DefaultSocketFactoryImpl/** Initialize the parser data for the standard ORB parser.  This is used both ... */ParserTable.classnew ParserTable(...)String MY_CLASS_NAME;ParserTable myInstance;...[] parserData;ParserData[] parserArraynew ParserData[]parserData.lengthString codeSetTestStringOSFCodeSetRegistry.ISO_646_VALUEOSFCodeSetRegistry.UTF_16_VALUEOSFCodeSetRegistry.ISO_8859_1_VALUEString[] debugTestDataUSLPort[] USLPortsnew USLPort[]new USLPort(...)ReadTimeouts readTimeoutsmakeReadTimeoutsFactory(...)ORBConstants.TRANSPORT_TCP_INITIAL_TIME_TO_WAITORBConstants.TRANSPORT_TCP_MAX_TIME_TO_WAITORBConstants.TRANSPORT_TCP_GIOP_HEADER_MAX_TIME_TO_WAITORBConstants.TRANSPORT_TCP_TIME_TO_WAIT_BACKOFF_FACTORORBInitializer[] TestORBInitializersnew ORBInitializer[]new TestORBInitializer1(...)new TestORBInitializer2(...)StringPair[] TestORBInitDatanew StringPair[]new StringPair(...)Acceptor[] TestAcceptorsnew Acceptor[]new TestAcceptor2(...)new TestAcceptor1(...)StringPair[] TestAcceptorDataStringPair[] TestORBInitRefDataURL testServicesURLString testServicesStringParserData[] pdORBConstants.DEBUG_PROPERTYlistAction(...)stringAction(...)integerAction(...)ORBConstants.SERVER_PORT_PROPERTYORBConstants.ORB_ID_PROPERTYORBConstants.OLD_ORB_ID_PROPERTYORBConstants.ORB_SERVER_ID_PROPERTYsetFlagAction(...)ORBConstants.HIGH_WATER_MARK_PROPERTYORBConstants.LOW_WATER_MARK_PROPERTYORBConstants.NUMBER_TO_RECLAIM_PROPERTYORBConstants.GIOP_VERSIONmakeGVOperation(...)GIOPVersion.DEFAULT_VERSIONORBConstants.GIOP_FRAGMENT_SIZEmakeFSOperation(...)ORBConstants.GIOP_DEFAULT_FRAGMENT_SIZEORBConstants.GIOP_BUFFER_SIZEORBConstants.GIOP_11_BUFFMGRmakeBMGROperation(...)ORBConstants.DEFAULT_GIOP_11_BUFFMGRORBConstants.GIOP_12_BUFFMGRORBConstants.DEFAULT_GIOP_12_BUFFMGRORBConstants.GIOP_TARGET_ADDRESSINGintegerRangeAction(...)convertIntegerToShort(...)ORBConstants.ADDR_DISP_HANDLE_ALLmakeADOperation(...)KeyAddr.valueORBConstants.ALWAYS_SEND_CODESET_CTX_PROPERTYbooleanAction(...)ORBConstants.USE_BOMSORBConstants.DEFAULT_USE_BYTE_ORDER_MARKERSORBConstants.USE_BOMS_IN_ENCAPSORBConstants.DEFAULT_USE_BYTE_ORDER_MARKERS_IN_ENCAPSORBConstants.CHAR_CODESETSmakeCSOperation(...)createFromString(...)ORBConstants.WCHAR_CODESETSORBConstants.ALLOW_LOCAL_OPTIMIZATIONORBConstants.LEGACY_SOCKET_FACTORY_CLASS_PROPERTYmakeLegacySocketFactoryOperation(...)new TestLegacyORBSocketFactory(...)ORBConstants.SOCKET_FACTORY_CLASS_PROPERTYmakeSocketFactoryOperation(...)new DefaultSocketFactoryImpl(...)new TestORBSocketFactory(...)ORBConstants.LISTEN_SOCKET_PROPERTYmakeUSLOperation(...)ORBConstants.IOR_TO_SOCKET_INFO_CLASS_PROPERTYmakeIORToSocketInfoOperation(...)new DefaultIORToSocketInfoImpl(...)new TestIORToSocketInfo(...)ORBConstants.IIOP_PRIMARY_TO_CONTACT_INFO_CLASS_PROPERTYmakeIIOPPrimaryToContactInfoOperation(...)new TestIIOPPrimaryToContactInfo(...)ORBConstants.CONTACT_INFO_LIST_FACTORY_CLASS_PROPERTYmakeContactInfoListFactoryOperation(...)new TestContactInfoListFactory(...)ORBConstants.BAD_SERVER_ID_HANDLER_CLASS_PROPERTYTestBadServerIdHandler.classORBConstants.PI_ORB_INITIALIZER_CLASS_PREFIXmakeROIOperation(...)ORBInitializer.classORBConstants.ACCEPTOR_CLASS_PREFIX_PROPERTYmakeAcceptorInstantiationOperation(...)Acceptor.classORBConstants.ACCEPTOR_SOCKET_TYPE_PROPERTYORBConstants.USE_NIO_SELECT_TO_WAIT_PROPERTYORBConstants.ACCEPTOR_SOCKET_USE_WORKER_THREAD_FOR_EVENT_PROPERTYORBConstants.CONNECTION_SOCKET_TYPE_PROPERTYORBConstants.CONNECTION_SOCKET_USE_WORKER_THREAD_FOR_EVENT_PROPERTYORBConstants.DISABLE_DIRECT_BYTE_BUFFER_USE_PROPERTYORBConstants.TRANSPORT_TCP_READ_TIMEOUTS_PROPERTYmakeTTCPRTOperation(...)ORBConstants.ENABLE_JAVA_SERIALIZATION_PROPERTYORBConstants.USE_REP_IDidentityAction(...)StringPair.classOperation[] fourIopnew Operation[]Operation op2sequenceAction(...)Operation rtOpnew Operation(...) { ... }ParserTable$1Object[] valuesInteger initialTimeInteger maxGIOPHdrTimeInteger maxGIOPBodyTimeInteger backoffPercentOperation ttcprtOpOperation[] siopOperation uslopParserTable$2Integer portOperation op3Operation listenopParserTable$3Map<> mapmakeMapOperation(...)Operation sfopParserTable$4String paramClass<?> legacySocketFactoryClassORBSocketFactory.classParserTable$5Class<?> socketFactoryClassParserTable$6Class<?> iorToSocketInfoClassIORToSocketInfo.classParserTable$7Class<?> iiopPrimaryToContactInfoClassIIOPPrimaryToContactInfo.classParserTable$8Class<?> contactInfoListFactoryClassCorbaContactInfoListFactory.classOperation csopParserTable$9String valOperation admapParserTable$10new Integer[]ProfileAddr.valueReferenceAddr.value...[] map;Operation rangeopOperation op1Operation resultOperation fscheckerParserTable$11int giopFragmentSizeORBConstants.GIOP_FRAGMENT_MINIMUM_SIZEORBConstants.GIOP_FRAGMENT_DIVISOROperation gvHelperOperation gvMainParserTable$12Object[] numsint majorOperation clsopOperation indexOpOperation mopmaskErrorAction(...)Operation mkinstParserTable$13Class<> initClassORBInitializer initializerParserTable$13$1// REVISIT - this is a cut and paste modification of makeROIOperation.ParserTable$14ParserTable$14$1ParserTable$15String[] valuesvalues.length// REVISIT: The test data gets put into a Properties object where// order is not guaranteed.  Thus the above array is in reverse.// propertyName,// operation,// fieldName, defaultValue,// testValue, testData (string or Pair[])// Where did this come from?//ParserDataFactory.make( ORBConstants.INITIAL_PORT_PROPERTY,//OperationFactory.booleanAction(),//"ORBInitialPortInitialized", Boolean.FALSE,//Boolean.TRUE, "27314" ),// NOTE: We are putting SERVER_HOST_NAME configuration info into// DataCollectorBase to avoid a security hole.  However, that forces// us to also set LISTEN_ON_ALL_INTERFACES at the same time.// This all needs to be cleaned up for two reasons: to get configuration// out of DataCollectorBase and to correctly support multihoming.// REVISIT after switch// ParserDataFactory.make( ORBConstants.INITIAL_SERVICES_PROPERTY,// OperationFactory.URLAction(),// "servicesURL", null,// testServicesURL, testServicesString ),// ParserDataFactory.make( ORBConstants.DEFAULT_INIT_REF_PROPERTY,// OperationFactory.stringAction(),// "defaultInitRef", null,// "Fooref", "Fooref" ),// Note that the same property is used to set two different// fields here.  This requires that both entries use the same test// data, or the test will fail.// No default - must be set by user if they are using// legacy socket factory.// Socket/Channel control// Acceptor:// useNIOSelector == true//   useSelectThreadToWait = true//   useWorkerThreadForEvent = false// else//   useSelectThreadToWait = false//   useWorkerThreadForEvent = true// Connection:// For security reasons avoid creating an instance if// this socket factory class is not one that would fail// the class cast anyway.// ClassNotFoundException, IllegalAccessException,// InstantiationException, SecurityException or// ClassCastException// For security reasons avoid creating an instance// if this class is one that would fail the class cast// to ORBInitializer anyway.// Now that we have a class object, instantiate one and// remember it:// Unwrap the exception, as we don't care exc here// Object is String[] of length 2.Class<> componentType;this.componentType/** For each String s that matches the prefix given by getPropertyName(), ... */int prefixLengthList<> matchesString keyString suffixStringPair data// Find all keys in props that start with propertyName// Convert the list into an array of the proper type.// An Object[] as a result does NOT work.  Also report// any errors carefully, as errors here or in parsers that// use this Operation often show up at ORB.init()....[] testData;testData.lengthStringPair spString propNamegetSecond(...)getFirst(...)CacheTable$Entryint val;Entry next;Entry rnext;// this chains the collision list of table "map"// this chains the collision list of table "rmap"boolean noReverseMap;int INITIAL_SIZE;// size must be power of 2int MAX_SIZE;int size;...[] rmap;initTables(...)new Entry[]Entry[] oldMap...<<=...Entry eput_table(...)e.keye.val...^=...moduloTableSize(...)... / ...hash(...)Entry newEntrynewEntry.nextint rindexnewEntry.rnexte.rnext//System.out.println("using new cache table");// now rehash the entries into the new table// these are the "supplemental hash function" copied from// java.util.HashMap, supposed to be "critical"// if we get here we are trying to put in the same key/val pair// this is a no-op, so we just return// this means the key is not present in our table// then it shouldnt be present in our reverse table eitherimport ResourceBundleimport MissingResourceExceptioninitResources(...)getString(...)MissingResourceException ignoreString formatformat(...)boolean resourcesInitialized;ResourceBundle resources;getBundle(...)MissingResourceException e/** Utility for managing mappings from densely allocated integer ... */ArrayList<> list;/** If key >= 0, return the value bound to key, or null if none. ... */checkKey(...)/** If key >= 0, bind value to the key. ... */extend(...)int maxensureCapacity(...)/** A convenience class for retrieving the string value of a system ... */String theProp;String defaultVal;/** Constructor that takes the name of the system property whose ... */this.theProp/** Constructor that takes the name of the system property and the default ... */this.defaultVal/** Determines the string value of the system property whose ... *//** Writes each input byte as a 2 byte hexidecimal output pair making it ... */...[] hex;StringWriter writer;/** Creates a new HexOutputStream. ... *//** Writes a byte. Will block until the byte is actually ... */Hashtable<> fields;/** Get the ObjectStreamClass that describes the fields in the stream. *//** All the Keywords that will be used in Logging Messages for CORBA need to ... */String LIFECYCLE_CREATE;/** * Keywords for Lifecycle Loggers. ... */String LIFECYCLE_INITIALIZE;String LIFECYCLE_SHUTDOWN;String LIFECYCLE_DESTROY;String LIFECYCLE_CREATE_SUCCESS;String LIFECYCLE_CREATE_FAILURE;String LIFECYCLE_INITIALIZE_SUCCESS;String LIFECYCLE_INITIALIZE_FAILURE;String LIFECYCLE_SHUTDOWN_SUCCESS;String LIFECYCLE_SHUTDOWN_FAILURE;String LIFECYCLE_DESTROY_SUCCESS;String LIFECYCLE_DESTROY_FAILURE;String NAMING_RESOLVE;/** * Keywords for Naming Read Loggers. */String NAMING_LIST;String NAMING_RESOLVE_SUCCESS;String NAMING_RESOLVE_FAILURE;String NAMING_LIST_SUCCESS;String NAMING_LIST_FAILURE;String NAMING_BIND;/** * Keywords for Naming Update Loggers. */String NAMING_UNBIND;String NAMING_REBIND;String NAMING_BIND_SUCCESS;String NAMING_BIND_FAILURE;String NAMING_UNBIND_SUCCESS;String NAMING_UNBIND_FAILURE;String NAMING_REBIND_SUCCESS;String NAMING_REBIND_FAILURE;String STRINGIFY_PREFIX;int NEO_FIRST_SERVICE_CONTEXT;// NEO_FIRST_SERVICE_CONTEXT + NUM_NEO_SERVICE_CONTEXTS - 1// NEO_FIRST_SERVICE_CONTEXT to// All NEO service contexts must be in the range/* TAGS ... */int NUM_NEO_SERVICE_CONTEXTS;int TAG_ORB_VERSION;int SUN_TAGGED_COMPONENT_ID_BASE;int SUN_SERVICE_CONTEXT_ID_BASE;int TAG_CONTAINER_ID;// Used by AS 7 for IIOP failover.// Tagged Components Idsint TAG_REQUEST_PARTITIONING_ID;// Used by AS 8.1 for Request Partioningint TAG_JAVA_SERIALIZATION_ID;// TaggedComponentId for Java serialization tagged component.int CONTAINER_ID_SERVICE_CONTEXT;// Service Context Idsint SERVANT_CACHING_POLICY;// the largest legal Sun policy is SUNVMCID.value + 4095.// used for minor codes.  This allows 12 bits of offset, so// All Sun policies are allocated using the SUNVMCID, which is alsoint ZERO_PORT_POLICY;int COPY_OBJECT_POLICY;int REQUEST_PARTITIONING_POLICY;int TOA_SCID;// SCIDs less than FIRST_POA_SCID are JavaIDL SCIDs.// Persistent SCIDs have the second bit as 1.// service/implementation.// These are the subcontract IDs for various qualities ofint DEFAULT_SCID;int FIRST_POA_SCID;int MAX_POA_SCID;int TRANSIENT_SCID;int PERSISTENT_SCID;int SC_TRANSIENT_SCID;int SC_PERSISTENT_SCID;int IISC_TRANSIENT_SCID;int IISC_PERSISTENT_SCID;int MINSC_TRANSIENT_SCID;int MINSC_PERSISTENT_SCID;String ORG_OMG_PREFIX;// since they occur in org.omg.CORBA.ORB.// org.omg.CORBA.ORBSingletonClass are not included here// The well known org.omg.CORBA.ORBClass and// org.omg.CORBA properties must be defined by OMG standards//    where appropriate after the prefix.// 4. proprietary property names should have a subsystem//    in their suffix.// 3. Property names must have "ORB" as the first 3 letters// 2. Property names must have unique suffixes after the last ".".//    ORG_OMG_CORBA_PREFIX or SUN_PREFIX.// 1. Property names must start with either// All ORB properties must follow the following rules:// Constants for ORB properties **************************************************************String ORG_OMG_CORBA_PREFIX;String INITIAL_HOST_PROPERTY;String INITIAL_PORT_PROPERTY;String INITIAL_SERVICES_PROPERTY;String DEFAULT_INIT_REF_PROPERTY;String ORB_INIT_REF_PROPERTY;String SUN_PREFIX;// All of our proprietary properties must start with com.sun.CORBAString ALLOW_LOCAL_OPTIMIZATION;// general propertiesString SERVER_PORT_PROPERTY;String SERVER_HOST_PROPERTY;String ORB_ID_PROPERTY;String OLD_ORB_ID_PROPERTY;// This property is provided for backward compatibility reasonsString ORB_SERVER_ID_PROPERTY;String DEBUG_PROPERTY;String USE_REP_ID;// Property for setting use of repository Ids during serialization.String LISTEN_ON_ALL_INTERFACES;// harder to use.// a user.  That is the reason it has spaces in its name - to make it// NOTE: This is an internal property.  It should never be set byString GIOP_VERSION;// giop related properties - default settings in decimal formString GIOP_FRAGMENT_SIZE;String GIOP_BUFFER_SIZE;String GIOP_11_BUFFMGR;String GIOP_12_BUFFMGR;String GIOP_TARGET_ADDRESSING;int GIOP_DEFAULT_FRAGMENT_SIZE;int GIOP_DEFAULT_BUFFER_SIZE;int DEFAULT_GIOP_11_BUFFMGR;int DEFAULT_GIOP_12_BUFFMGR;//Growingshort ADDR_DISP_OBJKEY;//Streamingshort ADDR_DISP_PROFILE;// object key used for target addressingshort ADDR_DISP_IOR;// iop profile used for target addressingshort ADDR_DISP_HANDLE_ALL;// ior used for target addressingint GIOP_12_MSG_BODY_ALIGNMENT;// LocateReply message bodies must begin on 8 byte boundaries.// state that the GIOP 1.2 RequestMessage, ReplyMessage, and// CORBA formal 00-11-03 sections 15.4.2.2, 15.4.3.2, 15.4.6.2// accept all target addressing dispositions (default)int GIOP_FRAGMENT_DIVISOR;// to GIOP 1.1 fragments, as well.// The GIOP 1.2 fragments must be divisible by 8.  We generalize thisint GIOP_FRAGMENT_MINIMUM_SIZE;String HIGH_WATER_MARK_PROPERTY;// connection management propertiesString LOW_WATER_MARK_PROPERTY;String NUMBER_TO_RECLAIM_PROPERTY;String ACCEPTOR_CLASS_PREFIX_PROPERTY;String CONTACT_INFO_LIST_FACTORY_CLASS_PROPERTY;String LEGACY_SOCKET_FACTORY_CLASS_PROPERTY;// Legacy:String SOCKET_FACTORY_CLASS_PROPERTY;String LISTEN_SOCKET_PROPERTY;String IOR_TO_SOCKET_INFO_CLASS_PROPERTY;String IIOP_PRIMARY_TO_CONTACT_INFO_CLASS_PROPERTY;int REQUEST_PARTITIONING_MIN_THREAD_POOL_ID;// Request partitioning maximum and minimum thread pool id constants.int REQUEST_PARTITIONING_MAX_THREAD_POOL_ID;String TRANSPORT_TCP_READ_TIMEOUTS_PROPERTY;// wait: max read message time to wait:backoff factor>// with syntax <initial time to wait:max read giop header time to// transport read tcp timeout property, colon separated propertyint TRANSPORT_TCP_INITIAL_TIME_TO_WAIT;// tcp read returns 0 bytes// initial time to wait in milliseconds if a transportint TRANSPORT_TCP_MAX_TIME_TO_WAIT;// if a transport tcp read returns 0 bytes// max time to spend in cumulative waits in millisecondsint TRANSPORT_TCP_GIOP_HEADER_MAX_TIME_TO_WAIT;// if a transport tcp read of GIOP header returns 0 bytesint TRANSPORT_TCP_TIME_TO_WAIT_BACKOFF_FACTOR;// wait on a subsequent transport tcp read of 0 bytes// A backoff percentage used to compute the next amount of time toString USE_NIO_SELECT_TO_WAIT_PROPERTY;String ACCEPTOR_SOCKET_TYPE_PROPERTY;// Note: Connections accepted by SocketChannel will be SocketChannel.// "Socket" | "SocketChannel"String ACCEPTOR_SOCKET_USE_WORKER_THREAD_FOR_EVENT_PROPERTY;// Applicable if using SocketChannel and using select thread.String CONNECTION_SOCKET_TYPE_PROPERTY;// Applicable on client-side. "Socket" | "SocketChannel"String CONNECTION_SOCKET_USE_WORKER_THREAD_FOR_EVENT_PROPERTY;// Applicable if using SocketChannel and using select threadString DISABLE_DIRECT_BYTE_BUFFER_USE_PROPERTY;// viewed in most (all?) debuggers.// debugging, because the contents of a direct byte buffer cannot be// Used to disable the use of direct byte buffers.  This enables much easierString SOCKET;String SOCKETCHANNEL;String PERSISTENT_SERVER_PORT_PROPERTY;// POA related policiesString SERVER_ID_PROPERTY;String BAD_SERVER_ID_HANDLER_CLASS_PROPERTY;String ACTIVATED_PROPERTY;String SERVER_NAME_PROPERTY;String SERVER_DEF_VERIFY_PROPERTY;// servers// Server Properties; e.g. when properties passed to ORB activatedString SUN_LC_PREFIX;// This one is an exception, but it may be externally visibleString SUN_LC_VERSION_PREFIX;// Necessary for package renaming to work correctlyString JTS_CLASS_PROPERTY;String ENABLE_JAVA_SERIALIZATION_PROPERTY;// Property for enabling ORB's use of Java serialization.String PI_ORB_INITIALIZER_CLASS_PREFIX;// Constants for ORB prefixes **************************************************************String USE_DYNAMIC_STUB_PROPERTY;String DYNAMIC_STUB_FACTORY_FACTORY_CLASS;int DEFAULT_INITIAL_PORT;// Constants for NameService properties ************************************String DEFAULT_INS_HOST;int DEFAULT_INS_PORT;int DEFAULT_INS_GIOP_MAJOR_VERSION;int DEFAULT_INS_GIOP_MINOR_VERSION;// defines the default GIOP minor version to be 0.// http://www.omg.org/cgi-bin/doc?ptc/00-08-07 [ Section 13.6.7.3 ]// GIOP Version number for validation of INS URL format addresses// Constants for INS properties ********************************************int TRANSIENT;// Name Service Property.// Subcontract's differentiation using the TRANSIENT and PERSISTENTint PERSISTENT;String DB_DIR_PROPERTY;// These properties are never passed on ORB init: they are only passed to ORBD.// Constants for ORBD properties ****************************************************************String DB_PROPERTY;String ORBD_PORT_PROPERTY;String SERVER_POLLING_TIME;String SERVER_STARTUP_DELAY;int DEFAULT_ACTIVATION_PORT;int RI_NAMESERVICE_PORT;// INS request.// passing the RI flag. That would start a Persistent Port to listen to// If RI is starting the NameService then they would indicate that byint DEFAULT_SERVER_POLLING_TIME;int DEFAULT_SERVER_STARTUP_DELAY;String LOG_LEVEL_PROPERTY;//***************** Constants for Logging ****************String LOG_RESOURCE_FILE;String TRANSIENT_NAME_SERVICE_NAME;// Constants for initial references *************************************************************String PERSISTENT_NAME_SERVICE_NAME;String NAME_SERVICE_SERVER_ID;// with NameServer Persistent Server Id// A large Number to make sure that other ServerIds doesn't collideString ROOT_POA_NAME;String POA_CURRENT_NAME;String SERVER_ACTIVATOR_NAME;String SERVER_LOCATOR_NAME;String SERVER_REPOSITORY_NAME;String INITIAL_NAME_SERVICE_NAME;String TRANSACTION_CURRENT_NAME;String DYN_ANY_FACTORY_NAME;String PI_CURRENT_NAME;// New for Portable InterceptorsString CODEC_FACTORY_NAME;String DEFAULT_DB_DIR;// Constants for ORBD DB ***********************************************************************String DEFAULT_DB_NAME;String INITIAL_ORB_DB;String SERVER_LOG_DIR;String ORBID_DIR_BASE;String ORBID_DB_FILE_NAME;int DEFAULT_INACTIVITY_TIMEOUT;// Default value for when inactive threads in the pool can stop running (ms)// Constants for ThreadPool ********************************************************************String THREADPOOL_DEFAULT_NAME;// Default name of the threadpoolString WORKQUEUE_DEFAULT_NAME;// Default name of the workqueueint LEGACY_SUN_NOT_SERIALIZABLE;// create a BAD_PARAM system exception with this minor code.// here for backwards compatibility, but note that the current ORB must never// This is the value that pre-Merlin Sun ORBs incorrectly used.  We preserve this// Constants for minor code bases **************************************************************boolean DEFAULT_ALWAYS_SEND_CODESET_CTX;// those of a first request with other large service contexts.// of failure when fragments of a smaller request are interleved with// If we don't always send the code set context, there's a possibility// Code Set related *******************************************************String ALWAYS_SEND_CODESET_CTX_PROPERTY;boolean DEFAULT_USE_BYTE_ORDER_MARKERS;// GIOP 1.1 due to limitations in the CDR encoding.// Use byte order markers in streams when applicable?  This won't apply toString USE_BOMS;boolean DEFAULT_USE_BYTE_ORDER_MARKERS_IN_ENCAPS;// Use byte order markers in encapsulations when applicable?String USE_BOMS_IN_ENCAPS;String CHAR_CODESETS;// are the only ones that won't get you into trouble.// either of the following properties, but the above assignments// Note:  The ORB will let you assign any of the above values to// UTF-8                   0x05010001// UCS-2                   0x00010100// UTF-16                  0x00010109// wchar/string:// ISO646 (ASCII)          0x00010020// ISO8859-1 (Latin-1)     0x00010001// char/string:// Code sets that we accept currently (see core/OSFCodeSetRegistry):// interpreted as decimal.// Number can be specified as hex if preceded by 0x, otherwise they are// registry numbers.  The first number in the list will be the native code// connection code sets.  The value should be a comma separated list of OSF// The CHAR_CODESETS and WCHAR_CODESETS allow the user to override the defaultString WCHAR_CODESETS;// Constants to make stream format version code easier to readbyte STREAM_FORMAT_VERSION_2;import Characterimport JavaSerializationComponent/** Handy class full of static functions that don't belong in util.Utility for pure ORB reasons. */CORBALogDomains.UTILEnumeration<> keysObject sString rIdString cName...[] members;systemExceptionMembers(...)StructMember[] systemExceptionMembers/** Static method for writing a CORBA standard exception to an Any. ... */getSystemExceptionTypeCode(...)isSystemExceptionTypeCode(...)readSystemException(...)/** Return default ValueHandler */new PrivilegedExceptionAction<ValueHandler>(...) { ... }ORBUtility$1PrivilegedActionException e/** Returns true if it was accurately determined that the remote ORB is ... *//** Unmarshal a byte array to an integer. ... *//** Marshal an integer to a byte array. ... *//** Converts an Ascii Character into Hexadecimal digit *//** Static method for writing a CORBA standard exception to a stream. ... */// method moved from util.Utility/** Static method for reading a CORBA standard exception from a stream. ... */classNameOf(...)/** Get the class name corresponding to a particular repository Id. ... *//** Return true if this repositoryId is a SystemException. ... */isJavaSerializationEnabled(...)IIOPProfile profIIOPProfileTemplate profTempJavaSerializationComponent jcbyte jcVersionjavaSerializationVersion(...)/** Get the repository id corresponding to a particular class. ... */Hashtable<> exceptionClassNames;Hashtable<> exceptionRepositoryIds;/** Parse a version string such as "1.1.6" or "jdk1.2fcs" into ... */char[] sint endint[] vals.length/** Compare two version arrays. ... */v1.lengthv2.length/** Compare two version strings. ... */compareVersion(...)parseVersion(...)// we need a short unambiguous name for such threads.// useful on the server side, where there are many SelectReaderThreads, and// Return a compressed representation of the thread name.  This is particularlyint numTokensString[] tokensgetMethodName(...)compressClassName(...)isNativeMethod(...)getFileName(...)getLineNumber(...)trace.lengthformatStackTraceElement(...)// Implements all dprint calls in this package.getThreadName(...)new Throwable(...)getStackTrace(...)arr1.lengtharr2.length/** Throws the CORBA equivalent of a java.io.NotSerializableException ... *//** Returns the maximum stream format version supported by our ... */ORBUtility$2/** This method is used to create untyped object references. */Object objectImpl/** This method obtains an IOR from a CORBA object reference. ... *//** Obtains an IOR for the object reference obj, first connecting it to ... */IOR resultBAD_OPERATION bopRemoteException excisJavaIdentifierStart(...)isDigit(...)Character.MODIFIER_SYMBOLCharacter.DASH_PUNCTUATIONCharacter.MATH_SYMBOLCharacter.OTHER_PUNCTUATIONCharacter.START_PUNCTUATIONCharacter.END_PUNCTUATIONORBUtility$3getPolicy(...)PermissionCollection pcgetPermissions(...)/* Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved. ... */// Is Java serialization enabled?// Check the JavaSerializationComponent (tagged component)// in the IIOPProfile. If present, the peer ORB's GIOP is capable// of using Java serialization instead of CDR serialization.// In such a case, use Java serialization, iff the java serialization// versions match.// throw error?// Since encodingVersion is <= 0 (CDR_ENC_VERSION).// default// construct repositoryId -> className hashtable// SystemExceptions from OMG Transactions Service Spec// from portability RTF 98-07-01.txt// from orbrev/00-09-01 (CORBA 2.4 Draft Specification)// Exception types introduced between CORBA 2.4 and 3.0// Exception types introduced in CORBA 3.0// construct className -> repositoryId hashtable//find the maximum span of the string "n.n.n..." where n is an integer//no digit found//cases like "n." or "n..m"//convert equivalent to "n.0" or "n.0.m"//v1 is longer or greater than v2// Note that this must end in . in order to be renamed correctly.// This depends on the formatting in SelectReaderThread and CorbaConnectionImpl.// Pattern for SelectReaderThreads:// SelectReaderThread CorbaConnectionImpl[ <host> <post> <state>]// Any other pattern in the Thread's name is just returned.// print the stack trace, ommitting the zeroth element, which is// always this method.// This is our code, but the ContactInfoList is not a// CorbaContactInfoList.  This should not happen, because// we are in the CORBA application of the DCSA framework.// This is a coding error, and thus an INTERNAL exception// should be thrown.// XXX needs minor code// obj is implemented by a foreign ORB, because the Delegate is not a// ClientDelegate.// XXX this case could be handled by marshalling and// unmarshalling.  However, object_to_string cannot be used// here, as it is implemented with getIOR.  Note that this// will require access to an ORB, so that we can create streams// as needed.  The ORB is available simply as io._orb().// Letters and $ _// ` ^// -// = ~ + | < >// !@#%&*;':",./?// ( [ {// ) ] }// Returns a String which looks similar to:// PermissionCollection java.security.Permissions@1053693 ...// (java.io.FilePermission <<ALL FILES>> ....)// (java.io.FilePermission /export0/sunwappserv/lib/- ...)// ... other permissions ...// Domain ProtectionDomain  (file:/export0/sunwappserv/lib-)// java.security.Permissions@141fedb (// (java.io.FilePermission <<ALL FILES>> ...)// (java.io.FilePermission /var/tmp//- ...)// Don't need to add 'Protection Domain' string, it's// in ProtectionDomain.toString() already.// no need to lookup the ObjectStreamClass// writeObject method was not being checked at all, so there is// maintained here for backward compatability with JDK 1.3, wherelong csuidgetSerialVersion(...)// declarations, and compute it for all others// up suid only for classes with private,static,final// to maintain same suid as the JDK 1.3, we pickObjectStreamClassUtil_1_3$1long suidint minimumboolean hasWriteObjectFlagClass<>[] argsMethod hasWriteObjectMethodObjectStreamClassUtil_1_3$CompareClassByNameClass<> c1Class<> c2ObjectStreamClassUtil_1_3$CompareMemberByNameObjectStreamClassUtil_1_3$2ObjectStreamClassUtil_1_3$MethodSignature// private static native boolean hasStaticInitializer(Class cl);// use java.io.ObjectStream's hasStaticInitializer methodClass<> classWithThisMethodObjectStreamClassUtil_1_3$3/* Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved. ... */// for computing the structural UID// for non-serializable/proxy classes//} catch (IllegalAccessException ex) {//     suid = _computeSerialVersionUID(cl);//In the old case, for the caller class, the write Method wasn't considered// for rep-id calculations correctly, but for parent classes it was taken// into account.  That is the reason there is the klude of getting the write// Object method in there// need to find the java replacement for hasStaticInitializer//if (!Modifier.isPrivate(mods) ||//    Modifier.isStatic(mods)) {//    method = null;// Since it is alright if methodName does not exist,// no need to do anything special here./** A ObjectStreamClass_1_3_1 describes a class that can be serialized to a stream ... *//** This is duplicated here to preserve the JDK 1.3.1FCS behavior ... */Hashtable<> translatedFields;ObjectStreamClass_1_3_1 descObjectStreamClass_1_3_1 superdescnew ObjectStreamClass_1_3_1(...)ObjectStreamClass_1_3_1 theosc/** Return a string describing this ObjectStreamClass_1_3_1. *//* Create a new ObjectStreamClass_1_3_1 from a loaded class. ... */ObjectStreamClass_1_3_1$1ObjectStreamField[] fObjectStreamClass_1_3_1$2NoSuchMethodException e2Class<?>[] args/* Create an empty ObjectStreamClass_1_3_1 for a class about to be read. ... */Object[] translationClass<?> osfClassObjectStreamField.classObject[] argClass<?>[] typesConstructor<> constructorobjs.lengthnew NoSuchFieldException(...)/* Return the ObjectStreamClass_1_3_1 of the local class this one is based on. */int numNonNullFieldsnew Field[]int fieldNum/* insertDescriptorFor a Class -> ObjectStreamClass_1_3_1 mapping. */ObjectStreamClass_1_3_1$3ObjectStreamClass_1_3_1 superclass;boolean hasWriteObjectMethod;/* True if this class has/had a writeObject method */ObjectStreamClass_1_3_1 localClassDesc;/* ObjectStreamClass_1_3_1 that this one was built from. */// private static native long getSerialVersionUIDField(Class cl);/* Get the private static final field for serial version UID */ObjectStreamClass_1_3_1$ObjectStreamClassEntry/* Entries held in the Cache of known ObjectStreamClass_1_3_1 objects. ... */ObjectStreamClass_1_3_1 c;ObjectStreamClass_1_3_1$CompareClassByNameObjectStreamClass_1_3_1$CompareMemberByNameObjectStreamClass_1_3_1$MethodSignature/* Copyright (c) 2001, 2014, Oracle and/or its affiliates. All rights reserved. ... */// already initialized// serial bug 7; the serialPersistentFields were not// being read and stored as Accessible bit was not set// serial bug 7; need to find if the field is of type// java.io.ObjectStreamField/* Thrown if a field serialPersistentField exists ... */// type and cache it in the ObjectStreamClass_1_3_1 for that field.// reflField.setAccessible(true);// get rid of native code// suid = getSerialVersionUIDField(cl);/* Cache lookup of writeObject and readObject for ... */// Method must be private and non-static/* Look for the readObject method ... */// Compute the structural UID.  This must be done after the// calculation for writeObject.  Fixed 4/20/2000, eea1// SerialBug 2: to have correct value in RepId// Field[] field = ObjectStreamClass_1_3_1.getDeclaredFields(cl);// Must make sure that the Field array we allocate// below is exactly the right size.  Bug fix for// 4397133.//Serial 6//if (Modifier.isTransient(m) || Modifier.isStatic(m))// spec reference 00-01-06.pdf, 1.3.5.6, states non-static// non-transient, public fields are mapped to Java IDL.// Here's the quote from the first paragraph:// Java non-static non-transient public fields are mapped to// OMG IDL public data members, and other Java fields are// not mapped.// if (Modifier.isTransient(m) || Modifier.isStatic(m))//     continue;/** This is duplicated here somewhat in haste since we can't ... *//* Returns the Field ID ... */// the next 3 things are RMI-IIOP specific, it can be easily// private static native long getFieldIDNative(Class c, String fieldName, String fieldSig);import Entryimport IdentityHashMap/** If arr1 and arr2 are both arrays of the same component type, ... */Class<> comp1Class<> comp2int len1getLength(...)int len2new IndentingObjectWriter(...)new SimpleObjectWriter(...)StringBuffer result;//=================================================================================================// ImplementationClass<> compClassboolean[] arrarr.lengthbyte.classshort.classshort[] arrint.classint[] arrlong.classlong[] arrchar.classchar[] arrfloat.classfloat[] arrdouble.classdouble[] arrObject[] arrObjectWriter$IndentingObjectWriter/** Expected patterns: ... */int level;int increment;this.levelthis.incrementstartLine(...)char[] fillfill(...)appendObjectHeader(...)ObjectWriter$SimpleObjectWriter// array of objectimport TypeMismatchException/** Delegates to the current RepositoryId implementation in ... */// RepositoryIdFactory methodsnew RepIdDelegator(...)// RepositoryIdUtility methodsRepositoryId.kClassDescValueRepIDRepositoryId.kWStringValueRepIDRepositoryId.kPreComputed_StandardRMIChunked_NoRepRepositoryId.kPreComputed_CodeBaseRMIChunked_NoRepRepositoryId.kPreComputed_StandardRMIChunkedRepositoryId.kPreComputed_CodeBaseRMIChunkedRepositoryId.kPreComputed_StandardRMIUnchunkedRepositoryId.kPreComputed_CodeBaseRMIUnchunkedRepositoryId.kPreComputed_StandardRMIUnchunked_NoRepRepositoryId.kPreComputed_CodeBaseRMIUnchunked_NoRep// RepositoryIdInterface methods// Constructor used for factory/utility cases// RepositoryId methods will use the provided delegate.// Constructor used by getIdFromString.  All non-staticRepositoryId delegate;RepIdDelegator currentDelegator;/** Returns the latest version RepositoryIdStrings instance *//** Returns the latest version RepositoryIdUtility instance *//** Methods on specific instances of RepositoryId.  Hides ... *//* Copyright (c) 2000, 2002, Oracle and/or its affiliates. All rights reserved. ... *//** Factory methods for creating various repository ID strings ... *//** Utility methods for working with repository IDs. */RepositoryId.kNoTypeInfoRepositoryId.kSingleRepTypeInfoRepositoryId.kPartialListTypeInfoint NO_TYPE_INFO;// to eliminate awkardness when using this interface.// RepositoryId_1_3, but provide the constants again here// These are currently the same in both RepositoryId andint SINGLE_REP_TYPE_INFO;int PARTIAL_LIST_TYPE_INFO;// tag.// Determine how many (if any) repository IDs follow the value// Accessors for precomputed value tags// java.util.Stack is thread-safe, negatively impacting performance.// We implement a Stack here instead of using java.util.Stack because// The stack for RequestInfo objects.int top;// Tests if this stack is empty.// Looks at the object at the top of this stack without removing itnew EmptyStackException(...)// object as the value of this function.// Removes the object at the top of this stack and returns thatint newSizeObject[] newData// Pushes an item onto the top of the stackensure(...)boolean evaluated;Closure closure;this.evaluatedthis.closure/** This class is designed for fans of POSIX pthreads programming. ... */boolean debug_;Sync mutex_;/** The mutex * */ReentrantMutex remutex_;releaseAll(...)acquireAll(...)/** Create a new CondVar that relies on the given mutual ... *//** Wait for notification. This operation at least momentarily ... */interrupted(...)new InterruptedException(...)dprintTrace(...)releaseMutex(...)acquireMutex(...)/** Wait for at most msecs for notification. ... */long start/** Notify a waiting thread. ... *//** Notify all waiting threads * *//* File: ConditionVariable.java ... */// Must ignore interrupt on re-acquireboolean inuse_;/** The lock status * */Thread holder_;long waitTime/* File: Mutex.java ... *//** A simple non-reentrant mutual exclusion lock. ... *//** The thread holding the lock * */int counter_;/** number of times thread has acquired the lock * *//** A simple reentrant mutual exclusion lock. ... */// This can't happen, but make sure anyway/** Main interface for locks, gates, and conditions. ... *//** Wait (possibly forever) until successful passage. ... *//** Wait at most msecs to pass; report whether passed. ... *//** Potentially enable others to pass. ... */long ONE_SECOND;/** One second, in milliseconds; convenient as a time-out value * */long ONE_MINUTE;/** One minute, in milliseconds; convenient as a time-out value * */long ONE_HOUR;/** One hour, in milliseconds; convenient as a time-out value * */long ONE_DAY;/** One day, in milliseconds; convenient as a time-out value * */long ONE_WEEK;/** One week, in milliseconds; convenient as a time-out value * */long ONE_YEAR;// The value used is the same as in java.util.GregorianCalendar// standard sources about value at msec precision.// Not that it matters, but there is some variation across/** One year in milliseconds; convenient as a time-out value  * */long ONE_CENTURY;/** One century in milliseconds; convenient as a time-out value * *//* File: Sync.java ... *//** Method to acquire a Sync without ever throwing an ... */boolean heldGuardedAction$1Guard.Result.ENABLEDGuard trueGuard;Guard guard;Action action;State nextState;this.guardthis.actionthis.nextStateString toStringName;// Return just the name of the class, not the full qualified name.String fqngetPreferredClassName(...)import GuardedAction/** Encodes the state transition function for a finite state machine. ... */StateEngineImpl$1Action emptyAction;// An action that does nothing at all.boolean initializing;Action defaultAction;StateEngineImpl$2StateImpl oldStateImplGuardedAction ganew GuardedAction(...)mustBeInitializing(...)addGuardedAction(...)GuardedAction tasetDefaultAction(...)setDefaultNextState(...)innerDoIt(...)StateImpl nextStategetDefaultNextState(...)Action actiongetDefaultAction(...)StateImpl currentStateboolean deferralSet<> gasgetGuardedActions(...)Result grgetGuard(...)getNextState(...)getAction(...)performStateTransition(...)boolean differentpostAction(...)preAction(...)internalSetState(...)mustNotBeInitializing(...)new FSMImpl(...)// optimize FSM here if desired.  For example,// we could choose different strategies for implementing// the state transition function based on the distribution// of values for states and input labels.// This method is present only for debugging.// innerDoIt does the actual transition.// Use the currentState defaults if// set, otherwise use the state engine default.// The state engine default never changes the state// Locals needed for performing the state transition, once we determine// the required transition.// Do until no guard has deferred.// clear this after each deferral!// Search for a guard that is not DISABLED.// All DISABLED means use defaults.// ga has the next state and action.// Perform the state transition.  Pre and post actions are only// performed if the state changes (see UML hidden transitions).// Note that action may be null in a transition, which simply// means that no action is needed.  Note that action.doIt may// throw an exception, in which case the exception is// propagated after making sure that the transition is properly// completed.// end of StateEngineImpl.java// Set<Node>/* Set<Node> */import AbstractSetMap<> nodeToData;// Required for AbstractSet/** ******************************************************************************** *//** ********** AbstractSet implementation ****************************************** */Node nodeNodeData ndnew NodeData(...)entrySet(...)Map<>.Entry<>Entry<> entry// traversal.// visitor is allowed to modify the graph during the// This visits every node in the graph exactly once.  Aboolean doneEntry<>[] entriesnew Entry<>[]entries.lengthEntry<> currentisVisited(...)visited(...)visit(...)visitAll(...)new NodeVisitor(...) { ... }GraphImpl$1getChildren(...)Node childNodeData cndgetNodeData(...)notRoot(...)isRoot(...)clearNodeData(...)markNonRoots(...)collectRootSet(...)/* Map<Node,NodeData> */// obj must be a Node// Clear every node// Repeat the traversal until every node has been visited.  Since// it takes one pass to determine whether or not each node has// already been visited, this loop always runs at least once.// Copy entries to array to avoid concurrent modification// problem with iterator if the visitor is updating the graph.// Visit each node in the graph that has not already been visited.// If any node is visited in this pass, we must run at least one more// pass.// Iterator<Node>// Make sure the child is in the graph so it can be// visited later if necessary.// Mark the child as a non-root, since a child is never a root./** Node in a graph. *//** Get all the children of this node. *//** Data about a node in a graph. */boolean visited;boolean root;this.visitedthis.root/** Return whether this node has been visited in a traversal. ... *//** Return whether this node is a root. */import Closeableimport AtomicIntegerimport AtomicLongimport NoSuchWorkQueueExceptionimport ThreadPoolimport Workimport WorkQueueimport WorkQueueImplimport MonitoringConstantsimport LongMonitoredAttributeBasenew AtomicLong(...)new ArrayList<WorkerThread>(...)new AtomicInteger(...)AtomicInteger threadCounter;// serial counter useful for debuggingWorkQueue workQueue;// those values must synchronized on this ThreadPool's WorkQueue.// call to a method in this ThreadPool. If any call to update or access// updates and accesses these values directly and indirectly though a// expected that this ThreadPool's WorkQueue is the only object that// or accessed this ThreadPool's WorkQueue must be locked. And, it is// Any time currentThreadCount and/or availableWorkerThreads is updatedint availableWorkerThreads;// Stores the number of available worker threadsint currentThreadCount;// Stores the number of threads in the threadpool currentlyint minWorkerThreads;// Minimum number of worker threads created at instantiation of the threadpoolint maxWorkerThreads;// Maximum number of worker threads in the threadpoollong inactivityTimeout;// Inactivity timeout value for worker threads to exit and stop runningboolean boundedThreadPool;// Indicates if the threadpool is bounded or unboundedAtomicLong processedCount;// averageWorkCompletionTime()// Set the value to 1 so that divide by zero is avoided in// Running count of the work items processedAtomicLong totalTimeTaken;// processed by the threads in the threadpool// Running aggregate of the time taken in millis to execute work items// Name of the ThreadPoolMonitoredObject threadpoolMonitoredObject;// MonitoredObject for ThreadPoolThreadGroup threadGroup;// ThreadGroup in which threads should be createdObject workersLock;List<WorkerThread> workers;/** This constructor is used to create an unbounded threadpool */ORBConstants.DEFAULT_INACTIVITY_TIMEOUTInteger.MAX_VALUEnew WorkQueueImpl(...)initializeMonitoring(...)/** This constructor is used to create an unbounded threadpool ... */getThreadGroup(...)/** This constructor is used to create bounded threadpool */createWorkerThread(...)// Note that this method should not return until AFTER all threads have died.List<WorkerThread> copyWorkerThread wtThread.State.TERMINATEDThread.Statejoin(...)// Setup monitoring for this threadpoolMonitoredObject rootgetRootMonitoredObject(...)createMonitoringManager(...)MonitoringConstants.DEFAULT_MONITORING_ROOTMonitoredObject threadPoolMonitoringObjectRootgetChild(...)MonitoringConstants.THREADPOOL_MONITORING_ROOTLongMonitoredAttributeBase b1new LongMonitoredAttributeBase(...) { ... }ThreadPoolImpl$1MonitoringConstants.THREADPOOL_CURRENT_NUMBER_OF_THREADSMonitoringConstants.THREADPOOL_CURRENT_NUMBER_OF_THREADS_DESCRIPTIONcurrentNumberOfThreads(...)ThreadPoolImpl.thisLongMonitoredAttributeBase b2ThreadPoolImpl$2MonitoringConstants.THREADPOOL_NUMBER_OF_AVAILABLE_THREADSnumberOfAvailableThreads(...)LongMonitoredAttributeBase b3ThreadPoolImpl$3MonitoringConstants.THREADPOOL_NUMBER_OF_BUSY_THREADSMonitoringConstants.THREADPOOL_NUMBER_OF_BUSY_THREADS_DESCRIPTIONnumberOfBusyThreads(...)LongMonitoredAttributeBase b4ThreadPoolImpl$4MonitoringConstants.THREADPOOL_AVERAGE_WORK_COMPLETION_TIMEMonitoringConstants.THREADPOOL_AVERAGE_WORK_COMPLETION_TIME_DESCRIPTIONaverageWorkCompletionTime(...)LongMonitoredAttributeBase b5ThreadPoolImpl$5MonitoringConstants.THREADPOOL_CURRENT_PROCESSED_COUNTMonitoringConstants.THREADPOOL_CURRENT_PROCESSED_COUNT_DESCRIPTIONcurrentProcessedCount(...)MonitoringConstants.THREADPOOL_MONITORING_ROOT_DESCRIPTIONaddChild(...)MonitoringConstants.THREADPOOL_MONITORING_DESCRIPTIONaddAttribute(...)getMonitoredObject(...)// class// Package private method to get the monitored object for thisnew NoSuchWorkQueueException(...)/** To be called from the workqueue when work is added to the ... */workItemsInQueue(...)WorkerThread threadnew WorkerThread(...)/** To be called from the workqueue to create worker threads when none ... */createWorkerThreadHelper(...)ThreadPoolImpl$6decrementCurrentNumberOfThreads(...)incrementCurrentNumberOfThreads(...)/** This method will return the number of WorkQueues serviced by the threadpool. */incrementAndGet(...)ThreadPoolImpl.threadCounter/** This method will decrement the number of available threads ... *//** This method will increment the number of available threads ... */ThreadPoolImpl$WorkerThreadWork currentWork;int threadId;boolean closeCalled;// unique id for the threadString threadPoolName;StringBuffer workerThreadName;// name seen by Thread.getName()this.threadIdgetUniqueThreadId(...)this.threadPoolNamesetName(...)composeWorkerThreadName(...)long elapsedTimedoWork(...)addAndGet(...)requestWork(...)performWork(...)resetClassLoader(...)setLength(...)// Copy to avoid concurrent modification problems.// Get root monitored object// Create the threadpool monitoring root// Add the monitored object for the WorkQueue// Thread creation needs to be in a doPrivileged block// if there is a non-null security manager for two reasons:// 1. The creation of a thread in a specific ThreadGroup//    is a privileged operation.  Lack of a doPrivileged//    block here causes an AccessControlException//    (see bug 6268145).// 2. We want to make sure that the permissions associated//    with this thread do NOT include the permissions of//    the current thread that is calling this method.//    This leads to problems in the app server where//    some threads in the ThreadPool randomly get//    bad permissions, leading to unpredictable//    permission errors (see bug 6021011).//    A Java thread contains a stack of call frames,//    one for each method called that has not yet returned.//    Each method comes from a particular class.  The class//    was loaded by a ClassLoader which has an associated//    CodeSource, and this determines the Permissions//    for all methods in that class.  The current//    Permissions for the thread are the intersection of//    all Permissions for the methods on the stack.//    This is part of the Security Context of the thread.//    When a thread creates a new thread, the new thread//    inherits the security context of the old thread.//    This is bad in a ThreadPool, because different//    creators of threads may have different security contexts.//    This leads to occasional unpredictable errors when//    a thread is re-used in a different security context.//    Avoiding this problem is simple: just do the thread//    creation in a doPrivileged block.  This sets the//    inherited security context to that of the code source//    for the ORB code itself, which contains all permissions//    in either Java SE or Java EE.// The thread must be set to a daemon thread so the// VM can exit if the only threads left are PooledThreads// or other daemons.  We don't want to rely on the// calling thread always being a daemon.// Note that no exception is possible here since we// are inside the doPrivileged block.// If we get here, we need to create a thread.// Decrementing the count of current worker threads.// But, it will be increased in the finally block.// set currentWork to null so that the work item can be// garbage collected without waiting for the next work item.// This should not be possible// End of WorkerThread classimport NoSuchThreadPoolExceptionimport ThreadPoolChooserimport ThreadPoolImplThreadPool threadPool;new ThreadPoolImpl(...)ORBConstants.THREADPOOL_DEFAULT_NAMEAtomicInteger tgCount;ThreadGroup tgnew PrivilegedAction<ThreadGroup>(...) { ... }ThreadPoolManagerImpl$1ThreadGroup ptggetParent(...)new ThreadGroup(...)getAndIncrement(...)boolean isDestroyedisDestroyed(...)int numThreadsactiveCount(...)int numGroupsactiveGroupCount(...)IllegalThreadStateException exc/** This method will return an instance of the threadpool given a threadpoolId, ... *//** This method will return an instance of the threadpool given a numeric threadpoolId. ... *//** This method is used to return the numeric id of the threadpool, given a String ... *//** Return a String Id for a numericId of a threadpool managed by the threadpool ... *//** Returns the first instance of ThreadPool in the ThreadPoolManager *//** Return an instance of ThreadPoolChooser based on the componentId that was ... *//** Return an instance of ThreadPoolChooser based on the componentIndex that was ... *//** Sets a ThreadPoolChooser for a particular componentId in the ThreadPoolManager. This ... *//** Gets the numeric index associated with the componentId specified for a ... */// See bugs 4916766 and 4936203// We intend to create new threads in a reliable thread group.// This avoids problems if the application/applet// creates a thread group, makes JavaIDL calls which create a new// connection and ReaderThread, and then destroys the thread// group. If our ReaderThreads were to be part of such destroyed thread// group then it might get killed and cause other invoking threads// sharing the same connection to get a non-restartable// CommunicationFailure. We'd like to avoid that.// Our solution is to create all of our threads in the highest thread// group that we have access to, given our own security clearance.// try to get a thread group that's as high in the threadgroup// parent-child hierarchy, as we can get to.// this will prevent an ORB thread created during applet-init from// being killed when an applet dies.// Discontinue going higher on a security exception.// something wrong, we go back to the original code//FIXME: This method is not used, but should be fixed once//nio select starts working and we start using ThreadPoolChooserThreadPool workerThreadPool;LinkedList<> theWorkQueue;long workItemsAdded;long workItemsDequeued;// Initialized to 1 to avoid divide by zero in averageTimeInQueue()long totalTimeInQueue;// Name of the work queueMonitoredObject workqueueMonitoredObject;// MonitoredObject for work queueORBConstants.WORKQUEUE_DEFAULT_NAMEthis.workerThreadPool// Setup monitoring for this workqueueWorkQueueImpl$1MonitoringConstants.WORKQUEUE_TOTAL_WORK_ITEMS_ADDEDMonitoringConstants.WORKQUEUE_TOTAL_WORK_ITEMS_ADDED_DESCRIPTIONtotalWorkItemsAdded(...)WorkQueueImpl.thisWorkQueueImpl$2MonitoringConstants.WORKQUEUE_WORK_ITEMS_IN_QUEUEMonitoringConstants.WORKQUEUE_WORK_ITEMS_IN_QUEUE_DESCRIPTIONWorkQueueImpl$3MonitoringConstants.WORKQUEUE_AVERAGE_TIME_IN_QUEUEMonitoringConstants.WORKQUEUE_AVERAGE_TIME_IN_QUEUE_DESCRIPTIONaverageTimeInQueue(...)MonitoringConstants.WORKQUEUE_MONITORING_DESCRIPTIONsetEnqueueTime(...)notifyForAvailableWork(...)Work workItemincrementNumberOfAvailableThreads(...)getEnqueueTime(...)decrementNumberOfAvailableThreads(...)long remainingWaitTimelong finishTimenew TimeoutException(...)InterruptedException ie/** Returns the total number of Work items added to the Queue. ... *//** Returns the total number of Work items in the Queue to be processed ... *//** This class controls the use of dynamic proxies. ... *//** Creates a new DynamicAccessPermission with the specified name. ... *///private static final long serialVersionUID = -8343910153355041693L;/** Creates a new DynamicAccessPermission object with the specified name. ... *//* Copyright (c) 2006, Oracle and/or its affiliates. All rights reserved. ... */import DynamicMethodMarshallernew ReaderWriterBase(...) { ... }DynamicMethodMarshallerImpl$1Boolean valDynamicMethodMarshallerImpl$2Byte valDynamicMethodMarshallerImpl$3Character valDynamicMethodMarshallerImpl$4Short valDynamicMethodMarshallerImpl$5Integer valDynamicMethodMarshallerImpl$6Long valDynamicMethodMarshallerImpl$7Float valDynamicMethodMarshallerImpl$8Double valDynamicMethodMarshallerImpl$9DynamicMethodMarshallerImpl$10DynamicMethodMarshallerImpl$11Method method;ExceptionHandler ehandler;boolean hasArguments;boolean hasVoidResult;boolean needsArgumentCopy;boolean needsResultCopy;// true if copyObjects call needs for args...[] argRWs;// true if copyObject call needs for resultReaderWriter resultRW;// Then return whether cls is an RMI-IIOP abstract interface.// !org.omg.CORBA.Object.class.isAssignableFrom( cls ).// Assume that cls is not Remote, !isAnyClass(cls), andallMethodsThrowRemoteException(...)throwsRemote(...)Class<>[] exceptionTypesexceptionTypes.lengthClass<> exceptionTypeDynamicMethodMarshallerImpl$ReaderWriterBaseReaderWriter booleanRW;ReaderWriter byteRW;ReaderWriter charRW;ReaderWriter shortRW;ReaderWriter intRW;ReaderWriter longRW;ReaderWriter floatRW;ReaderWriter doubleRW;ReaderWriter corbaObjectRW;ReaderWriter anyRW;ReaderWriter abstractInterfaceRW;DynamicMethodMarshallerImpl$12DynamicMethodMarshallerImpl$13isAnyClass(...)DynamicMethodMarshallerImpl$14Class<> resultTypethis.methodnew ExceptionHandlerImpl(...)argTypes.lengthnew ReaderWriter[]makeReaderWriter(...)void.classcopyObjects(...)Object[] resultargRWs.lengthisDeclaredException(...)writeException(...)readException(...)// Either cls is an interface that extends IDLEntity, or else// cls does not extend java.rmi.Remote and all of its methods// throw RemoteException.// Check that all methods (other than those declared in java.lang.Object)// throw an exception that is a subclass of RemoteException.// Check that some exceptionType is a subclass of RemoteException// For anything else, just read it as a value type.// This could be further optimized to avoid// copying if argTypes contains at most one// immutable object type.import ObjectImplimport InvocationHandlerFactoryimport DynamicStub// XXX Do we need _get_codebase?...[] typeIds;DynamicStub self;// The actual DynamicProxy for this stub.this.selfthis.typeIds_ids(...)_is_local(...)getRepositoryId(...)String cnamePresentationManager pmgetPresentationManager(...)PresentationManager.ClassDataClassData classDatagetClassData(...)InvocationHandlerFactoryImpl ihfactorygetInvocationHandlerFactory(...)ClassNotFoundException excgetInvocationHandler(...)// XXX Should probably only allow this once.// XXX log this/** Return true iff cls is an exception class that is ... *//** Write the exception ex to os.  ex must be assignment ... *//** Read the exception contained in the InputStream ... */...[] rws;///////////////////////////////////////////////////////////////////////////////// Used to read and write exceptions.// ExceptionRW interface and implementations.ExceptionHandlerImpl$ExceptionRWBaseClass<> cls;this.clsExceptionHandlerImpl$ExceptionRWIDLImplMethod readMethod;Method writeMethod;String helperNameClassLoader loaderMethod idMethodgetExceptionId(...)getExceptionClass(...)new ExceptionRW[]ExceptionRW erwUserException.classnew ExceptionRWIDLImpl(...)new ExceptionRWRMIImpl(...)rws.lengthClass<> nextString ridfindDeclaredException(...)String excNameException res// This is here just for the dynamicrmiiiop test/* Copyright (c) 2003, 2010, Oracle and/or its affiliates. All rights reserved. ... */// read and ignore!/* The following check is not performed ... */// This may occur when rws has not been fully// populated, in which case the search should just fail.// Note that the exception ID is present in both ae// and in the input stream from ae.  The exception// reader must actually read the exception ID fromimport IDLNameTranslatorimport IDLTypeExceptionimport IDLTypesUtil/** Bidirectional translator between RMI-IIOP interface methods and ... */IDL_KEYWORDS.lengthString nextString keywordAllCaps...[] IDL_KEYWORDS;// will be case insensitive also.// insensitive, java identifier comparisons to these// Note that since all IDL identifiers are case// From CORBA Spec, Table 6 Keywords....[] HEX_DIGITS;String UNDERSCORE;String INNER_CLASS_SEPARATOR;// used to mangle java inner class names...[] BASE_IDL_ARRAY_MODULE_TYPE;// used to form IDL array type namesString BASE_IDL_ARRAY_ELEMENT_TYPE;String LEADING_UNDERSCORE_CHAR;// used to mangling java identifiers that have a leading underscoreString ID_CONTAINER_CLASH_CHAR;String OVERLOADED_TYPE_SEPARATOR;// separator used between types in a mangled overloaded method nameString ATTRIBUTE_METHOD_CLASH_MANGLE_CHARS;// string appended to attribute if it clashes with a method nameString GET_ATTRIBUTE_PREFIX;// IDL names.// strings prepended to the attribute names in order to form theirString SET_ATTRIBUTE_PREFIX;String IS_ATTRIBUTE_PREFIX;Set<> idlKeywords_;...[] interf_;// Remote interface for name translation.// Instance stateMap<> methodToIDLNameMap_;// synchronized since the translation is never modified after// Maps used to hold name translations.  These do not need to beMap<> IDLNameToMethodMap_;...[] methods_;/** Return an IDLNameTranslator for the given interface. ... */new IDLNameTranslatorImpl(...)/** Return an IDLNameTranslator for the given interfacex. ... */IDLType itypeclassToIDLType(...)getExceptionName(...)/** Initialize an IDLNameTranslator for the given interface. ... */SecurityManager scheckPermission(...)new DynamicAccessPermission(...)IDLTypesUtil idlTypesUtilnew IDLTypesUtil(...)validateRemoteInterface(...)buildNameTranslation(...)IDLTypeException iteMap<> allMethodInfointerf_.lengthClass<> interfIDLNameTranslatorImpl$1Method nextMethodIDLMethodInfo methodInfonew IDLMethodInfo(...)methodInfo.methodisPropertyAccessorMethod(...)String attributeNamegetAttributeNameForProperty(...)methodInfo.isPropertymethodInfo.originalNamemethodInfo.mangledNameIterator<> outerIterIDLMethodInfo outerIterator<> innerIterIDLMethodInfo innerouter.originalNameinner.originalNameouter.mangledNamemangleCaseSensitiveCollision(...)IDLMethodInfo nextnext.mangledNamemangleIdentifier(...)next.isPropertyouter.isPropertyinner.isPropertymangleOverloadedMethod(...)outer.methodinner.mangledNameString mappedContainerNamegetMappedContainerName(...)identifierClashesWithContainer(...)mangleContainerClash(...)new Method[]String idlNameString origMethodNamenext.methodMethod clash/** Perform all necessary stand-alone identifier mangling operations ... */String mangledNamehasLeadingUnderscore(...)mangleLeadingUnderscore(...)isIDLKeyword(...)mangleIDLKeywordClash(...)isIDLIdentifier(...)mangleUnicodeChars(...)/** Checks whether a java identifier clashes with an ... */// refactorings present themselves.// fixes into a utility class.  Then we need to see what other// performs various checks for name problems and the corresponding// The problem appears to be that we need all of the code that// 2. Move all of classToIDLType to a constructor inside IDLType.//    other methods) into a utility class.// 1. Split off isIDLKeywork and mangleIDLKeywordClash (and possibly// XXX refactoring needed:// IDLType can use them.// isIDLKeyword and mangleIDLKeywordClash are exposed here so thatString identifierAllCaps/** Checks whether a java identifier starts with an underscore. ... *//** Implements Section 1.3.2.4 of Java2IDL Mapping. ... */StringBuffer mangledIdentifierchar nextCharisIDLIdentifierChar(...)String unicodecharToUnicodeRepresentation(...)/** Implements mangling portion of Section 1.3.2.7 of Java2IDL spec. ... */boolean needUnderscorechar nextisUpperCase(...)/** Implements Section 1.3.2.9 of Java2IDL Mapping. Container in this ... *//** Returns Unicode mangling as defined in Section 1.3.2.4 of ... */int origStringBuffer hexStringint numZerosToAddint divboolean isIdentifierisIDLAlphabeticChar(...)isUnderscore(...)isIDLDecimalDigit(...)/** True if character is one of 114 Alphabetic characters as ... */boolean alphaChar/** True if character is one of 10 Decimal Digits ... *//** Mangle an overloaded method name as defined in Section 1.3.2.6 of ... */String newMangledNameClass<>[] parameterTypesparameterTypes.lengthClass<> nextParamTypeIDLType idlTypeString moduleNamegetModuleName(...)getMemberName(...)String typeNamegetSpecialCaseIDLTypeMapping(...)getPrimitiveIDLTypeMapping(...)int numArrayDimensionsIDLType componentIdlTypeString[] moduleshasModule(...)concatenateArrays(...)getModules(...)new IDLType(...)getUnmappedContainerName(...)String packageNamegetPackageName(...)replaceAll(...)isEntity(...)String moreMangled/** Return Class' package name or null if there is no package. */Package thePackageString fullyQualifiedClassNameint lastDotString unmappedName/** Return portion of class name excluding package name. */int packageLengthIDLNameTranslatorImpl$IDLMethodInfo/** Internal helper class for tracking information related to each ... */boolean isProperty;String originalName;// attribute name. Otherwise, it holds the original method name.// If this is a property, originalName holds the originalString mangledName;// name. Otherwise, it holds the mangled method name.// If this is a property, mangledName holds the mangled attributeStringBuffer contents/* Copyright (c) 2003, 2013, Oracle and/or its affiliates. All rights reserved. ... */// Convert keyword to all caps to ease equality// check.// Requirements for this method:// 1. cls must be an exception but not a RemoteException.// 2. If cls has an IDL keyword name, an underscore is prepended (1.3.2.2).// 3. If cls jas a leading underscore, J is prepended (1.3.2.3).// 4. If cls has an illegal IDL ident char, it is mapped to UXXXX where//    XXXX is the unicode value in hex of the char (1.3.2.4).// 5. double underscore for inner class (1.3.2.5).// 6. The ID is "IDL:" + name with / separators + ":1.0".// holds method info, keyed by method// Handle the case of a non-public interface!// Take an initial pass through all the methods and create some// information that will be used to track the IDL name// transformation.// Perform case sensitivity test first.  This applies to all// method names AND attributes.  Compare each method name and// attribute to all other method names and attributes.  If names// differ only in case, apply mangling as defined in section 1.3.2.7// of Java2IDL spec.  Note that we compare using the original names.// Now check for overloaded method names and apply 1.3.2.6.// Now mangle any properties that clash with method names.// Ensure that no mapped method names clash with mapped name// of container(1.3.2.9).  This is a case insensitive comparison.// Populate name translation maps.// Final check to see if there are any clashes after all the// manglings have been applied.  If so, this is treated as an// invalid interface.  Currently, we do a CASE-SENSITIVE// comparison since that matches the rmic behavior.// @@@ Shouldn't this be a case-insensitive check?// @@@ I18N// Apply leading underscore test (1.3.2.3)// This should be done before IDL Keyword clash test, since clashing// IDL keywords are mangled by adding a leading underscore.// Apply IDL keyword clash test (1.3.2.2).// This is not needed for attributes since when the full property// name is composed it cannot clash with an IDL keyword.// (Also, rmic doesn't do it.)// Replace illegal IDL identifier characters (1.3.2.4)// for all method names and attributes.// There is always at least one trailing underscore, whether or// not the identifier has uppercase letters.// This bit of logic is needed to ensure that we have// an underscore separated list of indices but no// trailing underscores.  Basically, after we have at least// one uppercase letter, we always put an undercore before// printing the next one.// 1st char must be alphbetic.// NOTE that we can't use the java.lang.Character// isUpperCase, isLowerCase, etc. methods since they// include many characters other than the Alphabetic list in// the CORBA spec.  Instead, we test for inclusion in the// Unicode value ranges for the corresponding legal characters.// A - Z// a - z// other letter uppercase, other letter lowercase, which is// the entire upper half of C1 Controls except X and /// Start by appending the separator string// Calculate array depth, as well as base element type.// Section 1.3.2.5 of Java2IDL spec defines mangling rules for// inner classes.// replace inner class separator with double underscore// Get raw package name.  If there is a package, it// will still have the "." separators and none of the// mangling rules will have been applied.// If this is a generated IDL Entity Type we need to// prepend org_omg_boxedIDL per sections 1.3.5 and 1.3.9// Section 1.3.2.1 and 1.3.2.6 of Java2IDL spec defines// rules for mapping java packages to IDL modules and for// mangling module name portion of type name.  NOTE that// of the individual identifier mangling rules,// only the leading underscore test is done here.// The other two(IDL Keyword, Illegal Unicode chars) are// done in mangleOverloadedMethodName.// Try to get package name by introspection.  Some classloaders might// not provide this information, so check for null.// brute force method/** Holds information about the OMG IDL mapping of a Java type. */Class<> cl_;...[] modules_;// terminology for OMG IDL type package nameString memberName_;// name of element within moduleStringBuffer sbuffmodules_.lengthString modmakeConcatenatedName(...)String modNameint last/** True if this type doesn't have a containing module.  This ... */// Note that this should probably be makeConcatenatedName( '/', true )// for spec compliance,// but rmic does it this way, so we'll leave this.// The effect is that an overloaded method like// void foo( bar.typedef.Baz )// will get an IDL name of foo__bar_typedef_Baz instead of// foo__bar__typedef_Baz (note the extra _ before typedef).// Here we will check for IDL keyword collisions (see bug 5010332).// This means that the repository ID for// foo.exception.SomeException is// "IDL:foo/_exception/SomeEx:1.0" (note the underscore in front// of the exception module name).// See bug 4989312: we must always add the Ex./** Checked exception containing information about an ... *//** Utility class for testing RMI/IDL Types as defined in ... */String GET_PROPERTY_PREFIX;String SET_PROPERTY_PREFIX;String IS_PROPERTY_PREFIX;int VALID_TYPE;int INVALID_TYPE;boolean FOLLOW_RMIC;/* rmic -iiop does not correctly implement the clause in 1.3.4.3 ... *//** Validate a class to ensure it conforms to the rules for a ... */new IDLTypeException(...)Method nextvalidateExceptions(...)validateConstants(...)boolean remoteInterface/** Section 1.2.2 Primitive Types *//** Section 1.2.4 *//** Section 1.2.5 */boolean arrayTypeisObjectReference(...)isValue(...)isException(...)isRemoteInterface(...)/** Section 1.2.6 */isCheckedException(...)isRemoteException(...)RuntimeException.classError.class/** Section 1.2.7 *//** Section 1.2.8 *//** Return true if given method is legal property accessor as defined in ... */String methodNameClass<> returnTypeClass<>[] parametersString propertyTypeparameters.lengthreadHasCorrespondingIsProperty(...)hasCorrespondingReadProperty(...)isHasCorrespondingReadProperty(...)validPropertyExceptions(...)String writePropertyMethodNameClass<>[] writePropertyParametersboolean foundReadPropertyString readPropertyMethodNamereplaceFirst(...)Method readPropertyMethodboolean foundIsPropertyString isPropertyMethodNameMethod isPropertyMethodString remainder/** Return IDL Type name for primitive types as defined in ... *//** Return IDL Type name for special case type mappings as defined in ... *//** Implements 1.2.3 #2 and #4 */boolean declaresRemoteExceptionOrSuperClassint eIndexClass<> exceptionisRemoteExceptionOrSuperClass(...)/** Returns true if the method's throw clause conforms to the exception ... *//** Implements Section 1.2.3, #2. *//** Implements Section 1.2.3, #5. */Class<>[] directInterfacesSet<> allMethodNamesSet<> currentMethodNamesdirectInterfaces.length/** Implements 1.2.3 #6 */Field[] fieldsIDLTypesUtil$1Field next/* Copyright (c) 2003, 2006, Oracle and/or its affiliates. All rights reserved. ... */// Get all methods, including super-interface methods.// Removed because of bug 4989053// validateDirectInterfaces(c);// Must be a checked exception, not including RemoteException or// its subclasses.// Some final checks that apply to all properties.// Look for a valid corresponding Read property// ignore. this means we didn't find a corresponding get property.// Look for a valid corresponding Is property// ignore. this means we didn't find a corresponding Is property.// ignore. this means we didn't find a corresponding read property.// don't set the first letter to lower-case if the// first two are upper-case// Section 1.2.3, #2// Section 1.2.3, #4// See also bug 4972402// For all exceptions E in exceptions,// (isCheckedException(E) => (isValue(E) || RemoteException.isAssignableFrom( E ) )// Comparison is based on method names only.  First collect// all methods from current interface, eliminating duplicate// names.// Now check each method against list of all unique method// names processed so far.import InvocationHandlerimport LinkedInvocationHandlerimport DelegateInvocationHandlerImplimport CompositeInvocationHandlerimport CompositeInvocationHandlerImplPresentationManager.ClassData classData;PresentationManager pm;...[] proxyInterfaces;Class<>[] remoteInterfacesgetIDLNameTranslator(...)this.classDatathis.pmremoteInterfaces.lengthDynamicStub.classInvocationHandlerFactoryImpl$CustomCompositeInvocationHandlerImplDynamicStub stub;setSelf(...)getSelf(...)this.stub/** Return the stub, which will actually be written to the stream. ... */DynamicStub stubnew DynamicStubImpl(...)// This is also used in DynamicStubImpl to implement readResolve.InvocationHandler dynamicStubHandlerInvocationHandler stubMethodHandlernew StubInvocationHandlerImpl(...)CompositeInvocationHandler handlernew CustomCompositeInvocationHandlerImpl(...)new PrivilegedAction<Void>(...) { ... }InvocationHandlerFactoryImpl$1addInvocationHandler(...)setDefaultHandler(...)// Create an invocation handler for the methods defined on DynamicStub,// which extends org.omg.CORBA.Object.  This handler delegates all// calls directly to a DynamicStubImpl, which extends// org.omg.CORBA.portable.ObjectImpl.// Create an invocation handler that handles any remote interface// methods.// Create a composite handler that handles the DynamicStub interface// as well as the remote interfaces.// If the method passed to invoke is not from DynamicStub or its superclasses,// it must be from an implemented interface, so we just handle// all of these with the stubMethodHandler.  This used to be// done be adding explicit entries for stubMethodHandler for// each remote interface, but that does not work correctly// for abstract interfaces, since the graph analysis ignores// abstract interfaces in order to compute the type ids// correctly (see PresentationManagerImpl.NodeImpl.getChildren).// Rather than produce more graph traversal code to handle this// problem, we simply use a default.// This also points to a possible optimization: just use explict// checks for the three special classes, rather than a general// table lookup that usually fails.import javax.naming.*import StateFactoryimport CNCtx/** StateFactory that turns java.rmi.Remote objects to org.omg.CORBA.Object. ... */JNDIStateFactoryImpl$1CNCtx.classField orbField;/** Returns the CORBA object for a Remote object. ... */Remote stub// entirely.// other vendors may use the CosNaming provider with a different ORB// to use the StubAdapter.  But this has problems as well, because// The best solution for our ORB is to change the CosNaming provider// com.sun.jndi.cosnaming.CNCtx.  This is not an ideal solution.// This is necessary because the _orb field is package private in// XXX This creates a dependendcy on the implementation// of the CosNaming service provider.// XXX log exception at FINE// Not for this StateFactory// Wrong kind of context, so just give up and let another StateFactory// try to satisfy getStateToBind.// XXX log at FINE level?// Wrong sort of object: just return null to allow another StateFactory// to handle this.  This can happen easily because this StateFactory// is specified for the application, not the service context provider.// to handle this call.// ignore RemoteException because stub might have already// been connected// XXX log this exception at FINE level// ignore the exception and return null.// Note that the exception may be because ctx// is not a CosNaming context.import IDLNameTranslatorImplimport StubFactoryProxyImplimport Nodeimport Graphimport GraphImplMap<> classToClassData;Map<> methodToDMM;PresentationManager.StubFactoryFactory dynamicStubFactoryFactory;boolean useDynamicStubs;this.useDynamicStubs////////////////////////////////////////////////////////////////////////////////// PresentationManager interfaceDynamicMethodMarshaller resultnew DynamicMethodMarshallerImpl(...)ClassData resultnew ClassDataImpl(...)PresentationManagerImpl$ClassDataImplIDLNameTranslator nameTranslator;PresentationManager.StubFactory sfactory;InvocationHandlerFactory ihfactory;Map<> dictionary;Graph grnew GraphImpl(...)NodeImpl rootnew NodeImpl(...)Set<> rootSetgetRootSet(...)makeTypeIds(...)new InvocationHandlerFactoryImpl(...)PresentationManagerImpl.this// Graph computationsgetRoots(...)Class<> superclassSet<> initialRootSetremoveAll(...)Class<>[] classesNodeImpl nodegetInterface(...)Set<> nonRootSetaddNodes(...)String typeIdPresentationManagerImpl$NodeImplClass<> interf;this.interfNodeImpl otherother.interf// XXX these should probably be WeakHashMaps.// At this point, rootSet contains those remote interfaces// that are not related by inheritance, and gr contains// all reachable remote interfaces.// rootSet just contains root here// Use this class and its superclasses (not Object) as initial roots// Expand all nodes into the graph// remove the roots and find roots again// List<String> for the typeids// If the rootSet has more than one element, we must// put the type id of the implementation class first.// Root represents the implementation class here.import ResponseHandlerRemote target;this.targetClass<> targetClass_this_object(...)_poa(...)WrongPolicy exceptionObjectNotActive exceptionServantNotActive exceptionORB myORBset_delegate(...)Method javaMethodDynamicMethodMarshaller dmmreadArguments(...)getDynamicMethodMarshaller(...)writeResult(...)IllegalArgumentException exInvocationTargetException exnew UnknownException(...)// Unwrap the actual exception so that it can be wrapped by an// UnknownException or thrown if it is a system exception.// This is expected in the server dispatcher code./** Connect the stub to the orb if necessary. ... */BAD_OPERATION errgetAndForgetTie(...)ObjectImpl objref// No IOR, can we get a Tie for this stub?// Is the tie already connected?  If it is, check that it's// connected to the same ORB, otherwise connect it.// Thrown when tie is an ObjectImpl and its delegate is not set.// Thrown when tie is a Servant and its delegate is not set.// Get the delegate for the stub from the tie.// ior is initialized, so convert ior to an object, extract// the delegate, and set it on ourselfObject stubimport SerializablePermissionClassLoader loader;SecurityManager smnew SerializablePermission(...)this.loader// this.loader must not be null, or the newProxyInstance call// will fail./** Returns the stub classname for the given interface name. ... */stubName(...)StubFactory sfmakeDynamicStubFactory(...)new ReflectiveTie(...)// IDL stubs must always use static factories.new PrivilegedAction<StubFactoryProxyImpl>(...) { ... }StubFactoryFactoryProxyImpl$1new StubFactoryProxyImpl(...)import PackagePrefixCheckerString stubNameClassLoader expectedTypeClassLoaderString firstStubNameString secondStubNameClass<> clzidlStubName(...)stubNameForCompiler(...)hasOffendingPrefix(...)packagePrefix(...)ClassNotFoundException e1ClassNotFoundException e2new StubFactoryStaticImpl(...)Class<> tieClasstieName(...)Exception err// The old code was optimized to try to guess which way to load classes// first.  The real stub class name could either be className or// "org.omg.stub." + className.  We will compute this as follows:// If stubName starts with a "forbidden" package, try the prefixed// version first, otherwise try the non-prefixed version first.// In any case, try both forms if necessary.// log only at FINE level// XXX Is this step necessary, or should the Util.loadClass// algorithm always produce a valid class if the setup is correct?// Does the OMG standard algorithm need to be changed to include// this step?// XXX make this a system exception// XXX log exceptions at FINE level//_REVISIT_ The spec does not specify a loadingContext parameter for//the following call.  Would it be useful to pass one?InvocationHandlerFactory factoryLinkedInvocationHandler handlergetProxyInterfaces(...)newProxyInstance(...)setProxy(...)// Construct the dynamic proxy that implements this stub// using the composite handlerClass<> stubClass;this.stubClassimport ServantObjectObject stub;Proxy self;LocalClientRequestDispatcher lcrd/** Invoke the given method with the args and return the result. ... */String giopMethodNamegetIDLName(...)writeArguments(...)readResult(...)ApplicationException exRemarshalException exServantObject soservant_preinvoke(...)Object[] copiescopyArguments(...)so.servantisAccessible(...)StubInvocationHandlerImpl$1copyResult(...)Throwable mexThrowable exCopywrapException(...)servant_postinvoke(...)// create request// marshal arguments// finish invocation// unmarshal result// local branch// Make sure that we can invoke a method from a normally// inaccessible package, as this reflective class must always// be able to invoke a non-public method.// mex should never be null, as null cannot be thrown// This is not a user thrown exception from the// method call, so don't copy it.  This is either// an error or a reflective invoke exception./** This exception is thrown while reading GIOP 1.2 Request, LocateRequest ... */short expectedAddrDisp;this.expectedAddrDisp/** Class BootstrapServerRequestDispatcher handles the requests coming to the ... *//** Dispatch is called by the ORB and will serve get(key) and list() ... */CorbaMessageMediator requestCorbaMessageMediator responseMarshalInputStream isString methodMarshalOutputStream oscreateResponse(...)getProtocolHandler(...)String serviceKeyObject serviceObjectString objcreateSystemExceptionResponse(...)RuntimeException ex/** Locates the object mentioned in the locate requests, and returns ... *//** Not implemented */// Get the name of the requested service// Look it up// Write reply value// Marshal the exception thrown// Unknown exceptionimport ContactInfoListIterator// so RMI-IIOP Util.isLocal can call ClientRequestDispatcher.useLocalInvocation.// implements com.sun.corba.se.impl.core.ClientRequestDispatcherCorbaContactInfoList contactInfoList;this.contactInfoList// framework.subcontract.Delegate// CORBA_2_3.portable.DelegateClientInvocationInfo invocationInfocreateOrIncrementInvocationInfo(...)Iterator<> contactInfoListIteratorCorbaContactInfo contactInfoClientRequestDispatcher subcontractgetClientRequestDispatcher(...)setContactInfoListIterator(...)getFailureException(...)setClientRequestDispatcher(...)beginRequest(...)marshalingComplete(...)endRequest(...)releaseOrDecrementInvocationInfo(...)Object objimplget_interface_def(...)String myidis_a(...)non_existent(...)// portable.ObjectImpl, so we just ignore obj here.// obj._get_delegate() == this due to the argument passing conventions inCorbaClientDelegateImpl corbaDelegate/** This method overrides the org.omg.CORBA.portable.Delegate.equals method, ... */CorbaClientDelegateImpl otherDelIOR otherIorotherDel.contactInfoListnew RequestImpl(...)/** Returns true if this object is implemented by a local servant. ... *//* Returns the codebase for object reference provided. ... */// XXX Should this be public?// Remember chosen subcontract for invoke and releaseReply.// NOTE: This is necessary since a stream is not available in// releaseReply if there is a client marshaling error or an// error in _invoke.// NOTE: InputStream may be null (e.g., exception request from PI).// instantiate the stub// check if returned object is of correct type// This cannot happen.// dest is the typeId of the interface to compare against.// repositoryIds is the list of typeIds that the stub knows about.// First we look for an answer using local information.// But repositoryIds may not be complete, so it may be necessary to// go to server.// DO NOT clear out internal variables to release memory// This delegate may be pointed-to by other objrefs.// If ref is a local object, it is not a Stub!// Optimize the x.is_equivalent( x ) case// If delegate was created by a different ORB, return false// Come here if other is not implemented by our ORB.// XXX this need to check isNextCallValidimport ExceptionDetailMessageimport OutboundConnectionCacheimport CDRInputObjectimport ConcurrentMapimport ConcurrentHashMap/** ClientDelegate is the RMI client-side subcontract or representation ... */new ConcurrentHashMap<ContactInfo,Object>(...)ConcurrentHashMap$NodeConcurrentHashMap$KeySetViewConcurrentHashMap$CollectionViewConcurrentMap<ContactInfo,Object> locks;CorbaConnection connectionObject lockCorbaMessageMediator messageMediatorcreateMessageMediator(...)OutputObject outputObjectcreateOutputObject(...)orb.subcontractDebugFlagObject newLockputIfAbsent(...)isConnectionBased(...)shouldCacheConnection(...)getOutboundConnectionCache(...)createConnection(...)boolean retryreportException(...)unregisterWaiter(...)shouldRegisterReadEvent(...)registerForEvent(...)getSelector(...)getEventHandler(...)OutboundConnectionCache connectionCachestampTime(...)opAndId(...)setMessageMediator(...)performCodeSetNegotiation(...)addServiceContexts(...)registerWaiter(...)reclaim(...)invokeClientPIStartingPoint(...)makeCompletedClientRequest(...)ReplyMessage.LOCATION_FORWARDcleanupClientPIRequest(...)initializeMessage(...)InputObject inputObjectmarshalingComplete1(...)processResponse(...)finishSendingRequest(...)waitForResponse(...)continueOrThrowSystemOrRemarshal(...)setPostInitialContexts(...)reportSuccess(...)ReplyMessage.NO_EXCEPTIONconsumeServiceContexts(...)isSystemExceptionReply(...)getSystemExceptionReply(...)boolean doRemarshalServiceContexts contextsUEInfoServiceContext uscUEInfoServiceContext.SERVICE_CONTEXT_IDThrowable unknowngetUE(...)UnknownException ueisUserExceptionReply(...)String exceptionRepoIdpeekUserExceptionId(...)isDIIRequest(...)unmarshalDIIUserException(...)ReplyMessage.USER_EXCEPTIONsetDIIException(...)new ApplicationException(...)isLocationForwardReply(...)getForwardedIOR(...)isDifferentAddrDispositionRequestedReply(...)ReplyMessage.NEEDS_ADDRESSING_MODEreportAddrDispositionRetry(...)getAddrDispositionReply(...)handleDIIReply(...)// Note that this code is duplicated in GenericPOAClientSC.java// If the exception is null, no exception is thrown.// the above invoke code which must do this numerous times.// of one of these two types.  This is a utility method for// RemarshalException and throws it.  Assumes the given exception is// Filters the given exception into a SystemException or aCorbaConnection cGIOPVersion giopVersionORBVersionServiceContext ovscnew ORBVersionServiceContext(...)addCodeSetServiceContext(...)MaxStreamFormatVersionServiceContext.singletonisPostInitialContexts(...)SendingContextServiceContext scscnew SendingContextServiceContext(...)getFVDCodeBaseIOR(...)ServiceContexts ctxtsServiceContext scSendingContextServiceContext.SERVICE_CONTEXT_IDsetCodeBaseIOR(...)ThreadDeath tdORBVersionServiceContext.SERVICE_CONTEXT_IDgetVersion(...)getExceptionDetailMessage(...)ExceptionDetailMessage.valueEncapsInputStream insetReplyExceptionDetailMessage(...)InputObject inputObjOutputObject outputObjsendCancelRequestIfFinalFragmentNotSent(...)CorbaConnection connCodeSetComponentInfo serverCodeSetsCodeSetContext resultnegotiate(...)setCodeSetContext(...)CodeSetContext codeSetCtxCodeSetServiceContext csscnew CodeSetServiceContext(...)alwaysSendCodeSetServiceContext(...)CDRInputObject cdrInputObjectoperationNameAndRequestId(...)// Portable Interceptor initialization.// Connection.// This locking is done so that multiple connections are not created// for the same endpoint// 7046238 - Synchronization on a single monitor for contactInfo parameters// with identical hashCode(), so we lock on same monitor for equal parameters// (which can refer to equal (in terms of equals()) but not the same objects)// REVISIT: this part similar to marshalingComplete below.// this part similar to Remarshal in this method below// REVISIT: cast// Do not do connection reclaim here since the connections// are marked in use by registerWaiter() call and since this// call happens later do it after that.//              connectionCache.reclaim();// NOTE: Thread data so we can get the mediator in release reply// in order to remove the waiter in CorbaConnection.// We cannot depend on obtaining information in releaseReply// via its InputStream argument since, on certain errors// (e.g., client marshaling errors), the stream may be null.// Likewise for releaseReply "self".// NOTE: This must be done before initializing the message since// that may start sending fragments which may end up in "early"// replies or client marshaling exceptions.// NOTE: Not necessary for oneways, but useful for debugging.// This must be done BEFORE message initialization since fragments// may be sent at that time.// Do connection reclaim now// This MUST come before message is initialized so// service contexts may be added by PI because// initial fragments may be sent during message initialization.// NOTE: We get here because an interceptor raised ForwardRequest// and updated the IOR/Iterator.  Since we have a fresh iterator// hasNext should succeed.// REVISIT: We should feed ALL interceptor exceptions to// iterator.reportException so it can determine if it wants// to retry.  Right now, SystemExceptions will flow to the// client code.// This assumes that interceptors update// ContactInfoList outside of subcontract.// Want to move that update to here.// Fix for 6763340: Complete the first attempt before starting another.//Bug 6382377: must not lose exception in PI// Must run interceptor end point before retrying.// NOTE: Interceptor ending point will run in releaseReply.// for compiler// We know for sure now that we've sent a message.// So OK to not send initial again.// NOTE: not necessary to set MessageMediator for PI.// It already has it.// Process the response.// Invoke Portable Interceptors with receive_other// Now that we have the service contexts processed and the// correct ORBVersion set, we must finish initializing the stream.// REVISIT - need interface for this operation.// Invoke Portable Interceptors with receive_exception:// If PI did not change the exception, throw a// Remarshal.// exception = null is to maintain symmetry with// GenericPOAClientSC.//  Otherwise, throw the exception PI wants thrown.// No retry, so see if was unknown.// It was not a comm failure nor unknown.// This is the general case.// Note: We should never need to execute this line, but// we should assert in case exception is null somehow.// For DII:// This return will be ignored - already unmarshaled above.// NOTE: Expects iterator to update target IOR// Invoke Portable Interceptors with receive_other:// If PI did not change exception, throw Remarshal, else// throw the exception PI wants thrown.// KMC: GenericPOAClientSC did not check exception != null// Set the desired target addressing disposition.// For consistency with corresponding code in GenericPOAClientSC:// KMC: GenericPOAClientSC did not include exception != null check/* normal response */// Invoke Portable Interceptors with receive_reply:// Remember: not thrown if exception is null.// REVISIT - unify with PI handling// NOTE - We must unregister the waiter NOW for this request// since the retry will result in a new request id.  Therefore// the old request id would be lost and we would have a memory// leak in the responseWaitingRoom.// The messageMediator may be null if COMM_FAILURE before// it is created.// Add the RMI-IIOP max stream format version// service context to every request.  Once we have GIOP 1.3,// we could skip it since we now support version 2, but// probably safer to always send it.// ORBVersion servicecontext needs to be sent// NOTE : We only want to send the runtime context the first time// Do not do c.setPostInitialContexts() here.// If a client interceptor send_request does a ForwardRequest// which ends up using the same connection then the service// context would not be sent.// no service context available, return gracefully.// set the codebase returned by the server// see if the version subcontract is present, if yes, then set// the ORBversion// Note: the inputObject may be null if an error occurs//       in request or before _invoke returns.// Note: self may be null also (e.g., compiler generates null in stub).// Release any outstanding NIO ByteBuffers to the ByteBufferPool// XREVISIT NOTE - Assumes unregistering the waiter for// location forwards has already happened somewhere else.// The code below is only going to unregister the final successful// request.// NOTE: In the case of a recursive stack of endRequests in a// finally block (because of Remarshal) only the first call to// unregisterWaiter will remove the waiter.  The rest will be// noops.// Invoke Portable Interceptors cleanup.  This is done to handle// exceptions during stream marshaling.  More generally, exceptions// that occur in the ORB after send_request (which includes// after returning from _request) before _invoke:// REVISIT: Early replies?// See CDRInput/OutputObject.close() for more info.// This won't result in a Corba error if an IOException happens.// XXX This seems to be a broken double checked locking idiom: FIX IT!// conn.getCodeSetContext() is null when no other requests have// been made on this connection to trigger code set negotation.// Double checking.  Don't let any other// threads use this connection until the// code sets are straight.// This only looks at the first code set component.  If// there can be multiple locations with multiple code sets,// this requires more work.// Didn't have a code set component.  The default will// be to use ISO8859-1 for char data and throw an// exception if wchar data is used.// Get the native and conversion code sets the// server specified in its IOR// Perform the negotiation between this ORB's code sets and// the ones from the IOR// REVISIT.  OMG issue 3318 concerning sending the code set// service context more than once was deemed too much for the// RTF.  Here's our strategy for the moment:// Send it on every request (necessary in cases of fragmentation// with multithreaded clients or when the first thing on a// connection is a LocateRequest).  Provide an ORB property// to disable multiple sends.// Note that the connection is null in the local case and no// service context is included.  We use the ORB provided// encapsulation streams.// Also, there will be no negotiation or service context// in GIOP 1.0.  ISO8859-1 is used for char/string, and// wchar/wstring are illegal.// Get the negotiated code sets (if any) out of the connection// Either we shouldn't send the code set service context, or// for some reason, the connection doesn't have its code sets.// Perhaps the server didn't include them in the IOR.  Uses// ISO8859-1 for char and makes wchar/wstring illegal.// REVISIT - need interface for mark/resetboolean isRetryInvocation;// REVISIT - these needs to be an interface-based impl.Iterator<> contactInfoListIterator;ClientRequestDispatcher clientRequestDispatcher;MessageMediator messageMediator;this.contactInfoListIteratorthis.isRetryInvocationthis.clientRequestDispatcherimport PrintWriterimport SelectionKeyimport ProtocolHandlerimport CorbaProtocolHandlerimport CorbaResponseWaitingRoomimport AddressingDispositionExceptionimport AddressingDispositionHelperimport CancelRequestMessageimport FragmentMessage_1_1import FragmentMessage_1_2import LocateRequestMessageimport LocateRequestMessage_1_0import LocateRequestMessage_1_1import LocateRequestMessage_1_2import LocateReplyOrReplyMessageimport LocateReplyMessageimport LocateReplyMessage_1_0import LocateReplyMessage_1_1import LocateReplyMessage_1_2import MessageHandlerimport ReplyMessage_1_0import ReplyMessage_1_1import ReplyMessage_1_2import RequestMessageimport RequestMessage_1_0import RequestMessage_1_1import RequestMessage_1_2// REVISIT: normalize requestHeader, replyHeader, messageHeader.// REVISIT: make sure no memory leaks in client/server request/reply maps.InterceptorsSystemException interceptorWrapper;CorbaContactInfo contactInfo;short addrDisposition;CDROutputObject outputObject;CDRInputObject inputObject;Message messageHeader;RequestMessage requestHeader;LocateReplyOrReplyMessage replyHeader;String replyExceptionDetailMessage;IOR replyIOR;Integer requestIdInteger;Message dispatchHeader;ByteBuffer dispatchByteBuffer;boolean streamFormatVersionSet;Request diiRequest;boolean cancelRequestAlreadySent;ProtocolHandler protocolHandler;boolean _executeReturnServantInResponseConstructor;boolean _executeRemoveThreadInfoInResponseConstructor;boolean _executePIInResponseConstructor;// Client-side constructor.this.addrDispositiongetStreamFormatVersionForThisRequest(...)createRequest(...)// Acceptor constructor.this.interceptorWrapper// request side mediator will take over.// mediator will only be used for dispatch.  Then the original// Note: in some cases (e.g., a reply message) this message// Dispatcher constructor.this.dispatchHeaderthis.dispatchByteBuffer// MessageMediatorgetRequestHeader(...)finishSendingMessage(...)isResponseExpected(...)this.inputObject// CorbaMessageMediatorthis.replyHeaderthis.replyIORgetReplyHeader(...)sentFragment(...)sentFullMessage(...)sendCancelRequestWithLock(...)this.diiRequestExceptionList _exceptionsAny eanynew UnknownUserException(...)Exception benv(...)unmarshalReply(...)int poolToUseMessage msggetDispatchHeader(...)getThreadPoolToUse(...)getStreamFormatVersionForReply(...)/** If the RMI-IIOP maximum stream format version service context ... */ServiceContexts svcMaxStreamFormatVersionServiceContext msfvscMaxStreamFormatVersionServiceContext.SERVICE_CONTEXT_IDbyte localMaxVersionbyte remoteMaxVersionlessThan(...)GIOPVersion.V1_3ORBConstants.STREAM_FORMAT_VERSION_2ReplyMessage.LOCATION_FORWARD_PERMgetAddrDisposition(...)getSystemException(...)// Used by server side.// ResponseHandlercreateUserExceptionResponse(...)IOR effectiveTargetIORboolean isThreadDone;// mediator so combine for now.// up in a registry.  However it needs some state in the message// REVISIT - This could be a separate implementation object looked// pept.protocol.ProtocolHandlercallback(...)// iiop.messages.MessageHandlerresumeSelect(...)unregisterForEvent(...)EventHandler eventHandlertransportDebug(...)String requestIdregisterInterestOps(...)createInputObject(...)getAcceptor(...)setInputObject(...)responseReceived(...)getResponseWaitingRoom(...)// This handles message types for which we don't create classes.typeToString(...)setWorkThenReadOrResumeSelect(...)Message.GIOPCloseConnectionpurgeCalls(...)Message.GIOPMessageErrorreleaseByteBufferToPool(...)setWorkThenPoolOrResumeSelect(...)handleRequest(...)serverRequest_1_1_Put(...)// REVISIT: this is identical to 1_0 except for fragment part.unmarshalRequestID(...)serverRequestMapPut(...)serverRequestMapRemove(...)unmarshalHeader(...)signalResponseReceived(...)clientReply_1_1_Put(...)+...MessageMediator mediatorCDRInputObject inputObjectserverRequest_1_1_Get(...)clientReply_1_1_Get(...)processFragment(...)serverRequest_1_1_Remove(...)clientReply_1_1_Remove(...)serverRequestMapGet(...)clientRequestMapGet(...)processCancelRequest(...)throwNotImplemented(...)// REVISIT: move this to subcontract (but both client and server need it).int requestIdBufferManagerReadStream bufferManagerMessage.GIOPRequestcancelProcessing(...)// spi.protocol.CorbaProtocolHandlerhandleRequestRequest(...)handleThrowableDuringServerDispatch(...)sendResponse(...)dispatchError(...)handleLocateRequest(...)serverRequestProcessingBegins(...)CDROutputObject outputObjectserverRequestProcessingEnds(...)CorbaServerRequestDispatcher scdispatch(...)LocateRequestMessage msgLocateReplyMessage replyshort addrDispcreateAppropriateOutputObject(...)locate(...)createLocateReply(...)LocateReplyMessage.OBJECT_HERELocateReplyMessage.OBJECT_FORWARDAddressingDispositionException exLocateReplyMessage.LOC_NEEDS_ADDRESSING_MODEexpectedAddrDisp(...)RequestCanceledException exLocateReplyMessage.UNKNOWN_OBJECTnewCDROutputObject(...)(...).subcontractDebugFlag// REVISIT - catch and ignore RequestCanceledException.SystemException sexconvertThrowableToSystemException(...)ForwardException fexcreateLocationForward(...)handleAddressingDisposition(...)Throwable throwable2ReplyMessage replyHeaderLocateReplyMessage locateReplyHeaderMessage.GIOPLocateRequestcreateResponseHelper(...)getServiceContextsForReply(...)SystemException sysUEInfoServiceContext ueinew UEInfoServiceContext(...)CorbaMessageMediatorImpl mediatorOutputObject existingOutputObjectexecutePIInResponseConstructor(...)addExceptionDetailMessage(...)writeSystemException(...)ByteArrayOutputStream baosPrintWriter pwnew PrintWriter(...)EncapsOutputStream encapsOutputStreamUnknownServiceContext serviceContextReplyMessage replyReplyMessage message// REVISIT - IOR arg is ignored.OutputObject replyOutputObjectrunServantPostInvoke(...)runInterceptors(...)runRemoveThreadInfo(...)setReplyHeader(...)executeReturnServantInResponseConstructor(...)setExecuteReturnServantInResponseConstructor(...)setExecuteRemoveThreadInfoInResponseConstructor(...)EmptyStackException eseinvokeServerPIEndingPoint(...)cleanupServerPIRequest(...)executeRemoveThreadInfoInResponseConstructor(...)popInvocationInfo(...)//           very similar logic and debug information.//           since all locations that release ByteBuffers use// REVISIT - this method should be migrated to orbutil.ORBUtilityint bbId// REVISIT: probably move logic in outputObject to here.// REVISIT - need separate field?// Case: first a location forward, then a marshaling// exception (e.g., non-serializable object).  Only// send cancel once.// REVISIT: we could attempt to send a final incomplete// fragment in this case.// Find the typecode for the exception// Since we dont have the actual user exception// class, the spec says we have to create an// UnknownUserException and put it in the// environment.// must be a truly unknown exception// A null msg should never happen. But, we'll be// defensive just in case.// REVISIT: ContactInfo/Acceptor output object factories// just use this.  Maybe need to distinguish://    createOutputObjectForRequest//    createOutputObjectForReply// then do getStreamFormatVersionForRequest/ForReply here.// NOTE: The request service contexts may indicate the max.// Defaults to 1 for GIOP 1.2 or less, 2 for// GIOP 1.3 or higher.//return replyHeader.getReplyStatus() == ReplyMessage.LOCATION_FORWARD;// REVISIT: should look up in orb registry.// Note: relies on side-effect of setting mediator output field.// REVISIT - cast - need interface// Didn't have the max stream format version tagged// component.// REVISIT - this should be handled internally.// Leader/Follower when using reader thread.// When this thread is done working it will go back in pool.// First unregister current registration.// Have another thread become the reader.// When using reader thread then wen this thread is// done working it will continue reading.// NOTE: VERY IMPORTANT:// Only participate in select after getting to the point// that proper serialization of fragments is ensured.// REVISIT: not-OO:// IMPORTANT: To avoid bug (4953599), we force the Thread that does the NIO select// to also do the enable/disable of Ops using SelectionKey.interestOps(Ops of Interest).// Otherwise, the SelectionKey.interestOps(Ops of Interest) may block indefinitely in// this thread.// REVISIT: refactor createInputObject (and createMessageMediator)// into base PlugInFactory.  Get via connection (either ContactInfo// or Acceptor).// This will end up using the MessageMediator associated with// the original request instead of the current mediator (which// need to be constructed to hold the dispatchBuffer and connection).// Mask the exception from thread.;// NOTE: in the old code this used to be done conditionally:// if (header.moreFragmentsToFollow()).// Now we always put it in. We take it out when// the response is done.// This must happen now so if a header is fragmented the stream// may be found.// Leader/Follower.// Note: This *MUST* come after putting stream in above map// since the header may be fragmented and you do not want to// start reading again until the map above is set.//inputObject.unmarshalHeader(); // done in subcontract.// REVISIT: this should be done by waiting thread.// More fragments are coming to complete this reply, so keep// a reference to the InputStream so we can add the fragments// In 1.1, we can't assume that we have the request ID in the// first fragment.  Thus, another thread is used// to be the reader while this thread unmarshals// the extended header and wakes up the client thread.// REVISIT - error handling.// This must be done now.// Not fragmented, therefore we know the request// ID is here.  Thus, we can unmarshal the extended header// and wake up the client thread without using a third// thread as above.// REVISIT - error handling during unmarshal.// This must be done now to get the request id.// We know that the request ID is in the first fragment// REVISIT Put in subcontract.// Fragmented LocateReplies are not allowed in 1.1.// No need to put in client reply map - already there.// If no input stream available, then discard the fragment.// This can happen:// 1. if a fragment message is received prior to receiving//    the original request/reply message. Very unlikely.// 2. if a fragment message is received after the//    reply has been sent (early replies)// Note: In the case of early replies, the fragments received// during the request processing (which are never unmarshaled),// will eventually be discarded by the GC.// need to release dispatchByteBuffer to pool if// we are discarding// NOTE: This *must* come after queing the fragment// when using the selector to ensure fragments stay in order.// Note:  We know it's a 1.2 fragment, we have the data, but// we need the IIOPInputStream instance to unmarshal the// request ID... but we need the request ID to get the// IIOPInputStream instance. So we peek at the raw bytes.// See 1.1 comments.// REVISIT: but if it is a server don't you have to remove the// stream from the map?/* REVISIT ... */// REVISIT: Move these two to subcontract.// The GIOP version of CancelRequest does not matter, since// CancelRequest_1_0 could be sent to cancel a request which// has a different GIOP version./* CancelRequest processing logic : ... */// we do not support bi-directional giop yet, ignore.// Try to get hold of the InputStream buffer.// In the case of 1.0 requests there is no way to get hold of// InputStream. Try out the 1.1 and 1.2 cases.// was the request 1.2 ?// was the request 1.1 ?// XXX log this!// either the request was 1.0// or an early reply has already been sent// or request processing is over// or its a spurious CancelRequest// A spurious 1.1 CancelRequest has been received.// special case// this means that// 1. the 1.1 requests' requestId has not been received//    i.e., a CancelRequest was received even before the//    1.1 request was received. The spec disallows this.// 2. or the 1.1 request has a requestId 0.// It is a little tricky to distinguish these two. So, be// conservative and do not cancel the request. Downside is that// 1.1 requests with requestId of 0 will never be cancelled.// Any mediator obtained here should only ever be for a GIOP// At this point we have a valid message mediator that contains// a valid requestId.// at this point we have chosen a request to be cancelled. But we// do not know if the target object's method has been invoked or not.// Request input stream being available simply means that the request// processing is not over yet. simply set the abort flag in the// BMRS and hope that the worker thread would notice it (this can// happen only if the request stream is being unmarshalled and the// target's method has not been invoked yet). This guarantees// that the requests which have been dispatched to the// target's method will never be cancelled.// REVISIT - this makes hcks sendTwoObjects fail// messageMediator.getConnection().close();// REVISIT - type and location// REVISIT - can be null for TRANSIENT below.// release NIO ByteBuffers to ByteBufferPool// Given what close() does, this catch shouldn't ever happen.// It also won't result in a Corba error if an IOException happens.// Does nothing if already unmarshaled.// This is necessary so mediator can act as ResponseHandler// and pass necessary info to response constructors located// in the subcontract.// REVISIT - same class right now.//messageMediator.setProtocolHandler(this);// REVISIT: Should we catch SystemExceptions?// create a response containing the expected target// addressing disposition.// no need to send reply// REVISIT If exception is not OBJECT_NOT_EXIST, it should// have a different reply// This handles OBJECT_NOT_EXIST exceptions thrown in// the subcontract or obj manager. Send back UNKNOWN_OBJECT.// outputObject.setMessage(reply); // REVISIT - not necessary// locate msgs 1.0 & 1.1 :=> grow,// 1.2 :=> stream// If we haven't unmarshaled the header, we probably don't// have enough information to even send back a reply.// Cannot do this check.  When target addressing disposition does// not match (during header unmarshaling) it throws an exception// to be handled here./* if (! ((CDRInputObject)messageMediator.getInputObject()) ... */// REVISIT - should we close connection?// Else.// User code (e.g., postinvoke, interceptors) may change// the exception, so we end up back here.// Report the changed exception.// Reporting an exception response causes the// poa current stack, the interceptor stacks, etc.// to be balanced.  It also notifies interceptors// that the request was cancelled.// NOTE: We do not trap ThreadDeath above Throwable.// There is no reason to stop the thread.  It is// just a worker thread.  The ORB never throws// ThreadDeath.  Client code may (e.g., in ServantManagers,// interceptors, or servants) but that should not// effect the ORB threads.  So it is just handled// generically.// Last resort.// If user code throws a non-SystemException report it generically.// from iiop.RequestProcessor.// Respond with expected target addressing disposition.// REVISIT: via acceptor factory.// REVISIT: ignore service contexts during framework transition.// They are set in SubcontractResponseHandler to the wrong connection.// Then they would be set again here and a duplicate contexts// exception occurs.// REVISIT - same as above// NOTE: This service context container gets augmented in// tail call.// It is possible that fragments of response have already been// sent.  Then an error may occur (e.g. marshaling error like// non serializable object).  In that case it is too late// to send the exception.  We just return the existing fragmented// stream here.  This will cause an incomplete last fragment// to be sent.  Then the other side will get a marshaling error// when attempting to unmarshal.// REVISIT: Impl - make interface method to do the following.// REVISIT: need to think about messageMediator containing correct// pointer to output object.// Only do this if interceptors have been initialized on this request// and have not completed their lifecycle (otherwise the info stack// may be empty or have a different request's entry on top).// REVISIT: not necessary in framework now?// Inform Portable Interceptors of the SystemException.  This is// required to be done here because the ending interception point// is called in the when creating the response below// but we do not currently write the SystemException into the// response until after the ending point is called.// NOTE: We MUST add the service context before creating// the response since service contexts are written to the// stream when the response object is created.// NOTE: From here on, it is too late to add more service contexts.// They have already been serialized to the stream (and maybe fragments// sent).// NOTE: you must flush or baos will be empty.// REVISIT - these should be invoked from subcontract.// REVISIT = do not use null.// REVISIT - not necessary?//messageMediator.this.replyIOR = reply.getIOR();// NOTE: The mediator holds onto output object so return value// not really necessary.// Run ServantLocator::postinvoke.  This may cause a SystemException// which will throw out of the constructor and return later// to construct a reply for that exception.  The internal logic// of returnServant makes sure that postinvoke is only called once.// REVISIT: instead of instanceof, put method on all orbs.// This flag is to deal with BootstrapServer use of reply streams,// with ServerRequestDispatcher's use of reply streams, etc.// It is possible to get marshaling errors in the skeleton after// postinvoke has completed.  We must set this to false so that// when the error exception reply is constructed we don't try// to incorrectly access poa current (which will be the wrong// one or an empty stack.// Invoke server request ending interception points (send_*):// Note: this may end up with a SystemException or an internal// Runtime ForwardRequest// Note this will be executed even if a ForwardRequest or// SystemException is thrown by a Portable Interceptors ending// point since we end up in this constructor again anyway.// See createSystemExceptionResponse for why this is necesary.// Once you get here then the final reply is available (i.e.,// postinvoke and interceptors have completed.// send ORBVersion servicecontext as part of the Replyimport InvokeHandlerimport SpecialMethodimport ServerRequestImpl// my ORB instancePOASystemException poaWrapper;// public static final int UNKNOWN_EXCEPTION_INFO_ID = 9;// XXX remove me and rebuild: probably no longer needed// Added from last version because it broke the build - RTW/** XXX/REVISIT: ... */checkServerId(...)findObjectAdapter(...)ObjectAdapter objectAdaptergetServantWithPI(...)dispatchToServant(...)ForwardException exOADestroyed exUnknownException exex.originalExThrowable ex// Note that objectAdapter.enter() must be called before getServant.makeInvocationInfo(...)setOperation(...)pushInvocationInfo(...)String mdiinitializeServerPIInfo(...)invokeServerPIStartingPoint(...)handleNullServant(...)getSpecialMethod(...)int sIdhandleBadServerId(...)/** Always throws OBJECT_NOT_EXIST if operation is not a special method. ... */SpecialMethod specialMethodisNonExistentMethod(...)boolean hasCodeSetContextprocessCodeSetContext(...)boolean isForeignORBSpecialMethod methodDynamicImplementation dynimplServerRequestImpl sreqnew ServerRequestImpl(...)handleDynamicResult(...)InvokeHandler invhandleOutputStream streamAny excanycheckResultCalled(...)sendingReply(...)marshalReplyParams(...)/** Must always be called, just after the servant's method returns. ... */CorbaMessageMediator respisSystemException(...)/** Handles setting the connection's code sets if required. ... */CodeSetServiceContext.SERVICE_CONTEXT_IDCodeSetContext csctx// Called only for its side-effect of throwing appropriate exceptions// to set the codebase information, if any transmitted; and also// appropriate ORB Version.// correct ORBVersion set, we must finish initializing the// stream.// Check that this server is the right server// Thrown by Portable Interceptors from InterceptorInvoker,// through Response constructor.// DO NOT CALL THIS HERE:// releaseServant(objectAdapter);// The problem is that OADestroyed is only thrown by oa.enter, in// which case oa.exit should NOT be called, and neither should// the invocationInfo stack be popped.// Destroyed POAs can be recreated by normal adapter activation.// So just restart the dispatch.// IDLJ generated non-tie based skeletons do not catch the// RequestCanceledException. Rethrow the exception, which will// cause the worker thread to unwind the dispatch and wait for// other requests.// RMIC generated tie skeletons convert all Throwable exception// types (including RequestCanceledException, ThreadDeath)// thrown during reading fragments into UnknownException.// If RequestCanceledException was indeed raised,// then rethrow it, which will eventually cause the worker// thread to unstack the dispatch and wait for other requests.// Prepare Portable Interceptors for a new server request// and invoke receive_request_service_contexts.  The starting// point may throw a SystemException or ForwardException.// This must be set just after the enter so that exceptions thrown by// enter do not cause// the exception reply to pop the thread stack and do an extra oa.exit.// Note: we do not know the MDI on a null servant.// We only end up in that situation if _non_existent called,// so that the following handleNullServant call does not throw an// we cannot depend on this since for our local case, we do not send// in this service context.  Can we rely on just the CodeSetServiceContext?// boolean rtSC = false; // Runtime ServiceContext// the RTSC is sent only once during session establishment.  We// need to find out if the CodeBaseRef is already set.  If yes,// then also the rtSC flag needs to be set to true// this is not possible for the LocalCase since there is no// IIOPConnection for the LocalCase// used for a case where we have JDK 1.3 supporting 1.0 protocol,// but sending 2 service contexts, that is not normal as per// GIOP rules, based on above information, we figure out that we// are talking to the legacy ORB and set the ORB Version Accordingly.// this special case tell us that it is legacy SUN orb// and not a foreign one// rtSC is not available for localcase due to which this generic// path would fail if relying on rtSC//if (giopVersion.equals(GIOPVersion.V1_0) && hasCodeSetContext && rtSC)// System.out.println("setting legacy ORB version");// If it didn't include our ORB version service context (below),// then it must be a foreign ORB.// try to get the ORBVersion sent as part of the ServiceContext// if any// Invoke on the servant using the portable DSI skeleton// Note: When/if dynimpl.invoke calls arguments() or// set_exception() then intermediate points are run.// Check if ServerRequestImpl.result() has been called// normal return// Marshal out/inout/return parameters into the ReplyMessage// Check if the servant set a SystemException or// UserException// Get the exception object from the Any// Marshal the exception back// Somehow a code set service context showed up in the local case.// If it's GIOP 1.0, it shouldn't have this context at all.  Our legacy// ORBs sent it and we need to know if it's here to make ORB versioning// decisions, but we don't use the contents.// Note on threading:// getCodeSetContext and setCodeSetContext are synchronized// on the Connection.  At worst, this will result in// multiple threads entering this block and calling// setCodeSetContext but not actually changing the// values on the Connection.// Alternative would be to lock the connection for the// whole block, but it's fine either way.// The connection's codeSetContext is null until we've received a// request with a code set context with the negotiated code sets.// Use these code sets on this connection// We had to read the method name using ISO 8859-1// (which is the default in the CDRInputStream for// char data), but now we may have a new char// code set.  If it isn't ISO8859-1, we must tell// the CDR stream to null any converter references// it has created so that it will reacquire// the code sets again using the new info.// This should probably compare with the stream's// char code set rather than assuming it's ISO8859-1.// (However, the operation name is almost certainly// ISO8859-1 or ASCII.)// If no code set information is ever sent from the client,// the server will use ISO8859-1 for char and throw an// exception for any wchar transmissions.// In the local case, we use ORB provided streams for// marshaling and unmarshaling.  Currently, they use// ISO8859-1 for char/string and UTF16 for wchar/wstring.OAInvocationInfo cachedInfogetCachedInfo(...)new OAInvocationInfo(...)checkForCompatibleServant(...)OADestroyed pdes// Note that info is shared across multiple threads// using the same subcontract, each of which may// have its own operation.  Therefore we need to clone it./** INSServerRequestDispatcher handles all INS related discovery request. The INS Service ... */// Need to signal one of OBJECT_HERE, OBJECT_FORWARD, OBJECT_NOT_EXIST.String insKeygetINSReference(...)/** getINSReference if it is registered in INSObjectKeyMap. */IOR entry// send a locate forward with the right IOR. If the insKey is not// registered then it will throw OBJECT_NOT_EXIST Exception// If entry is not null then the locate is with an INS Object key,// so send a location forward with the right IOR.// have its own operation.  Therefore we need to copy it.import LocalClientRequestDispatcherBaseServantObject servant;// REVISIT - This is called from TOAImpl.new ServantObject(...)this.servant.servant// DO NOT set the IOR to null.  (Un)exporting is only concerns// the servant not the IOR.  If the ior is set to null then// null pointer exceptions happen during an colocated invocation.// It is better to let the invocation proceed and get OBJECT_NOT_EXIST// from the server side.//ior = null;LocalClientRequestDispatcherBase$1boolean servantIsLocal;// Cached information needed for local dispatchObjectAdapterFactory oaf;ThreadLocal<> isNextCallValid;// the next call to isLocal should be valid// If isNextIsLocalValid.get() == Boolean.TRUE,RequestDispatcherRegistry sregisLocalOptimizationAllowed(...)/* Possible paths through ... *//** Check that the servant in info (which must not be null) is ... */// Normally, this test will never fail.  However, if the servant// and the stub were loaded in different class loaders, this test// When servant_preinvoke returns null, the stub will// recursively re-invoke itself.  Thus, the next call made from// the stub is another useLocalInvocation call.// REVISIT: Rewrite rmic.HelloTest and rmic.LocalStubTest// (which directly call servant_preinvoke)// then revert to exception again.// Thus, this method must call returnServant if it returns null.// Portable Interceptors and Servant Locators in the POA.// ObjectAdapter.returnServant calls are paired, as required for// cases we must be sure that ObjectAdapter.getServant and// by the stub UNLESS this method returns null.  However, in all// ServantObject.  Note that servant_postinvoke is always called// Look up the servant for this request and return it in aservantEnter(...)servantExit(...)RuntimeException runexcThreadDeath ex// So just reinvoke this method.// Cleanup after this call, then throw to allow// outer try to handle the exception appropriately.// ThreadDeath on the server side should not cause a client// side thread death in the local case.  We want to preserve// this behavior for location transparency, so that a ThreadDeath// has the same affect in either the local or remote case.// The non-colocated case is handled in iiop.ORB.process, which// throws the same exception./** If this exception is caught explicitly, this need to be rethrown. */int requestId;this.requestId/** This is a registry of all subcontract ID dependent objects.  This includes: ... */DenseIntMapImpl SDRegistry;// This happens when invoking a foreign IOR.// there is no more specific ID available.// The default subcontract ID to use ifDenseIntMapImpl CSRegistry;// ServerRequestDispatcher registryDenseIntMapImpl OAFRegistry;// ClientRequestDispatcher registryDenseIntMapImpl LCSFRegistry;// ObjectAdapterFactory registrySet<> objectAdapterFactories;// LocalClientRequestDispatcherFactory registrySet<> objectAdapterFactoriesView;// Set of all ObjectAdapterFactory instancesMap<> stringToServerSubcontract;// Read-only view of oaf instances// for special bootstrap IORs// ServerSubcontract// Map from obect key string tothis.defaultId// will similarly need to return the default ServerRequestDispatcher.// which must return a valid ServerRequestDispatcher.  A bad subcontract ID// result in a lookup in the named key table (stringToServerSubcontract),// malformed requests.  In particular, a bad MAGIC will// This is essential to proper handling of errors for// the default server delegate if no other match is found.// Note that both forms of getServerRequestDispatcher need to return// **************************************************// Methods to find the subcontract side subcontractCorbaServerRequestDispatcher sdelLocalClientRequestDispatcherFactory factoryOAInvocationInfo cachedInfo;ForwardException freqOADestroyed oades// XXX This should be in the SPI// InvocationInfo must be pushed before calling getInvocationServant// This is an error since no user of this implementation// should ever throw this exception// End of File// of subcontract - does not complicate subcontract registry.// Benefit: then in ContactInfo no need to do a direct new// handle what is done below.// different MessageMediator finishSendingRequest and waitForResponse// use same CorbaClientRequestDispatcherImpl but have// Rather than have separate CDR subcontract,CDROutputObject cdrOutputObjectORB inOrbByteBuffer inBufferMessage inMsgnew PrivilegedAction<CDRInputObject>(...) { ... }SharedCDRClientRequestDispatcherImpl$1new CDRInputObject(...)ORB inOrb2ByteBuffer inBuffer2Message inMsg2SharedCDRClientRequestDispatcherImpl$2// Create server-side input object.// Dispatch// REVISIT: Impl cast.// InputStream must be closed on the InputObject so that its// ByteBuffer can be released to the ByteBufferPool. We must do// this before we re-assign the cdrInputObject reference below.// No need to do anything since we're done with the input stream// and cdrInputObject will be re-assigned a new client-side input// object, (i.e. won't result in a corba error).// Create client-side input objectnew SpecialMethod[]new IsA(...)new GetInterface(...)new NonExistent(...)new NotExistent(...)...[] methods;// _is_aString clientIdboolean answerids.length// _get_interface// _non_existent// _not_existent/** com/sun/corba/se/impl/protocol/giopmsgheaders/AddressingDispositionHelper.java ... *//** This interface captures the CancelRequestMessage contract. ... */int CANCEL_REQ_MSG_SIZE;/** This implements the GIOP 1.0 CancelRequest header. ... */int request_id;Message.GIOPBigMagicMessage.GIOPCancelRequest// Accessor methodsthis.request_id// IO methodshandleInput(...)// class CancelRequestMessage_1_0/** This implements the GIOP 1.1 CancelRequest header. ... */// class CancelRequestMessage_1_1/** This implements the GIOP 1.2 CancelRequest header. ... */// class CancelRequestMessage_1_2/** This interface captures the FragmentMessage contract. ... *//** This implements the GIOP 1.1 Fragment header. ... */msg11.magicthis.GIOP_versionmsg11.GIOP_versionthis.flagsmsg11.flagsthis.message_typethis.message_size/* This will never be called, since we do not currently read the ... *//* 1.1 has no request_id; so nothing to write */// 1.1 has no fragment header and so no request_id// class FragmentMessage_1_1/** This implements the GIOP 1.2 Fragment header. ... */// This is currently never called.Message.GIOPFragmentmsg12.magicmsg12.GIOP_versionmsg12.flagsmsg12.message_type// class FragmentMessage_1_2/** com/sun/corba/se/impl/protocol/giopmsgheaders/IORAddressingInfo.java ... */int selected_profile_index;IOR ior;// class IORAddressingInfo/** com/sun/corba/se/impl/protocol/giopmsgheaders/IORAddressingInfoHelper.java ... */TCKind.tk_ulongIORAddressingInfo valuenew IORAddressingInfo(...)value.selected_profile_indexvalue.ior/** com/sun/corba/se/impl/protocol/giopmsgheaders/KeyAddr.java ... */short value;/** This interface captures the LocateReplyMessage contract. ... */int UNKNOWN_OBJECT;int OBJECT_HERE;int OBJECT_FORWARD;int OBJECT_FORWARD_PERM;int LOC_SYSTEM_EXCEPTION;// 1.2int LOC_NEEDS_ADDRESSING_MODE;/** This implements the GIOP 1.0 LocateReply header. ... */int locate_status;Message.GIOPLocateReplythis.locate_statusthis.iorisValidReplyStatus(...)CDRInputStream cdr// IOR may be written afterwards into the reply mesg body.// Note, this writes only the header information.// Static methodsORBUtilSystemException localWrapper// 1.0 LocateReply body does not contain SystemException// raises exception on error// The code below reads the reply body if status is OBJECT_FORWARD// class LocateReplyMessage_1_0/** This implements the GIOP 1.1 LocateReply header. ... */int reply_status;this.reply_status// Note, this writes only the header information. SystemException or// class LocateReplyMessage_1_1/** This implements the GIOP 1.2 LocateReply header. ... */String exClassName;int minorCode;CompletionStatus completionStatus;// default;String reposIdint statusthis.exClassNamethis.minorCodethis.completionStatus// reply mesg body.// IOR or GIOP::AddressingDisposition may be written afterwards into the// GIOP 1.2 LocateReply message bodies are not aligned on// 8 byte boundaries.// The code below reads the reply body in some cases// LOC_SYSTEM_EXCEPTION & OBJECT_FORWARD & OBJECT_FORWARD_PERM &// LOC_NEEDS_ADDRESSING_MODE// read GIOP::AddressingDisposition from body and resend the// original request using the requested addressing mode. The// resending is transparent to the caller.// class LocateReplyMessage_1_2/** This interface captures the LocateRequestMessage contract. ... *//** This implements the GIOP 1.0 LocateRequest header. ... */...[] object_key;ObjectKey objectKey;// Accessor methods (LocateRequestMessage interface)this.objectKeyextractObjectKey(...)this.object_keynullCheck(...)this.object_key.length// this will raise a MARSHAL exception upon errors.// class LocateRequestMessage_1_0/** This implements the GIOP 1.1 LocateRequest header. ... */int _len1// class LocateRequestMessage_1_1/** This implements the GIOP 1.2 LocateRequest header. ... */TargetAddress target;// this does AddressingDisposition check// class LocateRequestMessage_1_2/** This is the base interface for different message type interfaces. ... */int defaultBufferSize;// Generic constantsint GIOPBigEndian;int GIOPLittleEndian;int GIOPBigMagic;int GIOPLittleMagic;int GIOPMessageHeaderLength;byte LITTLE_ENDIAN_BIT;// Other useful constantsbyte MORE_FRAGMENTS_BIT;byte FLAG_NO_FRAG_BIG_ENDIAN;byte TRAILING_TWO_BIT_BYTE_MASK;byte THREAD_POOL_TO_USE_MASK;byte CDR_ENC_VERSION;// Encoding related constantsbyte JAVA_ENC_VERSION;byte GIOPRequest;// Message typesbyte GIOPReply;byte GIOPCancelRequest;byte GIOPLocateRequest;byte GIOPLocateReply;byte GIOPCloseConnection;byte GIOPMessageError;byte GIOPFragment;// 1.1 & 1.2:// Mutator methodsimport Class/** This class acts as the base class for the various GIOP message types. This ... */...[] giopHeader;// turned on.// This is only used when the giopDebug flag isint threadPoolToUse;// (encodingVersion >  0x00) implies Java serialization version.// (encodingVersion == 0x00) implies CDR encoding,MessageBase msgreadGIOPHeader(...)readGIOPBody(...)getTransportTCPReadTimeouts(...)ByteBuffer bufbyte requestEncodingVersionGIOPVersion orbVersionget_max_giop_header_time_to_wait(...)orb.giopDebugFlagByteBuffer viewBufferasReadOnlyBuffer(...)AreFragmentsAllowed(...)new RequestMessage_1_0(...)new RequestMessage_1_1(...)new RequestMessage_1_2(...)new LocateRequestMessage_1_0(...)new LocateRequestMessage_1_1(...)new LocateRequestMessage_1_2(...)new CancelRequestMessage_1_0(...)new CancelRequestMessage_1_1(...)new CancelRequestMessage_1_2(...)new ReplyMessage_1_0(...)new ReplyMessage_1_1(...)new ReplyMessage_1_2(...)new LocateReplyMessage_1_0(...)new LocateReplyMessage_1_1(...)new LocateReplyMessage_1_2(...)new Message_1_0(...)new Message_1_1(...)new FragmentMessage_1_1(...)new FragmentMessage_1_2(...)Message_1_0 msg10msg10.magicmsg10.GIOP_versionmsg10.byte_ordermsg.threadPoolToUsemsg10.message_typemsg10.message_sizereadSize(...)Message_1_1 msg11msg11.message_typemsg11.message_sizeByteBuffer viewBufbyte[] msgBufmsgBuf.length(...).giopHeadersetEncodingVersion(...)int msgSizeMinusHeaderMessageBase.GIOPMessageHeaderLengthget_max_time_to_wait(...)byte response_flagsTargetAddress targetnew TargetAddress(...)RequestMessage msgobject_key(...)RequestMessage requestMessageIIOPProfile profileObjectKey objKeybyte[] object_keyprofile(...)IORAddressingInfo iorInfogetIOPIOR(...)ior(...)getRequestPartitioningId(...)setThreadPoolToUse(...)ReplyMessage msgLocateReplyMessage msg/** Set a flag in the given buffer (fragment bit, byte order bit, etc) *//** Clears a flag in the given buffer *//** Construct an ObjectKey from a byte[]. ... */ObjectKey objectKey/** Extract the object key from TargetAddress. ... */short orbTargetAddrPrefgetGIOPTargetAddressPreference(...)short reqAddrDispdiscriminator(...)ORBConstants.ADDR_DISP_OBJKEYnew AddressingDispositionException(...)ORBConstants.ADDR_DISP_PROFILEORBConstants.ADDR_DISP_IORbyte[] objKeyIIOPProfile iiopProfileiorInfo.ior.profilesiorInfo.selected_profile_indexiorInfo.iorint a1int a2int a3int a4Class<>[] typesException someExsysEx.minorsysEx.completed// Since this is executed in debug mode only the overhead of// using a View Buffer is not an issue. We'll also use a// read-only View Buffer so we don't disturb the state of// byteBuffer.// Sanity checks/* check for magic corruption ... */// If Magic is incorrect, it is an error.// ACTION : send MessageError and close the connection.// Extract the encoding version from the request GIOP Version,// if it contains an encoding, and set GIOP version appropriately.// For Java serialization, we use GIOP Version 1.2 message format.// Entering this block means the request is using Java encoding,// and the encoding version is <= this ORB's Java encoding version.// For requests, sending ORB should use the version info// published in the IOR or may choose to use a <= version// for requests. If the version is greater than published version,// it is an error.// For replies, the ORB should always receive a version it supports// or less, but never greater (except for MessageError)// ACTION : Send back a MessageError() with the the highest version// the server ORB supports, and close the connection.// create appropriate messages types//msg = new RequestMessage(orb.giopDebugFlag);// 1.0// 1.1//msg = new LocateRequestMessage(orb.giopDebugFlag);//msg = new CancelRequestMessage(orb.giopDebugFlag);//msg = new ReplyMessage(orb.giopDebugFlag);//msg = new LocateReplyMessage(orb.giopDebugFlag);// REVISIT a MessageError  may contain the highest version server// can support. In such a case, a new request may be made with the// correct version or the connection be simply closed. Note the// connection may have been closed by the server.//msg = new Message(orb.giopDebugFlag);//msg = new FragmentMessage(orb.giopDebugFlag);// not possible (error checking done already)// unknown message type ?// ACTION : send MessageError and close the connection// Initialize the generic GIOP header instance variables.// 'request partitioning' not supported on GIOP version 1.0// so just use the default thread pool, 0.// 1.1 & 1.2// IMPORTANT: For 'request partitioning', the thread pool to use//            information is stored in the leading 6 bits of byte 6.// IMPORTANT: Request partitioning is a PROPRIETARY EXTENSION !!!// NOTE: Bitwise operators will promote a byte to an int before//       performing a bitwise operation and bytes, ints, longs, etc//       are signed types in Java. Thus, the need for the//       THREAD_POOL_TO_USE_MASK operation.// For debugging purposes, save the 12 bytes of the header// REVISIT: is giopHeader still used?// Note: Currently we use response_expected flag to decide if the// call is oneway or not. Ideally, it is possible to expect a// response on a oneway call too, but we do not support it now./* // REVISIT The following is the correct way to do it. This gives ... */// object key will be used for target addressing// only object_key based target addressing is allowed for// GIOP 1.0 & 1.1// iop profile will be used// ior will be used// profile index// invalid target addressing disposition value// add request partitioning thread pool to use info// default pool// This method is not currently used.// New fragment messages are always created from existing messages.// Creating a FragmentMessage from InputStream is done in// createFromStream(..)// XXX log this exception// This exception is thrown if any exceptions are raised while// extracting the object key or if the object key is empty.// AddressingDisposition::KeyAddr// AddressingDisposition::ProfileAddr// AddressingDisposition::IORAddr// this cannot happen// There is no need for a explicit exception, since the// TargetAddressHelper.read() would have raised a BAD_OPERATION// exception by now.// extracting the object key from the TargetAddress or if all the// the valid TargetAddress::AddressingDispositions are empty./** Interface which allows an implementation to use ... *//** Used for message types for which we don't have concrete classes, yet, ... *///           Should be handled internally.// REVISIT - These should not throw IOException.// Request// Reply// LocateRequest// LocateReply// Fragment// CancelRequest/* This implements the GIOP 1.0 Message header. ... */GIOPVersion GIOP_version;boolean byte_order;byte message_type;int message_size;this.byte_orderint patch// So, we would never need to read the Message Header off a CDRInputStream.// in order to choose the correct CDR Version, msg_type, and msg_size.// is read off java.io.InputStream (not a CDRInputStream) by IIOPConnection// This should do nothing even if it is called. The Message Header already// Patch the size field in the header./* this.magic = istream.read_long(); ... */// class Message_1_0/* This implements the GIOP 1.1 & 1.2 Message header. ... */int UPPER_THREE_BYTES_OF_INT_MASK;// Constantsbyte flags;// this.flags represents byte 6 here.// Add the poolToUse to the upper 6 bits of byte 6 of the GIOP header.// NOTE: This is a SUN PROPRIETARY EXTENSIONint tmpFlags/** Allows us to create a fragment message from any message type. */// in order to choose the correct CDR Version , msg_type, and msg_size.// off a java.io.InputStream (not a CDRInputStream) by IIOPConnection// This should do nothing even if it is called. The Message Header is read// IMPORTANT: Bitwise operations will promote//            byte types to int before performing//            bitwise operations. And, Java//            types are signed.// check for message type validity/* // A fragmented mesg can be created only if the current mesg' fragment ... */// class Message_1_1/** The byteBuffer is presumed to have contents of the message already ... */GIOPVersion gv// save// restore/** com/sun/corba/se/impl/protocol/giopmsgheaders/ProfileAddr.java ... *//** com/sun/corba/se/impl/protocol/giopmsgheaders/ReferenceAddr.java ... *//** This interface captures the ReplyMessage contract. ... */int NO_EXCEPTION;// please update the REPLY_MESSAGE_TO_PI_REPLY_STATUS table in PIHandlerImpl.// Note: If the value, order, or number of these constants change,int USER_EXCEPTION;int SYSTEM_EXCEPTION;int LOCATION_FORWARD;int LOCATION_FORWARD_PERM;int NEEDS_ADDRESSING_MODE;/** This implements the GIOP 1.0 Reply header. ... */ServiceContexts service_contexts;Message.GIOPReplythis.service_contextswriteNullServiceContext(...)// SYSTEM_EXCEPTION & LOCATION_FORWARD// do nothing. The client stub will read the exception from body./** This implements the GIOP 1.1 Reply header. ... */import CDRInputStream_1_2import CDROutputStream_1_2/** This implements the GIOP 1.2 Reply header. ... */// CORBA formal 00-11-0 15.4.2.2 GIOP 1.2 body must be// aligned on an 8 octet boundary.// Ensures that the first read operation called from the stub code,// during body deconstruction, would skip the header padding, that was// inserted to ensure that the body was aligned on an 8-octet boundary.// SYSTEM_EXCEPTION & LOCATION_FORWARD & LOCATION_FORWARD_PERM &// NEEDS_ADDRESSING_MODE// resending is transparent to the client program.// Ensures that the first write operation called from the stub code,// during body construction, would insert a header padding, such that// the body is aligned on an 8-octet boundary.// class ReplyMessage_1_2/** This interface captures the RequestMessage contract. ... */byte RESPONSE_EXPECTED_BIT;// interface RequestMessage/** This implements the GIOP 1.0 Request header. ... */boolean response_expected;String operation;Principal requesting_principal;// Accessor methods (RequestMessage interface)this.response_expectedthis.requesting_principal// Mutators// REVISIT Should we throw an exception or return null ?// No-op, must be GIOP Version 1.1 or greater// to support this SUN PROPRIETARY EXTENSION.// class RequestMessage_1_0/** This implements the GIOP 1.1 Request header. ... */...[] reserved;// Added in GIOP 1.1this.reservedint _o0this.reserved.length// class RequestMessage_1_1/** This implements the GIOP 1.2 Request header. ... */byte response_flags;this.response_flags/* case 1: LSBit[1] == 1 ... */// class RequestMessage_1_2/** com/sun/corba/se/impl/protocol/giopmsgheaders/TargetAddress.java ... */...[] ___object_key;TaggedProfile ___profile;IORAddressingInfo ___ior;short __discriminator;boolean __uninitialized;verifyobject_key(...)verifyprofile(...)verifyior(...)// class TargetAddress/** com/sun/corba/se/impl/protocol/giopmsgheaders/TargetAddressHelper.java ... */TypeCode _disTypeCode0UnionMember[] _members0new UnionMember[]Any _anyOf_members0new UnionMember(...)create_union_tc(...)TargetAddress valueshort _dis0byte[] _object_keyTaggedProfile _profileIORAddressingInfo _iorobject_key(...).length// Branch for object_key// Branch for profile// Branch for iorDelegate bootstrapDelegate;byte[] initialKeyIOR initialIORCORBALogDomains.ORB_RESOLVER/** For the BootStrap operation we do not expect to have more than one ... */boolean remarshalInputStream inStream// Create a new IOR with the magic of INIT// Invoke.// If there is a location forward then you will need// to invoke again on the updated information.// Just calling this same routine with the same host/port// does not take the location forward info into account.// The only reason a null objref is passed is to get the version of// invoke used by streams.  Otherwise the PortableInterceptor// call stack will become unbalanced since the version of// invoke which only takes the stream does not call// PortableInterceptor ending points.// Note that the first parameter is ignored inside invoke.// NOTE: do note trap and ignore errors.// Let them flow out.Resolver first;Resolver second;File file;Properties savedProps;long fileModified;this.fileString stringifiedObjectcheck(...)Enumeration<> theKeys/** Checks the lastModified() timestamp of the file and optionally ... */long lastModlastModified(...)FileInputStream fileISFileNotFoundException e// Obtain all the keys from the property objectimport IIOPEndpointInfoimport INSURLimport CorbalocURLimport CorbanameURL/** This class provides an Operation that converts from CORBA INS URL strings into ... */Resolver bootstrapResolver;NamingContextExt rootNamingContextExt;// Root Naming Context for default resolution of names.Object rootContextCacheLock;// The URLHandler to parse INS URL'sthis.bootstrapResolverint NIBBLES_PER_BYTE;int UN_SHIFT;/** This static method takes a Stringified IOR and converts it into IOR object. ... */// "UPPER NIBBLE" shift factor for <<EncapsInputStream sgetIORFromString(...)resolveINSURL(...)resolveCorbaname(...)resolveCorbaloc(...)/** resolves a corbaloc: url that is encapsulated in a CorbalocURL object. ... */getIORUsingCorbaloc(...)/** resolves a corbaname: url that is encapsulated in a CorbanameURL object. ... */NamingContextExt theNamingContextString StringifiedNamegetDefaultRootNamingContext(...)Object corbalocResultresolve_str(...)clearRootNamingContextCache(...)/** This is an internal method to get the IOR from the CorbalocURL object. ... */Map<> profileMapList<> profileList1_0List<> theEndpointInfoString theKeyStringObjectKey keyIIOPProfileTemplate pTemplateComparator<> compnew Comparator<>(...) { ... }INSURLOperationImpl$1GIOPVersion gv1GIOPVersion gv2IIOPEndpointInfo elementIIOPProfileTemplate profileTemplateAlternateIIOPAddressComponent iiopAddressComponentmakeAlternateIIOPAddressComponent(...)IIOPProfileTemplate pt/** This is required for corbaname: resolution. Currently we ... *//** A utility method to clear the RootNamingContext, if there is an ... */// Length must be even for str to be valid// XXX handle this as just another URL scheme// XXX resolve should be a method on INSURL// If RIR flag is true use the Bootstrap protocol// Case 1 of corbaname: rir#// Case 2 of corbaname: ::hostname#// This means return the Root Naming context// corbalocObject cannot be null, because it's validated during// parsing. So no null check is required.// If there is no KeyString then it's invalid// Add profile for GIOP version used by this ORB// Now remove this value from the map// Create a comparator that can sort in decending order (1.2, 1.1, ...)// Now sort using the above comparator// Add the profiles in the sorted order// Finally add the 1.0 profilesMap<> nameToClosure;Closure clOperation urlHandler;String orbDefaultInitRef;this.urlHandlerthis.orbDefaultInitRefString urlString// XXX Validate the URL?// If the ORBDefaultInitRef is not defined simply return null// If the ORBDefaultInitDef is  defined as corbaloc: then create the// corbaloc String in the format// <ORBInitDefaultInitDef Param>/<Identifier>// and resolve it using resolveCorbaloc methodMap<> orbInitRefTable;initRefs.lengthORB itsOrb;int itsByteBufferSize;ArrayList<> itsPool;int itsObjectCounter;// of ORB fragment size.// Construct a ByteBufferPool for a pool of NIO ByteBufferstheORB.transportDebugFlag// size, allocate a new non-direct ByteBuffer.// If the request ByteBuffer size is greater than the ORB fragment// then allocate a a DirectByteBuffer of ORB fragment size.// pool if there is one, if there is not one in the pool,// then get a DirectByteBuffer from the// direct byte buffers (normally for debugging purposes)// the ORB fragment size, and we have not disabled use of// If the requested ByteBuffer size is less than or equal to/* Locations where ByteBuffers are gotten from the pool: ... */ByteBuffer abbdisableDirectByteBufferUse(...)int poolSizeallocateDirect(...)//       here. An additional check could be added here for that though.//       ever allocated. Hence, only DirectByteBuffer are checked//       this pool's ByteBuffer size since only DirectByteBuffers// NOTE: The size of the ByteBuffer is not checked with the// the pool and caller is saying he/she is done with it.// Otherwise, set its reference to null since it's not kept in// If the ByteBuffer is a DirectByteBuffer, add it to the pool./* Locations where ByteBuffers are released to the pool: ... */isDirect(...)boolean refInPoolByteBuffer tmpbbString threadName//            purposes, it does not use synchronized access.// IMPORTANT: Since this counter is used only for information// (Those allocated and have not been returned to the pool).// Get a count of the outstanding allocated DirectByteBuffers.// check if there's one in the pool, if not allocate one.// clear ByteBuffer before returning it// NOTE: Moved the 'else' part of the above if statement//       outside the synchronized block since it is likely//       less expensive to check poolSize than to allocate a//       DirectByteBuffer in the synchronized block.// increment the number of ByteBuffers gotten from pool// Requested ByteBuffer size larger than the pool manages.// Just allocate a non-direct ByteBuffer// use with debug to determine if byteBuffer is already// in the pool.// Check to make sure we don't have 'thebb' reference// already in the pool before adding it.// NOTE: The else part of this if will only get called//       if debug = true and refInPool = true, see logic above.// add ByteBuffer back to the pool// otherwise, log a stack trace with duplicate message// decrement the count of ByteBuffers released// ByteBuffer not pooled nor neededimport CorbaConnectionCachelong timestamp;String cacheType;String monitoringName;this.cacheTypethis.monitoringNameregisterWithMonitoring(...)dprintCreation(...)// pept.transport.ConnectionCachesetTimeStamp(...)backingStore(...)closeConnectionResources(...)long countIterator<> connectionsisBusy(...)/** Discarding least recently used Connections that are not busy ... */long numberOfConnectionsnumberOfConnections(...)Object backingStoregetNumberToReclaim(...)getLowWaterMark(...)getHighWaterMark(...)Connection toCloselong lruLong.MAX_VALUEConnection cgetTimeStamp(...)// spi.transport.ConnectionCache// This is public so folb.Server test can access it.getMonitoringName(...)getCacheType(...)numberOfIdleConnections(...)numberOfBusyConnections(...)/* Copyright (c) 2001, 2010, Oracle and/or its affiliates. All rights reserved. ... */// _REVISIT_ Need to worry about wrap around some day// REVISIT - A less expensive alternative connection reclaiming//           algorithm could be investigated.// Find least recently used and not busy connection in cache// REVISIT - log// XXX is necessary to do a GC to reclaim// closed network connections ??// java.lang.System.gc();import CorbaMessageMediatorImplIOR effectiveTargetIOR;// NOTE: This may be different from same named one in CorbaContactInfoList.short addressingDisposition;OutboundConnectionCache connectionCache;// These are convenience methods that may not be used.// Note: not all derived classes will use a connection cache.this.connectionCache// Called when client making an invocation.new CorbaMessageMediatorImpl(...)chooseRequestVersion(...)getNextRequestId(...)getAddressingDisposition(...)// Called when connection handling a read event.shouldReadGiopHeaderOnly(...)readGIOPMessage(...)// Called when connection reading message bodyCorbaMessageMediator corbaMessageMediatorgetDispatchBuffer(...)setDispatchHeader(...)setDispatchBuffer(...)// spi.transport.CorbaContactInfo// REVISIT - remove this.// REVISIT: Would like version, ior, requestid, etc., decisions// to be in client subcontract.  Cannot pass these to this// factory method because it breaks generic abstraction.// Maybe set methods on mediator called from subcontract// after creation?// read giop header only// read entire giop message// read giop body only// REVISIT: Duplicate of acceptor code.import NotLocalLocalCRDImplLocalClientRequestDispatcher LocalClientRequestDispatcher;IOR targetIOR;List<> effectiveTargetIORContactInfoList;ContactInfo primaryContactInfo;setTargetIOR(...)createContactInfoList(...)new CorbaContactInfoListIteratorImpl(...)// spi.transport.CorbaContactInfoListthis.targetIORgetIIOPPrimaryToContactInfo(...)setLocalSubcontract(...)// REVISIT - hashCode(org.omg.CORBA.Object self)// org.omg.CORBA.portable.DelegateString hostnamecreateContactInfo(...)ContactInfo contactInfoaddRemoteContactInfos(...)List<> socketInfosgetSocketInfo(...)getIORToSocketInfo(...)new SocketOrChannelContactInfoImpl(...)/** setLocalSubcontract sets cached information that is set whenever ... */getLocalClientRequestDispatcherFactory(...)new NotLocalLocalCRDImpl(...)/* Copyright (c) 2002, 2006, Oracle and/or its affiliates. All rights reserved. ... */// For use by "sticky manager" if one is registered.// NOTE: IMPORTANT:// Only do local.  The APP Server interceptors check// effectiveTarget.isLocal - which is determined via// the IOR - so if we added other addresses then// transactions and interceptors would not execute.// XREVISIT - See Base Line 62// XXX Note that this always uses the first IIOP profile to get the// scid.  What about multi-profile IORs?  This should perhaps be// tied to the current ContactInfo in some way, together with an// implementation of ClientDelegate that generally prefers co-located// ContactInfo.  This may in fact mean that we should do this at// the ContactInfo level, rather than the IOR/profile level.// REVISIT: create a unit test for this class.CorbaContactInfo successContactInfo;CorbaContactInfo failureContactInfo;RuntimeException failureException;Iterator<> effectiveTargetIORIterator;// ITERATOR stateCorbaContactInfo previousContactInfo;boolean isAddrDispositionRetry;IIOPPrimaryToContactInfo primaryToContactInfo;List<> listOfContactInfos;// End ITERATOR statethis.primaryContactInfothis.effectiveTargetIORIteratorthis.listOfContactInfosthis.previousContactInfothis.isAddrDispositionRetrythis.successContactInfo// com.sun.corba.se.pept.transport.ContactInfoListIteratorupdateEffectiveTargetIOR(...)// spi.CorbaContactInfoListIteratorsetAddressingDisposition(...)// that exception.// Need to update CorbaClientRequestDispatchImpl to catch and use// way, go back to ContactInfoList and get a new iterator.// Essentially what you need to do is whenever the iterator fails this// timestamp may fail because the granularity is too coarse).// changes.  This is implemented by keeping a modification counter (the// ConcurrentModificationException whenever the underlying collection// The normal operation for a standard iterator is to throw// listOfContactInfos is null when used by the legacy// socket factory.  In that case this iterator is NOT used.// List is immutable so no need to synchronize access.// REVISIT: Implement as internal closure iterator which would// wraps sticky or default.  Then hasNext and next just call// the closure.// We hold onto the last in case we get an addressing// disposition retry.  Then we use it again.// We also hold onto it for the sticky manager.// If we report the exception in _request (i.e., beginRequest// we cannot throw RemarshalException to the stub because _request// does not declare that exception.// To keep the two-level dispatching (first level chooses ContactInfo,// second level is specific to that ContactInfo/EPT) we need to// ensure that the request dispatchers get their iterator from the// InvocationStack (i.e., ThreadLocal). That way if the list iterator// needs a complete update it happens right here.import CorbaAcceptorCollection<> connectionCache;Acceptor acceptor;getConnectionCacheType(...)this.acceptor// pept.transport.InboundConnectionCachesetConnectionCache(...)dprintStatistics(...)MonitoredObject orbMOgetMonitoringManager(...)MonitoredObject connectionMOMonitoringConstants.CONNECTION_MONITORING_ROOTMonitoredObject inboundConnectionMOMonitoringConstants.INBOUND_CONNECTION_MONITORING_ROOTMonitoredObject thisMOLongMonitoredAttributeBase attributeMonitoringConstants.CONNECTION_MONITORING_ROOT_DESCRIPTIONMonitoringConstants.INBOUND_CONNECTION_MONITORING_ROOT_DESCRIPTIONMonitoringConstants.CONNECTION_MONITORING_DESCRIPTIONCorbaInboundConnectionCacheImpl$1MonitoringConstants.CONNECTION_TOTAL_NUMBER_OF_CONNECTIONSMonitoringConstants.CONNECTION_TOTAL_NUMBER_OF_CONNECTIONS_DESCRIPTIONCorbaInboundConnectionCacheImpl.thisCorbaInboundConnectionCacheImpl$2MonitoringConstants.CONNECTION_NUMBER_OF_IDLE_CONNECTIONSMonitoringConstants.CONNECTION_NUMBER_OF_IDLE_CONNECTIONS_DESCRIPTIONCorbaInboundConnectionCacheImpl$3MonitoringConstants.CONNECTION_NUMBER_OF_BUSY_CONNECTIONSMonitoringConstants.CONNECTION_NUMBER_OF_BUSY_CONNECTIONS_DESCRIPTION// ORB// REVISIT - add ORBUtil mkdir -p like operation for this.// CONNECTION// INBOUND CONNECTION// NODE FOR THIS CACHE// ATTRIBUTEHashtable<> connectionCache;// pept.transport.OutboundConnectionCacheMonitoredObject outboundConnectionMOMonitoringConstants.OUTBOUND_CONNECTION_MONITORING_ROOTMonitoringConstants.OUTBOUND_CONNECTION_MONITORING_ROOT_DESCRIPTIONCorbaOutboundConnectionCacheImpl$1CorbaOutboundConnectionCacheImpl.thisCorbaOutboundConnectionCacheImpl$2CorbaOutboundConnectionCacheImpl$3// OUTBOUND CONNECTIONCorbaResponseWaitingRoomImpl$OutCallDescObject done;Thread thread;SystemException exception;InputObject inputObject;Map<Integer,OutCallDesc> out_calls;// Maps requestId to an OutCallDesc.new HashMap<Integer,OutCallDesc>(...)// pept.transport.ResponseWaitingRoomInteger requestIdgetRequestIdInteger(...)OutCallDesc callnew OutCallDesc(...)call.threadcall.messageMediatorInputObject returnStreamcall.donecall.inputObjectcall.exceptionLocateReplyOrReplyMessage header// CorbaResponseWaitingRoomCorbaMessageMediator corbaMsgMediator// The waiter is removed in releaseReply in the same// way as a normal request.// Wait for the reply from the server.// The ReaderThread reads in the reply IIOP message// and signals us.// REVISIT -- exceptions from unmarshaling code will// go up through this client thread!// On fragmented streams the header MUST be unmarshaled here// (in the client thread) in case it blocks.// If the header was already unmarshaled, this won't// do anything// REVISIT: cast - need interface method.// This is an interesting case.  It could mean that someone sent us a// reply message, but we don't know what request it was for.  That// would probably call for an error.  However, there's another case// that's normal and we should think about --// If the unmarshaling thread does all of its work inbetween the time// the ReaderThread gives it the last fragment and gets to the// out_calls.get line, then it will also be null, so just return;// Set the reply InputObject and signal the client thread// that the reply has been received.// The thread signalled will remove outcall descriptor if appropriate.// Otherwise, it'll be removed when last fragment for it has been put on// BufferManagerRead's queue.// anything waiting for BufferManagerRead's fragment queue// needs to be cancelled// IMPORTANT: If inputObject is null, then no need to tell//            BufferManagerRead to cancel request processing.// attempt to wake up waiting threads in all cases// This can happen when getting early reply fragments for a// request which has completed (e.g., client marshaling error).List<> acceptors;Map<> outboundConnectionCaches;Map<> inboundConnectionCaches;Selector selector;new SelectorImpl(...)// pept TransportManagergetConnectionCache(...)new CorbaOutboundConnectionCacheImpl(...)InboundConnectionCache connectionCachenew CorbaInboundConnectionCacheImpl(...)Object ccObject iccunregisterAcceptor(...)// CorbaTransportManagershouldRegisterAcceptEvent(...)// REVISIT - POA specific policiesCorbaAcceptor acceptoraddToIORTemplate(...)// implemenation// REVISIT - impl/poa specific:// REVISIT: Would like to be able to configure// the connection cache type used.// REVISIT - need to filter based on arguments.// REVISIT - initialization will be moved to OA.// Lazy initialization of acceptors.IIOPProfileTemplate iiopProfileTemplatecreateSocketInfo(...)AlternateIIOPAddressComponent alternategetAddress(...)new SocketInfo(...) { ... }DefaultIORToSocketInfoImpl$1// NOTE: we could check for 0 (i.e., CSIv2) but, for a// non-CSIv2-configured client ORB talking to a CSIv2 configured// server ORB you might end up with an empty contact info list// which would then report a failure which would not be as// instructive as leaving a ContactInfo with a 0 port in the list.import SocketExceptionnew PrivilegedAction<Boolean>(...) { ... }DefaultSocketFactoryImpl$1boolean keepAlive;connectionSocketType(...)setKeepAlive(...)// Disable Nagle's algorithm (i.e., always send immediately).Work work;boolean useWorkerThreadForEvent;boolean useSelectThreadToWait;SelectionKey selectionKey;// EventHandler methodsthis.selectionKey/* NOTE: ... */interestOps(...)getSelectionKey(...)getInterestOps(...)Throwable throwableaddWork(...)getWorkQueue(...)getWork(...)getThreadPool(...)NoSuchThreadPoolException eNoSuchWorkQueueException eINTERNAL ithis.work// REVISIT: need to close connection.import ListenerThreadboolean keepRunning;long enqueueTime;this.selector// ListenerThread methods.// REVISIT - this needs alot more from previous ListenerThread// Work methods.accept(...)int initial_time_to_wait;int max_time_to_wait;int max_giop_header_time_to_wait;double backoff_factor;this.initial_time_to_waitthis.max_time_to_waitthis.max_giop_header_time_to_waitthis.backoff_factorimport ReaderThread// ReaderThread methods.// REVISIT - this needs alot more from previous ReaderThread.// REVISIT - put in pool;import ClosedChannelExceptionimport SelectableChannelimport ClosedSelectorExceptionlong timeout;List<> deferredRegistrations;List<> interestOpsList;HashMap<> listenerThreads;Map<> readerThreads;boolean selectorStarted;boolean closed;this.timeoutSelectionKey selectionKeyint ehOpsSelectionKeyAndOp keyAndOpnew SelectionKeyAndOp(...)wakeup(...)isClosed(...)startSelector(...)SelectionKey.OP_ACCEPTcreateListenerThread(...)SelectionKey.OP_READcreateReaderThread(...)cancel(...)destroyListenerThread(...)destroyReaderThread(...)setClosed(...)ListenerThread listenerThreadReaderThread readerThreadclearDeferredRegistrations(...)// Thread methods.selectedKeys(...)handleDeferredRegistrations(...)enableInterestOps(...)select(...)ClosedSelectorException csExattachment(...)handleEvent(...)/////////////////////////////////////////////////////int deferredListSizeSelectableChannel channelattach(...)IOException ioExthis.closedClosedChannelException esetSelectionKey(...)int listSizeint keyOpint selectionKeyOpskeyAndOp.selectionKeykeyAndOp.keyOpnew ListenerThreadImpl(...)new ReaderThreadImpl(...)//           directly.// REVISIT - Could do away with this class and use the EventHanlder// Op.// Used only by SelectorImpl to register and enable SelectionKey// Private class to contain a SelectionKey and a SelectionKey op.int keyOp;// A SelectionKey.[OP_READ|OP_WRITE|OP_ACCEPT|OP_CONNECT]this.keyOp// tell Selector Thread there's an update to a SelectorKey's Ops// wakeup Selector thread to process close request// Kill listeners.// Kill readers.// Selector/* if (timeout == 0 && orb.transportDebugFlag) { ... */// IMPORTANT: ignore all errors so the select thread keeps running.// Otherwise a guaranteed hang.// REVISIT - better handling/reporting// Need to check if the SelectionKey is valid because a// connection's SelectionKey could be put on the list to// have its OP enabled and before it's enabled be reclaimed.// Otherwise, the enabling of the OP will throw an exception// here and exit this method an potentially not enable all// registered ops.// So, we ignore SelectionKeys that are invalid. They will get// cleaned up on the next Selector.select() call.import SharedCDRClientRequestDispatcherImpl// Rather than rewrite the test, just fake it.// It tests that request ids are different.// This is only necessary for the pi.clientrequestinfo test.new SharedCDRClientRequestDispatcherImpl(...)// REVISIT - use registry/// XXX LOGGING// Connection;// Fake RequestId// NOTE: GROW.import RequestPartitioningPolicy// END Legacy support.ServerSocketChannel serverSocketChannel;ServerSocket serverSocket;InboundConnectionCache connectionCache;setWork(...)// BEGIN Legacy support.// pept.transport.AcceptorInetSocketAddress inetSocketAddressgetListenOnAllInterfaces(...)getInboundConnectionCache(...)acceptorSocketUseSelectThreadToWait(...)setUseWorkerThreadForEvent(...)acceptorSocketUseWorkerThreadForEvent(...)new SocketOrChannelConnectionImpl(...)setAcceptedSocketOptions(...)shouldRegisterServerReadEvent(...)Selector selector// CorbaAcceptorIIOPAddress iiopAddressint templatePortIIOPProfileTemplate iiopProfilelegacyGetPersistentServerPort(...)RequestPartitioningPolicy rpPolicyORBConstants.REQUEST_PARTITIONING_POLICYmakeRequestPartitioningComponent(...)makeJavaSerializationComponent(...)/* CONFLICT: with legacy below. ... */isAcceptable(...)String permissionStrgetClassSecurityInfo(...)// REVISIT: refactor into common base or delegate.// Factory methods.finishCreatingMessageMediator(...)// SocketOrChannelAcceptorString sock// LegacyServerSocketEndPointInfo and EndPointInfo// BEGIN Legacy support// REVISIT impl/poa specific// Determine the listening port (for the IOR).// This is important when using emphemeral ports (i.e.,// when the port value to the constructor is 0).// Register with transport (also sets up monitoring).// Finish configuation.// Configure to use listener and reader threads.// NOTE: The connection MUST be put in the cache BEFORE being// registered with the selector.  Otherwise if the bytes// are read on the connection it will attempt a time stamp// but the cache will be null, resulting in NPE.// A connection needs to be timestamped before putting to the cache.// Otherwise the newly created connection (with 0 timestamp) could be// incorrectly reclaimed by concurrent reclaim() call OR if there// will be no events on this connection then it could be reclaimed// by upcoming reclaim() call.// REVISIT - need to close - recreate - then register new one.// NOTE: if register cycling we do not want to shut down ORB// since local beans will still work.  Instead one will see// a growing log file to alert admin of problem.// REVISIT - how does this play with legacy ORBD port exchange?// IMPORTANT: To avoid bug (4953599), we force the// Thread that does the NIO select to also do the// enable/disable of Ops using SelectionKey.interestOps().// Otherwise, the SelectionKey.interestOps() may block// indefinitely.// NOTE: If "acceptorSocketUseWorkerThreadForEvent" is// set to to false in ParserTable.java, then this method,// doWork(), will get executed by the same thread// (SelectorThread) that does the NIO select.// If "acceptorSocketUseWorkerThreadForEvent" is set// to true, a WorkerThread will execute this method,// doWork(). Hence, the registering of the enabling of// the SelectionKey's interestOps is done here instead// of calling SelectionKey.interestOps(<interest op>).// REVISIT - no factoring so cheat to avoid code dup right now.// REVISIT **** COUPLING !!!!// Kluge alert:// Work and Legacy both define getName.// Try to make this behave best for most cases.// END Legacy supportimport ResponseWaitingRoomimport CorbaResponseWaitingRoomImplnew CachedCodeBase(...)boolean dprintWriteLocks;// New transport.SocketChannel socketChannel;// protected for test: genericRPCMSGFramework.IIOPConnection constructor.ConnectionCache connectionCache;Socket socket;// From iiop.Connection.javalong timeStamp;// The socket used for this connection.boolean isServer;// value in some protocols.// Start at some value other than zero since this is a magicCorbaResponseWaitingRoom responseWaitingRoom;Object stateEvent;Object writeEvent;boolean writeLocked;int serverRequestCount;Map<> serverRequestMap;// Maps request ID to IIOPInputStream.// Server request map: used on the server side of Connectionboolean postInitialContexts;// already...// initial set of sending contexts were sent to the receiver// This is a flag associated per connection telling us if theIOR codeBaseServerIOR;// FullValueDescription, among other things)// Remote reference to CodeBase server (suppliesCachedCodeBase cachedCodeBase;// necessary.// handle connecting, and ensure we don't do any remote operations until// CodeBase cache for this connection.  This will cache remote operations,// transport read timeout valuesboolean shouldReadGiopHeaderOnly;CorbaMessageMediator partialMessageMediator;// SelectorThread and WorkerThread.// true to maintain request message state across execution in a// A message mediator used when shouldReadGiopHeaderOnly is// Used in genericRPCMSGFramework test.new CorbaResponseWaitingRoomImpl(...)setReadTimeouts(...)// Both client and servers.// Client constructor.// Client-side convenience.// Server-side constructor.this.socket// Server-side convenience// framework.transport.ConnectionreadBits(...)sendMessageError(...)getSocketChannel(...)getSocket(...)StringBuffer bbsbString bbmsgint bytecountlong time_to_waitget_initial_time_to_wait(...)long total_time_in_waitget_backoff_factor(...)// To support non-channel connections.hasRemaining(...)getOutputStream(...)/** Note:it is possible for this to be called more than once */sendCloseConnection(...)// other means?  XREVISIT// Can we determine if we are on the server side by// throw the correct error when handling code sets.// This is used by the GIOPOutputObject in order tonumberRegistered(...)/** Sets the writeLock for this connection. ... */int localState// Assumes the caller handles writeLock and writeUnlockIOException e1setReadGiopHeaderOnly(...)//    public Acceptor getAcceptor() - already defined above.getPartialMessageMediator(...)finishReadingBits(...)// IMPORTANT: Reader Threads must NOT read Giop header only.// spi.transport.CorbaConnection.// higher interface.// REVISIT - inteface defines isServer but already defined in// com.sun.corba.se.spi.legacy.connection.Connection// REVISIT: this is also defined in:/** It is possible for a Close Connection to have been ... */CodeSetComponentInfo.CodeSetContext codeSetContext;// Negotiated code sets for char and wchar data// so it doesn't incur synchronization overhead.// new fragments.  Only the ReaderThread touches the clientReplyMap,// ReaderThread can still obtain the input stream to give// the reply and remove it from the out_calls map while the// This is so the client thread can start unmarshaling// Map request ID to an InputObject.// from iiop.IIOPConnection.javaMessageMediator clientReply_1_1;MessageMediator serverRequest_1_1;// Can never be unset.../** Wake up the outstanding requests on the connection, and hand them ... */int minor_codesystemException.minorCompletionStatus completion_statusORBUtilSystemException.CONNECTION_REBINDsystemException.completedsignalExceptionToAllWaiters(...)createCloseConnection(...)sendHelper(...)createMessageError(...)/** Send a CancelRequest message. This does not lock the connection, so the ... */createCancelRequest(...)sendCancelRequest(...)// Our ORBs always send this, but it's optional in CORBA.// getting the IOR out of the SendingContext service context.// Sets this connection's code base IOR.  This is done after// that would be after the set.// first possible get would occur during reading a valuetype, and// The set and get methods don't need to be synchronized since the// JavaSoft ORBs send it.// SendingContext.  This is an optional service context, but all// Set this connection's code base IOR.  The IOR comes from the// Begin Code Base methods ---------------------------------------// won't connect to the remote codebase unless it's necessary.// Get a CodeBase stub to use in unmarshaling.  The CachedCodeBase// set transport read thresholds// End Code Base methods -----------------------------------------this.readTimeouts// Must be public - used in encoding.// Null can happen when client closes stream// causing purgecalls.// REVISIT - use common factory base class.// REVISIT - make sure reader thread is killed.// Notify anyone waiting.//keepRunning = false;// REVISIT - if this is called after purgeCalls then// the state of the socket is ABORT so the writeLock// in close throws an exception.  It is ignored but// causes IBM (screen scraping) tests to fail.//close();// This call is the transition from the tranport block// to the protocol block.// The reading of data incorporates a strategy to detect a// rogue client. The strategy is implemented as follows. As// long as data is being read, at least 1 byte or more, we// assume we have a well behaved client. If no data is read,// then we sleep for a time to wait, re-calculate a new time to// wait which is lengthier than the previous time spent waiting.// Then, if the total time spent waiting does not exceed a// maximum time we are willing to wait, we attempt another// read. If the maximum amount of time we are willing to// spend waiting for more data is exceeded, we throw an// IOException.// NOTE: Reading of GIOP headers are treated with a smaller//       maximum time to wait threshold. Based on extensive//       performance testing, all GIOP headers are being//       read in 1 read access.// ignore exception// failed to read entire message/* NOTE: cannot perform this test.  If one ask for a ... */// IMPORTANT: For non-blocking SocketChannels, there's no guarantee//            all bytes are written on first write attempt.// TimeStamp connection to indicate it has been used// Note granularity of connection usage is assumed for// now to be that of a IIOP packet.// REVISIT It will be good to have a read lock on the reader thread// before we proceed further, to avoid the reader thread (server side)// from processing requests. This avoids the risk that a new request// will be accepted by ReaderThread while the ListenerThread is// attempting to close this connection.// we are busy!// stop the reader without causing it to do purgeCalls//Exception ex = new Exception();//reader.stop(ex); // REVISIT// NOTE: !!!!!!// This does writeUnlock().// REVISIT - remove this method from Connection and all it subclasses.// REVISIT: ASSERT// Keep looping till we can set the writeLock.// somebody has changed 'state' so be careful// Loop back// do not stay here too long if state != ESTABLISHED// Bug 4752117// XXX// Need to distinguish between client and server roles// here probably.// the connection has been closed or closing// ==> throw rebind exception// wake up one guy waiting to write// Don't we need to check for CloseConnection// here?  REVISIT// XREVISIT - Shouldn't the MessageMediator// be the one to handle writing the data here?// Write the fragment/message// REVISIT - no flush?//socket.getOutputStream().flush();/* ADDED(Ram J) 10/13/2000 In the event of an IOException, try ... */// Since IIOPOutputStream's msgheader is set only once, and not// altered during sending multiple fragments, the original// msgheader will always have the requestId.// REVISIT This could be optimized to send a CancelRequest only// if any fragments had been sent already./* REVISIT: MOVE TO SUBCONTRACT ... */// REVISIT When a send failure happens, purgeCalls() need to be// called to ensure that the connection is properly removed from// further usage (ie., cancelling pending requests with COMM_FAILURE// with an appropriate minor_code CompletionStatus.MAY_BE).// Relying on the IIOPOutputStream (as noted below) is not// sufficient as it handles COMM_FAILURE only for the final// fragment (during invoke processing). Note that COMM_FAILURE could// happen while sending the initial fragments.// Also the IIOPOutputStream does not properly close the connection.// It simply removes the connection from the table. An orderly// closure is needed (ie., cancel pending requests on the connection// COMM_FAILURE as well.// IIOPOutputStream will cleanup the connection info when it// sees this exception.// REVISIT - Reading of a GIOP header only is information//           that should be passed into the constructor//           from the SocketOrChannelConnection factory.// IMPORTANT: Sanity checks on SelectionKeys such as//            SelectorKey.isValid() should not be done//            here.// get the partialMessageMediator// created by SelectorThread// read remaining info needed in a MessageMediator// Needs to be synchronized for the following case when the client// doesn't send the code set context twice, and we have two threads// in ServerRequestDispatcher processCodeSetContext.// Thread A checks to see if there is a context, there is none, so//     it calls setCodeSetContext, getting the synch lock.// Thread B checks to see if there is a context.  If we didn't synch,//     it might decide to outlaw wchar/wstring.// Double check whether or not we need to do this// If the client says it's negotiated a code set that// isn't a fallback and we never said we support, then// it has a bug.// If this invocation is a result of ThreadDeath caused// by a previous execution of this routine, just exit.// Grab the writeLock (freeze the calls)// Mark the state of the connection// and determine the request status// Signal all threads with outstanding requests on this// connection and give them the SystemException;// REVISIT: Stop the reader thread// Signal all the waiters of the writeLock.// There are 4 types of writeLock waiters:// 1. Send waiters:// 2. SendReply waiters:// 3. cleanUp waiters:// 4. purge_call waiters:// REVISIT: See comments in CDROutputObject constructor.import CorbaContactInfoBaseboolean isHashCodeCached;int cachedHashCode;String socketType;this.socketTypeCorbaTransportManager.SOCKET_OR_CHANNEL_CONNECTION_CACHESocketOrChannelContactInfoImpl otherother.socketTypeimport Dictionary/** IdentityHashtable is a modified copy of the 1.1.6 Hashtable class which ... */...[] table;/** The hash table data. */int count;/** The total number of entries in the hash table. */int threshold;/** Rehashes the table when count exceeds this threshold. */float loadFactor;/** The load factor for the hashtable. *//** Constructs a new, empty hashtable with the specified initial ... */this.loadFactornew IdentityHashtableEntry[]/** Constructs a new, empty hashtable with the specified initial capacity ... *//** Constructs a new, empty hashtable with a default capacity and load ... *//** Returns the number of keys in this hashtable. ... *//** Tests if this hashtable maps no keys to values. ... *//** Returns an enumeration of the keys in this hashtable. ... */new IdentityHashtableEnumerator(...)/** Returns an enumeration of the values in this hashtable. ... *//** Tests if some key maps into the specified value in this hashtable. ... */IdentityHashtableEntry[] tabtab.lengthIdentityHashtableEntry ee.value/** Tests if the specified object is a key in this hashtable. ... */e.hash/** Returns the value to which the specified key is mapped in this hashtable. ... *//** Rehashes the contents of the hashtable into a hashtable with a ... */table.lengthIdentityHashtableEntry[] oldTableIdentityHashtableEntry[] newTableIdentityHashtableEntry oldold.next/** Maps the specified <code>key</code> to the specified ... */new IdentityHashtableEntry(...)Object oldrehash(...)/** Removes the key (and its corresponding value) from this ... */IdentityHashtableEntry prev/** Clears this hashtable so that it contains no keys. ... *//** Returns a rather long string representation of this hashtable. ... */StringBuffer bufEnumeration<> k//System.out.println("rehash old=" + oldCapacity + ", new=" + newCapacity + ", thresh=" + threshold + ", count=" + count);// Make sure the value is not null// Makes sure the key is not already in the hashtable.// Rehash the table if the threshold is exceeded// Creates the new entry./** IdentityHashtable collision list. */int hash;IdentityHashtableEntry next;/** A hashtable enumerator class.  This class should remain opaque ... */boolean keys;IdentityHashtableEntry entry;this.tablethis.keysnew NoSuchElementException(...)/** Utility methods for doing various method calls which are used ... */setCodebaseProperties(...)/** Get local codebase System property (java.rmi.server.codebase). ... *//** Return true if the system property "java.rmi.server.useCodebaseOnly" ... */loadClassM(...)String LOCAL_CODEBASE_KEY;String USE_CODEBASE_ONLY_KEY;String localCodebase;boolean useCodebaseOnly;/** Set the codebase and useCodebaseOnly properties. This is public ... */String prop/** Set the default code base. This method is here only ... */MalformedURLException e/* Copyright (c) 1995, 2004, Oracle and/or its affiliates. All rights reserved. ... *//* // If on 1.2, use a policy with all permissions. ... *//** Utility method for crawling call stack to load class */new JDKClassLoaderCache(...)JDKClassLoader$1JDKClassLoaderCache classCache;createKey(...)getLatestUserDefinedLoader(...)knownToFail(...)recordFailure(...)JDKClassLoader$JDKClassLoaderCache/** Private cache implementation specific to JDKClassLoader. */// can abort early next time.// ClassLoader.  Note this in our cache so JDKClassLoader// JDKClassLoader couldn't find the class with the locatedJDKClassLoaderCache.KNOWN_TO_FAIL// expensive to create.// the latest user defined class loader, so it's fairly// A key currently consists of the class name as well as// of JDKClassLoaderCache).// Factory for a key (CacheKey is an implementation detailnew CacheKey(...)// and ClassLoader is known to fail.// Determine whether or not this combination of class nameMap<> cache;// Synchronized WeakHashMapObject KNOWN_TO_FAIL;// key// no way JDKClassLoader could succeed with the given// Cache result used to mark the caches when there isJDKClassLoader$JDKClassLoaderCache$CacheKey// user defined class loader// Key consisting of the class name and the latestString className;this.className// into the hashcode// Try to incorporate both class name and loaderCacheKey otherother.classNameother.loader// Maintain the same error semantics as Class.forName()// It would be nice to bypass JDKClassLoader's attempts completely// if it's known that the latest user defined ClassLoader will// fail.// Otherwise, we end up calling Class.forName here as well as in// the next step in JDKBridge.  That can take a long time depending// on the length of the classpath.// Note: Looking at the only place in JDKBridge where this code// is invoked, it is clear that aClass will always be null.// See createKey for a description of what's involved// Loading this class with the call stack// loader isn't known to fail, so try// to load it.// Record that we failed to find the class// with this particular loader.  This way, we won't// waste time looking with this loader, again.// WeakHashMap may compare null keys// I've made a decision to actually compare the// loader references.  I don't want a case when// two loader instances override their equals// methods and only compare code base.// This way, at worst, our performance will// be slower, but we know we'll do the correct// loading.String ORB_CLASS;String ORB_SINGLETON_CLASS;File propFileFileOutputStream out// Check if orb.properties exists// Write properties to orb.properties/** PackagePrefixChecker provides static utility methods for getting package prefixes. ... */String PACKAGE_PREFIX;hasBeenPrefixed(...)// || p.startsWith("com.sun.") || p.equals("com.sun")ObjectStreamClass.kDefaultUIDuseCodebaseOnly(...)computeValueTag(...)ClassDesc.classnew RepositoryIdCache(...)...[] IDL_IDENTIFIER_CHARS;// legal use of '.' in a Java name.// uniformly, and is safe because that is the only// qualified Java name with '.' package separators// not legal in IDL. This allows us to treat a fully// that '.' (2E) is marked as legal even though it is// Legal IDL Identifier characters (1 = legal). NoteString defaultServerURL;IdentityHashtable classToRepStr;IdentityHashtable classIDLToRepStr;IdentityHashtable classSeqToRepStr;IdentityHashtable repStrToByteArray;Hashtable<> repStrToClass;String repId;boolean isSupportedFormat;String versionString;boolean isSequence;boolean isRMIValueType;boolean isIDLType;String completeClassName;String unqualifiedName;String definedInId;String suid, ...;long suidLong, ...;String kSequenceKeyword;// Repository ID fragmentsString kValuePrefix;String kIDLPrefix;String kIDLNamePrefix;String kIDLClassnamePrefix;String kSequencePrefix;String kCORBAPrefix;String kArrayPrefix;int kValuePrefixLength;int kIDLPrefixLength;int kSequencePrefixLength;String kInterfaceHashCode;String kInterfaceOnlyHashStr;String kExternalizableHashStr;int kInitialValueTag;// Value tag utility methods and constantsint kNoTypeInfo;int kSingleRepTypeInfo;int kPartialListTypeInfo;int kChunkedMask;int kPreComputed_StandardRMIUnchunked;int kPreComputed_CodeBaseRMIUnchunked;int kPreComputed_StandardRMIChunked;int kPreComputed_CodeBaseRMIChunked;int kPreComputed_StandardRMIUnchunked_NoRep;int kPreComputed_CodeBaseRMIUnchunked_NoRep;int kPreComputed_StandardRMIChunked_NoRep;int kPreComputed_CodeBaseRMIChunked_NoRep;String kWStringValueVersion;// String// would be more efficient and easier to maintain...// _REVISIT_ : A table structure with a good search routine for all of this// Public, well known repository IDsString kWStringValueHash;String kWStringStubValue;String kWStringTypeStr;String kWStringValueRepID;String kAnyRepID;// AnyString kClassDescValueHash;// Anita4: convert to uppercase// ClassString kClassDescStubValue;String kClassDescTypeStr;String kClassDescValueRepID;String kObjectValueHash;// ObjectString kObjectStubValue;String kSequenceValueHash;// SequenceString kPrimitiveSequenceValueHash;String kSerializableValueHash;// SerializableString kSerializableStubValue;String kExternalizableValueHash;// ExternalizableString kExternalizableStubValue;String kRemoteValueHash;// Remote (The empty string is used for java.rmi.Remote)String kRemoteStubValue;String kRemoteTypeStr;String kRemoteValueRepID;Hashtable<> kSpecialArrayTypeStrings;Hashtable<> kSpecialCasesRepIDs;Hashtable<> kSpecialCasesStubValues;Hashtable<> kSpecialCasesVersions;Hashtable<> kSpecialCasesClasses;Hashtable<> kSpecialCasesArrayPrefix;Hashtable<> kSpecialPrimitives;...[] ASCII_HEX;/** Used to convert ascii to hex. */RepositoryIdCache cache;// in a subclass.// bug fix for 4328952; to eliminate possibility of overriding thisString kjava_rmi_Remote;// Interface Rep ID StringsString korg_omg_CORBA_Object;...[] kNoParamTypes;// Dummy arguments for getIdFromHelper method...[] kNoArgs;// RepositoryId.cache.getId( id );// To create a RepositoryID, use code similar to the following:this.repIdconvertFromISOLatin1(...)int secondIndex// a special class "pseudo" name, then the matching real classname is returned.// This method will return the classname from the typestring OR if the classname turns out to be// given repid is an acceptable result.// cache if no class was found.  It's used where any class matching the// This method calls getClazzFromType() and falls back to the repStrToClassClass<> specialCaseloadClassOfType(...)/** Checks to see if the FullValueDescription should be retrieved. ... */String clazzRepIDStrRepositoryId targetRepidRepositoryId clazzRepidisRMIValueType(...)String mssgcreateHashString(...)long actualLongString hashlong declaredLongString declared/** Creates a repository ID for a sequence.  This is for expert users only as ... */String repidClass<> originalClazzint numOfDimscreateForSpecialCase(...)/** Creates a repository ID for a normal Java Type. ... *//** Creates a repository ID for an IDL Java Type. ... */Class<> helperClazz/** Createa a repository ID for the type if it is either a java type ... */getIdFromHelper(...)createForIDLType(...)TypeMismatchException e/** Convert strings with illegal IDL identifier characters. ... *//** Convert strings with ISO Latin 1 escape sequences back to original strings. ... */String leftString rightint value_tag// Imports for using codebase URL to load class//d11638 files in the same package, therefore remove their reference//import com.sun.corba.se.impl.util.JDKBridge;//import com.sun.corba.se.impl.util.IdentityHashtable;// 0 1 2 3  4 5 6 7  8 9 a b  c d e f// 00-0f// 10-1f// 20-2f// 30-3f// 40-4f// 50-5f// 60-6f// 70-7f// 80-8f// 90-9f// a0-af// b0-bf// c0-cf// d0-df// e0-ef// f0-ff//kSpecialCasesClasses.put(kRemoteTypeStr, java.rmi.Remote.class);// Special case for remote// fix where Attempting to obtain a FullValueDescription// for an RMI value type with a String field causes an exception.// default if not explicitly specified// we have a declared hash also// actualSuid = suid.substring(pos);// suid = suid.substring(0, pos-1);// _REVISIT_ : Special case version failure ?// to avoid race condition where multiple threads could be// accessing this method, and their access to the cache may// be interleaved giving unexpected results//ObjectStreamClass osc = ObjectStreamClass.lookup(clazz);//com.sun.corba.se.impl.io.ValueUtility.log("RepositoryId",mssg);// We gotta convert. Have we already started?// No, so get set up...// Convert the character into the IDL escape syntax...// Convert Hexadecimal// Really limited pool - in this case just creating several at a time...int MAX_CACHE_SIZE;increasePool(...)// Pool managementnew RepositoryId(...)this.cachenew RepositoryIdPool(...)RepositoryIdPool pool;setCaches(...)//if (cache.size() <= MAX_CACHE_SIZE)/* // _REVISIT_ This will not work w/out either thread tracing or weak references.  I am ... *///repId = pool.popId().init(key);/** The vendor minor code ID reserved for Sun by the OMG. ... *//** The vendor minor code ID reserved for Sun. This value is or'd with ... */import Stub/** Handy class full of static functions. */String STUB_PREFIX;String RMI_STUB_SUFFIX;String DYNAMIC_STUB_SUFFIX;String IDL_STUB_SUFFIX;String TIE_SUFIX;IdentityHashtable tieCache;IdentityHashtable tieToStubCache;IdentityHashtable stubToTieCache;Object CACHE_MISS;/** Ensure that stubs, ties, and implementation objects ... */BAD_OPERATION okayRemoteException eRemote remoteObjSystemException okayactivateTie(...)/* Get a new instance of an RMI-IIOP Tie for the ... */Class<> objClassObject itPortableRemoteObject.class/* Load an RMI-IIOP Tie *//* Clear the stub/tie caches. Intended for use by ... *//* Load a class and check that it is assignable to a given type. ... */Class<> loadedClasswithoutPackagePrefix(...)/* Load a class and check that it is compatible with a given type. ... *//** Get the helper for an IDLValue ... *//** Get the factory for an IDLValue ... */lookup_value_factory(...)Class<> factoryClass/* Load an RMI-IIOP Stub given a Tie. ... */StubEntry entryObject cachedloadStubAndUpdateCache(...)entry.mostDerivedentry.stubDelegate stubDelException e2/* Load an RMI-IIOP Stub given a Tie, but do not look in the cache. ... */boolean tieIsStubnew _Remote_Stub(...)StubFactoryFactory stubFactoryFactoryException e1BAD_INV_ORDER badnew StubEntry(...)/* If we loadStub(Tie,...) stashed away a tie which was ... *//* Remove any cached Stub for the given tie. *//* Remove cached tie/servant pair. */Object target/* Convert a RepId to a stubName... */RepositoryId id/* Load an RMI-IIOP Stub.  This is used in PortableRemoteObject.narrow. */get_codebase(...)/* Load an RMI-IIOP Stub class.  This is used in the ... */stubNameFromRepID(...)/** Create an RMI stub name. *//** Create an RMI tie name. */tieNameForCompiler(...)/** Throws the CORBA equivalent of a java.io.NotSerializableException *//** Create an IDL stub name. */fillInStackTrace(...)/** Read an object reference from the input stream and narrow ... *//** Read an abstract interface type from the input stream and narrow ... */boolean mostDerived;this.mostDerived// The stub could not be connected because it// has an invalid IOR...// This is an implementation object which has not been// exported to IIOP OR is a JRMP stub or implementation// object which cannot be marshalled into an ORB stream...// Didn't need to do anything, just return the input...// Have we tried to find this guy before?// No, so try it...// First try the classname...// If we don't have a valid tie at this point,// walk up the parent chain until we either// load a tie or encounter PortableRemoteObject// or java.lang.Object...// Did we get it?// Nope, so cache that fact...// Yes, so cache it...// Yes, return a new instance or fail again if// it was a miss last time...//Sequence finding of the stubs according to spec//If-else is put here for speed up of J2EE.//According to the OMG spec, the if clause is not dead code.//It can occur if some compiler has allowed generation//into org.omg.stub hierarchy for non-offending//classes. This will encourage people to//produce non-offending class stubs in their own hierarchy.// If no class was loaded, or if the loaded class is not of the// correct type, make a further attempt to load the correct class// using the classloader of the expected type.// _REVISIT_ Is this step necessary, or should the Util,loadClass// If no class was not loaded, or if the loaded class is not of the// using the classloader of the related type.// no repId or unrecognized repId// Try other way// if earlier search found a non-default factory, or the same default// factory that loadClassForClass would return, bale out now...// Do we already have it cached?// No, so go try to load it...// Yes, is it a stub?  If not, it was a miss last// time, so return null again...// It's a stub.// Does the cached stub meet the requirements// of the caller? If the caller does not require// the most derived stub and does not require// a specific stub type, we don't have to check// any further because the cached type is good// enough...// We must reload because we do not have// the most derived cached already...// The stubFactory arg must be null here// to force onlyMostDerived=true to work// We do not have exactly the right stub. First, try to// upgrade the cached stub by forcing it to the most// derived stub...// If that failed, try again with the exact type// we need...// Use the cached stub. Is the delegate set?// No, so set it if we can...// This will throw an exception if the tie// is not a Servant.  XXX Handle this better?// Now walk all the RepIDs till we find a stub or fail...// Stub == null, so cache the miss...// The tie does not have a delegate set, so stash// this tie away using the stub as a key so that// later, when the stub is connected, we can find// and connect the tie as well...// Tie extends Servant// Exception is caught because of any of the// following reasons// 1) POA is not associated with the TIE// 2) POA Policies for the tie-associated POA//    does not support _this_object() call.// Update the cache...// Convert the typeid to a RepositoryId instance, get// the className and mangle it as needed...// Get the codebase from the delegate to use when loading// the new stub, if possible...// We can't assume that narrowFrom is a CORBA_2_3 stub, yet// it may have a 2_3 Delegate that provides a codebase.  Swallow// the ClassCastException otherwise.// Get the repID and check for "" special case.// We should never be called with it (See CDRInputStream// and the loadStub() method)...// Get the stubname from the repID and load// the class. If we have a valid 'sender', fall// back to using its codebase if we need to...String PROJECT_NAME;String VERSION;String BUILD;String BUILD_TIME;String FULL;/** Class BootstrapServer is the main entry point for the bootstrap server ... *//** Main startup routine for the bootstrap server. ... */String propertiesFilenameLocalResolver lresResolver fresmakeFileResolver(...)Resolver cresLocalResolver sresmakeSplitLocalResolver(...)canRead(...)// Process arguments// Look for the filename// Was the initial port specified? If so, override// This property normally is applied for the client side// configuration of resolvers.  Here we are using it to// define the server port that the with which the resolvers// communicate.// Create a file// Verify that if it exists, it is readable// Success: start up// Use the SERVER_PORT to create an Acceptor using the// old legacy code in ORBConfiguratorImpl.  When (if?)// the legacy support is removed, this code will need// to create an Acceptor directly.// This causes the acceptors to start listening.import POAORB/** Deprecated class for backward compatibility. *//* Copyright (c) 1995, 2003, Oracle and/or its affiliates. All rights reserved. ... *//* 1.4 value: com.sun.corba.se.internal.corba.ORB */// Class ORB/** This ORB class is defined to provide a home for the ... *//** <p> An <code>InputObject</code> is the interface used by the ... *//** <p> An <code>OutputObject</code> is the interface used by the ... *//** <p>The presentation block interacts with the PEPt architecture ... *//** The {@link com.sun.corba.se.pept.broker.Broker Broker} associated ... *//** Get the ... *//** <code>ClientRequestDispatcher</code> coordinates the request (and possible ... *//** At the beginning of a request the presentation block uses this ... *//** After the presentation block has set data on the ... *//** After the presentation block completes a request it signals ... */// REVISIT EXCEPTIONS/** <code>MessageMediator</code> is a central repository for artifacts ... *//** Used to initialize message headers. ... *//** Used to send the message (or its last fragment). ... *//** Used to wait for a response for synchronous messages. ... *//** Used to set the ... *//** Used to get the ... *//** <code>ProtocolHandler</code> is used to determine the ... *//** This method determines the type of an incoming message and ... */// REVISIT - return type/** <code>ServerRequestDispatcher</code> coordinates the request (and possible ... *//** This method coordinates the processing of a message received ... *//** <p>The <b><em>primary</em></b> PEPt server-side plug-in point and enabler ... *//** Used to initialize an <code>Acceptor</code>. ... *//** Used to determine if an <code>Acceptor</code> has been initialized. ... *//** PEPt uses separate caches for each type of <code>Acceptor</code> ... *//** Set the ... *//** Used to determine if the <code>Acceptor</code> should register ... *//** Accept a connection request. ... *//** Close the <code>Acceptor</code>. *//** Used to get a ... */// REVISIT: Identical to ContactInfo method.  Refactor into base interface.// Factory methods/** Used to finish creating a ... */// Usage dictates implementation equals and hashCode./** <p><code>Connection</code> represents a <em>transport</em> in the ... *//** Used to determine if the <code>Connection</code> should register ... *//** Called to read incoming messages. ... */// REVISIT - why special?/** Close the <code>Connection</code>. */// and Acceptor).// REVISIT: replace next two with PlugInFactory (implemented by ContactInfo/** Indicates whether a ... *//** Indicates if the <code>Connection</code> is in the process of ... *//** Timestamps are used for connection management, in particular, for ... *//** The "state" of the <code>Connection</code>. ... *//** Grab a write lock on the <code>Connection</code>. ... *//** Release a write lock on the <code>Connection</code>. *//* Send the data encoded in ... *//** Register an invocation's ... *//** If a message expect's a response then this method is called. ... *//** Unregister an invocation's ... *//** Close all connections in the connection cache. ... *//** <p>The <b><em>primary</em></b> PEPt client-side plug-in point and enabler ... *//** The parent ... *//** Used to determine if a ... *//** Used to determine if the ... *//** PEPt uses separate caches for each type of <code>ContactInfo</code> ... *//** Used to lookup artifacts associated with this <code>ContactInfo</code>. ... *//** <p> <code>ContactInfoList</code> contains one or more ... *//** <code>ContactInfoIterator</code> is used to retrieve individual ... *//** The underlying list for this iterator. ... *//** Used to report information to the iterator to be used ... *//** The exception to report to the presentation block. ... */// is handled.// allow discrimination between different ops and how threading// NOTE: if there is more than one interest op this does not// REVISIT: need base class with two derived.// REVISIT: maybe return void (or MessageMediator)./** com/sun/corba/se/spi/activation/Activator.java . ... *//** com/sun/corba/se/spi/activation/ActivatorHelper.java . ... *//** com/sun/corba/se/spi/activation/ActivatorHolder.java . ... *//** com/sun/corba/se/spi/activation/ActivatorOperations.java . ... */// A new ORB started server registers itself with the Activator// Install a particular kind of endpoint// list active servers// If the server is not running, start it up.// If the server is running, shut it down// currently running, this method will activate it.// list all registered ORBs for a server// After this hook completes, the server may still be running./** com/sun/corba/se/spi/activation/BadServerDefinition.java . ... *//** com/sun/corba/se/spi/activation/BadServerDefinitionHelper.java . ... *//** com/sun/corba/se/spi/activation/BadServerDefinitionHolder.java . ... *//** com/sun/corba/se/spi/activation/EndPointInfo.java . ... *//** com/sun/corba/se/spi/activation/EndPointInfoHelper.java . ... *//** com/sun/corba/se/spi/activation/EndPointInfoHolder.java . ... *//** com/sun/corba/se/spi/activation/EndpointInfoListHelper.java . ... *//** com/sun/corba/se/spi/activation/EndpointInfoListHolder.java . ... *//** com/sun/corba/se/spi/activation/IIOP_CLEAR_TEXT.java . ... */// to avoid a compilation dependency./** com/sun/corba/se/spi/activation/InitialNameService.java . ... *//** com/sun/corba/se/spi/activation/InitialNameServiceHelper.java . ... *//** com/sun/corba/se/spi/activation/InitialNameServiceHolder.java . ... *//** com/sun/corba/se/spi/activation/InitialNameServiceOperations.java . ... */// bind initial name/** com/sun/corba/se/spi/activation/InitialNameServicePackage/NameAlreadyBound.java . ... *//** com/sun/corba/se/spi/activation/InitialNameServicePackage/NameAlreadyBoundHelper.java . ... *//** com/sun/corba/se/spi/activation/InitialNameServicePackage/NameAlreadyBoundHolder.java . ... *//** com/sun/corba/se/spi/activation/InvalidORBid.java . ... *//** com/sun/corba/se/spi/activation/InvalidORBidHelper.java . ... *//** com/sun/corba/se/spi/activation/InvalidORBidHolder.java . ... *//** com/sun/corba/se/spi/activation/Locator.java . ... *//** com/sun/corba/se/spi/activation/LocatorHelper.java . ... *//** com/sun/corba/se/spi/activation/LocatorHolder.java . ... *//** com/sun/corba/se/spi/activation/LocatorOperations.java . ... */// Starts the server if it is not already running.// get the port for the endpoint of the locator// to pick a particular port type./** com/sun/corba/se/spi/activation/LocatorPackage/ServerLocation.java . ... */// class ServerLocation/** com/sun/corba/se/spi/activation/LocatorPackage/ServerLocationHelper.java . ... */ServerLocation value/** com/sun/corba/se/spi/activation/LocatorPackage/ServerLocationHolder.java . ... */ServerLocation value;/** com/sun/corba/se/spi/activation/LocatorPackage/ServerLocationPerORB.java . ... *//** com/sun/corba/se/spi/activation/LocatorPackage/ServerLocationPerORBHelper.java . ... *//** com/sun/corba/se/spi/activation/LocatorPackage/ServerLocationPerORBHolder.java . ... *//** com/sun/corba/se/spi/activation/NoSuchEndPoint.java . ... *//** com/sun/corba/se/spi/activation/NoSuchEndPointHelper.java . ... *//** com/sun/corba/se/spi/activation/NoSuchEndPointHolder.java . ... *//** com/sun/corba/se/spi/activation/ORBAlreadyRegistered.java . ... *//** com/sun/corba/se/spi/activation/ORBAlreadyRegisteredHelper.java . ... *//** com/sun/corba/se/spi/activation/ORBAlreadyRegisteredHolder.java . ... *//** com/sun/corba/se/spi/activation/ORBPortInfo.java . ... *//** com/sun/corba/se/spi/activation/ORBPortInfoHelper.java . ... *//** com/sun/corba/se/spi/activation/ORBPortInfoHolder.java . ... *//** com/sun/corba/se/spi/activation/ORBPortInfoListHelper.java . ... *//** com/sun/corba/se/spi/activation/ORBPortInfoListHolder.java . ... */// issue resolved./** com/sun/corba/se/spi/activation/ORBidHelper.java . ... *//** com/sun/corba/se/spi/activation/ORBidListHelper.java . ... *//** com/sun/corba/se/spi/activation/ORBidListHolder.java . ... *//** com/sun/corba/se/spi/activation/POANameHelper.java . ... *//** com/sun/corba/se/spi/activation/POANameHolder.java . ... *//** com/sun/corba/se/spi/activation/Repository.java . ... *//** com/sun/corba/se/spi/activation/RepositoryHelper.java . ... *//** com/sun/corba/se/spi/activation/RepositoryHolder.java . ... *//** com/sun/corba/se/spi/activation/RepositoryOperations.java . ... */// always uninstalled.// unregister server definition// get server definition// Return whether the server has been installed// if the server is currently marked as installed.// if the server is currently marked as uninstalled.// list registered servers// servers.// Find the ServerID associated with the given application name./** com/sun/corba/se/spi/activation/RepositoryPackage/ServerDef.java . ... *//** com/sun/corba/se/spi/activation/RepositoryPackage/ServerDefHelper.java . ... *//** com/sun/corba/se/spi/activation/RepositoryPackage/ServerDefHolder.java . ... *//** com/sun/corba/se/spi/activation/RepositoryPackage/StringSeqHelper.java . ... *//** com/sun/corba/se/spi/activation/RepositoryPackage/StringSeqHolder.java . ... *//** Server callback API, passed to Activator in active method. *//** com/sun/corba/se/spi/activation/Server.java . ... */// interface Server/** com/sun/corba/se/spi/activation/ServerAlreadyActive.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyActiveHelper.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyActiveHolder.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyInstalled.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyInstalledHelper.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyInstalledHolder.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyRegistered.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyRegisteredHelper.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyRegisteredHolder.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyUninstalled.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyUninstalledHelper.java . ... *//** com/sun/corba/se/spi/activation/ServerAlreadyUninstalledHolder.java . ... *//** com/sun/corba/se/spi/activation/ServerHeldDown.java . ... *//** com/sun/corba/se/spi/activation/ServerHeldDownHelper.java . ... *//** com/sun/corba/se/spi/activation/ServerHeldDownHolder.java . ... *//** com/sun/corba/se/spi/activation/ServerHelper.java . ... */_ServerStub stubnew _ServerStub(...)/** com/sun/corba/se/spi/activation/ServerHolder.java . ... */Server value;/** com/sun/corba/se/spi/activation/ServerIdHelper.java . ... *//** com/sun/corba/se/spi/activation/ServerIdsHelper.java . ... */int[] value/** com/sun/corba/se/spi/activation/ServerIdsHolder.java . ... *//** com/sun/corba/se/spi/activation/ServerManager.java . ... *//** com/sun/corba/se/spi/activation/ServerManagerHelper.java . ... *//** com/sun/corba/se/spi/activation/ServerManagerHolder.java . ... *//** com/sun/corba/se/spi/activation/ServerManagerOperations.java . ... *//** com/sun/corba/se/spi/activation/ServerNotActive.java . ... *//** com/sun/corba/se/spi/activation/ServerNotActiveHelper.java . ... *//** com/sun/corba/se/spi/activation/ServerNotActiveHolder.java . ... *//** com/sun/corba/se/spi/activation/ServerNotRegistered.java . ... *//** com/sun/corba/se/spi/activation/ServerNotRegisteredHelper.java . ... *//** com/sun/corba/se/spi/activation/ServerNotRegisteredHolder.java . ... *//** com/sun/corba/se/spi/activation/ServerOperations.java . ... */// interface ServerOperations/** com/sun/corba/se/spi/activation/TCPPortHelper.java . ... *//** com/sun/corba/se/spi/activation/_ActivatorImplBase.java . ... */Server serverObjint[] $result// activation/Activator/active// activation/Activator/registerEndpoints// activation/Activator/getActiveServers// activation/Activator/activate// activation/Activator/shutdown// activation/Activator/install// activation/Activator/getORBNames// activation/Activator/uninstall/** com/sun/corba/se/spi/activation/_ActivatorStub.java . ... */// active// registerEndpoints/** com/sun/corba/se/spi/activation/_InitialNameServiceImplBase.java . ... */// activation/InitialNameService/bind/** com/sun/corba/se/spi/activation/_InitialNameServiceStub.java . ... *//** com/sun/corba/se/spi/activation/_LocatorImplBase.java . ... */ServerLocation $result// activation/Locator/locateServer// activation/Locator/locateServerForORB// activation/Locator/getEndpoint// activation/Locator/getServerPortForType/** com/sun/corba/se/spi/activation/_LocatorStub.java . ... *//** com/sun/corba/se/spi/activation/_RepositoryImplBase.java . ... */// activation/Repository/registerServer// activation/Repository/unregisterServer// activation/Repository/getServer// activation/Repository/isInstalled// activation/Repository/install// activation/Repository/uninstall// activation/Repository/listRegisteredServers// activation/Repository/getApplicationNames// activation/Repository/getServerID/** com/sun/corba/se/spi/activation/_RepositoryStub.java . ... *//** com/sun/corba/se/spi/activation/_ServerImplBase.java . ... */// activation/Server/shutdown// activation/Server/install// activation/Server/uninstall// class _ServerImplBase/** com/sun/corba/se/spi/activation/_ServerManagerImplBase.java . ... *//** com/sun/corba/se/spi/activation/_ServerManagerStub.java . ... *//** com/sun/corba/se/spi/activation/_ServerStub.java . ... */// class _ServerStub/** Manager of ObjectCopier implementations used to support javax.rmi.CORBA.Util.copyObject(s). ... *//** Set the Id of the copier to use if no other copier has been set. *//** Return the copier for the default copier id.  Throws a BAD_PARAM exception ... *//** Register an ObjectCopierFactory under a particular id.  This can be retrieved ... */import ReferenceObjectCopierImplimport FallbackObjectCopierImplimport ORBStreamObjectCopierImplimport JavaStreamObjectCopierImplnew ReferenceObjectCopierImpl(...)new ObjectCopierFactory(...) { ... }CopyobjectDefaults$3/** Obtain the ORB stream copier factory.  Note that this version behaves differently ... */CopyobjectDefaults$1new ORBStreamObjectCopierImpl(...)CopyobjectDefaults$2new JavaStreamObjectCopierImpl(...)ObjectCopier referenceObjectCopier;ObjectCopierFactory referenceObjectCopierFactory;/** Obtain the reference object "copier".  This does no copies: it just ... *//** Create a fallback copier factory from the two ObjectCopierFactory ... */CopyobjectDefaults$4ObjectCopier c1ObjectCopier c2new FallbackObjectCopierImpl(...)/** Provides an interface for a variety of means to copy an arbitrary ... *//** ObjectCopier factory interface used for registration. *//** Create a new instance of an ObjectCopier. *//** Policy used to specify the copyObject implementation to use. *//** Policy used to support the request partitioning feature and to ... */int DEFAULT_VALUE;/** Policy used to implement servant caching optimization in the POA. ... */int NO_SERVANT_CACHING;/** Do not cache servants in the ClientRequestDispatcher.  This will ... */int FULL_SEMANTICS;/** Perform servant caching, preserving POA current and POA destroy semantics. ... */int INFO_ONLY_SEMANTICS;/** Perform servant caching, preservent only POA current semantics. ... */int MINIMAL_SEMANTICS;/** Perform servant caching, not preserving POA current or POA destroy semantics. */ServantCachingPolicy policy;ServantCachingPolicy infoOnlyPolicy;ServantCachingPolicy minimalPolicy;int type;typeToName(...)/** Return the default servant caching policy. */getFullPolicy(...)new ServantCachingPolicy(...)/** Policy used to implement zero IIOP port policy in the POA. */new ZeroPortPolicy(...)ZeroPortPolicy policy;boolean flag;this.flaggetEncapsulationStream(...)readContents(...)/** Return the type id string from the IOR. *//** Return an iterator that iterates over tagged profiles with ... *//** Return a representation of this IOR in the standard GIOP stringified ... *//** Return a representation of this IOR in the standard GIOP marshalled ... *//** Return true if this IOR has no profiles. *//** Return true if this IOR is equivalent to ior.  Here equivalent means ... *//** Return the IORTemplate for this IOR.  This is simply a list ... */import IORImplimport IORTemplateImplimport IORTemplateListImplimport ObjectReferenceProducerBaseimport ObjectReferenceFactoryImplimport ObjectReferenceTemplateImpl/** This class provides a number of factory methods for creating ... *//** Create an ObjectId for the given byte sequence. *//** Create an ObjectKey for the given ObjectKeyTemplate and ... *//** Create an empty IOR for the given orb and typeid.  The result is mutable. *//** Create an empty IOR for the given orb with a null typeid.  The result is mutable. *//** Read an IOR from an InputStream.  ObjectKeys are not shared. *//** Create an IORTemplate with the given ObjectKeyTemplate.  The result ... */new IORTemplateImpl(...)/** Read an IORTemplate from an InputStream. */new IORTemplateListImpl(...)ObjectReferenceTemplateImpl ortiObjectReferenceProducerBase basenew ObjectReferenceTemplateImpl(...)new ObjectReferenceFactoryImpl(...)new ObjectKeyFactoryImpl(...)/** This method must be called in order to register the value ... */ValueFactory vfnew ValueFactory(...) { ... }IORFactories$1register_value_factory(...)ObjectReferenceTemplateImpl.repositoryIdIORFactories$2ObjectReferenceFactoryImpl.repositoryId// Create and register the factory for the Object Reference Template// implementation.// Create and register the factory for the Object Reference Factory/** An IORFactory provides the capability of creating IORs.  It contains ... *//** Construct an IOR containing the given ORB, typeid, and ObjectId. ... *//** Return true iff this.makeIOR(orb,typeid,oid).isEquivalent( ... *//** An IORTemplate provides all of the data necessary to create an IOR except ... *//** Iterate over all TaggedProfileTemplates in this IORTemplate ... *//** An IORTemplateList is a list of IORTemplate instances.  It can be used to create IORs. ... *//** This interface represents an entity that can be written to an ... *//** Return the (type) identity of this entity. ... */import Writeable/** Provide support for properly reading and writing Identifiable objects ... *//** Write the data for this object as a CDR encapsulation. ... */writeEncapsulation(...)/** Convenience class for defining objects that contain lists of Identifiables. ... *//** Create this class with an empty list of identifiables. ... *//** Return an iterator which iterates over all contained Identifiables ... */IdentifiableContainerBase$1IdentifiableContainerBase.thisadvance(...)Iterator<> iter;Object current;Identifiable ide/** Factory interface for creating Identifiables. *//** Return the id of this factory, which is the id of the result ... *//** Construct the appropriate Identifiable object with the ... *//** Interface used to manage a group of related IdentifiableFactory instances. ... *//** If there is a registered factory for id, use it to ... *//** Register a factory for the given id. *//** This is the object adapter ID for an object adapter. ... *//** Return the number of elements in the adapter ID. *//** Return an iterator that iterates over the components ... *//** Get the adapter name simply as an array of strings. *//** The full object key, which is contained in an IIOPProfile. ... *//** Return the object identifier for this Object key. *//** Return the template for this object key. *//** Construct ObjectKey and ObjectKeyTemplate instances from their ... *//** Create an ObjectKey from its octet sequence representation. *//** Create an ObjectKeyTemplate from its representation ... *//** An ObjectKeyTemplate represents the part of an Object Key ... *//** An ID used to determine how to perform operations on this ... *//** Return the server ID for this template. ... *//** Return the ORB ID for this template. *//** Return the object adapter ID for this template. *//** Compute an adapter ID for this template than includes ... *//** Generic interface for all tagged components.  Users of the ORB may ... *//** Base class to use for implementing TaggedComponents.  It implements ... *//** Create a tagged component from a GIOP marshalled representation ... *//** TaggedProfile represents a tagged profile in an IOR. ... *//** Return true is prof is equivalent to this TaggedProfile. ... *//** Return the TaggedProfile as a CDR encapsulation in the standard ... *//** Return true if this TaggedProfile was created in orb. ... *//** Base template for creating TaggedProfiles.  A TaggedProfile will often contain ... *//** Return an iterator that iterates over tagged components with ... *//** Create a TaggedProfile from this template. *//** Write the profile create( oktemp, id ) to the OutputStream os. *//** Return true if temp is equivalent to this template.  Equivalence ... *//** Return the tagged components in this profile (if any) ... */new TaggedComponent[]TaggedComponent compgetIOPComponent(...)/** This interface represents an entity that can be written to an OutputStream. ... *//** Write this object directly to the output stream. */GIOPVersion V1_0;// Static fieldsGIOPVersion V1_1;GIOPVersion V1_2;GIOPVersion V1_3;GIOPVersion V13_XX;// Minor version [00-FF] is the version number.// Major version 13 indicates Java serialization,GIOPVersion DEFAULT_VERSION;int VERSION_1_0;int VERSION_1_1;int VERSION_1_2;int VERSION_1_3;int VERSION_13_XX;byte major;byte minor;this.majorthis.minor// General methodsgv.majorgv.minorGIOPVersion.V13_XXint dotIdxnew NumberFormatException(...)/** This chooses the appropriate GIOP version. ... */GIOPVersion profVersionORBVersion targetOrbVersionbyte prof_majorbyte prof_minorbyte orb_majorbyte orb_minor// Check if the profile is from a legacy Sun ORB.// we are dealing with a SUN legacy orb which emits 1.1 IORs,// in spite of being able to handle only GIOP 1.0 messages.// Now the target has to be (FOREIGN | NEWER*)// both major version are the same/** IIOPAddress represents the host and port used to establish a ... */import EncapsulationFactoryBaseimport IIOPAddressImplimport CodeSetsComponentImplimport AlternateIIOPAddressComponentImplimport JavaCodebaseComponentImplimport MaxStreamFormatVersionComponentImplimport ORBTypeComponentImplimport IIOPProfileImplimport IIOPProfileTemplateImplimport RequestPartitioningComponentImpl/** This class provides all of the factories for the IIOP profiles and ... */new EncapsulationFactoryBase(...) { ... }IIOPFactories$1int threadPoolToUseIdentifiable compnew RequestPartitioningComponentImpl(...)IIOPFactories$2new AlternateIIOPAddressComponentImpl(...)IIOPFactories$3new CodeSetsComponentImpl(...)IIOPFactories$4new JavaCodebaseComponentImpl(...)IIOPFactories$5new ORBTypeComponentImpl(...)IIOPFactories$6byte versionIIOPFactories$7Identifiable cmpsingleton(...)IIOPFactories$8Identifiable resultnew IIOPProfileImpl(...)IIOPFactories$9new IIOPProfileTemplateImpl(...)/** IIOPProfile represents an IIOP tagged profile. ... *//** Return the servant for this profile, if it is local ... *//** Return the GIOPVersion of this profile.  Caches the result. *//** Return the Codebase of this profile.  Caches the result. *//** IIOPProfileTemplate represents the parts of an IIOPProfile that are independent ... *//** Return the GIOP version of this profile. *//** Return the IIOP address from the IIOP profile.  This is called the ... *//** This interface represents the connection on which a request is made. *//** This exception is raised by <code>ORBSocketFactory.createSocket</code>. ... */this.socketInfo/** LegacyServerSocketEndPointInfo is an abstraction of a port. *//** e.g.: "CLEAR_TEXT", "SSL", ... *//** Get the host name of this end point. Subcontracts must use this ... *//** The ORBD's proxy port of this end point. ... */String DEFAULT_ENDPOINT;// to get what used to be called "default" or "bootstrap" endpoints.// NAME is used while we still have a "port-exchange" ORBDString BOOT_NAMING;String NO_NAME;/** DEPRECATED.  DEPRECATED. DEPRECATED. DEPRECATED. <p> ... */String IIOP_CLEAR_TEXT;/** DEPRECATED.  DEPRECATED. DEPRECATED. DEPRECATED. <p ... *//** The interface defines an extension to the standard ORBInitInfo ... *//** This interface is implemented by our implementation of ... *//** Defines constants for all of the logging domains used in the ORB. ... */String TOP_LEVEL_DOMAIN;// Top level log domain for CORBAString RPC;String RPC_PRESENTATION;/** Log domain for code directly implementing the CORBA API and ... */String RPC_ENCODING;/** Log domain for any sort of wire encoding used in marshalling */String RPC_PROTOCOL;/** Log domain for the code used to handle any kind of invocation ... */String RPC_TRANSPORT;/** Log domain for low-level transport details, which are ... */String NAMING;String NAMING_LIFECYCLE;/** Log domain for naming context creation and destruction. */String NAMING_READ;/** Log domain for name service lookup. */String NAMING_UPDATE;/** Log domain for name service bind, rebind, destroy, and other state ... */String ORBD;String ORBD_LOCATOR;/** Log domain for the ORBD locator function, which forwards ... */String ORBD_ACTIVATOR;/** Log domain for the ORBD activator function, which starts ... */String ORBD_REPOSITORY;/** Log domain for the Implementation Repository. */String ORBD_SERVERTOOL;/** Log domain for the servertool utilitiy used to update the ... */String ORB;String ORB_LIFECYCLE;/** Log domain for ORB initialization, configuration, startup, ... */String ORB_RESOLVER;/** Log domain for ORB client side name resolution and supporting ... */String OA;String OA_LIFECYCLE;/** Log domain for creation, destruction, and state change of ... */String OA_IOR;/** Log domain for all IOR related code. */String OA_INVOCATION;/** Log domain for object adapter request dispatch. */String RMIIIOP;String RMIIIOP_DELEGATE;/** Log domain for the RMI-IIOP implementation in the Stub, Util, and ... */String UTIL;/** Log domain for utility classes. */import LogRecordLogger logger;String loggerName;this.loggerthis.loggerNameLogRecord lrecnew LogRecord(...)setParameters(...)inferCaller(...)setThrown(...)setLoggerName(...)setResourceBundle(...)getResourceBundle(...)StackTraceElement[] stackStackTraceElement frameString wcnameString baseNameLogWrapperBase.classint ixstack.lengthsetSourceClassName(...)setSourceMethodName(...)// Private method to infer the caller's class and method names// Get the stack trace.// The top of the stack should always be a method in the wrapper class,// or in this base class.// Search back to the first method not in the wrapper class or this class.// Set the class and method if we are not past the end of the stack// trace/** <p> ... */// operations///////////////////////////////////////MonitoredAttributeInfoFactory fgetMonitoredAttributeInfoFactory(...)MonitoredAttributeInfo maInfocreateMonitoredAttributeInfo(...)Long.classsetMonitoredAttributeInfo(...)// end LongMonitoredAttributeBase// end MonitoredAttributeMonitoredAttributeInfo attributeInfo;/** Constructor. */this.attributeInfo/** A Package Private Constructor for internal use only. *//** A Package Private convenience method for setting MonitoredAttributeInfo ... *//** If the concrete class decides not to provide the implementation of this ... *//** This method should be implemented by the concrete class. *//** This method should be implemented by the concrete class only if the ... */isWritable(...)/** Gets the MonitoredAttributeInfo for the attribute. *//** Gets the name of the attribute. */// end MonitoredAttributeBase// end MonitoredAttributeInfo/** A Simple Factory Method to create the Monitored Attribute Info. */// end MonitoredObject/** A Simple Factory Method to create the Monitored Object. The name ... */String DEFAULT_MONITORING_ROOT;String DEFAULT_MONITORING_ROOT_DESCRIPTION;String CONNECTION_MONITORING_ROOT;// Connection MonitoringString CONNECTION_MONITORING_ROOT_DESCRIPTION;String INBOUND_CONNECTION_MONITORING_ROOT;String INBOUND_CONNECTION_MONITORING_ROOT_DESCRIPTION;String OUTBOUND_CONNECTION_MONITORING_ROOT;String OUTBOUND_CONNECTION_MONITORING_ROOT_DESCRIPTION;String CONNECTION_MONITORING_DESCRIPTION;String CONNECTION_TOTAL_NUMBER_OF_CONNECTIONS;String CONNECTION_TOTAL_NUMBER_OF_CONNECTIONS_DESCRIPTION;String CONNECTION_NUMBER_OF_IDLE_CONNECTIONS;String CONNECTION_NUMBER_OF_IDLE_CONNECTIONS_DESCRIPTION;String CONNECTION_NUMBER_OF_BUSY_CONNECTIONS;String CONNECTION_NUMBER_OF_BUSY_CONNECTIONS_DESCRIPTION;String THREADPOOL_MONITORING_ROOT;// ThreadPool and WorkQueue monitoring constantsString THREADPOOL_MONITORING_ROOT_DESCRIPTION;String THREADPOOL_MONITORING_DESCRIPTION;String THREADPOOL_CURRENT_NUMBER_OF_THREADS;String THREADPOOL_CURRENT_NUMBER_OF_THREADS_DESCRIPTION;String THREADPOOL_NUMBER_OF_AVAILABLE_THREADS;String THREADPOOL_NUMBER_OF_AVAILABLE_THREADS_DESCRIPTION;String THREADPOOL_NUMBER_OF_BUSY_THREADS;String THREADPOOL_NUMBER_OF_BUSY_THREADS_DESCRIPTION;String THREADPOOL_AVERAGE_WORK_COMPLETION_TIME;String THREADPOOL_AVERAGE_WORK_COMPLETION_TIME_DESCRIPTION;String THREADPOOL_CURRENT_PROCESSED_COUNT;String THREADPOOL_CURRENT_PROCESSED_COUNT_DESCRIPTION;String WORKQUEUE_MONITORING_DESCRIPTION;String WORKQUEUE_TOTAL_WORK_ITEMS_ADDED;String WORKQUEUE_TOTAL_WORK_ITEMS_ADDED_DESCRIPTION;String WORKQUEUE_WORK_ITEMS_IN_QUEUE;String WORKQUEUE_WORK_ITEMS_IN_QUEUE_DESCRIPTION;String WORKQUEUE_AVERAGE_TIME_IN_QUEUE;String WORKQUEUE_AVERAGE_TIME_IN_QUEUE_DESCRIPTION;import MonitoredObjectFactoryImplimport MonitoredAttributeInfoFactoryImplimport MonitoringManagerFactoryImplnew MonitoredObjectFactoryImpl(...)new MonitoredAttributeInfoFactoryImpl(...)new MonitoringManagerFactoryImpl(...)MonitoredObjectFactoryImpl monitoredObjectFactory;// attributesMonitoredAttributeInfoFactoryImpl monitoredAttributeInfoFactory;MonitoringManagerFactoryImpl monitoringManagerFactory;// end MonitoringManagerStatisticsAccumulator statisticsAccumulator;// this Monitored Attribute// will use Statisticsaccumulator to accumulate the samples associated with// Every StatisticMonitoredAttribute will have a StatisticAccumulator. UserObject mutex;// getValue() and clearState() is synchronized on this user provided mutex// Mutex is passed from the user class which is providing the sample values.this.statisticsAccumulatorthis.mutex/** Gets the value from the StatisticsAccumulator, the value will be a formatted ... */// end StatisticMonitoredAttribute/** Clears the state on Statistics Accumulator, After this call all samples are ... *//** Gets the statistics accumulator associated with StatisticMonitoredAttribute. ... */Double.MIN_VALUEDouble.MAX_VALUEdouble max;// Users can extend this class to get access to current Max valuedouble min;// Users can extend this class to get access to current Min valuedouble sampleSum;double sampleSquareSum;long sampleCount;String unit;/** Computes the Standard Statistic Results based on the samples collected ... */// end sample/** Users can extend StatisticsAccumulator to provide the complete ... */computeStandardDeviation(...)computeAverage(...)/** If users choose to custom format the stats. *//** We use a derived Standard Deviation formula to compute SD. This way ... */double sampleSumSquaresqrt(...)this.unit/** Clears the samples and starts fresh on new samples. *//** This is an internal API to test StatisticsAccumulator... */double differenceabs(...)// We are computing Standard Deviation from two different methods// for comparison. So, the values will not be the exact same to the last// few digits. So, we are taking the difference and making sure that// the difference is not greater than 1.// end StatisticsAccumulator// end StringMonitoredAttributeBase/** NullServant is used to represent a null servant returned ... *//** Obtain the exception that is associated with this ... *//** OADefault provides methods to create the standard ObjectAdapterFactory ... */new POAFactory(...)new TOAFactory(...)/** This exception is thrown when an operation on an ObjectAdapter ... *//** This class is a holder for the information required to implement POACurrent. ... */Object servantContainer;// In all other cases, it is the same as the Servant.// target of the Tie.// In the RMI-IIOP case, it is the RMI-IIOP Tie, and the servant is the// This is the container object for the servant.ObjectAdapter oa;// These fields are to support standard OMG APIs....[] oid;CookieHolder cookieHolder;// These fields are to support the Object adapter implementation.ObjectCopierFactory factory;// For the current request.// This is the copier to be used by javax.rmi.CORBA.Util.copyObject(s)this.oa// Copy constructor of sorts; used in local optimization pathinfo.servantthis.servantContainerinfo.servantContainerthis.cookieHolderinfo.cookieHolderinfo.oainfo.oidinfo.factory//getters// thread, so no synchronization is needed.// Create CookieHolder on demand.  This is only called by a singlenew CookieHolder(...)//setters/** ObjectAdapter represents the abstract model of an object ... */// REVISIT: What should the order be?  enter/push...pop/exit?/** Returns the ORB associated with this adapter. */// Basic methods for supporting interceptors/** Returns the IOR template of this adapter.  The profiles ... *//** Return the ID of the AdapterManager for this object adapter. */// Methods needed to support ORT./** Return the current state of this object adapter (see ... *//** Change the current factory.  This may only be called during the ... *//** Get the servant corresponding to the given objectId, if this is supported. ... */// Methods required for dispatching to servants/** enter must be called before each request is invoked on a servant. ... *//** exit must be called after each request has been completed.  If enter ... *//** Must be called every time getInvocationServant is called after ... *//** Create an instance of InvocationInfo that is appropriate for this ... */POASystemException _iorWrapper;// Exception wrappersPOASystemException _invocationWrapper;POASystemException _lifecycleWrapper;OMGSystemException _omgInvocationWrapper;OMGSystemException _omgLifecycleWrapper;IORTemplate iortemp;// supporting the Object Reference Template.// Data related to the construction of object references andObjectReferenceTemplate adapterTemplate;ObjectReferenceFactory currentFactory;/* This creates the complete template. ... */makeObjectReferenceTemplate(...)PIHandler pih// but overriding it would make sense for OAs that use a different InvocationInfo.// Note that all current subclasses share the same implementation of this method,setCopierFactory(...)// This calls acceptors which create profiles and may// add tagged components to those profiles.// This runs the IORInterceptors./** Initialize this object adapter factory instance. *//** Shutdown all object adapters and other state associated ... *//** Find the ObjectAdapter instance that corresponds to the ... *//** Interface for collecting all sources of ORB configuration properties ... *//** Return true iff this DataCollector was created from ... *//** Return true iff the local host and ORB initial host are the same. ... *//** Set the parser which is used to obtain property names. ... *//** Return the consolidated property information to be used ... */import TypeCodeFactoryimport ByteBufferPoolImplimport PresentationManagerImplimport AppContextnew ConcurrentHashMap<>(...)boolean ORBInitDebug;// that sets the xxxDebugFlags!// be one of the xxxDebugFlags because it is used to debug the mechanism// Flag set at compile time to debug flag processing: this can't//    incompletely initialized ORBs that need to perform logging.// 3. Logging support is here so that we can avoid problems with//    are needed in both ORBImpl and ORBSingleton.// 2. typeCodeMap and primitiveTypeCodeConstants are here because they//    frequently, and we do not want a cast to the impl just for that.// 1. The ORB debug flags are defined here because they are accessed// there are a few reasons why it is not:// As much as possible, this class should be stateless.  However,boolean transportDebugFlag;// Note that x,y,z must not contain spaces.// These are set by passing the flag -ORBDebug x,y,z in the ORB init args.// All debug flags must be public boolean types.// Currently defined debug flags.  Any additions must be called xxxDebugFlag.boolean subcontractDebugFlag;boolean poaDebugFlag;boolean poaConcurrencyDebugFlag;boolean poaFSMDebugFlag;boolean orbdDebugFlag;boolean namingDebugFlag;boolean serviceContextDebugFlag;boolean transientObjectManagerDebugFlag;boolean giopVersionDebugFlag;boolean shutdownDebugFlag;boolean giopDebugFlag;boolean invocationTimingDebugFlag;boolean orbInitDebugFlag;ORBUtilSystemException staticWrapper;// subclasses.// SystemException log wrappers.  Protected so that they can be used inMap<> typeCodeMap;// XXX Should this be a WeakHashMap for GC?// based on the unique repository id.// This map is needed for resolving recursive type code placeholders...[] primitiveTypeCodeConstants;ByteBufferPool byteBufferPool;// ByteBufferPool - needed by both ORBImpl and ORBSingleton// XXX clean this up, probably remove these// Local testing// Invocation stack manipulationMap<> wrapperMap;// representing LogDomain and ExceptionGroup.// different classes to log exceptions.  The key is a StringPair// wrapperMap maintains a table of LogWrapper instances used byORB$HoldersetupPresentationManager(...)PresentationManager defaultPresentationManager;Object pmLock;Map<> staticWrapperMap;MonitoringManager monitoringManager;boolean useDynamicStubORB$1ORBConstants.USE_DYNAMIC_STUB_PROPERTYStubFactoryFactory dynamicStubFactoryFactoryORB$2getProxyStubFactoryFactory(...)ORBConstants.DYNAMIC_STUB_FACTORY_FACTORY_CLASSnew PresentationManagerImpl(...)setStubFactoryFactory(...)/** Returns the Presentation Manager for the current thread group, using the ThreadGroup-specific ... */getAppContexts(...)AppContext acgetAppContext(...)PresentationManager.classHolder.defaultPresentationManager/** Get the appropriate StubFactoryFactory.  This ... */PresentationManager gPMboolean useDynamicStubsuseDynamicStubs(...)MonitoringConstants.DEFAULT_MONITORING_ROOT_DESCRIPTION// Typecode support: needed in both ORBImpl and ORBSingleton// with the standard ORB.init methods.// the system properties and orb.properties files as// those properties passes explicitly in props, not by// An ORB created by this call is affected only by// creating a precisely controlled ORB instance.// Special non-standard set_parameters method for// ORB versioning// XXX This needs a better name/** Handle a bad server id for the given object key.  This should ... */// This is used by the first level server side subcontract.// Dispatch support: in the ORB because it is needed for shutdown./** Return this ORB's transient server ID.  This is needed for ... */// XXX These next 7 methods should be moved to a ResolverManager./** Set the ServerRequestDispatcher that should be used for handling INS requests. *//** Factory finders for the various parts of the IOR: tagged components, tagged ... */// XXX The next 5 operations should be moved to an IORManager./** Returns the logger based on the category. */// Logging SPIORBData odataString ORBIdgetCORBALogger(...)String fqLogDomainCORBALogDomains.TOP_LEVEL_DOMAINORBConstants.LOG_RESOURCE_FILE/** get the log wrapper class (its type is dependent on the exceptionGroup) for the ... */StringPair keyLogWrapperBase logWrapperstaticGetLogger(...)//       This method must also be inherited by both ORB and ORBSingleton.//       There can be more than one ORB per process.// NOTE: ByteBuffer pool must be unique per ORB, not per process.// get a reference to a ByteBufferPool, a pool of NIO ByteBuffersnew ByteBufferPoolImpl(...)/* This method is called to verify that a stringified IOR passed to ... */// XXX needs an SPI or else it does not belong here// XXX Should there be a SPI level constants ?// First try the configured class name, if any// Use the default. Log the error as a warning.// No security manager or AppContext// Initialize logging first, since it is needed nearly// everywhere (for example, in TypeCodeImpl).// Determine the correct ORBId.  There are 3 cases:// 1. odata is null, which happens if we are getting a logger before//    ORB initialization is complete.  In this case we cannot determine//    the ORB ID (it's not known yet), so we set the ORBId to//    _INITIALIZING_.// 2. odata is not null, so initialization is complete, but ORBId is set to//    the default "".  To avoid a ".." in//    the log domain, we simply use _DEFAULT_ in this case.// 3. odata is not null, ORBId is not "": just use the ORBId./** Interface used to configure an ORB instance.  The DataCollector dc has all ... *//** Get the prefered code sets for connections. Should the client send the ... */byte FOREIGN;byte OLD;// ORB from another vendorbyte NEW;// JDK 1.3.0 or earlierbyte JDK1_3_1_01;// JDK 1.3.1 FCSbyte NEWER;// JDK1_3_1_01 patchbyte PEORB;// JDK 1.4.x// PEORB in JDK 1.5, S1AS 8, J2EE 1.4import ORBVersionImplORBVersionImpl.FOREIGNORBVersionImpl.OLDORBVersionImpl.NEWORBVersionImpl.JDK1_3_1_01ORBVersionImpl.NEWERORBVersionImpl.PEORB/** Return the current version of this ORB */byteToVersion(...)/* Throwing an exception here would cause this version to be ... *//** Update: If we treat all unknown versions as the latest version ... *//** A generic class representing a function that takes a value and returns ... *//** Apply some function to a value and return the result. *//** This is a static factory class for commonly used operations ... */new SuffixAction(...)new ValueAction(...)new IdentityAction(...)new BooleanAction(...)new IntegerAction(...)new StringAction(...)new ClassAction(...)new SetFlagAction(...)new URLAction(...)new ConvertIntegerToShort(...)OperationFactory$OperationBaseOperationBase otherOperationFactory$MaskErrorActionOperation op;this.opnew MaskErrorAction(...)OperationFactory$IndexActiongetObjectArray(...)new IndexAction(...)OperationFactory$SuffixActiongetStringPair(...)Operation suffixActionImpl;OperationFactory$ValueActionOperation valueActionImpl;OperationFactory$IdentityActionOperation identityActionImpl;OperationFactory$BooleanActionOperation booleanActionImpl;OperationFactory$IntegerActionOperation integerActionImpl;OperationFactory$StringActionOperation stringActionImpl;OperationFactory$ClassActionClass<?> resultOperation classActionImpl;OperationFactory$SetFlagActionOperation setFlagActionImpl;OperationFactory$URLActionOperation URLActionImpl;OperationFactory$IntegerRangeActionint min;int max;this.minthis.maxnew IntegerRangeAction(...)OperationFactory$ListActionString sep;Operation act;this.septhis.act// results in a null result.// not convertible into the correct type.  Also note that no tokens// of the first result, rather than just using Object[], which is// Note that this method carefully constructs an array of the typenew ListAction(...)OperationFactory$SequenceAction...[] actions;this.actionsactions.lengthOperation actnew SequenceAction(...)OperationFactory$ComposeActionOperation op1;Operation op2;this.op1this.op2new ComposeAction(...)OperationFactory$MapActionnew MapAction(...)OperationFactory$MapSequenceAction...[] op;// homogeneous arrays need to use Array.newInstance tricks.// that hetereogeneous arrays work this way, while// XXX Does this correctly handle array types?  It seemsnew MapSequenceAction(...)OperationFactory$ConvertIntegerToShortOperation convertIntegerToShortImpl;import NormalParserDataimport PrefixParserDatanew NormalParserData(...)new PrefixParserData(...)// more derived class.  Do we want to go that far?// a dynamic proxy that satisfies the interfaces that are inherited by the// XXX This could probably be further extended by using more reflection and/** Override this method if there is some needed initialization ... */makeParser(...)parse(...)setParser(...)setFields(...)Field resultSet<> entriesParserImplBase$1Field fieldgetAnyField(...)ParserImplBase.this// Do nothing in this case: no parsing takes place// Since exc wraps the actual exception, use exc.getCause()// instead of exc.// Make sure that any extra initialization takes place after all the// fields are set from the map.import AbstractMap...[] entries;this.entriessetDefaultValues(...)PropertyParser resultParserData entryaddToParser(...)ParserImplTableBase$MapEntryMapEntry otherother.keyother.valueParserImplTableBase$FieldMap// correct (key, value) pairs (nested typed lambda expression).// which iterates over the ParserData, extracting the// map entries, which requires implementing an iterator,// entrySet() method, which requires implementing a set of// by implementing AbstractMap, which requires implementing the// then use setFields from the parent class.  A map is constructed// Construct a map that maps field names to test or default values,boolean useDefault;this.useDefaultnew AbstractSet<>(...) { ... }ParserImplTableBase$FieldMap$1ParserImplTableBase$FieldMap$1$1int ctr;// index of next element to returnParserData pdEntry<> resultnew MapEntry(...)setValue(...)getDefaultValue(...)getTestValue(...)new FieldMap(...)import ParserActionimport ParserActionFactoryList<> actions;makeNormalAction(...)makePrefixAction(...)/** Return a map from field name to value. */ParserAction actapply(...)// A null result means that the property was not set for// this action, so do not override the default value in this case.String first;String second;StringPair otherother.firstother.secondimport Constantimport Futurenew Constant(...)new Future(...)/** Description goes here ... *//** Called by the state engine to perform an action ... */// end of Action.javaimport NameBase/** An FSM is used to represent an instance of a finite state machine ... *//** Get the current state of this FSM. *//** Perform the action and transition to the next state based ... */// end of FSM.javaimport StateEngineImpl/** This is the main class that represents an instance of a state machine ... */StateEngineImpl stateEngine;/** Create an instance of an FSM using the StateEngine ... *//** Return the current state. *//** Perform the transition for the given input in the current state.  This proceeds as follows: ... */// Methods for use only by StateEngineImpl// end of FSMImpl.javathis.msgInput value;String msg;this.oldStatethis.newStatethis.labelState oldState;Input label;State newState;complement(...)FSMTest.STATE1new Guard(...) { ... }FSMTest$1MyFSM mfsmmfsm.counterState STATE1;State STATE2;State STATE3;State STATE4;Input INPUT1;Input INPUT2;Input INPUT3;Input INPUT4;Guard counterGuard;new TestAction1(...)new TestAction2(...)TestAction3 ta3new TestAction3(...)StateEngine seMyFSM fsmnew MyFSM(...)TestInput in11new TestInput(...)TestInput in12TestInput in21TestInput in22TestInput in31TestInput in32TestInput in33TestInput in41add1(...)add2(...)getInput(...)Guard$ComplementGuard$Resultnew Result(...)Result ENABLED;Result DISABLED;Result DEFERED;/** Called by the state engine to determine whether a ... *//** This interface must be implemented by any class that is used as ... */// end of Input.java/** Method that defines action that occurs whenever this state is entered. ... *//** Method that defines action that occurs whenever this state is exited. ... */// end of State.java/** A StateEngine defines the state transition function for a ... *//** Add a new transition (old,in,guard,act,new) to the state engine. ... *//** Add a transition with a guard that always evaluates to true. *//** Set the default transition and action for a state. ... *//** Equivalent to setDefault( oldState, act, newState ) where act is an ... *//** Euaivalent to setDefault( oldState, oldState ) *//** Set the default action used in this state engine.  This is the ... *//** Called after all transitions have been added to the state engine. ... *//** Create an instance of a FSM that uses this state engine. ... */// end of StateEngine.java/** Factory for creating the standard state machine implementation. ... */new StateEngineImpl(...)/** Base class for all states in a StateEngine.  This must be used ... */State defaultNextState;Map<> inputToGuardedActions;// Methods for use only by StateEngineImpl.this.defaultNextStatethis.defaultAction/** Add an invocation handler for all methods on interface interf. *//** Set the default invocation handler to use if none of the ... */import LinkedHashMapimport DynamicAccessPermissionnew LinkedHashMap<>(...)Map<> classToInvocationHandler;InvocationHandler defaultHandler;InvocationHandler handlerDynamicAccessPermission perm;// Note that the declaring class in method is the interface// in which the method was defined, not the proxy class.// handler should never be null here.new InvocationHandler(...) { ... }DelegateInvocationHandlerImpl$1/* Copyright (c) 2004, 2006, Oracle and/or its affiliates. All rights reserved. ... */// This throws an IllegalArgument exception if the delegate// is not assignable from method.getDeclaring class.// Propagate the underlying exception as the// result of the invocation/** Get an InvocationHandler. *//** Get the interfaces that InvocationHandler instances ... *//** This interface is used for InvocationHandler types that are ... *//** This interface defines a thread pool execution service.  The ORB uses this ... *//** This method will return any instance of the WorkQueue. If the ThreadPool ... *//** This method will return an instance of the of the WorkQueue given a queueId. ... *//** This method will return the minimum number of threads maintained by the threadpool. *//** This method will return the maximum number of threads in the threadpool at any ... *//** This method will return the time in milliseconds when idle threads in the threadpool are ... *//** This method will return the current number of threads in the threadpool. This method ... *//** This method will return the number of available threads in the threadpool which are ... *//** This method will return the number of busy threads in the threadpool ... *//** This method returns the number of Work items processed by the threadpool *//** This method returns the average elapsed time taken to complete a Work ... *//** This method will return the name of the threadpool. *//** This method is used to return an instance of ThreadPool based on the ... *//** This method is used to return an instance of ThreadPool that is obtained ... *//** This method is a convenience method to see what threadpool-ids are being ... *//** This method denotes the actual work that is done by the work item. *//** This methods sets the time in millis in the work item, when this ... *//** This methods gets the time in millis in the work item, when this ... *//** This method will return the name of the work item. *//** This method is used to add work to the WorkQueue *//** This method will return the name of the WorkQueue. *//** Returns the total number of Work items added to the Queue. *//** Returns the total number of Work items in the Queue to be processed. *//** Returns the average time a work item is waiting in the queue before ... *//** Set the ThreadPool instance servicing this WorkQueue *//** Get the ThreadPool instance servicing this WorkQueue *//** Used to read and write arguments and results for a particular method. *//** Returns the method used to create this DynamicMethodMarshaller. *//** Copy the arguments as needed for this particular method. ... *//** Read the arguments for this method from the InputStream. ... *//** Write arguments for this method to the OutputStream. ... *//** Copy the result as needed for this particular method. ... *//** Read the result from the InputStream.  Returns null ... *//** Write the result to the OutputStream.  Does nothing if ... *//** Returns true iff thr's class is a declared exception (or a subclass of ... *//** Write the repository ID of the exception and the value of the ... *//** Reads an exception ID and the corresponding exception from ... *//** Interface used to support dynamically generated stubs. ... *//** Similar to ObjectImpl._set_delegate *//** Similar to ObjectImpl._get_delegate *//** Similar to ObjectImpl._orb() *//** Similar to ObjectImpl._ids *//** Connect this dynamic stub to an ORB. ... *//** Translates between methods on an interface and RMI-IIOP encodings ... *//** Get the interfaces that this IDLNameTranslator describes. *//** Get all methods for this remote interface. ... *//** Get the method from this IDLNameTranslator's interfaces that ... *//** Get the mangled name that corresponds to the given method ... */import StubFactoryFactoryProxyImplimport StubFactoryFactoryStaticImplimport StubFactoryStaticImplStubFactoryFactoryStaticImpl staticImpl;new StubFactoryFactoryStaticImpl(...)new StubFactoryFactoryProxyImpl(...)/** Provides access to RMI-IIOP stubs and ties. ... *//** Creates StubFactory and Tie instances. *//** Return the standard name of a stub (according to the RMI-IIOP specification ... *//** Create a stub factory for stubs for the interface whose type is given by ... *//** Return a Tie for the given class. *//** Return whether or not this StubFactoryFactory creates StubFactory ... *//** Creates the actual stub needed for RMI-IIOP remote ... *//** Create a new dynamic stub.  It has the type that was ... *//** Return the repository ID information for all Stubs ... *//** Get the class used to create this ClassData instance *//** Get the IDLNameTranslator for the class used to create ... *//** Return the array of repository IDs for all of the remote ... *//** Get the InvocationHandlerFactory that is used to create ... *//** Get the dictionary for this ClassData instance. ... *//** Get the ClassData for a particular class. ... *//** Given a particular method, return a DynamicMethodMarshaller ... *//** Return the registered StubFactoryFactory. *//** Register the StubFactoryFactory.  Note that ... *//** Equivalent to getStubFactoryFactory( true ).getTie( null ). ... *//** Returns the value of the com.sun.CORBA.ORBUseDynamicStub ... */import AdapterInactive/** Provide access to stub delegate and type id information ... */ObjectImpl.class/** Use implicit activation to get an object reference for the servant. */Object refPOAManager mgrServantNotActive snaWrongPolicy wpPOAManagerImpl mgrImplimplicitActivation(...)/** Given any Tie, return the corresponding object refernce, activating ... */thisObject(...)/** This also gets the delegate from a Servant by ... */// XXX Getting rid of this requires introducing an ObjectAdapterManager abstraction// as an interface into the OA framework.// Make sure that the POAManager is activated if no other// POAManager state management has taken place./** Any implementation of Tie should be either a Servant or an ObjectImpl, ... */import DomainManagerimport SetOverrideType/** Wrapper that can take any stub (object x such that StubAdapter.isStub(x)) ... */this.object_is_equivalent(...)_non_existent(...)_hash(...)_duplicate(...)_release(...)_get_interface_def(...)_create_request(...)_get_policy(...)_get_domain_managers(...)_set_policy_override(...)/** Interface used to create a ClientDelegate from a ContactInfoList. */// REVIST name ForRequest?// go here.// REVISIT - not sure if the final fragment and DII stuff should// Server side// from core.ServerRequestimport ServerRequestDispatcher/** Server delegate adds behavior on the server-side -- specifically ... *//** Handle a locate request. */// XXX These must all be replaced by Sun private APIs./** Thrown to signal an OBJECT_FORWARD or LOCATION_FORWARD */Object obj;this.obj// This check is done early so that no attempt// may be made to do a location forward to a local// object.  Doing this lazily would allow// forwarding to locals in some restricted cases./** InitialServerRequestDispatcher is a specialized version of a ServerRequestDispatcher ... *//** Plug in the resolver that this InitialServerRequestDispatcher should ... *//** Returns a Java reference to the servant which should be used for this ... *//** This interface defines the PI interface that is used to interface the rest of the ... *//** Complete the initialization of the PIHandler.  This will execute the methods ... *//** Called when a new object adapter is created. ... *//* *************************** ... *//** Called whenever a state change occurs in an adapter manager. ... *//** Called whenever a state change occurs in an object adapter that ... *//** Called for pseudo-ops to temporarily disable portable interceptor ... *//** Called for pseudo-ops to re-enable portable interceptor ... *//** Called when the send_request or send_poll portable interception point ... *//** Called when the appropriate client ending interception point is ... *//** Called when a retry is needed after initiateClientPIRequest but ... *//** Invoked when a request is about to be created.  Must be called before ... *//** Invoked when a request is about to be cleaned up.  Must be called ... *//** Notifies PI of additional information for client-side interceptors. ... *//** Notify PI of the MessageMediator for the request. *//** Called when the appropriate server starting interception point is ... *//** Called when the appropriate server intermediate interception point is ... *//** Called when the appropriate server ending interception point is ... *//** Notifies PI to start a new server request and set initial ... *//** Notifies PI of additional information reqired for ServerRequestInfo. ... *//** Notifies PI of additional information required for ServerRequestInfo. *//** Notifies PI of additional information for server-side interceptors. ... */// XXX These need to go away.import CorbaClientRequestDispatcherImplimport CorbaServerRequestDispatcherImplimport MinimalServantCacheLocalCRDImplimport InfoOnlyServantCacheLocalCRDImplimport FullServantCacheLocalCRDImplimport POALocalCRDImplimport INSServerRequestDispatcherimport BootstrapServerRequestDispatchernew CorbaClientRequestDispatcherImpl(...)new CorbaServerRequestDispatcherImpl(...)new BootstrapServerRequestDispatcher(...)new INSServerRequestDispatcher(...)new LocalClientRequestDispatcherFactory(...) { ... }RequestDispatcherDefault$1new MinimalServantCacheLocalCRDImpl(...)RequestDispatcherDefault$2new InfoOnlyServantCacheLocalCRDImpl(...)RequestDispatcherDefault$3new FullServantCacheLocalCRDImpl(...)RequestDispatcherDefault$4new JIDLLocalCRDImpl(...)RequestDispatcherDefault$5new POALocalCRDImpl(...)// Used only in the implementation: no client of this class ever needs these/** Register a ClientRequestDispatcher for a particular subcontract ID. ... *//** Get the ClientRequestDispatcher for subcontract ID scid. *//** Register a LocalClientRequestDispatcher for a particular subcontract ID. ... *//** Get the LocalClientRequestDispatcher for subcontract ID scid. *//** Register a CorbaServerRequestDispatcher for a particular subcontract ID. ... *//** Get the CorbaServerRequestDispatcher for subcontract ID scid. *//** Register a CorbaServerRequestDispatcher for handling an explicit object key name. ... *//** Get the CorbaServerRequestDispatcher for a particular object key. *//** Register an ObjectAdapterFactory for a particular subcontract ID. ... *//** Get the ObjectAdapterFactory for a particular subcontract ID scid. *//** Return the set of all ObjectAdapterFactory instances that are registered. *///   Client side receive_xxx interceptor point.//   request sent to the server (from the response), or from the// - AFTER_RESPONSE means that the retry is a result either of the//   Client side send_request interceptor point.//   an exception from the SocketFactory, or one from the//   something that happened BEFORE the message was sent: either// - BEFORE_RESPONSE means that the retry is caused by// so we can properly handle the two cases:// Introduce more information about WHY we are re-trying a requestnew RetryType(...)RetryType NONE;RetryType BEFORE_RESPONSE;RetryType AFTER_RESPONSE;boolean isRetry;this.isRetry/* Copyright (c) 2010, Oracle and/or its affiliates. All rights reserved. ... *//** A LocalResolver is a Resolver that allows registration of (name, CORBA object) ... *//** Register the Closure with the given name. ... *//** Resolver defines the operations needed to support ORB operations for ... *//** Look up the name using this resolver and return the CORBA object ... *//** Return the entire collection of names that are currently bound ... */import LocalResolverImplimport ORBInitRefResolverImplimport ORBDefaultInitRefResolverImplimport BootstrapResolverImplimport CompositeResolverImplimport INSURLOperationImplimport SplitLocalResolverImplimport FileResolverImpl/** Utility class that provides factory methods for all of the ... *//** Return a local resolver that simply stores bindings in a map. */new LocalResolverImpl(...)/** Return a resolver that relies on configured values of ORBInitRef for data. */new ORBInitRefResolverImpl(...)new ORBDefaultInitRefResolverImpl(...)/** Return a resolver that uses the proprietary bootstrap protocol ... */new BootstrapResolverImpl(...)/** Return a resolver composed of the two given resolvers.  result.list() is the ... */new CompositeResolverImpl(...)new INSURLOperationImpl(...)new SplitLocalResolverImpl(...)new FileResolverImpl(...)this.cscint SERVICE_CONTEXT_ID;// Required SERVICE_CONTEXT_ID and getId definitionsCodeSetComponentInfo.CodeSetContext csc;import RMICustomMaxStreamFormatimport javax.rmi.CORBA.*new MaxStreamFormatVersionServiceContext(...)RMICustomMaxStreamFormat.valuebyte maxStreamFormatVersion;MaxStreamFormatVersionServiceContext singleton;// ValueHandler.// The singleton uses the maximum version indicated by ourthis.maxStreamFormatVersionORBConstants.TAG_ORB_VERSION// current ORB Version// pay particular attention to where the version is being read from!// is contains an encapsulation, ServiceContext reads off the// encapsulation and leaves the pointer in the variable "in",// which points to the long value./** Base class for all ServiceContext classes. ... *//** Simple default constructor used when subclass is constructed ... *//** Stream constructor used when subclass is constructed from an ... *//** Returns Service context id.  Must be overloaded in subclass. *//** Write the service context to an output stream.  This method ... *//** Writes the data used to represent the subclasses service context ... */InputStream in;/** in is the stream containing the service context representation. ... *//** Internal class used to hold data about a service context class. */BAD_PARAM errorORB.ORBInitDebugGIOPVersion.classthrowBadParam(...)NoSuchFieldException nsfeIllegalArgumentException iaeBAD_PARAM nssc/** Factory method used to create a ServiceContext object by ... */Class<> scClass;Constructor<> scConstructor;int scId;// Find the appropriate constructor in cls// get the ID from the public static final int SERVICE_CONTEXT_IDimport ServiceContextDataVector<> scCollection;/** Register the ServiceContext class so that it will be recognized ... */ServiceContextData scdnew ServiceContextData(...)findServiceContextData(...)import OctetSeqHelperorb.serviceContextDebugFlagisDebugging(...)/** Given the input stream, this fills our service ... */int numValidint scId/** Read the Service contexts from the input stream. */createMapFromInputStream(...)/** Find the ServiceContextData for a given scId and unmarshal ... */EncapsInputStream eismakeServiceContext(...)int JAVAIDL_ALIGN_SERVICE_ID;/** Hopefully unused scid:  This should be changed to a proper ... *//** Write the service contexts to the output stream. ... */int numscwriteServiceContextsInOrder(...)/** Write the service contexts in scMap in a desired order. ... */Integer ueInfoIdObject unknownExceptionInfowriteMapEntry(...)/** Write the given entry from the scMap to the OutputStream. ... *//** Add a service context to the stream, if there is not already ... */Map<> scMap;/** Map of all ServiceContext objects in this container. ... */boolean addAlignmentOnWrite;/** If true, write out a special alignment service context to force the ... */// Use the GIOP version of the ORB.  Should// be specified in ServiceContext.// See REVISIT below concerning giopVersion.// We need to store this so that we can have access// to the CodeBase for unmarshaling possible// RMI-IIOP valuetype data within an encapsulation.// (Known case: UnknownExceptionInfo)// Fix for bug 4904723// REVISIT.  GIOP version should be specified as// part of a service context's definition, so should// be accessible from ServiceContextData via// its ServiceContext implementation class.// Since we don't have that, yet, I'm using the GIOP// version of the input stream, presuming that someone// can't send a service context of a later GIOP// version than its stream version.// Note:  As of Jan 2001, no standard OMG or Sun service contexts// ship wchar data or are defined as using anything but GIOP 1.0 CDR.// Now the input stream passed to a ServiceContext// constructor is already the encapsulation input// stream with the endianness read off, so the// service context should just unmarshal its own// data.// Make service context 12 bytes longer by adding// JAVAIDL_ALIGN_SERVICE_ID service context at end.// The exact length// must be >8 (minimum service context size) and// =4 mod 8, so 12 is the minimum.// Temporarily remove this rather than check it per iteration// Write the UnknownExceptionInfo service context last// (so it will be after the CodeBase) and restore it in// the map.// If it's still in byte[] form, we don't need to// unmarshal it here, just copy the bytes into// the new stream.// We actually unmarshaled it into a ServiceContext// at some point.// Lazy unmarshaling on first use.ThreadDeath dThrowable unknown;// Facade to ResponseWaitingRoom.int OPENING;// Connection statusint ESTABLISHED;int CLOSE_SENT;int CLOSE_RECVD;int ABORT;// REVISIT: WRONG: should not expose sockets here.// REVISIT - MessageMediator parameter?/** Clean up all connection resources.  Used when shutting down an ORB. */// REVISIT - type/** Interface used to create a ContactInfoList from an IOR, as required ... *//** This will be called after the no-arg constructor before ... */// REVISIT: this is GIOP specific.String SOCKET_OR_CHANNEL_CONNECTION_CACHE;/** This interface is the "sticky manager" for IIOP failover.  The default ... *//** @param *//** Used to extract socket address information from an IOR. ... */import CorbaInputObject/** Interface that provides operations to transorm an IOR ... */// create transport read timeouts// activation.idl accordingly.  It has a duplicate definition// If you change the value of this constant then update// Endpoint types known in advance.import ReadTimeoutsFactoryimport CorbaClientDelegateImplimport ReadTCPTimeoutsImpl/** This class provices standard building blocks for the ORB, as do all Default classes ... */TransportDefault$1new CorbaContactInfoListImpl(...)new ClientDelegateFactory(...) { ... }TransportDefault$2new CorbaClientDelegateImpl(...)new ReadTimeoutsFactory(...) { ... }TransportDefault$3new ReadTCPTimeoutsImpl(...)// Internal imports, not used in the interface to this package/** Signals that an Image Format exception of some sort has occurred. ... *//** Constructs an <code>ImageFormatException</code> with no detail message. *//** Constructs an <code>ImageFormatException</code> with the specified ... *//* Copyright (c) 2007, Oracle and/or its affiliates. All rights reserved. ... *//* ******************************************************************** ... */import JPEGImageDecoderImplimport JPEGImageEncoderImplimport JPEGParamimport BufferedImageimport Rasterimport ColorModel/** This class is a factory for implementations of the JPEG Image ... *//** This creates an instance of a JPEGImageDecoder that can be used ... */new JPEGImageDecoderImpl(...)/** This creates an instance of a JPEGImageEncoder that can be used ... */new JPEGImageEncoderImpl(...)/** This is a factory method for creating JPEGEncodeParam objects. ... */int colorIDgetDefaultColorId(...)getColorModel(...)getDefaultJPEGEncodeParam(...)getRaster(...)JPEGParam retnew JPEGParam(...)getNumBands(...)setWidth(...)getWidth(...)setHeight(...)getHeight(...)/** This is a factory method for creating JPEGEncodeParam objects.  It ... *//** This is a factory method for creating a JPEGEncodeParam from a ... *//** ******************************************************************** ... *//** JPEGDecodeParam encapsulates tables and options necessary to ... */int COLOR_ID_UNKNOWN;/** Unknown or Undefined Color ID */int COLOR_ID_GRAY;/** Monochrome */int COLOR_ID_RGB;/** Red, Green, and Blue */int COLOR_ID_YCbCr;/** YCbCr */int COLOR_ID_CMYK;/** CMYK */int COLOR_ID_PYCC;/** PhotoYCC */int COLOR_ID_RGBA;/** RGB-Alpha */int COLOR_ID_YCbCrA;/** YCbCr-Alpha */int COLOR_ID_RGBA_INVERTED;/** RGB-Alpha with R, G, and B inverted. */int COLOR_ID_YCbCrA_INVERTED;/** YCbCr-Alpha with Y, Cb, and Cr inverted. */int COLOR_ID_PYCCA;/** PhotoYCC-Alpha */int COLOR_ID_YCCK;/** YCbCrK */int NUM_COLOR_ID;/** Number of color ids defined. */int NUM_TABLES;/** Number of allowed Huffman and Quantization Tables */int DENSITY_UNIT_ASPECT_RATIO;/** The X and Y units simply indicate the aspect ratio of the pixels. */int DENSITY_UNIT_DOTS_INCH;/** Pixel density is in pixels per inch. */int DENSITY_UNIT_DOTS_CM;/** Pixel density is in pixels per centemeter. */int NUM_DENSITY_UNIT;/** The max known value for DENSITY_UNIT */int APP0_MARKER;/** APP0 marker - JFIF info */int APP1_MARKER;/** APP1 marker */int APP2_MARKER;/** APP2 marker */int APP3_MARKER;/** APP3 marker */int APP4_MARKER;/** APP4 marker */int APP5_MARKER;/** APP5 marker */int APP6_MARKER;/** APP6 marker */int APP7_MARKER;/** APP7 marker */int APP8_MARKER;/** APP8 marker */int APP9_MARKER;/** APP9 marker */int APPA_MARKER;/** APPA marker */int APPB_MARKER;/** APPB marker */int APPC_MARKER;/** APPC marker */int APPD_MARKER;/** APPD marker */int APPE_MARKER;/** APPE marker - Adobe info */int APPF_MARKER;/** APPF marker */int COMMENT_MARKER;/** Adobe marker indicates presence/need for Adobe marker. *//** Get the image width ... *//** Get the image height ... *//** Return the Horizontal subsampling factor for requested ... *//** Return the Vertical subsampling factor for requested ... *//** Returns the coefficient quantization tables or NULL if not ... *//** Returns the Quantization table for the requested component. ... *//** Returns the DC Huffman coding table requested or null if ... *//** Returns the DC Huffman coding table for the requested component. ... *//** Returns the AC Huffman coding table requested or null if ... *//** Returns the AC Huffman coding table for the requested component. ... *//** Get the number of the DC Huffman table that will be used for ... *//** Get the number of the AC Huffman table that will be used for ... *//** Get the number of the quantization table that will be used for ... *//** Returns true if the image information in the ParamBlock is ... *//** Returns true if the tables in the ParamBlock are currently ... *//** Returns true if at least one instance of the marker is present ... *//** Returns a 'byte[][]' associated with the requested marker in ... *//** Returns the JPEG Encoded color id. This is generally ... *//** Returns the number of components for the current encoding ... *//** Get the MCUs per restart marker. ... *//** Get the code for pixel size units This value is copied from the ... *//** Get the horizontal pixel density This value is copied from the ... *//** Get the vertical pixel density This value is copied into the ... *//** JPEGEncodeParam encapsulates tables and options necessary to ... *//** Set the horizontal subsample factor for the given component. ... *//** Set the vertical subsample factor for the given component.  Note that ... *//** Sets the coefficient quantization tables at index ... *//** Sets the DC Huffman coding table at index to the table provided. ... *//** Sets the AC Huffman coding table at index to the table provided. ... *//** Sets the mapping between a component and it's DC Huffman Table. ... *//** Sets the mapping between a component and it's AC Huffman Table. ... *//** Sets the mapping between a component and it's Quantization Table. ... *//** Set the flag indicating the validity of the table information ... *//** Set the flag indicating the validity of the image information ... *//** Sets the marker data to be written to the output data stream. ... *//** Appends 'data' to the array of byte[] associated with ... *//** Set the MCUs per restart, or 0 for no restart markers. ... *//** Set the pixel size units This value is copied into the APP0 ... *//** Set the horizontal pixel density This value is written into the ... *//** Set the vertical pixel density.  This value is copied into ... *//** This creates new Quantization tables that replace the currently ... *//** A class to encapsulate a JPEG Huffman table. ... */new JPEGHuffmanTable(...)short[] lengthsshort[] symbolsStdDCLuminance.lengthsStdDCLuminance.symbolscheckTable(...)StdDCChrominance.lengthsStdDCChrominance.symbolsStdACLuminance.lengthsStdACLuminance.symbolsStdACChrominance.lengthsStdACChrominance.symbolsint HUFF_MAX_LEN;/** The maximum number of symbol lengths ... */int HUFF_MAX_SYM;/** the maximum number of symbols */...[] lengths;/** bits[k] = number of symbols with length k bits */...[] symbols;/** Symbols in order of increasing length */JPEGHuffmanTable StdDCLuminance;/** Standard Huffman table ( JPEG standard section K.3 ) */JPEGHuffmanTable StdDCChrominance;JPEGHuffmanTable StdACLuminance;JPEGHuffmanTable StdACChrominance;/** Private constructor used to construct the Standard Huffman tables *//** Creates a Huffman Table and initializes it. ... */lengths.lengthsymbols.lengththis.lengthsthis.symbols/** This checks that the table they gave us isn't 'illegal' It ... */int numValsint sum...-=.../** Return a copy of the array containing the number of symbols ... */short[] ret/** Return an array containing the Huffman symbols arranged by ... */// 0-base//System.out.println("NumVals: " + numVals);//System.out.println("Sum: " + sum + " Symbols: " + symbols.length);// I'll let them go if they gave us 'extra' symbols...import Pointimport ColorSpaceimport DirectColorModelimport DataBufferimport DataBufferByteimport DataBufferIntimport SampleModelimport WritableRaster/** This interface describes a JPEG data stream decoder.  This decoder ... *//** Returns the JPEGDecodeParam object that resulted from the most ... *//** Sets the JPEGDecodeParam object used to determine the features ... *//** Get the input stream that decoding will occur from. ... *//** Decode the JPEG stream that was passed as part of ... *//** Decodes the current JPEG data stream.  The result of decoding ... *//** JPEGImageDecoder Interface ... */// end class JPEGImageDecoder/** JPEGImageEncoder encodes buffers of image data into JPEG data ... *//** Return the stream the Encoder is currenlt associated with. *//** Set the JPEGEncodeParam object that is to be used for future ... *//** This returns a copy of the current JPEGEncodeParam object, if ... *//** Encode a BufferedImage as a JPEG data stream.  Note, some color ... *//** Returns the 'default' encoded COLOR_ID for a given ColorModel. ... *//** Encode a Raster as a JPEG data stream.  Note that no color ... *//** JPEGImageEncoder Interface ... *//** Class to encapsulate the JPEG quantization tables. ... */new JPEGQTable(...)int[] lumValsStdLuminance.quantvalint[] chromValsStdChrominance.quantval...[] quantval;/** Quantization step for each coefficient in zig-zag order */byte QTABLESIZE;/** The number of coefficients in a DCT block */JPEGQTable StdLuminance;/** This is the sample luminance quantization table given in the ... */JPEGQTable StdChrominance;/** Constructs an empty quantization table. This is used to create ... *//** Constructs an quantization table from the array that was ... *//** Returns the current quantization table as an array of ints in ... */int[] table/** Returns a new Quantization table where the values are ... */long maxint[] retlong holder// limit to valid range// Max quantizer for 12 bits/** Signals that a truncated file was detected.  This object contains ... */Raster ras;BufferedImage bi;/** Constructs a <code>TruncatedFileException</code> with the ... */this.bithis.ras/** Constructs an <code>TruncatedFileException</code> with the ... *//** Allows access to the raster that was in the progress of being ... *//** Allows access to the BufferedImage that was in the progress of ... */...[] compressionTypeNames;compressionTypeNames.length/* Copyright (c) 2013, Oracle and/or its affiliates. All rights reserved. ... */String VERSION_2;// bmp versionsString VERSION_3;String VERSION_3_NT;String VERSION_4;String VERSION_5;int LCS_CALIBRATED_RGB;// Color space typesint LCS_sRGB;int LCS_WINDOWS_COLOR_SPACE;int PROFILE_LINKED;int PROFILE_EMBEDDED;int BI_RGB;// Compression Typesint BI_RLE8;int BI_RLE4;int BI_BITFIELDS;int BI_JPEG;int BI_PNG;import Rectangleimport Transparencyimport ICC_ColorSpaceimport ICC_Profileimport ComponentColorModelimport ComponentSampleModelimport DataBufferUShortimport IndexColorModelimport MultiPixelPackedSampleModelimport PixelInterleavedSampleModelimport SinglePixelPackedSampleModelimport IIOExceptionimport ImageIOimport ImageReaderimport ImageReadParamimport ImageTypeSpecifierimport IIOMetadataimport ImageReaderSpiimport ImageInputStreamimport IIOReadProgressListenerimport IIOReadUpdateListenerimport IIOReadWarningListenerimport java.nio.*import ImageUtilimport I18N/** This class is the Java Image IO plugin reader for BMP images. ... */int VERSION_2_1_BIT;// BMP Image typesint VERSION_2_4_BIT;int VERSION_2_8_BIT;int VERSION_2_24_BIT;int VERSION_3_1_BIT;int VERSION_3_4_BIT;int VERSION_3_8_BIT;int VERSION_3_24_BIT;int VERSION_3_NT_16_BIT;int VERSION_3_NT_32_BIT;int VERSION_4_1_BIT;int VERSION_4_4_BIT;int VERSION_4_8_BIT;int VERSION_4_16_BIT;int VERSION_4_24_BIT;int VERSION_4_32_BIT;int VERSION_3_XP_EMBEDDED;int VERSION_4_XP_EMBEDDED;int VERSION_5_XP_EMBEDDED;long bitmapFileSize;// BMP variableslong bitmapOffset;long compression;long imageSize;...[] palette;int imageType;int numBands;boolean isBottomUp;int bitsPerPixel;int redMask, ...;SampleModel sampleModel, ...;ColorModel colorModel, ...;ImageInputStream iis;/** The input stream where reads from */boolean gotHeader;/** Indicates whether the header is read. */int width;/** The original image width. */int height;/** The original image height. */Rectangle destinationRegion;/** The destination region. */Rectangle sourceRegion;/** The source region. */BMPMetadata metadata;/** The metadata from the stream. *//** The destination image. */boolean noTransform;/** Indicates whether subsampled, subregion is required, and offset is ... */boolean seleBand;/** Indicates whether subband is selected. */int scaleX, ...;/** The scaling factors. */...[] sourceBands, ...;/** source and destination bands. *//** Constructs <code>BMPImageReader</code> from the provided ... *//** Overrides the method defined in the superclass. */setInput(...)setByteOrder(...)ByteOrder.LITTLE_ENDIANresetHeaderInfo(...)checkIndex(...)readHeader(...)new IIOException(...)/** Process the image header. ... */int profileDataint profileSizebyte[] markerlong sizereadUnsignedInt(...)int planesreadUnsignedShort(...)ColorSpace colorSpaceColorSpace.CS_sRGBthis.metadatanew BMPMetadata(...)metadata.widthmetadata.heightmetadata.bitsPerPixelint numberOfEntriesint sizeOfPalettemetadata.bmpVersionmetadata.palettemetadata.paletteSizelong xPelsPerMeterlong yPelsPerMeterlong colorsUsedlong colorsImportantmetadata.compressionmetadata.xPixelsPerMetermetadata.yPixelsPerMetermetadata.colorsUsedmetadata.colorsImportantmetadata.redMaskmetadata.greenMaskmetadata.blueMasklong csTypeint redXint redYint redZint greenXint greenYint greenZint blueXint blueYint blueZlong gammaRedlong gammaGreenlong gammaBluemetadata.intentmetadata.colorSpacemetadata.redXmetadata.redYmetadata.redZmetadata.greenXmetadata.greenYmetadata.greenZmetadata.blueXmetadata.blueYmetadata.blueZmetadata.gammaRedmetadata.gammaGreenmetadata.gammaBluemetadata.alphaMaskbyte[] profileisLinkedProfileAllowed(...)isUncOrDevicePath(...)String pathnew ICC_ColorSpace(...)byte[] rbyte[] gbyte[] bint[] bandOffsetsnew PixelInterleavedSampleModel(...)DataBuffer.TYPE_BYTEnew MultiPixelPackedSampleModel(...)int offpalette.lengthisIndicesForGrayscale(...)createColorModel(...)new IndexColorModel(...)new SinglePixelPackedSampleModel(...)DataBuffer.TYPE_USHORTnew DirectColorModel(...)int[] bitMasksDataBuffer.TYPE_INTArrayList<> listnew ImageTypeSpecifier(...)new ImageReadParam(...)WritableRaster rasterbyte[] bdatashort[] sdataint[] idataclearAbortRequest(...)processImageStarted(...)getDefaultReadParam(...)new Rectangle(...)computeRegions(...)this.widththis.heightgetDestination(...)getSourceXSubsampling(...)getSourceYSubsampling(...)getSourceBands(...)getDestinationBands(...)createCompatibleSampleModel(...)destinationRegion.xdestinationRegion.widthdestinationRegion.ydestinationRegion.heightcreateSubsetSampleModel(...)createWritableRaster(...)new Point(...)new BufferedImage(...)getWritableTile(...)getSampleModel(...)getBounds(...)getDataType(...)getDataBuffer(...)read1Bit(...)read4Bit(...)read8Bit(...)read24Bit(...)readRLE4(...)readRLE8(...)read16Bit(...)read32Bit(...)readEmbedded(...)abortRequested(...)processReadAborted(...)processImageComplete(...)BufferedImage bi// Deal with 1 Bit images using IndexColorModelsint bytesPerScanlineint paddingint lineLengthprocessImageUpdate(...)processImageProgress(...)int lineStridegetScanlineStride(...)int skipLengthint[] srcOffint[] destOffint[] srcPosint[] destPosint lastLinesourceRegion.ysourceRegion.xint v// Method to read a 4 bit BMP image data// Method to read 8 bit BMP image data// Method to read 24 bit BMP image dataint bdestBands.lengthshort[] bufint[] bufint imSizeint remainderbyte[] valuesint bytesReaddecodeRLE8(...)byte[] valint lboolean flagint lineNoint finishedint xoffint yoffsourceRegion.heightint currentLinesourceRegion.widthdecodeRLE4(...)int shiftint[] alternate/** Decodes the jpeg/png image embedded in the bitmap using any jpeg ... */ImageReader readergetImageReadersByFormatName(...)byte[] buffImageReadParam paramcreateImageInputStream(...)ImageTypeSpecifier embTypegetImageTypes(...)createBufferedImage(...)addIIOReadProgressListener(...)new EmbeddedProgressAdapter(...) { ... }BMPImageReader$1addIIOReadUpdateListener(...)new IIOReadUpdateListener(...) { ... }BMPImageReader$2processPassComplete(...)processPassStarted(...)addIIOReadWarningListener(...)new IIOReadWarningListener(...) { ... }BMPImageReader$3processWarningOccurred(...)setDestination(...)setDestinationBands(...)setDestinationOffset(...)getDestinationOffset(...)setSourceBands(...)setSourceRegion(...)getSourceRegion(...)setSourceSubsampling(...)getSubsamplingXOffset(...)getSubsamplingYOffset(...)BMPImageReader$EmbeddedProgressAdapterBoolean isLinkedProfileDisabled;PrivilegedAction<Boolean> aBMPImageReader$4Boolean isWindowsPlatform;/** Verifies whether the byte array contans a unc path. ... */BMPImageReader$5String osname// Always works// read and check the magic marker// Read file size// skip the two reserved fields// Offset to the bitmap from the beginning// End File Header// Start BitmapCoreHeader//metadata.colorPlane = planes;// As BMP always has 3 rgb bands, except for Version 5,// which is bgra// Windows 2.x and OS/2 1.x// Classify the image type// Read in the palette// Windows 3.x and Windows NT// No compression// 8-bit RLE compression// 4-bit RLE compression// 0x1F;// BitsField encoding// there is a palette// Windows 4.x BMP// rgb masks, valid only if comp is BI_BITFIELDS// Only supported for 32bpp BI_RGB argb// All the new fields are valid only for this case// bottom up image// top down image// Reset Image Layout so there's only one tile.//Define the color space// the colorModel and sampleModel will be initialzed// by the  reader of embedded image// When number of bitsPerPixel is <= 8, we use IndexColorModel.// 1 and 4 bit pixels can be stored in a packed format.// Create IndexColorModel from the palette.// The number of bands in the SampleModel is determined by// the length of the mask array passed in.// Create SampleModel// Reset to the start of bitmap; then jump to the//start of image data//read header// If the destination band is set used it// If the destination is provided, then use it.  Otherwise, create new one// Get the image data.// buffer for byte data// buffer for short data// buffer for int data// the sampleModel can be null in case of embedded image// There should only be one tile.// no compression// 1-bit images cannot be compressed.// 24-bit images are not compressed// cache the values to avoid duplicated computation//get the bit and assign to the data buffer of the raster// Padding bytes at the end of each scanline// width * bitsPerPixel should be divisible by 32// If imageSize field is not provided, calculate it.// If width is not 32 bit aligned, then while uncompressing each// scanline will have padding bytes, calculate the amount of padding// Read till we have the whole image// Since data is compressed, decompress it// End-of-scanline marker// End-of-RLE marker// delta or vector marker// Move to the position xoff, yoff down// Whenever end pixels can fit into odd number of bytes,// an extra padding byte will be present, so skip that.// If End-of-RLE data, then exit the while loop// If imageSize field is not specified, calculate it.// If width is not 32 byte aligned, then while uncompressing each// Decompress the RLE4 compressed data.// Absolute mode// When end is odd, the above for loop does not// increment count, so do it now.// Encoded mode// prepare input/* no need for the check on platforms except windows *//* normalize prefix of the path */// long path: whether unc or local// device path or short unc notationimport Localeimport IIORegistryimport ServiceRegistry...[] writerSpiNames;...[] formatNames;...[] entensions;...[] mimeType;boolean registered;ImageInputStream.classBMPMetadata.nativeMetadataFormatNameImageInputStream streamnew BMPImageReader(...)import DataBufferShortimport BandedSampleModelimport RenderedImageimport ByteOrderimport IIOImageimport ImageWriteParamimport ImageWriterimport ImageWriterSpiimport ImageOutputStreamimport IIOWriteProgressListenerimport IIOWriteWarningListenerimport BMPImageWriteParam/** The Java Image IO plugin writer for encoding a binary RenderedImage into ... */ImageOutputStream stream;/** The output stream to write into */ByteArrayOutputStream embedded_stream;int version;int compressionType;boolean isTopDown;int w, ...;int compImageSize;...[] bitMasks;...[] bitPos;...[] bpixels;...[] spixels;...[] ipixels;/** Constructs <code>BMPImageWriter</code> based on the provided ... */setOutput(...)this.streamnew BMPImageWriteParam(...)BMPMetadata metameta.bmpVersionmeta.compressiongetPreferredCompressionType(...)getCompressionMode(...)ImageWriteParam.MODE_EXPLICITgetCompressionType(...)meta.bitsPerPixelgetPixelSize(...)BMPImageWriteParam bmpParamint bitsPerPixelboolean isPaletteint paletteEntriesIndexColorModel icmRenderedImage inputRaster inputRasterboolean writeRasterhasRaster(...)Rectangle sourceRegionSampleModel sampleModelColorModel colorModelIIOMetadata imageMetadatagetMetadata(...)BMPMetadata bmpImageMetadataint scaleXint scaleYint xOffsetint yOffsetint dataTypeint minXint minYRectangle destinationRegionboolean noTransformint[] sourceBandsboolean noSubbandint numBandsboolean bgrOrderint[] sampleSizegetSampleSize(...)int destScanlineBytesbyte[] aint fileSizeint offsetint headerSizeint imageSizeint xPelsPerMeterint yPelsPerMeterint colorsUsedint colorsImportantlong headPosgetStreamPosition(...)int scanlineBytesint[] pixelsint maxBandOffsetint[] pixelint destScanlineLengthgetDefaultWriteParam(...)intersection(...)Rectangle rectgetMinX(...)getMinY(...)getRenderedImage(...)ImageTypeSpecifier imageTypegetDefaultImageMetadata(...)getBandOffsets(...)bandOffsets.lengthint[] bitOffsetsgetBitOffsets(...)bitOffsets.lengthImageWriteParam.MODE_COPY_FROM_METADATAbmpImageMetadata.compressionImageWriteParam.MODE_DEFAULTcanEncodeImage(...)int rmaskint gmaskint bmaskgetDataTypeSize(...)DirectColorModel dcmgetRedMask(...)getGreenMask(...)getBlueMask(...)writeMaskToPalette(...)firstLowBit(...)getMapSize(...)getAlphas(...)getReds(...)getGreens(...)getBlues(...)int[] sample_sizesroundBpp(...)writeFileHeader(...)isTopDown(...)writeInfoHeader(...)int masklong endPoswriteEmbedded(...)writeSize(...)processWriteAborted(...)flushBefore(...)int rowRaster srcRectangle srcRectSampleModel smint startXsrcRect.xgetSampleModelTranslateX(...)int startYsrcRect.ygetSampleModelTranslateY(...)ComponentSampleModel csmgetOffset(...)int nbMultiPixelPackedSampleModel mppsmSinglePixelPackedSampleModel sppsmshort[] usdataDataBuffer.TYPE_SHORTwriteShorts(...)writeInts(...)bpixels.lengthgetPixels(...)srcRect.widthsrcRect.heightencodeRLE4(...)encodeRLE8(...)pixel.lengthwritePixels(...)incCompImageSize(...)int pixelbyte[] bipixelsspixels.lengthint entriesgetRGB(...)ipixels.lengthint runCountint absValbyte runValbyte nextValbyte[] absBufint aisEven(...)int qbyte runVal1byte runVal2byte nextVal1byte nextVal2int rgetImageWritersByFormatName(...)ImageWriter writerImageWriteParam paramaddIIOWriteProgressListener(...)new IIOWriteProgressAdapter(...) { ... }BMPImageWriter$1addIIOWriteWarningListener(...)new IIOWriteWarningListener(...) { ... }BMPImageWriter$2createImageOutputStream(...)...>>>=...BMPImageWriter$IIOWriteProgressAdapter/* Returns preferred compression type for given image. ... */getBufferedImageType(...)BufferedImage.TYPE_USHORT_565_RGB/* Check whether we can encode image of given type using compression method in question. ... */ImageTypeSpecifier imgTypeImageWriterSpi spigetOriginatingProvider(...)int biTypeint bppboolean canUseRGBboolean canUseBITFIELDSint[] sizessizes.length// validates output// Default is using 24 bits per pixel.// cache the data type;// Raw data can only handle bytes, everything greater must be ASCII.// for images with BandedSampleModel we can not work//  with raster directly and must use writePixels()// we can work with raster directly only in case of// BGR component order.// In any other case we must use writePixels()// BugId 4892214: we can not work with raster directly// if image have different color order than RGB.// We should use writePixels() for such images.// we will use getPixels() to extract pixel data for writePixels()// Please note that getPixels() provides rgb bands order.//XXX: check more// Number of bytes that a scanline for the image written out will have.// ImageWriteParam.MODE_DISABLED:// we should use 32bpp images in case of BI_BITFIELD// compression to avoid color conversion artefacts// Setting this flag to false ensures that generic// writePixels() will be used to store image data/* NB: canEncodeImage() ensures we have image of ... */// it is unlikely, but if it happens, we should throw// an exception related to unsupported image format// prepare info for writePixels procedure// handle BI_RGB compression// Cannot be written as a Palette image. So write out as// 24 bit image.// Grey scale images/* NB: the actual pixel size can be smaller than ... */// actual writing of image data// Calculate padding for each scanline// FileHeader is 14 bytes, BitmapHeader is 40 bytes,// add palette size and that is where the data will begin/* According to MSDN description, the top-down image layout ... */// compression// imageSize// xPelsPerMeter// yPelsPerMeter// Colors Used// Colors Important// palette// write palette// write masks for red, green and blue components.// Writing of actual image data// Buffer for up to 8 rows of pixels// Also create a buffer to hold one line of the data// to be written to the file, so we can use array writes.// prepare embedded buffer// update the file/image Size// Get the pixels//byte[] bdata =//    ((DataBufferByte)src.getDataBuffer()).getData();//System.out.println("bdata.length="+bdata.length);//System.arraycopy(bdata, pos, bpixels, 0, scanlineBytes);// pixel data is provided here in RGB order// Write the RLE EOF marker and// Partially filled last byte, if any// Put the last pixel of odd-length lines in the 4 MSBs/* We expect that pixel data comes in RGB order. ... *//* please note that despite other cases, ... */// Since BMP needs BGR format// Case where IndexColorModel had > 256 colors.// We have two possibilities here:// 1. we are writing the indexed image with bitfields//    compression (this covers also the case of BYTE_BINARY)//    => use icm to get actual RGB color values.// 2. we are writing the gray-scaled image with BI_BITFIELDS//    compression//    => just replicate the level of gray to color components.// Write out the padding/// Check if there was an existing Absolute Run//Padding/// Absolute Encoding for less than 3/// treated as regular encoding/// Do not include the last element since it will/// be inclued in the next encoding/run/// Only 255 values permitted/// If there was an existing run// First time..//  0-254 only// padding since 255 elts is not even// EOF scanline// Write the run// write the Absolute Run/// EOF scanline//Check if there was an existing Absolute Run// we need to exclude  last 2 elts, similarity of// which caused to enter this part of the code// if # of elts is odd - read the last element// Padding to word align absolute encoding// Even runlength/// Only EOF required now// odd runlength and the run ends here// runCount wont be > 254 since 256/255 case will// be taken care of in above code.// If end of scanline// Check for existing run// first time// only 255 elements// Padding for word align// since it will fit into 127 bytes// Handle the End of scanline for the last 2 4bits// Padding// magic value// File size// reserved1 and reserved2// offset to image data// size of header// width// height// number of planes// Bits Per Pixel//param.setDestinationBands(bmpParam.getDestinationBands());// only 4bpp images can be encoded as BI_RLE4// only 8bpp images can be encoded as BI_RLE8/* Technically we expect that we may be able to ... */...[] readerSpiNames;ImageOutputStream.classnew BMPImageWriter(...)import UnsupportedEncodingExceptionimport IIOMetadataNodeimport IIOMetadataFormatimport IIOMetadataFormatImplString nativeMetadataFormatName;String bmpVersion;// Fields for Image Descriptorshort bitsPerPixel;int compression;int imageSize;int xPixelsPerMeter;// Fields for PixelsPerMeterint yPixelsPerMeter;int colorsUsed;int colorsImportant;int redMask;// Fields for BI_BITFIELDS compression(Mask)int greenMask;int blueMask;int alphaMask;int colorSpace;double redX;// Fields for CIE XYZ for the LCS_CALIBRATED_RGB color spacedouble redY;double redZ;double greenX;double greenY;double greenZ;double blueX;double blueY;double blueZ;int gammaRed;// Fields for Gamma values for the LCS_CALIBRATED_RGB color spaceint gammaGreen;int gammaBlue;int intent;// Fields for the Palette and Entriesint paletteSize;int red;int green;int blue;List<> comments;// List of byte[]// Fields from CommentExtension// new ArrayList();getNativeTree(...)IIOMetadataFormatImpl.standardMetadataFormatNamegetStandardTree(...)UnsupportedEncodingException eIIOMetadataNode rootnew IIOMetadataNode(...)IIOMetadataNode nodeaddChildNode(...)int versionaddXYZPoints(...)int numCompsIIOMetadataNode entry// Standard tree node methodsIIOMetadataNode subNodesetAttribute(...)IIOMetadataNode subNode1appendChild(...)String bitscountBits(...)float ratioIIOMetadataNode childsetUserObject(...)setNodeValue(...)convertObjectToString(...)// Palette// CompressionTypeNameIIOMetadataFormat instance;addBooleanAttribute(...)new BMPMetadataFormat(...)// root -> ImageDescriptor/// Should the max value be 1.7976931348623157e+308 ?// root -> Palette// root -> Palette -> PaletteEntry// root -> CommentExtensions// root -> CommentExtensions -> CommentExtensionimport ListResourceBundlenew Object[][]/* Copyright (c) 2003, 2005, Oracle and/or its affiliates. All rights reserved. ... */// Node name, followed by description/* Came from GIFEncoder initially. ... */ImageOutputStream output;int bitsLeft;boolean blocks;/** note this also indicates gif format BITFile. * */// bits left at current index that are avail./* @param output destination for output data ... */this.outputthis.blocksint bitsWritten...>>=...int topbits/* Copyright (c) 2005, Oracle and/or its affiliates. All rights reserved. ... */// gif block count// This handles the GIF block count stuff// bits contents fit in current index byte// GIF// bits overflow from current byte to next.// if bits  > space left in current byte then the lowest order bits// of code are taken and put in current byte and rest put in next.// if bits  > space left in current byte then the highest order bits// at highest order bit location !!// ok this many bits gone off the top// next index/** A dummy <code>ColorSpace</code> to enable <code>ColorModel</code> ... *//** Return the type given the number of components. ... */ColorSpace.TYPE_GRAY/** Constructs a bogus <code>ColorSpace</code>. ... */// specified behavior of the methods vis-a-vis exceptions.// output array while otherwise attempting to adhere to the// The following methods simply copy the input array to thefloat[] rgbvaluecolorvalue.lengthgetNumComponents(...)new ArrayIndexOutOfBoundsException(...)float[] colorvaluergbvalue.lengthfloat[] xyzvaluexyzvalue.length// Based on the constant definitions TYPE_2CLR=12 through// TYPE_FCLR=25. This will return unknown types for// numComponents > 15.String resource_name;import PropertyResourceBundle/** Class to simplify use of internationalization message strings. ... *//** Returns the message string with the specified key from the ... */PropertyResourceBundle bundleInputStream streamgetResourceAsStream(...)new PropertyResourceBundle(...)handleGetObject(...)// Chain the exception./** Creates a <code>ColorModel</code> that may be used with the ... *//* XXX testing only ... */DataBuffer.TYPE_FLOATDataBuffer.TYPE_DOUBLEboolean hasAlphaboolean isAlphaPremultipliedint transparencyTransparency.TRANSLUCENTTransparency.OPAQUEColorSpace.CS_GRAYnew BogusColorSpace(...)new ComponentColorModel(...)getBitMasks(...)int amaskbitMasks.lengthint bitssampleSize.lengthint bitsPerSamplebyte[] map/** For the case of binary data (<code>isBinary()</code> returns ... */int rectXrect.xint rectYrect.yint rectWidthrect.widthint rectHeightrect.heightDataBuffer dataBufferint dxint dyMultiPixelPackedSampleModel mppint eltOffsetint bitOffsetgetBitOffset(...)int numBytesPerRowbyte[] binaryDataArrayisBinary(...)getData(...).lengthint strideshort[] dataint xRemainingshort datumint[] dataint datumint leftShiftint rightShiftint bOffsetint leftint deltaint right/** Returns the binary data unpacked into an array of bytes. ... */int maxYint maxXshort s/** Sets the supplied <code>Raster</code>'s data from an array ... */int leftShift8int mask1byte datumint remainMaskint leftShift16int mask2int leftShift32/** Copies data into the packed array of the <code>Raster</code> ... */getPixelBitStride(...)boolean useAlphaboolean premultipliedint dataTypeSizeint[] bitsbyte[] compint elementSizegetDataBitOffset(...)int maxBandOffint pixelStridegetPixelStride(...)int scanlineStrideint[] bankIndicesgetBankIndices(...)max(...)bankIndices.lengthgetTileSize(...)/** Tests whether the color indices represent a gray-scale image. ... */r.lengthg.lengthbyte temp/** Converts the provided object to <code>String</code> */byte[] bArraybArray.lengthint[] iArrayiArray.lengthshort[] sArraysArray.length/** Checks that the provided <code>ImageWriter</code> can encode ... */ImageTypeSpecifier type/** Returns whether the image has contiguous data across rows. */WritableRaster ras//import javax.imageio.ImageTypeSpecifier;// Check the parameter.// Get the data type.// Check the data type// Return null for other types.// The return variable.// Get the sample size.// Create a Component ColorModel.// Get the number of bands.// Determine the color space.// Load the colormap with a ramp.// bitOffset != 0// bitOffset % 8 != 0// Optimal case: simply return.// when all the bits in this BYTE will be set// into the data buffer.// All the "leftShift" high bits will be set// into the data buffer.  But not all the// "rightShift" low bits will be set.// Less than "leftShift" high bits will be set.// This BYTE is set into one SHORT// Mask the bits to be set.// This BYTE will be set into two SHORTs// This BYTE will be set into two SHORTs;// But not all the low bits will be set into SHORT// Only some of the high bits will be set into// SHORTs// This BYTE is set into one INT// All the bits of this BYTE will be set into two INTs// This BYTE will be set into two INTs;// But not all the low bits will be set into INT// Only some of the high bits will be set into INT//dataType == DataBuffer.TYPE_SHORT ||// Ensure image rows samples are stored contiguously// in a single bank.// Otherwise true if and only if it's a bilevel image with// a MultiPixelPackedSampleModel, 1 bit per pixel, and 1 bit// pixel stride.ImageInputStream stream;/* Copyright (c) 2000, Oracle and/or its affiliates. All rights reserved. ... *//* Modified from original LZWCompressor to change interface to passing a ... */int codeSize;/** base underlying code size of data being compressed 8 for TIFF, 1 to 8 for GIF * */int clearCode;/** reserved clear code based on code size * */int endOfInfo;/** reserved end of data code based on code size * */int numBits;/** current number bits output for each code * */int limit;/** limit at which current number of bits code size has to be increased * */short prefix;/** the prefix code which represents the predecessor string to current input point * */BitFile bf;/** output destination for bit codes * */LZWStringTable lzss;/** general purpose LZW string table * */boolean tiffFudge;/** modify the limits of the code values in LZW encoding due to TIFF bug / feature * */new BitFile(...)this.codeSizenew LZWStringTable(...)clearTable(...)writeBits(...)int idxbyte cshort indexint maxOffsetfindCharString(...)addCharString(...)/* Indicate to compressor that no more data to go so write out ... */// set flag for GIF as NOT tiff/** General purpose LZW String Table. ... */int RES_CODES;/** codesize + Reserved Codes */short HASH_FREE;short NEXT_FIRST;int MAXBITS;int MAXSTR;short HASHSIZE;short HASHSTEP;...[] strChr;...[] strNxt;// after predecessor character...[] strHsh;// predecessor stringshort numStrings;// hash table to find  predecessor + char pairs...[] strLen;/* each entry corresponds to a code and contains the length of data ... */// next code if adding new prestring + char/* Constructor allocate memory for string store data *//* @param index value of -1 indicates no predecessor [used in initialisation] ... */int hshidx/* @param index index to prefix string ... */int nxtidx/* @param codesize the size of code to be preallocated for the ... */int w/* If expanded data doesn't fit into array only what will fit is written ... */int expandLenint codeLenint bufSpaceint skipTail// if used up all codes// return the code and inc for next code// Rob fixed used to sign extend// search// init with no prefix// just in case// DONE no more unpacked// how much data we are actually expanding// length of expanded code left// how much space left// only got this many to unpack// only > 0 if codeLen > bufSpace [left overs]// initialise to exclusive end address of buffer area// NOTE: data unpacks in reverse direction and we are placing the// unpacked data directly into the array in the correct location.// skip required of expanded data// to predecessor code// indicate what part of codeLen used// indicate length of dat unpackedimport Color/** This class implements the octree quantization method ... */int MAXLEVEL;/** maximum of tree depth */RenderedImage src;ColorModel srcColorModel;int requiredSize;ColorNode root;int numNodes;int maxNodes;int currLevel;int currSize;...[] reduceList;int transparency;ColorNode transColor;/** Creates an image representing given image ... */PaletteBuilder pbnew PaletteBuilder(...)buildPalette(...)getIndexedImage(...)/** Creates an palette representing colors from given image ... */getIndexColorModel(...)/** Returns <code>true</code> if PaletteBuilder is able to create ... */canCreatePalette(...)BufferedImage dstBufferedImage.TYPE_BYTE_INDEXEDWritableRaster wrColor aColorgetSrcColor(...)setSample(...)findColorIndex(...)this.srcthis.srcColorModelthis.srcRasterthis.transparencygetTransparency(...)this.requiredSizeint argbgetDataElements(...)new Color(...)getAlpha(...)aNode.isLeafaNode.paletteIndexint childIndexgetBranchIndex(...)aNode.levelaNode.childrennew ColorNode[]reduceList.lengthnew ColorNode(...)transColor.isLeafinsertNode(...)reduceTree(...)aNode.colorCountaNode.redgetRed(...)aNode.greengetGreen(...)aNode.bluegetBlue(...)int branchIndexaNode.childCountaNode.nextReduciblebyte[] redbyte[] greenbyte[] bluefindPaletteEntry(...)int red_indexint green_indexint blue_indexint levelColorNode thisNodeColorNode pListint minColorCountpList.colorCountint cntint leafChildCountgetLeafChildCount(...)int aDepththisNode.levelpList.nextReduciblepList.nextReducible.colorCountthisNode.nextReduciblethisNode.isLeaffreeTree(...)thisNode.childrenthisNode.childCountPaletteBuilder$ColorNode/** The node of color tree. */boolean isLeaf;int childCount;...[] children;int colorCount;long red;long blue;long green;int paletteIndex;ColorNode nextReducible;children.length...[...].isLeafint gint c/* Copyright (c) 2005, 2006, Oracle and/or its affiliates. All rights reserved. ... */// default transparnt pixel/* from the book *//* If transparency of given image is not opaque we assume all ... */// one slot for transparent color// we need place for transparent color;// nothing to reduce// look for element with lower color count// save pointer to first reducible node// NB: current color count for node could be changed in future// we need to process it// reduce node/** This class contains utility methods that may be useful to ImageReader ... */// Helper for computeUpdatedPixels methodboolean gotPixelint firstDstint secondDstint lastDstint srcint dst/** A utility method that computes the exact set of destination ... */int[] valscomputeUpdatedPixels(...)destinationOffset.xdestinationOffset.y// We need to satisfy the congruences:// dst = destinationOffset + (src - sourceOffset)/sourceSubsampling// src - passStart == 0 (mod passPeriod)// src - sourceOffset == 0 (mod sourceSubsampling)// subject to the inequalities:// src >= passStart// src < passStart + passExtent// src >= sourceOffset// src < sourceOffset + sourceExtent// dst >= dstMin// dst <= dstmax// where// For now we use a brute-force approach although we could// attempt to analyze the congruences.  If passPeriod and// sourceSubsamling are relatively prime, the period will be// their product.  If they share a common factor, either the// period will be equal to the larger value, or the sequences// will be completely disjoint, depending on the relationship// between passStart and sourceOffset.  Since we only have to do this// twice per image (once each for X and Y), it seems cheap enough// to do it the straightforward way.// Record smallest valid pixel// Record second smallest valid pixel// Record largest valid pixel// If we never saw a valid pixel, set width to 0// The period is given by the difference of any two adjacent pixels// Utility method for nodes with a single attribute named "value"List<> valuesaddSingleAttributeElement(...)// root -> Chroma// root -> Chroma -> ColorSpaceType// root -> Chroma -> NumChannels// root -> Chroma -> Gamma// root -> Chroma -> BlackIsZero// root -> Chroma -> Palette// root -> Chroma -> PaletteEntry// root -> Chroma -> BackgroundIndex// root -> Chroma -> BackgroundColor// root -> Compression// root -> Compression -> CompressionTypeName// root -> Compression -> Lossless// root -> Compression -> NumProgressiveScans// root -> Compression -> BitRate// root -> Data// root -> Data -> PlanarConfiguration// root -> Data -> SampleFormat// root -> Data -> BitsPerSample// root -> Data -> SignificantBitsPerSample// root -> Data -> SampleMSB// root -> Dimension// root -> Dimension -> PixelAspectRatio// root -> Dimension -> ImageOrientation// root -> Dimension -> HorizontalPixelSize// root -> Dimension -> VerticalPixelSize// root -> Dimension -> HorizontalPhysicalPixelSpacing// root -> Dimension -> VerticalPhysicalPixelSpacing// root -> Dimension -> HorizontalPosition// root -> Dimension -> VerticalPosition// root -> Dimension -> HorizontalPixelOffset// root -> Dimension -> VerticalPixelOffset// root -> Dimension -> HorizontalScreenSize// root -> Dimension -> VerticalScreenSize// root -> Document// root -> Document -> FormatVersion// root -> Document -> SubimageInterpretation// root -> Document -> ImageCreationTime// second = 60 denotes leap second// root -> Document -> ImageModificationTime// root -> Text// root -> Text -> TextEntry// root -> Transparency// root -> Transparency -> Alpha// root -> Transparency -> TransparentIndex// root -> Transparency -> TransparentColor// root -> Transparency -> TileTransparencies// root -> Transparency -> TileTransparencies -> TransparentTile// root -> Transparency -> TileOpacities// root -> Transparency -> TileOpacities -> OpaqueTile// Node name, followed by description, or// Node name + "/" + AttributeName, followed by descriptionimport ImageInputStreamImpllong startingPos;int startingLength;this.startingPosthis.startingLengththis.length/* Copyright (c) 2000, 2005, Oracle and/or its affiliates. All rights reserved. ... */// Local EOF// Empty finalizer (for improved performance; no need to call// super.finalize() in this case)import IIOInvalidTreeException// package scope...[] disposalMethodNames;int imageLeftPosition;// Fields from Image Descriptorint imageTopPosition;int imageWidth;int imageHeight;boolean interlaceFlag;boolean sortFlag;...[] localColorTable;int disposalMethod;// Fields from Graphic Control Extensionboolean userInputFlag;boolean transparentColorFlag;int delayTime;int transparentColorIndex;boolean hasPlainTextExtension;// Fields from Plain Text Extensionint textGridLeft;int textGridTop;int textGridWidth;int textGridHeight;int characterCellWidth;int characterCellHeight;int textForegroundColor;int textBackgroundColor;...[] text;List<> applicationIDs;// Fields from ApplicationExtensionList<> authenticationCodes;List<> applicationData;int numAppExtensionsint numCommentslocalColorTable.lengthtoISO8859(...)IIOMetadataNode appExtNodebyte[] applicationIDbyte[] authenticationCodebyte[] appDataIIOMetadataNode commentNodebyte[] commentIIOMetadataNode chroma_nodeIIOMetadataNode compression_nodeIIOMetadataNode data_nodeIIOMetadataNode dimension_node// Document not in imageIterator<> commentIterIIOMetadataNode text_nodeIIOMetadataNode transparency_node// scratch node// Image descriptor// Local color table// Graphic control extension// Application extensions// Comment extensions// Gamma not in format// BackgroundIndex not in image// BackgroundColor not in format// BitRate not in format// PlanarConfiguration not in format// BitsPerSample not in image// SignificantBitsPerSample not in format// SampleMSB not in format// PixelAspectRatio not in image// HorizontalPixelSize not in format// VerticalPixelSize not in format// HorizontalPhysicalPixelSpacing not in format// VerticalPhysicalPixelSpacing not in format// HorizontalPosition not in format// VerticalPosition not in format// HorizontalScreenSize not in image// VerticalScreenSize not in image// Alpha not in format// TransparentColor not in format// TileTransparencies not in format// TileOpacities not in formatGIFImageMetadata.nativeMetadataFormatNameGIFStreamMetadata.colorTableSizesGIFImageMetadata.disposalMethodNamesaddObjectValue(...)new GIFImageMetadataFormat(...)// root -> LocalColorTable// root -> LocalColorTable -> ColorTableEntry// root -> GraphicControlExtension// root -> PlainTextExtension// root -> ApplicationExtensions// root -> ApplicationExtensions -> ApplicationExtension/* Copyright (c) 2001, 2005, Oracle and/or its affiliates. All rights reserved. ... */import ReaderUtil// The current ImageInputStream source.// True if the file header including stream metadata has been read.// Per-stream settingsGIFStreamMetadata streamMetadata;// Global metadata, read once per input setting.int currIndex;// The current image indexGIFImageMetadata imageMetadata;// Metadata for image at 'currIndex', or null.List<> imageStartPosition;// as needed.// start of the metadata for each image.  Entries are added// A List of Longs indicating the stream positions of theint imageMetadataLength;// imageMetadata != null.// Length of metadata for image at 'currIndex', valid only ifint numImages;// The number of images in the stream, if known, otherwise -1....[] block;// Variables used by the LZW decoding processint bitPos;int nextByte;int initCodeSize;int eofCode;int next32Bits;// 32-bit lookahead bufferboolean lastBlockFound;// and we are simply draining the 32-bit buffer// Try if the end of the data blocks has been found,BufferedImage theImage;// The image to be written.WritableRaster theTile;// The image's tile.int width, ...;// The image dimensions (from the stream).int streamX, ...;// The pixel currently being decoded (in the stream's coordinates).int rowsDone;// The number of rows decodedint interlacePass;// The current interlace pass, starting with 0....[] fallbackColorTable;...[] interlaceIncrement;// Constants used to control interlacing.// End per-stream settings...[] interlaceOffset;// Take input from an ImageInputStreamresetStreamSettings(...)this.numImageslocateImage(...)// and bump minIndex if required.// Throw an IndexOutOfBoundsException if index < minIndex,readMetadata(...)imageMetadata.imageWidthimageMetadata.imageHeight// since this method is private and we pass consistent data here// We don't check all parameters as ImageTypeSpecifier.createIndexed doimageMetadata.transparentColorFlagimageMetadata.transparentColorIndexList<> lbyte[] colorTablecolorTable.lengthint lutLengthint rgbIndeximageMetadata.localColorTablestreamMetadata.globalColorTablegetDefaultPalette(...)createIndexed(...)// BEGIN LZW STUFF// When the last block is found, we continue to// and extracted from the right.// a 32-bit lookahead buffer that is filled from the left// Load a block (1-255 bytes) at a time, and maintainint codereadUnsignedByte(...)int nbytesint sourceXSubsampling;int sourceYSubsampling;int sourceMinProgressivePass;int sourceMaxProgressivePass;Point destinationOffset;int updateMinY;// Used only if IIOReadUpdateListeners are presentint updateYStep;boolean decodeThisRow;int destY;...[] rowBuf;int widthint destXsetDataElements(...)int[] bandsthis.decodeThisRowoutputRow(...)imageMetadata.interlaceFlagstartPass(...)this.destYcomputeDecodeThisRow(...)// END LZW STUFFthis.streamMetadatanew GIFStreamMetadata(...)byte[] signatureStringBuffer versionint packedFieldsboolean globalColorTableFlagint numGCTEntriesstreamMetadata.versionstreamMetadata.logicalScreenWidthstreamMetadata.logicalScreenHeightstreamMetadata.colorResolutionstreamMetadata.sortFlagstreamMetadata.backgroundColorIndexstreamMetadata.pixelAspectRatioint blockTypeint labelEOFException eLong lLong l1skipImage(...)// Read blocks of 1-255 bytes, stop at a 0-length blockbyte[] newData// Stream must be positioned at start of metadata for 'currIndex'long startPositionthis.imageMetadatanew GIFImageMetadata(...)int idPackedFieldsboolean localColorTableFlagint numLCTEntriesimageMetadata.imageLeftPositionimageMetadata.imageTopPositionimageMetadata.sortFlagthis.imageMetadataLengthint gceLengthint gcePackedFieldsint terminatorimageMetadata.disposalMethodimageMetadata.userInputFlagimageMetadata.delayTimeimageMetadata.hasPlainTextExtensionimageMetadata.textGridLeftimageMetadata.textGridTopimageMetadata.textGridWidthimageMetadata.textGridHeightimageMetadata.characterCellWidthimageMetadata.characterCellHeightimageMetadata.textForegroundColorimageMetadata.textBackgroundColorimageMetadata.textconcatenateBlocks(...)imageMetadata.commentsint blockSizebyte[] authCodebyte[] blockDatacopyData(...)byte[] applicationDataapplicationData.lengthimageMetadata.applicationIDsimageMetadata.authenticationCodesimageMetadata.applicationDataIIOException iioedst.lengthint restsrc.lengthint yStepthis.updateMinYthis.updateYStepIterator<> imageTypesthis.theImagethis.theTilethis.streamXthis.streamYthis.rowsDonethis.interlacePassthis.sourceRegionthis.destinationRegionthis.destinationOffsetthis.sourceXSubsamplingthis.sourceYSubsamplingthis.sourceMinProgressivePassgetSourceMinProgressivePass(...)this.sourceMaxProgressivePassgetSourceMaxProgressivePass(...)this.rowBufint oldCodeint[] prefixbyte[] suffixbyte[] initialint[] lengthbyte[] stringint tableIndexint codeSizeint codeMaskthis.initCodeSizethis.blockLengththis.bitPosthis.nextBytethis.lastBlockFoundinitNext32Bits(...)this.clearCodethis.eofCodeinitializeStringTable(...)getCode(...)int newSuffixIndexint tiint ocoutputPixels(...)/** Remove all settings including global settings such as ... *//** Remove local settings based on parsing of a stream. */...[] defaultPalette;BufferedImage img// Clear all values based on the previous stream contents// Some files erroneously have a transparent color index// of 255 even though there are fewer than 256 colors.// no color table, the spec allows to use any palette.// Normalize color table length to 2^1, 2^2, 2^4, or 2^8// Bump from 3 to 4 bits// Bump to 8 bits// Entries from length + 1 to lutLength - 1 will be 0// No more data available// Shift in a byte of new data at a time// Check if current block is out of bytes// Get next block size// Fill in the entire table for robustness against// out-of-sequence codes.// tableIndex = numEntries + 2;// codeSize = initCodeSize + 1;// codeMask = (1 << codeSize) - 1;// Clip against ImageReadParam// Update IIOReadUpdateListeners, if any// updateYStep will have been initialized if// updateListeners is non-null// Process end-of-row// Update IIOReadProgressListeners// Inform IIOReadUpdateListeners of end of pass// Determine whether pixels from this row will// be written to the destination// Create an object to store the stream metadata// Found position of metadata for image 0// Stream must be at the beginning of an image descriptor// upon exit// Skip color table if any// EOF// Find closest known index// Seek to that position// Skip images until at desired index or last image found// Create an object to store the image metadata// Image Descriptor// Read color table if any// Record length of this metadata block// Now positioned at start of LZW-compressed pixels// Extension block// Graphics Control Extension// 4// Plain text extension// Comment extension// Application extension// read available data// Init lists if necessary// Skip over unknown extension blocks// Trailer// Initialized updateMinY and updateYStep// Inform IIOReadUpdateListeners of new pass// A null ImageReadParam means we use the default// Initialize the destination image// Get source region, taking subsampling offsets into account,// and clipping against the true source bounds// Inform IIOReadProgressListeners of start of image// Read and decode the image data, fill in theImage// Read first data block// Init 32-bit buffer// Inform IIOReadProgressListeners of end of image// code == tableIndex// warning - code out of sequence// possibly data corruption// Reverse code// No need to reinitialize 'block'String vendorName;String version;...[] suffixes;...[] MIMETypes;String readerClassName;GIFStreamMetadata.nativeMetadataFormatNamenew GIFImageReader(...)import Dimensionimport NodeListimport LZWCompressorimport PaletteBuilderimport ByteComponentRasterGIFWritableStreamMetadata.NATIVE_FORMAT_NAMEGIFWritableImageMetadata.NATIVE_FORMAT_NAMEboolean DEBUG;String STANDARD_METADATA_NAME;// XXX false for release!String STREAM_METADATA_NAME;String IMAGE_METADATA_NAME;/** The <code>output</code> case to an <code>ImageOutputStream</code>. */boolean isWritingSequence;/** Whether a sequence is being written. */boolean wroteSequenceHeader;/** Whether the header has been written. */GIFWritableStreamMetadata theStreamMetadata;/** The stream metadata of a sequence. */int imageIndex;/** The index of the image being written. *//** The number of bits represented by the value which should be a ... */int numBits/** Compute the source region and destination dimensions taking any ... */int periodXint periodYint gridXint gridYsourceBands.lengthsetBounds(...)sourceBounds.xsourceBounds.ysourceBounds.widthsourceBounds.heightdestSize.widthdestSize.height/** Create a color table from the image ColorModel and SampleModel. */int mapSizeint ctSizegetGifPaletteSize(...)byte[] redsbyte[] greensbyte[] bluesint colorTableLength/** According do GIF specification size of clor table (palette here) ... *//** Merges <code>inData</code> into <code>outData</code>. The supplied ... */String formatNameString nativeFormatNamegetNativeMetadataFormatName(...)String[] extraFormatNamesgetExtraMetadataFormatNames(...)extraFormatNames.lengthisStandardMetadataFormatSupported(...)Node rootgetAsTree(...)mergeTree(...)IIOInvalidTreeException e/** Creates a default stream metadata object and merges in the ... */IIOMetadata smgetDefaultStreamMetadata(...)convertMetadata(...)/** Creates a default image metadata object and merges in the ... */GIFWritableImageMetadata imboolean isProgressiveim.interlaceFlagcanWriteProgressive(...)getProgressiveMode(...)param.MODE_COPY_FROM_METADATAwriteTrailer(...)resetLocal(...)GIFWritableImageMetadata imageMetadatanew GIFWritableImageMetadata(...)Rectangle sourceBoundsDimension destSizenew Dimension(...)ImageWriteParam.MODE_DISABLEDcreateColorTable(...)int transparentIndexgetTransparentPixel(...)GIFWritableStreamMetadata streamMetadatanew GIFWritableStreamMetadata(...)new GIFImageWriteParam(...)getLocale(...)this.theStreamMetadatathis.isWritingSequence/** Resets locally defined instance variables. */this.wroteSequenceHeaderthis.imageIndexconvertStreamMetadata(...)getComponentSize(...)/** Writes any extension blocks, the Image Descriptor, the image data, ... */RenderedImage imagebyte[] globalColorTableneedToCreateIndex(...)createIndexedImage(...)setRenderedImage(...)GIFMetadata.UNDEFINED_INTEGER_VALUEgetNumBits(...)globalColorTable.lengthimageMetadata.localColorTable.lengthwriteHeader(...)theStreamMetadata.globalColorTablewriteImage(...)/** Writes any extension blocks, the Image Descriptor, and the image data ... */boolean writeGraphicsControlExtensionNodeList listgetElementsByTagName(...)writeGraphicControlExtension(...)writePlainTextExtension(...)writeApplicationExtension(...)writeCommentExtension(...)writeImageDescriptor(...)writeRasterData(...)int[] sbufbyte[] dbufRaster rastergetTile(...)getNumXTiles(...)getNumYTiles(...)getSamples(...)compress(...)int sourceXOffsetint sourceYOffsetint sourceWidthint sourceHeightint destWidthint destHeightint initCodeSizeLZWCompressor compressornew LZWCompressor(...)boolean isOptimizedCaseint numRowsWrittenint progressReportRowPeriodByteComponentRaster tilegetDataOffset(...)writeRowsOpt(...)writeRows(...)Raster tilewriteBytes(...)GIFWritableStreamMetadata smsetFromTree(...)sm.versionsm.logicalScreenWidthsm.logicalScreenHeightsm.colorResolutionsm.pixelAspectRatiosm.backgroundColorIndexsm.sortFlagsm.globalColorTableim.disposalMethodim.userInputFlagim.transparentColorFlagim.delayTimeim.transparentColorIndexim.hasPlainTextExtensionim.textGridLeftim.textGridTopim.textGridWidthim.textGridHeightim.characterCellWidthim.characterCellHeightim.textForegroundColorim.textBackgroundColorwriteBlocks(...)im.textim.applicationIDsIterator<> iterIDsIterator<> iterCodesim.authenticationCodesIterator<> iterDataim.applicationDataim.commentsthis.canWriteCompressedthis.canWriteProgressivethis.compressionTypesthis.compressionTypesetCompressionMode(...)// Get source region and subsampling factors// Clip to actual image bounds// Adjust for subsampling offsets// Get subsampling factors// Compute output dimensions/** The GIF image format assumes that size of image palette ... *//** fill tail of color component arrays by replica of first color ... */// create gray-scaled color table for single-banded images// We do not have enough information here// to create well-fit color table for RGB image.// Save interlace flag state.// Undo change to interlace flag if not MODE_COPY_FROM_METADATA.// Image dimensions// Interlacing// Transparency// Save the possibly converted stream metadata as an instance variable.// Check for ability to encode image.// Determine source region and destination dimensions.// Convert any provided image metadata.// Converted rgb image can use palette different from global.// In order to avoid color artefacts we want to be sure we use// appropriate palette. For this we initialize local color table// from current color and sample models.// At this point we can guarantee that local color table can be// build because image was already converted to indexed or// gray-scale representations// in case of indexed image we should take care of// transparent pixels/* NB: transparentColorFlag might have not beed reset for ... */// Global color table values.// Write the header (Signature+Logical Screen Descriptor+// Global Color Table).// Set the version if not set.// Set the Logical Screen Desriptor if not set.// Set the Global Color Table if not set, i.e., if not// provided in the stream metadata.// Writing a sequence and a local color table was// provided in the metadata of the first image: use it.// Create a color table.// Set the Global Color Table. At this point it should be// A) the global color table provided in stream metadata, if any;// B) the local color table of the image metadata, if any, if//    writing a sequence;// C) a table created on the basis of the first image ColorModel//    and SampleModel if no local color table is available; or// D) null if none of the foregoing conditions obtain (which//    should only be if a sequence is not being written and//    a local color table is provided in image metadata).// Write the header.// Write extension blocks, Image Descriptor, and image data.// Write the trailer.// Create default metadata.// Set GraphicControlExtension flag only if there is// transparency.// Check for GraphicControlExtension element.// Should never happen.// Set GraphicControlExtension flag if element present.// If progressive mode is not MODE_COPY_FROM_METADATA, ensure// the interlacing is set per the ImageWriteParam mode setting.// Unset local color table if equal to global color table.// Override dimensions// Write Graphics Control Extension.// Write extension blocks.// Write Image Descriptor// Write image data/* At this moment we know that input image is indexed image. ... */// take into account the raster data offset// Signature// Screen Descriptor// Width// Height// Global Color Table// Packed fields// Background color index// Pixel aspect ratioString writerClassName;ColorModel cmboolean canEncodenew GIFImageWriter(...)/* Copyright (c) 2005, 2010, Oracle and/or its affiliates. All rights reserved. ... *//** Class which adds utility DOM element attribute access methods to ... */int UNDEFINED_INTEGER_VALUE;/** Represents an undefined value of integer attributes. */// Shorthand for throwing an IIOInvalidTreeException// com.sun.imageio.plugins.png.PNGMetadata and modified.// Note: These attribute methods were shamelessly lifted fromnew IIOInvalidTreeException(...)// Get an integer-valued attributeNode attrgetNamedItem(...)getAttributes(...)getNodeValue(...)fatal(...)boolean validValuerange.lengthgetNodeName(...)getStringAttribute(...)// Get a float-valued attributeparseFloat(...)// Get a required integer-valued attributegetIntAttribute(...)// Get a required float-valued attributegetFloatAttribute(...)// Get a boolean-valued attribute// Get a required boolean-valued attributegetBooleanAttribute(...)// Get an enumerated attribute as an index into a String arraylegalNames.length// Get a required enumerated attribute as an index into a String arraygetEnumeratedAttribute(...)// Get a String-valued attribute// Get a required String-valued attributegetAttribute(...)mergeNativeTree(...)mergeStandardTree(...)int maxIndexNode entrygetFirstChild(...)getNextSibling(...)// Allow lower case booleans for backward compatibility, #5082756// TODO - document elimination of globalColorTableFlag...[] versionStrings;int logicalScreenWidth;// 87a or 89aint logicalScreenHeight;int colorResolution;int pixelAspectRatio;// 1 to 8int backgroundColorIndex;// Valid if globalColorTable != null...[] colorTableSizes;...[] globalColorTable;// Set global color table flag in header to 0 if null, 1 otherwisefloat aspectRatioIIOMetadataNode document_node/* NB: At the moment we use empty strings to support undefined ... */// Stored value plus one// NumChannels not in stream// backgroundColorIndex is valid iff there is a color table// NumProgressiveScans not in stream// PlanarConfiguration// SignificantBitsPerSample// SampleMSB// HorizontalPixelOffset not in stream// VerticalPixelOffset not in stream// SubimageInterpretation not in format// ImageCreationTime not in format// ImageModificationTime not in format// Not in streamGIFStreamMetadata.versionStringsnew GIFStreamMetadataFormat(...)// root -> Version// root -> LogicalScreenDescriptor// root -> GlobalColorTable// root -> GlobalColorTable -> ColorTableEntryString NATIVE_FORMAT_NAME;int sizeOfLocalColorTablegetColorTable(...)String disposalMethodNameString textStringfromISO8859(...)IIOMetadataNode applicationExtensionString applicationIDStringString authenticationCodeStringObject applicationExtensionDatagetUserObject(...)Node commentExtensionString commentNode childNodeString childNameint numProgressiveScansisSupported(...)/* Copyright (c) 2005, 2008, Oracle and/or its affiliates. All rights reserved. ... */// XXX The "text" attribute of the PlainTextExtension element// is not defined in the GIF image metadata format but it is// present in the GIFImageMetadata class. Consequently it is// used here but not required and with a default of "". See// bug 5082763.int sizeOfGlobalColorTableint ratioString formatVersionversionStrings.length/* The source for this class was copied verbatim from the source for ... */// XXX J2SE// initialize metadata fields by default valuesimport NamedNodeMap/** An Adobe APP14 (Application-Specific) marker segment. */int flags0;int flags1;int transform;int ID_SIZE;JPEG.APP14this.transformbuffer.bufPtrbuffer.bufbuffer.bufAvailupdateFromNativeNode(...)NamedNodeMap attrsgetAttributeValue(...)/** Writes the data for this segment to the stream in ... */writeTag(...)write2bytes(...)new AdobeMarkerSegment(...)printTag(...)/* Copyright (c) 2001, Oracle and/or its affiliates. All rights reserved. ... */// Skip the id// default transform will be changed// Only the transform is required/** A Comment marker segment.  Retains an array of bytes representing the ... */String ENCODING;/** Constructs a marker segment from the given buffer, which contains ... */loadData(...)/** Constructs a marker segment from a String.  This is used when ... */JPEG.COM/** Constructs a marker segment from a native tree node.  If the node ... */IIOMetadataNode ourNode/** Returns the array encoded as a String, using ISO-Latin-1 encoding. ... *//** Returns an <code>IIOMetadataNode</code> containing the data array ... */getComment(...)// Default encoding// Won't happenimport JPEGHuffmanTable/** A DHT (Define Huffman Table) marker segment. */List<> tables;JPEG.DHTnew Htable(...)JPEGHuffmanTable.StdDCLuminanceJPEGHuffmanTable.StdDCChrominanceJPEGHuffmanTable.StdACLuminanceJPEGHuffmanTable.StdACChrominanceHtable newGuynewGuy.values.lengthnewGuy.valuesdcTables.lengthacTables.lengthNodeList childrengetChildNodes(...)DHTMarkerSegment newGuynewGuy.tablesHtable tablegetNativeNode(...)DHTMarkerSegment$Htable/** A Huffman table within a DHT marker segment. */int tableClass;int tableID;// 0 == DC, 1 == ACint NUM_LENGTHS;// 0 - 4...[] numCodes;// # of codes of each length...[] values;int numValuesgetLengths(...)getValues(...)JPEGHuffmanTable tableCloneNotSupportedException enewGuy.numCodes// We don't write DHT segments; the IJG library does.// won't happen/* System.out.print("Lengths:"); ... */import JPEGQTable/** A DQT (Define Quantization Table) marker segment. */// Could be 1 to 4JPEG.DQTnew Qtable(...)Qtable newGuynewGuy.data.lengthnewGuy.dataqtables.lengthDQTMarkerSegment newGuyQtable table/** Assuming the given table was generated by scaling the "standard" ... */boolean allSameluma.QTABLE_SIZEluma.datanewGuy.tableIDint largestPosfloat scaleFactorgetTable(...)JPEGQTable.K1Div2LuminanceJPEGQTable jpegTablegetScaledInstance(...)JPEGQTable.K2Div2ChrominanceDQTMarkerSegment$Qtable/** A quantization table within a DQT marker segment. */int elementPrecision;int QTABLE_SIZE;...[] zigzag;/** The zigzag-order position of the i'th element ... */// 64 elements, in natural orderJPEGQTable baseJPEG.DEFAULT_QUALITYconvertToLinearQuality(...)JPEGQTable.K1LuminanceJPEGQTable table// We don't write DQT segments; the IJG library does.// Determine if the table is all the same values// if so, use the same table// Otherwise, find the largest coefficient less than 255.  This is// the largest value that we know did not clamp on scaling.// Compute the scale factor by dividing it by the value in the// same position from the "standard" table.// If the given table was not generated by scaling the standard,// the resulting table will still be reasonable, as it will reflect// a comparable scaling of chrominance frequency response of the// eye.//    generate a new table// IJG is compiled for 8-bits, so this shouldn't happen// Read from zig-zag order to natural order/* for (int i = 0; i < 64; i++) { ... *//** A DRI (Define Restart Interval) marker segment. */int restartInterval;/** Restart interval, or 0 if none is specified. */JPEG.DRI// We don't write DRI segments; the IJG library does.import MemoryCacheImageOutputStreamimport Graphics/** A JFIF (JPEG File Interchange Format) APP0 (Application-Specific) ... */int majorVersion;int minorVersion;int resUnits;int Xdensity;int Ydensity;int thumbWidth;int thumbHeight;JFIFThumbRGB thumb;ArrayList<> extSegments;// If presentICCMarkerSegment iccSegment;int THUMB_JPEG;// optional ICCint THUMB_PALETTE;int THUMB_UNASSIGNED;int THUMB_RGB;int DATA_SIZE;int MAX_THUMB_WIDTH;int MAX_THUMB_HEIGHT;boolean inICC;/** Set to <code>true</code> when reading the chunks of an ... */ICCMarkerSegment tempICCSegment;/** A placeholder for an ICC profile marker segment under ... *//** Default constructor.  Used to create a default JFIF header */JPEG.APP0JPEG.DENSITY_UNIT_ASPECT_RATIO/** Constructs a JFIF header by reading from a stream wrapped ... */new JFIFThumbRGB(...)/** Constructs a JFIF header from a DOM Node. *//** Returns a deep-copy clone of this object. */JFIFMarkerSegment newGuynewGuy.extSegmentsJFIFExtensionMarkerSegment jfxxnewGuy.iccSegment/** Add an JFXX extension marker segment from the stream wrapped ... */new JFIFExtensionMarkerSegment(...)/** Adds an ICC Profile APP2 segment from the stream wrapped ... */new ICCMarkerSegment(...)addData(...)/** Add an ICC Profile APP2 segment by constructing it from ... *//** Returns a tree of DOM nodes representing this object and any ... */IIOMetadataNode JFXXnodeJFIFExtensionMarkerSegment seg/** Updates the data in this object from the given DOM Node tree. ... */hasChildNodes(...)NodeList extsint extCountNode extjfxx.thumbBufferedImage retthumbnailStarted(...)getThumbnail(...)thumbnailComplete(...)int thumbWidthint thumbHeightint thumbLengthint[] thumbDatawarningOccurred(...)JPEGImageWriter.WARNING_THUMB_CLIPPEDthumbData.lengthwriteThumbnailData(...)/* Write out the values in the integer array as a sequence of bytes, ... */int progIntervalthumbnailProgress(...)/** Write out this JFIF Marker Segment, including a thumbnail or ... */writeThumb(...)ColorSpace csgetColorSpace(...)jfxx.codewriteJFXXSegment(...)BufferedImage thumbRGBconvertToIntDiscrete(...)setThumbnail(...)ColorSpace.TYPE_RGBJPEGImageWriter.WARNING_NO_RGB_THUMB_AS_INDEXEDexpandGrayThumb(...)JPEGImageWriter.WARNING_NO_GRAY_THUMB_AS_INDEXEDJPEGImageWriter.WARNING_ILLEGAL_THUMBNAILJFIFMarkerSegment$IllegalThumbException// in order to provide more meaningful warnings.// Could put reason codes in here to be parsed in writeJFXXSegment/** Writes out a new JFXX extension segment, without saving it. */IllegalThumbException e/** Return an RGB image that is the expansion of the given grayscale ... */BufferedImage.TYPE_INT_RGBGraphics ggetGraphics(...)drawImage(...)/** Writes out a default JFIF marker segment to the given ... */JFIFMarkerSegment jfifnew JFIFMarkerSegment(...)writeWithThumbs(...)writeICC(...)/** Prints out the contents of this object to System.out for debugging. */JFIFExtensionMarkerSegment extSegmentJFIFMarkerSegment$JFIFExtensionMarkerSegment/** A JFIF extension APP0 marker segment. */int code;JFIFThumb thumb;new JFIFThumbJPEG(...)int thumbXint thumbYloadBuf(...)new JFIFThumbPalette(...)int csTypehasAlpha(...)new IllegalThumbException(...)JFIFExtensionMarkerSegment newGuynewGuy.thumbJFIFMarkerSegment$JFIFThumb/** A superclass for the varieties of thumbnails that can ... */long streamPos;// Save the thumbnail pos when reading// When writingJFIFMarkerSegment$JFIFThumbUncompressedBufferedImage thumbnail;skipData(...)float percentDoneJFIFMarkerSegment$JFIFThumbRGB/** A JFIF thumbnail stored as RGB, one byte per channel, ... */DataBufferByte buffernew DataBufferByte(...)createInterleavedRaster(...)JPEG.JCS.sRGBColorModel.OPAQUEJPEG.JCSreadByteBuffer(...)JFIFMarkerSegment$JFIFThumbPalette/** A JFIF thumbnail stored as an indexed palette image ... */int PALETTE_SIZE;byte[] palettefloat palettePartIndexColorModel cmJFIFMarkerSegment$JFIFThumbJPEG/** A JFIF thumbnail stored as a JPEG stream.  No JFIF or ... */JPEGMetadata thumbMetadata;int PREAMBLE_SIZE;// Compressed image data, for writinglong finalPosbuffer.iisnew JPEGMetadata(...)setFromMarkerSequenceNode(...)int INITIAL_BUFSIZEint MAZ_BUFSIZEMemoryCacheImageOutputStream mosnew MemoryCacheImageOutputStream(...)JPEGImageWriter thumbWriternew JPEGImageWriter(...)JPEGMetadata metadataMarkerSegment jfiffindMarkerSegment(...)JFIFMarkerSegment.classmetadata.markerSequencenew IIOImage(...)dispose(...)int retvalSOFMarkerSegment sofSOFMarkerSegment.classsof.samplesPerLinesof.numLinesJFIFMarkerSegment$JFIFThumbJPEG$ThumbnailReadListenerJPEGImageReader reader;this.readerJPEGImageReader thumbReadernew JPEGImageReader(...)new ThumbnailReadListener(...)JFIFThumbJPEG newGuynewGuy.thumbMetadata/** Write out the given profile to the stream, embedded in ... */int LENGTH_LENGTHString IDint ID_LENGTHint COUNTS_LENGTHint MAX_ICC_CHUNK_SIZEint numChunksint chunkNumint dataLengthint segLengthJPEG.APP2JFIFMarkerSegment$ICCMarkerSegment/** An APP2 marker segment containing an ICC profile.  In the stream ... */ArrayList<> chunks;...[] profile;// May remain null when writing// The complete profile when it's fully readint chunksRead;int numChunks;byte[] profileDataICC_Profile profICCMarkerSegment newGuynewGuy.profileint dataLenint newNumChunksboolean retvalboolean foundItint chunkbyte[] chunkDatachunkData.length/** No-op.  Profiles are never written from metadata. ... */// skip the id, we already checked it// Clone the list with a deep copy// Just one chunk// none of the attributes are required// No thumbnail// Clip if necessary and get the data in thumbData// approx. every 5%// All others write as separate JFXX segments// Just the header without any thumbnail// No thumbnails// We never write a palette image into the header// So if it's the only one, we need to write the header first// Expand to RGB// Handles clipping if needed// As part of the header// If this is the only one, write the header first// following constructors handle bufAvail// Now the child// Should never happen// Save the stream position for reading the thumbnail later// Now skip the thumbnail data// not used when writing// width and height// read the palette// Write the palette (must be 768 bytes)// Compute the final stream position// Set the stream back to the start of the thumbnail// and read its metadata (but don't decode the image)// Set the stream to the computed final position// Clear the now invalid buffer// get default metadata for the thumb// Remove the jfif segment, which should be there./* Use this if removing leaves a hole and causes trouble ... */// Now check that the size is OK// spec says it's null-terminated// Null-terminate the string// gets whole segment or fills the buffer/* Reduce the stored length by the id size.  The stored ... */// get the chunk number// get the total number of chunks// if there are no more chunks, set up the data// reduce the stored length by the two chunk numbering bytes// If we store them away, include the chunk numbering bytes// Now reduce the stored length by the// two chunk numbering bytes// May be null// skip the tag// Get the length, but not in length// Don't include length itself// skip the id// get the number of chunks, which should match// create an array for the whole thing// copy the existing chunks, releasing them// Note that they may be out of order// Right one// No-op/** A class containing JPEG-related constants, definitions, and ... */new int[][]int TEM;/** For temporary use in arithmetic coding */// List of all the JPEG markers (pre-JPEG2000)int SOF0;/** Baseline DCT */// SOF markers for Nondifferential Huffman coding// Codes 0x02 - 0xBF are reservedint SOF1;/** Extended Sequential DCT */int SOF2;/** Progressive DCT */int SOF3;/** Lossless Sequential */int DHT;/** Define Huffman Tables */int SOF5;/** Differential Sequential DCT */// SOF markers for Differential Huffman codingint SOF6;/** Differential Progressive DCT */int SOF7;/** Differential Lossless */int JPG;/** Reserved for JPEG extensions */int SOF9;/** Extended Sequential DCT, Arithmetic coding */// SOF markers for Nondifferential arithmetic codingint SOF10;/** Progressive DCT, Arithmetic coding */int SOF11;/** Lossless Sequential, Arithmetic coding */int DAC;/** Define Arithmetic conditioning tables */int SOF13;/** Differential Sequential DCT, Arithmetic coding */// SOF markers for Differential arithmetic codingint SOF14;/** Differential Progressive DCT, Arithmetic coding */int SOF15;/** Differential Lossless, Arithmetic coding */int RST0;// Restart Markersint RST1;int RST2;int RST3;int RST4;int RST5;int RST6;int RST7;int RESTART_RANGE;/** Number of restart markers */int SOI;/** Start of Image */int EOI;/** End of Image */int SOS;/** Start of Scan */int DQT;/** Define Quantisation Tables */int DNL;/** Define Number of lines */int DRI;/** Define Restart Interval */int DHP;/** Define Heirarchical progression */int EXP;/** Expand reference image(s) */int APP0;/** APP0 used by JFIF */// Application markersint APP1;int APP2;int APP3;int APP4;int APP5;int APP6;int APP7;int APP8;int APP9;int APP10;int APP11;int APP12;int APP13;int APP14;/** APP14 used by Adobe */int APP15;int COM;/** Comment marker */// codes 0xF0 to 0xFD are reserved// JFIF Resolution unitsint ADOBE_IMPOSSIBLE;// Adobe transform valuesint ADOBE_UNKNOWN;int ADOBE_YCC;int ADOBE_YCCK;String vendor;// Spi initialization stuff// Names of the formats we can read or writeString nativeImageMetadataFormatName;String nativeImageMetadataFormatClassName;String nativeStreamMetadataFormatName;String nativeStreamMetadataFormatClassName;int JCS_UNKNOWN;// IJG Color codes.int JCS_GRAYSCALE;// error/unspecifiedint JCS_RGB;// monochromeint JCS_YCbCr;// red/green/blueint JCS_CMYK;// Y/Cb/Cr (also known as YUV)int JCS_YCC;// C/M/Y/Kint JCS_RGBA;// PhotoYCCint JCS_YCbCrA;// RGB-Alphaint JCS_YCCA;// on reading anyway.  Support for writing them is being dropped, too.// 8 and 9 were old "Legacy" codes which the old code never identified// Y/Cb/Cr/Alphaint JCS_YCCK;// PhotoYCC-Alphaint NUM_JCS_CODES;// Y/Cb/Cr/K...[] bandOffsets;/** IJG can handle up to 4-channel JPEGs */...[] bOffsRGB;JPEG$JCS/* These are kept in the inner class to avoid static initialization ... */ColorSpace sRGB;ColorSpace YCC;boolean yccInited;ColorSpace.CS_PYCCfloat DEFAULT_QUALITY;// Default value for ImageWriteParam/** Returns <code>true</code> if the given <code>ColorSpace</code> ... */isCS_sRGB(...)ColorSpace.CS_CIEXYZColorSpace.CS_LINEAR_RGB/** Returns <code>true</code> if the given imageType can be used ... */int numComponentsColorSpace.TYPE_YCbCr/** Given an image type, return the Adobe transform corresponding to ... */ColorSpace.TYPE_CMYK/** Converts an ImageWriteParam (i.e. IJG) non-linear quality value ... *//** Return an array of default, visually lossless quantization tables. */JPEGQTable[] qTablesnew JPEGQTable[]/** Return an array of default Huffman tables. */JPEGHuffmanTable[] tablesnew JPEGHuffmanTable[]// PYCC.pf may not always be installed// Can't have alpha// Gray is OK, always// If it isn't gray, it must have 3 channels// Must be RGB// Must be YCbCr// The following is converted from the IJG code./** A class wrapping a buffer and its state.  For efficiency, ... */int BUFFER_SIZE;/** The size of the buffer.  This is large enough to hold all ... */...[] buf;/** The actual buffer. */int bufAvail;/** The number of bytes available for reading from the buffer. ... */int bufPtr;/** A pointer to the next available byte in the buffer.  This is ... *//** The ImageInputStream buffered. */this.iis/** Ensures that there are at least <code>count</code> bytes available ... */int ret/** Fills the data array from the stream, starting with ... *//** Skips <code>count</code> bytes, leaving the buffer ... *//** Push back the remaining contents of the buffer by ... *//** Return the stream position corresponding to the next ... *//** Scan the buffer until the next 0xff byte, reloading ... */boolean foundFFJPEG.EOI/** Prints the contents of the buffer, in hex. ... */int ptr// have enough// already full// First copy any remaining bytes down to the beginning// Now fill the rest of the buffer// First see what's left in the buffer.// It's enough// Some there, but not enough// Now read the rest directly from the stream// out of inner while// Reload the buffer and keep going// Skip any remaining pad bytes// Only if it still is 0xff// Premature EOF// send out a warning, but treat it as EOI//reader.warningOccurred(JPEGImageReader.WARNING_NO_EOI);JPEGImageMetadataFormat theInstance;List<> resUnitsList<> codesList<> transformsList<> procsList<> compsList<> tabidsJPEG.nativeImageMetadataFormatNameaddStreamElements(...)addChildElement(...)ICC_Profile.classisInSubtree(...)getRootName(...)isJFIFcompliant(...)new JPEGImageMetadataFormat(...)// Hex 10// Hex 11// Hex 13// All images can have these// If it is an element in the app0jfif subtree, just check// that the image type is JFIF compliant....[] imageContents;Object[][] combinedContentscommonContents.lengthimageContents.lengthint combined// return a copy of the combined commonContents and imageContents;// in theory we want a deep clone of the combined arrays,// but since it only contains (immutable) Strings, this shallow// copy is sufficientimport JPEGImageReadParamimport CMMExceptionimport ColorConvertOpimport Disposerimport DisposerRecordnew CallBackLock(...)JPEGImageReader$1loadLibrary(...)initReaderIDs(...)JPEGQTable.classJPEGHuffmanTable.classlong structPointer;/** The following variable contains a pointer to the IJG library ... *//** The input stream we read from */List<> imagePositions;/** List of stream positions for images, reinitialized every time ... *//** The number of images in the stream, or 0. */int WARNING_NO_EOI;/** Warning code to be passed to warningOccurred to indicate ... */// and its children.// as keys to get localized resources from JPEGImageReaderResources// The following warnings are converted to strings when usedint WARNING_NO_JFIF_IN_THUMB;int WARNING_IGNORE_INVALID_ICC;int MAX_WARNING;int currentImage;/** Image index of image for which header information ... *//** Set by setImageData native code callback */// if we are to read an image at all.// Unlike metadata, which may never be retrieved, we need this// The following is copied out from C after reading the header.int colorSpaceCode;/** Set by setImageData native code callback.  A modified ... */int outColorSpaceCode;int numComponents;ColorSpace iccCS;ColorConvertOp convert;/** If we need to post-convert in Java, convert with this op */BufferedImage image;/** The image we are going to fill */WritableRaster raster;/** An intermediate Raster to hold decoded data */WritableRaster target;/** A view of our target Raster that we can setRect to */DataBufferByte buffer;/** The databuffer for the above Raster */Rectangle destROI;/** The region in the destination where we will write pixels */...[] destinationBands;/** The list of destination bands, if any */JPEGMetadata streamMetadata;/** Stream metadata, cached, even when the stream is changed. */JPEGMetadata imageMetadata;/** Image metadata, valid for the imageMetadataIndex only. */int imageMetadataIndex;boolean haveSeeked;/** Set to true every time we seek in the stream; used to ... */...[] abbrevQTables;/** Tables that have been read from a tables-only image at the ... */...[] abbrevDCHuffmanTables;...[] abbrevACHuffmanTables;int minProgressivePass;int maxProgressivePass;int UNKNOWN;/** Variables used by progress monitoring. */int MIN_ESTIMATED_PASSES;// Number of passesint knownPassCount;// IJG defaultint pass;float percentToDate;float previousPassPercentage;int progInterval;boolean tablesOnlyChecked;/** Set to true once stream has been checked for stream metadata */Object disposerReferent;/** The referent to be registered with the Disposer. */DisposerRecord disposerRecord;/** The DisposerRecord that handles the actual disposal of this reader. *//** Sets up static C structures. */initJPEGImageReader(...)new JPEGReaderDisposerRecord(...)addRecord(...)/** Sets up per-reader C structure and returns a pointer to it. *//** Called by the native code or other classes to signal a warning. ... *//** The library has it's own error facility that emits warning messages. ... */setThreadLock(...)this.ignoreMetadataresetInternalState(...)setSource(...)clearThreadLock(...)/** This method is called from native code in order to fill ... *//** This method is called from the native code in order to ... */long savePosboolean tablesOnlyreadNativeHeader(...)long poshasNextImage(...)Long posgetNumImagesOnThread(...)gotoImage(...)JPEGBuffer buffernew JPEGBuffer(...)checkTablesOnly(...)scanForFF(...)JPEG.SOIJPEG.RST0JPEG.RST1JPEG.RST2JPEG.RST3JPEG.RST4JPEG.RST5JPEG.RST6JPEG.RST7/** Sets the input stream to the start of the requested image. ... *//** Skip over a complete image in the stream, leaving the stream ... */int byteval/** Returns <code>true</code> if there is an image beyond ... *//** Push back the given number of bytes to the input stream. ... *//** Reads header information for the given image, if possible. */readImageHeader(...)/** Read in the header information starting from the current ... *//* Called by the native code whenever an image header has been ... */ICC_Profile newProfileICC_Profile oldProfilethis.colorSpaceCodethis.outColorSpaceCodethis.numComponentsfloat[] colorsfromRGB(...)CMMException e/** Return an ImageTypeSpecifier corresponding to the given ... *//////////// Color Conversion and Image TypesImageTypeProducer retJPEG.NUM_JCS_CODESgetTypeProducer(...)getImageType(...)getImageTypesOnThread(...)ImageTypeProducer rawArrayList<ImageTypeProducer> listnew ArrayList<ImageTypeProducer>(...)JPEG.JCS_GRAYSCALEJPEG.JCS_RGBJPEG.JCS_YCCJPEG.JCS_RGBAJPEG.JCS_YCCAJPEG.JCS_YCbCrnew ImageTypeProducer(...) { ... }JPEGImageReader$2createInterleaved(...)JPEG.bOffsRGBJPEG.JCS_YCbCrAnew ImageTypeIterator(...)/** Checks the implied color conversion between the stream and ... */setOutColorSpace(...)new ColorConvertOp(...)ColorSpace YCCgetYCC(...)/** Set the IJG output space to the given value.  The library will ... *//////// End of Color Conversion & Image Typesnew JPEGImageReadParam(...)readInternal(...)resetLibraryState(...)WritableRaster imRasint numImageBandsint[] srcBandsJPEG.bandOffsetsint numRasterBandsRectangle srcROIint lineSizedestROI.widthint[] bandOffsint[] bandSizesboolean callbackUpdatesboolean abortedcheckColorConversion(...)checkReadParamBandSettings(...)int[] sBandssrcBands.lengthJPEGImageReadParam jparamareTablesSet(...)getQTables(...)getDCHuffmanTables(...)getACHuffmanTables(...)destROI.heightbandSizes.lengthinitProgressData(...)imageMetadata.markerSequencedestinationBands.lengthreadImage(...)srcROI.xsrcROI.ysrcROI.widthsrcROI.height/** This method is called back from C when the intermediate Raster ... */filter(...)setRect(...)destROI.xdestROI.yint heightfloat percentOfPassint remainingPassesint totalPassesthis.passprocessThumbnailStarted(...)// Provide access to protected superclass methodprocessThumbnailProgress(...)processThumbnailComplete(...)/** Returns <code>true</code> if the read was aborted. */abort(...)abortRead(...)/** Set the C level abort flag. Keep it atomic for thread safety. *//** Resets library state when an exception occurred during a read. */Raster retvalPoint saveDestOffsetcreateWritableTranslatedChild(...)saveDestOffset.xsaveDestOffset.ygetImageMetadata(...)jfif.thumbjfif.extSegmentsgetNumThumbnails(...)getThumbnailWidth(...)getThumbnailHeight(...)resetReader(...)JPEGImageReader$JPEGReaderDisposerRecordlong pData;this.pDatadisposeReader(...)Thread theThread;int theLockCount;Thread currThreadCallBackLock cbLock;JPEGImageReader$CallBackLockState lockState;State.UnlockedState.LockedJPEGImageReader$CallBackLock$Statenew State(...)State Unlocked;State Locked;/** An internal helper class that wraps producer's iterator ... */Iterator<ImageTypeProducer> producers;ImageTypeSpecifier theNext;this.producersImageTypeSpecifier t/** An internal helper class that provides means for deferred creation ... */new ImageTypeProducer[]ImageTypeSpecifier type;boolean failed;int csCode;this.csCodeproduce(...)...[] defaultTypes;new ImageTypeProducer(...)createFromBufferedImageType(...)BufferedImage.TYPE_BYTE_GRAYcreatePacked(...)/* Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. ... */// Read the first header// This reads the tables-only image twice, once from C// and once from Java, but only if ignoreMetadata is false// Now we are at the first image if there are any, so add it// to the list// Not tables only, so add original pos to the list// And set current image since we've read it now// If the image positions list is empty as in the case of a tables-only// stream, then attempting to access the element at index// imagePositions.size() - 1 will cause an IndexOutOfBoundsException.// locked thread// Otherwise we have to read the entire stream// FALL THROUGH to decrement buffer vars// This first set doesn't have a length// not a marker, just a data 0xff// All the others have a length// length includes itself// Search is necessary for JPEG// stream, then no image data can be read.// read to start of image, saving positions// First seek to the last position we already have, and skip the// entire image// Now add all intervening positions, skipping images// Is there an image?// Otherwise we are where we want to be// No way is native buffer still valid// We hit the end of the stream before we hit an SOI, so no image// The buffer is clear after this, so no need to set haveSeeked.// Ignore return/* Color profile data seems to be invalid. ... *//* At the moment we can't rely on the ColorSpace.equals() ... */// verify new color space/* Embedded profile seems to be corrupted. ... */// Returns null if it can't be represented// We return an iterator containing the default, any// conversions that the library provides, and// all the other default types with the same number// of components, as we can do these as a post-process.// As we convert Rasters rather than images, images// with alpha cannot be converted in a post-process.// If this image can't be interpreted, this method// returns an empty Iterator.// Get the raw ITS, if there is one.  Note that this// won't always be the same as the default.// Given the encoded colorspace, build a list of ITS's// representing outputs you could handle starting// with the default.// Might be null if PYCC.pf not installed// As there is no YCbCr ColorSpace, we can't support// the raw type.// due to 4705399, use RGB as default in order to avoid// slowing down of drawing operations with result image.// Assume it's for RGB// Default is to convert to RGBA// If we are rearranging channels at all, the default// conversions remain in place.  If the user wants// raw channels then he should do this while reading// a Raster.// Accept default conversions out of decoder, silently// XXX - We do not currently support any indexed color models,// though we could, as IJG will quantize for us.// This is a performance and memory-use issue, as// users can read RGB and then convert to indexed in Java.// Now check the ColorSpace type against outColorSpaceCode// We may want to tweak the default// Its gray in the file// We want RGB// IJG can do this for us more efficiently// Update java state according to changes// in the native part of decoder.// IJG wants to go to RGB// We want gray// If the jpeg space is YCbCr, IJG can do it// We have an ICC profile but it isn't used in the dest// image.  So convert from the profile cs to the target cs// Leave IJG conversion in place; we still need it// Target isn't sRGB, so convert from sRGB to the target// No conversions available; image must be RGBA// We can't do YCC at all// No conversions available; image must be YCCA// Anything else we can't handle at all// imageMetadataIndex will always be either a valid index or// -1, in which case imageMetadata will not be null.// So we can leave checking imageIndex for gotoImage.// don't keep a reference here// Can we read this image?// The destination may still be incompatible.// Check whether we can handle any implied color conversion// Throws IIOException if the stream and the image are// incompatible, and sets convert if a java conversion// is necessary// Check the source and destination bands in the param// Set the output color space equal to the input colorspace// This disables all conversions// Create an intermediate 1-line Raster that will hold the decoded,// subsampled, clipped, band-selected image data in a single// byte-interleaved buffer.  The above transformations// will occur in C for performance.  Every time this Raster// is filled we will call back to acceptPixels below to copy// this to whatever kind of buffer our image has.// ignore dest bands for Raster// Now that we have the Raster we'll decode to, get a view of the// target Raster that will permit a simple setRect for each scanline/* If the process is sequential, and we have restart markers, ... */// Check for update listeners (don't call back if none)// Set up progression data// if we have a metadata object, we can count the scans// and set knownPassCount// We have metadata// Finally, we are ready to read// Note that getData disables acceleration on buffer, but it is// just a 1-line intermediate data transfer buffer that will not// affect the acceleration of the resulting image.// Use the range of allowed progressive passes// Assume there are a minimum of MIN_ESTIMATED_PASSES// and that there is always one more pass// Compute the percentage as the percentage at the end// of the previous pass, plus the percentage of this// pass scaled to be the percentage of the total remaining,// assuming a minimum of MIN_ESTIMATED_PASSES passes and// that there is always one more pass.  This is monotonic// and asymptotic to 1.0, which is what we need.// including this one/** NB: we do not check the call back lock here, ... *//* This could be further optimized by not resetting the dest. ... */// For Rasters, destination offset is logical, not physical, so// set it to 0 before calling computeRegions, so that the destination// region is not clipped.// Apply the destination offset, if any, as a logical offset// checks iis state for us// Now check the jfif segments// Now we know that there is a jfif segment// Now we know that there is a jfif segment and that iis is good// reset C structures// reset local Java structures// it looks like that this reader instance is used// by multiple threads.// undefinedJPEGImageReader.WARNING_NO_EOIJPEGImageReader.WARNING_NO_JFIF_IN_THUMBJPEGImageReader.WARNING_IGNORE_INVALID_ICCJPEG.vendorJPEG.versionJPEG.namesJPEG.suffixesJPEG.MIMETypesJPEG.nativeStreamMetadataFormatNameJPEG.nativeStreamMetadataFormatClassNameJPEG.nativeImageMetadataFormatClassNameImageInputStream iisint byte1int byte2// If the first two bytes are a JPEG SOI marker, it's probably// a JPEG file.  If they aren't, it definitely isn't a JPEG file.import JPEGImageWriteParamJPEG.ADOBE_IMPOSSIBLEJPEGImageWriter$1initWriterIDs(...)new Dimension[]///////// Private variablesImageOutputStream ios;/** The output stream we write to */Raster srcRas;/** The Raster we will write from *//** An intermediate Raster holding compressor-friendly data */boolean indexed;/** Set to true if we are writing an image with an ... */IndexColorModel indexCM;boolean convertTosRGB;WritableRaster converted;// Used by PhotoYCC onlyboolean isAlphaPremultiplied;ColorModel srcCM;List<> thumbnails;/** If there are thumbnails to be written, this is the list. */ICC_Profile iccProfile;/** If metadata should include an icc profile, store it here. */int sourceXOffset;int sourceYOffset;int sourceWidth;...[] srcBands;int sourceHeight;/** Used when calling listeners */ColorConvertOp convertOp;...[] streamQTables;...[] streamDCHuffmanTables;...[] streamACHuffmanTables;boolean ignoreJFIF;// Parameters for writing metadataboolean forceJFIF;// If it's there, use itboolean ignoreAdobe;// Add one for the thumbnailsint newAdobeTransform;boolean writeDefaultJFIF;// Change if neededboolean writeAdobe;JPEGMetadata metadata;boolean sequencePrepared;int numScans;/** The DisposerRecord that handles the actual disposal of this writer. */int WARNING_DEST_IGNORED;///////// Protected variables///////// End of Private variablesint WARNING_STREAM_METADATA_IGNORED;int WARNING_DEST_METADATA_COMP_MISMATCH;int WARNING_DEST_METADATA_JFIF_MISMATCH;int WARNING_DEST_METADATA_ADOBE_MISMATCH;int WARNING_IMAGE_METADATA_JFIF_MISMATCH;int WARNING_IMAGE_METADATA_ADOBE_MISMATCH;int WARNING_METADATA_NOT_JPEG_FOR_RASTER;int WARNING_NO_BANDS_ON_INDEXED;int WARNING_ILLEGAL_THUMBNAIL;int WARNING_IGNORING_THUMBS;int WARNING_FORCING_JFIF;int WARNING_THUMB_CLIPPED;int WARNING_METADATA_ADJUSTED_FOR_THUMB;int WARNING_NO_RGB_THUMB_AS_INDEXED;int WARNING_NO_GRAY_THUMB_AS_INDEXED;//////// Public APIinitJPEGImageWriter(...)new JPEGWriterDisposerRecord(...)setDest(...)new JPEGImageWriteParam(...)JPEGMetadata jpegDatajpegData.isStreamconvertImageMetadataOnThread(...)Node treejfifOK(...)...[] preferredThumbSizes;convertImageMetadata(...)writeOnThread(...)boolean rasterOnlyRenderedImage rimageint numSrcBandsint numBandsUsedboolean usingBandSubsetboolean fullImageImageTypeSpecifier destTypeint imageWidthint imageHeightJPEGHuffmanTable[] DCHuffmanTablesJPEGHuffmanTable[] ACHuffmanTablesboolean optimizeHuffmanJPEGImageWriteParam jparamint progressiveModeIIOMetadata mdataint inCsTypeJPEG.JCS_UNKNOWNint outCsTypeAdobeMarkerSegment adobeboolean metadataProgressiveint[] scansint numThumbsboolean haveMetadataboolean writeDQTboolean writeDHTDQTMarkerSegment dqtDHTMarkerSegment dhtint restartIntervalint[] componentIdsint[] HsamplingFactorsint[] VsamplingFactorsint[] QtableSelectorsgetMinTileX(...)getMinTileY(...)createChild(...)isAlphaPremultiplied(...)int[] tempint[] tempSizegetDestinationType(...)Rectangle imageBoundsfloat qualitygetCompressionQuality(...)JPEGQTable.K2ChrominancegetOptimizeHuffmanTables(...)AdobeMarkerSegment.classcheckSOFBands(...)checkJFIF(...)isNonStandardICC(...)checkAdobe(...)int transformtransformForType(...)getSrcCSType(...)getDefaultDestCSType(...)ImageTypeSpecifier inputTypeboolean alphaadobe.transformJPEG.ADOBE_UNKNOWNjfif.iccSegmentJPEG.ADOBE_YCCint outCSgetIDencodedCSType(...)boolean subsampledisSubsampled(...)sof.componentSpecsColorSpace.TYPE_3CLRsof.tagJPEG.SOF2collectScans(...)getThumbnails(...)DRIMarkerSegment driDRIMarkerSegment.classDQTMarkerSegment.classDHTMarkerSegment.classdri.restartIntervalcollectQTablesFromMetadata(...)getDefaultQTables(...)collectHTablesFromMetadata(...)getDefaultHuffmanTables(...)...[...].componentId...[...].HsamplingFactor...[...].VsamplingFactor...[...].QtableSelectorprepareWriteSequenceOnThread(...)JPEGMetadata jmetajmeta.isStreamstreamQTables.lengthwriteTables(...)abortWrite(...)resetWriter(...)///////// Package-access API////////// End of public API///////// Metadata handling///////// Private methods///////// End of Package-access APIsof.componentSpecs.lengthint rightTransform/** Collect all the scan info from the given metadata, and ... */List<> segmentsint SCAN_SIZEint MAX_COMPS_PER_SCANint[] retvalMarkerSegment segSOSMarkerSegment sossos.componentSpecs.lengthsos.componentSpecsint compSel...[...].componentSelectorsos.startSpectralSelectionsos.endSpectralSelectionsos.approxHighsos.approxLow/** Finds all DQT marker segments and returns all the q ... */ArrayList<> tablesJPEGQTable[] retvaldqt.tablesretval.length(...).dataDQTMarkerSegment.Qtable/** Finds all DHT marker segments and returns all the q ... */JPEGHuffmanTable[] retvaldht.tablesDHTMarkerSegment.HtableHtable htablehtable.tableClassHtable[] htablesnew Htable[]...[...].tableID...[...].numCodes...[...].values////////////// ColorSpace conversion/////////// End of metadata handlingJPEG.JCS_CMYKJPEG.JCS_YCCKSOFMarkerSegment.ComponentSpecint hsamp0int vsamp0specs.length/** Sets up static native structures. */////////////// Native methods and callbacks////////////// End of ColorSpace conversion/** Sets up per-writer native structure and returns a pointer to it. *//** Sets up native structures for output stream *//** Returns <code>true</code> if the write was aborted. *//** Writes the metadata out when called by the native code, ... */writeDefaultJFIF(...)writeAdobeSegment(...)writeToStream(...)/** Write out a tables-only image to the stream. *//** Put the scanline y of the source ROI view Raster into the ... */Raster sourceLineboolean forceARGBBufferedImage tempcreateCompatibleWritableRaster(...)setPixels(...)coerceData(...)/** Aborts the current write in the native code *//** Resets native structures *//** Releases native structures */JPEGImageWriter$JPEGWriterDisposerRecorddisposeWriter(...)/** This method is called from native code in order to write encoder ... */JPEGImageWriter$CallBackLockJPEGImageWriter$CallBackLock$State/* Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved. ... *////////// End of Protected variables///////// static initializer// so this will always work// Set the native destination// There isn't much we can do.  If it's one of ours, then// return it.  Otherwise just return null.  We use it only// for tables, so we can't get a default and modify it,// as this will usually not be what is intended.// If it's one of ours, just return it// Can't convert stream metadata to image metadata// XXX Maybe this should put out a warning?// If it's not one of ours, create a default and set it from// the standard tree from the input, if it exists.// Other plug-in generates bogus standard tree// If the image type and metadata are JFIF compatible, return true// metadata must have a jfif node// if streamMetadata is not null, issue a warning// Obtain the raster and image, if there is one// Use the Raster directly.// Get the unique tile.// Ensure the Raster has dimensions of the image,// as the tile dimensions might differ.// Image is tiled so get a contiguous raster by copying.// Now determine if we are using a band subset// By default, we are using all source bands// Consult the param to determine if we're writing a subset// If this is a subset, we must adjust bandSizes// All the same// 4450894 part 1: The IJG libraries are compiled so they only// handle <= 8-bit samples.  We now check the band sizes and throw// an exception for images, such as USHORT_GRAY, with > 8 bits// per sample.// 4450894 part 2: We expand IndexColorModel images to full 24-// or 32-bit in grabPixels() for each scanline.  For indexed// images such as BYTE_BINARY, we need to ensure that we update// bandSizes to account for the scaling from 1-bit band sizes// to 8-bit.// Destination type, if there is one// Ignore dest type if we are writing a complete image// Examine the param// We'll handle the metadata case later// Now examine the metadata// First set a default state// By default we'll do no conversion:// By default don't write one// PhotoYCC does this// Check the metadata against the destination type// Do we want to write an ICC profile?// no metadata, but there is a dest type// If we can add a JFIF or an Adobe marker segment, do so// re-create the metadata// no destination type// no dest, no metadata, full image// Use default metadata matching the image and param// else no dest, no metadata, not an image,// so no special headers, no color conversion// no dest type, but there is metadata// no dest, metadata, image// Check that the metadata and the image match// out colorspace remains unknown// consult the ids// if they don't resolve it,// consult the sampling factors// RGBA// PhotoYCCA// else no dest, metadata, not an image.  Defaults ok// Might still be null// determine if thumbnails can be written// If we are going to add a default JFIF marker segment,// then thumbnails can be written// If there is no metadata, then we can't write thumbnails// There is metadata// If we are writing a raster or subbands,// then the user must specify JFIF on the metadata// Or we can't include thumbnails// It is a full image, and there is metadata// Not JFIF// Can it have JFIF?// Nope, not JFIF-compatible// Set up a boolean to indicate whether we need to call back to// write metadata// Now that we have dealt with metadata, finalize our tables set up// Are we going to write tables?  By default, yes.// But if the metadata has no tables, no.// Ignored if optimizeHuffman is true// Whether we write tables or not, we need to figure out which ones// to use// Get them from metadata, or use defaults// If we are optimizing, we don't want any tables.// If they were for progressive scans, we can't use them.// By default, ids are 1 - N, no subsampling// JFIF compatible// Now override them with the contents of sof, if there is one,// else use JFIF-compatible default// Create an appropriate 1-line databuffer for writing// Create a raster from that// Call the writer, who will call back for every scanline// just a 1-line intermediate data transfer buffer that does not// affect the acceleration of the source image.// After a successful write/* from jpeg_metadata.html: ... */// write a complete tables-only image at the beginning of// Check that we are// at the beginning of the stream, or can go there, and haven't// written out the metadata already.// Set the tables// If the metadata has no tables, use default tables.// Now write them out// In the case of JPEG this does nothing different from write/** NB: we do not check the call back lock here, we allow to abort ... */// reset the native destination// Does the metadata frame header, if any, match numBandsUsed?// type overrides metadata// num comps// out of for over sof comps// If the image has BITMASK transparency, we need to make sure// it gets converted to 32-bit ARGB, because the JPEG encoder// relies upon the full 8-bit alpha channel.// The first time through, converted is null, so// a new raster is allocated.  It is then reused// on subsequent lines.// Every 8 scanlinesJPEGImageWriter.WARNING_DEST_IGNOREDJPEGImageWriter.WARNING_STREAM_METADATA_IGNOREDJPEGImageWriter.WARNING_DEST_METADATA_COMP_MISMATCHJPEGImageWriter.WARNING_DEST_METADATA_JFIF_MISMATCHJPEGImageWriter.WARNING_DEST_METADATA_ADOBE_MISMATCHJPEGImageWriter.WARNING_IMAGE_METADATA_JFIF_MISMATCHJPEGImageWriter.WARNING_IMAGE_METADATA_ADOBE_MISMATCHJPEGImageWriter.WARNING_METADATA_NOT_JPEG_FOR_RASTERJPEGImageWriter.WARNING_NO_BANDS_ON_INDEXEDJPEGImageWriter.WARNING_IGNORING_THUMBSJPEGImageWriter.WARNING_FORCING_JFIFJPEGImageWriter.WARNING_METADATA_ADJUSTED_FOR_THUMBint bitDepth// Find the maximum bit depth across all channels// 4450894: Ensure bitDepth is between 1 and 8/** Metadata for the JPEG plug-in. *///////// Private variablesList<> resetSequence;/** A copy of <code>markerSequence</code>, created the first time the ... */boolean inThumb;/** Set to <code>true</code> when reading a thumbnail stored as ... */boolean hasAlpha;/** Set by the chroma node construction method to signal the ... */List<> markerSequence;/** All data is a list of <code>MarkerSegment</code> objects. ... *//////// Package-access variables//////// end of private variablesboolean isStream;/** Indicates whether this object represents stream or image ... *//** Constructor containing code shared by other constructors. *//////// Constructors/////// End of package-access variablesthis.inThumbthis.isStream/* Constructs a <code>JPEGMetadata</code> object by reading the ... */MarkerSegment newGuyJPEG.SOF0JPEG.SOF1new SOFMarkerSegment(...)new DQTMarkerSegment(...)new DHTMarkerSegment(...)new DRIMarkerSegment(...)JFIFMarkerSegment dummyaddJFXX(...)new MarkerSegment(...)addICC(...)new COMMarkerSegment(...)JPEG.SOSnew SOSMarkerSegment(...)newGuy.unknownpushBack(...)isConsistent(...)/** Constructs a default stream <code>JPEGMetadata</code> object appropriate ... *//** Constructs a default image <code>JPEGMetadata</code> object appropriate ... */boolean wantJFIFboolean wantAdobeboolean willSubsampleboolean wantICCboolean wantProgboolean wantOptimizedboolean wantExtendedboolean wantQTablesboolean wantHTablesbyte[] componentIDsgetDCHuffmanTables(...).lengthgetACHuffmanTables(...).lengthcanWriteCompressed(...)boolean hasExtraComponentsgetNumColorComponents(...)JPEG.ADOBE_YCCK/** Returns the first MarkerSegment object in the list ... */// The first ones have package access for access from the writer.// Utilities for dealing with the marker sequence.////// End of constructorsseg.tag/** Returns the first or last MarkerSegment object in the list ... */hasPrevious(...)previous(...)/** Returns the index of the first or last MarkerSegment in the list ... */seg.unknown// Implement Cloneable, but restrict accessJPEGMetadata newGuynewGuy.markerSequencecloneSequence(...)newGuy.resetSequence/** Returns a deep copy of the current marker sequence. */List<> retval// Tree methodsIIOMetadataNode topIIOMetadataNode sequenceIIOMetadataNode headerIIOMetadataNode chromaIIOMetadataNode csTypeint numChannelsIIOMetadataNode numChanNodeboolean idsAreJFIFint hfactorint vfactorIIOMetadataNode compressionIIOMetadataNode nameIIOMetadataNode losslessint sosCountMarkerSegment msms.tagIIOMetadataNode progIIOMetadataNode dimIIOMetadataNode orientIIOMetadataNode aspectjfif.resUnitsjfif.Ydensityjfif.XdensityinsertBefore(...)float scaleIIOMetadataNode horizIIOMetadataNode vertIIOMetadataNode textCOMMarkerSegment comIIOMetadataNode transIIOMetadataNode alpha// EditingList<> copymergeJFIFsubtree(...)mergeSequenceSubtree(...)getLastChild(...)/** Merge a JFIF subtree into the marker sequence, if the subtree ... */Node jfifNodeJFIFMarkerSegment jfifSegmergeDQTNode(...)mergeDHTNode(...)mergeDRINode(...)mergeCOMNode(...)mergeAdobeNode(...)mergeUnknownNode(...)mergeSOFNode(...)mergeSOSNode(...)/** Merge the given DQT node into the marker sequence.  If there already ... */ArrayList<> oldDQTsint childIDDQTMarkerSegment testDQTtestDQT.tablesQtable testTabletestTable.tableIDgetQtableFromNode(...)int firstDHTfindMarkerSegmentPosition(...)int firstSOFint firstSOSSOSMarkerSegment.class/** Merge the given DHT node into the marker sequence.  If there already ... */ArrayList<> oldDHTsint childClassDHTMarkerSegment testDHTtestDHT.tablesHtable testTabletestTable.tableClassgetHtableFromNode(...)int lastDQT/** Merge the given DRI node into the marker sequence. ... */DRIMarkerSegment newGuy/** Merge the given COM node into the marker sequence. ... */COMMarkerSegment newGuyinsertCOMMarkerSegment(...)/** Insert a new COM marker segment into an appropriate place in the ... */int lastCOMCOMMarkerSegment.classboolean hasJFIFint firstAdobe/** Merge the given Adobe APP14 node into the marker sequence. ... */AdobeMarkerSegment newGuyinsertAdobeMarkerSegment(...)/** Insert the given AdobeMarkerSegment into the marker sequence, as ... */int lastUnknownfindLastUnknownMarkerSegmentPosition(...)/** Merge the given Unknown node into the marker sequence. ... *//** Merge the given SOF node into the marker sequence. ... */SOFMarkerSegment newGuy/** Merge the given SOS node into the marker sequence. ... */SOSMarkerSegment firstSOSSOSMarkerSegment lastSOSboolean transparencyDone;mergeStandardChromaNode(...)mergeStandardCompressionNode(...)mergeStandardDataNode(...)mergeStandardDimensionNode(...)mergeStandardDocumentNode(...)mergeStandardTextNode(...)mergeStandardTransparencyNode(...)/* In general, it could be possible to convert all non-pixel data to some ... */Node csTypeString csNamebyte[] idsboolean wantAlphaboolean updateQtablesboolean updateHtablesboolean progressiveint[] subsampledSelectorsint[] nonSubsampledSelectorsint[] newTableSelectorsComponentSpec[] oldCompSpecsNode transwantAlpha(...)oldCompSpecs.lengthboolean idsDifferSOSMarkerSegment targettarget.componentSpecs.lengthtarget.componentSpecsint oldSelector...[...].dcHuffTable...[...].acHuffTableList<> tableSegmentsDQTMarkerSegment testdqtIterator<> tabitertestdqt.tablesQtable tabtab.tableIDQtable table0getChromaForLuma(...)DHTMarkerSegment testdhttestdht.tablesHtable tabDHTMarkerSegment lastDHTaddHtable(...)boolean returnValueNode alphahasAttributes(...)boolean canHaveJFIFString valueStringPoint pfindIntegerRatio(...)p.xp.yint dpcmround(...)JPEG.DENSITY_UNIT_DOTS_CM/* Return a pair of integers whose ratio (x/y) approximates the given ... */float epsilonboolean invertedfloat deltaNode compboolean copyItString compStringboolean hadAlphaComponentSpec[] newSpecsnew ComponentSpec[]byte oldFirstIDbyte newIDScanComponentSpec[] newScanSpecsnew ScanComponentSpec[]SOSMarkerSegment.ScanComponentSpecgetComponentSpec(...)getScanComponentSpec(...)setFromNativeTree(...)Node markerSequenceNodeNode JPEGvariety/** Check that this metadata object is in a consistent state and ... */int numSOFBandsint numScanBandscountScanBands(...)/** Returns the total number of bands referenced in all SOS marker ... */List<> idsScanComponentSpec[] specs///// Writer supportAdobeMarkerSegment newAdobenewAdobe.transform//// End of writer support// Supports standard format// and a native format// No other formats// But if we are stream metadata, adjust the variables// The first three bytes should be FF, SOI, FF// Next byte should be the ff before a marker// Either JFIF, JFXX, or unknown APP0// tag, length, id// Leave newGuy null// Read a dummy to skip the segment// newGuy remains null// Either an ICC profile or unknown APP2// Either Adobe or unknown APP14// Just skip it// Now that we've read up to the EOI, we need to push back// whatever is left in the buffer, so that the next read// in the native code will work.// default tables.// Defensive programming// Ignore the destination type.// The only progressive mode that makes sense here is MODE_DEFAULT// the param may not be one of ours, so it may return false.// If so, the following would throw an exception// If the param has them, metadata shouldn't// Progressive forces optimized, regardless of param setting// so consult the param re optimized only if not progressive// compression quality should determine the q tables.  Note that this// will be ignored if we already decided not to create any.// Again, the param may not be one of ours, so we must check that it// supports compression settings// We are done with the param, now for the image types// e.g. alpha// e.g. K or alpha// Not alpha, so must be K// with or without alpha// Everything else is not subsampled, gets no special marker,// and component ids are 1 - N// without alpha we just accept the JFIF defaults// then it must be K// and component ids are 0 - N// do we want an ICC profile?// Now step through the markers, consulting our variables.// Can't happen here// Adobe// dqt// dht// sof// sos// Default progression scans are done in the writer// JFIF must be first, so this skips it// Unless we find otherwise// Colorspace type - follow the rules in the spec// First get the SOF marker segment, if there is one// No image, so no chroma// get the number of channels// is there a JFIF marker segment?// How about an Adobe marker segment?// Neither marker.  Check components// Check against the letters// Finally, 3-channel subsampled are YCbCr, unsubsampled are RGB// 4-channel subsampled are YCbCrA, unsubsampled are CMYK// Not subsampled.  numChannels < 3 is taken care of above// Lossless - false// NumProgressiveScans - count sos segments// If we have a JFIF marker segment, we know a little// otherwise all we know is the orientation, which is always normal// Aspect Ratio is width of pixel / height of pixel// In this case they just encode aspect ratio directly// They are true densities (e.g. dpi) and must be inverted// Pixel size// 1 == dpi, 2 == dpc// Add a text entry for each COM Marker Segment// Always assume// Deep copy// Avoid cloning twice// JPEGvariety and markerSequence// is there already a jfif marker segment?// Add it as the first element in the list.// First collect any existing DQT nodes into a local list// JFIF is always 0// ColorSpaceType can change the target colorspace for compression// This must take any transparency node into account as well, as// that affects the number of channels (if alpha is present).  If// a transparency node is dealt with here, set a flag to indicate// this to the transparency processor below.  If we discover that// the nodes are not in order, throw an exception as the tree is// invalid.// If there is no ColorSpaceType node, we have nothing to do// We can't handle them, so don't modify any metadata// out of for// If the metadata specifies progressive, then the number of channels// must match, so that we can modify all the existing SOS marker segments.// If they don't match, we don't know what to do with SOS so we can't do// the merge.  We then just return silently.// An exception would not be appropriate.  A warning might, but we have// nowhere to send it to.// Progressive// JFIF header might be removed// Now add a JFIF if we do want one, but only if it isn't stream metadata// Adobe header might be removed or the transform modified, if it isn't// stream metadata// Keep the old componentSpecs array// SOF might be modified// Now replace the SOF with a new one; it might be the same, but// this is easier.// we never need extended// Now suss out if subsampling changed and set the boolean for// updating the q tables// if the old componentSpec q table selectors don't match// the new ones, update the qtables.  The new selectors are already// in place in the new SOF segment above.// if the component ids are different, update all the existing scans// ignore Huffman tables// update the ids in each SOS marker segment// Find the position in the old componentSpecs array// of the old component with the old selector// and replace the component selector with the// new id at the same position, as these match// the new component specs array in the SOF created// above.// htables - if the old htable selectors don't match the new ones,// update the tables.// Might be the same as the old one, but this is easier.// should be stream metadata if there isn't an SOF, but check it anyway// update tables - routines below check if it's really necessary// If there are no tables, don't add them, as the metadata encodes an// abbreviated stream.// If we are not subsampling, we just need one, so don't do anything// Is it really necessary?  There should be at least 2 tables.// If there is only one, assume it's a scaled "standard"// luminance table, extract the scaling factor, and generate a// scaled "standard" chrominance table.// Find the table with selector 1.//    find the table with selector 0.  There should be one.// Assuming that the table with id 0 is a luminance table,// compute a new chrominance table of the same quality and// add it to the last DQT segment// Is it really necessary?  There should be at least 2 dc and 2 ac// tables.  If there is only one, add a// "standard " chrominance table.// find a table with selector 1. AC/DC is irrelevant// Create new standard dc and ac chrominance tables and add them// to the last DHT segment// Alpha must be first if present// NumProgressiveScans is ignored.  Progression must be enabled on the// ImageWriteParam.// Pixel Aspect Ratio or pixel size can be incorporated if there is,// or can be, a JFIF segment// Can there be one?// Criteria:// SOF must be present with 1 or 3 channels, (stream metadata fails this)//     Component ids must be JFIF compatible.// remaining tests are negative// if Adobe present, transform = ADOBE_UNKNOWN for 1-channel,//     ADOBE_YCC for 3-channel.// If so, create one and insert it into the sequence.  Note that// default is just pixel ratio at 1:1// Convert from mm/dot to dots/cm// Normalize// Deal with min case// Deal with max case// Remember if we invert// First approximation// not close enough// Increment y and compute a new x// Convert to comments.  For the moment ignore the encoding issue.// Ignore keywords, language, and encoding (for the moment).// If compression tag is present, use only entries with "none".// This might indicate that an alpha channel is being added or removed.// The nodes must appear in order, and a Chroma node will process any// transparency, so process it here only if there was no Chroma node// Do nothing for stream metadata// do we have alpha already?  If the number of channels is 2 or 4,// we do, as we don't support CMYK, nor can we add alpha to it// The number of channels can be determined from the SOF// We can do nothing for progressive, as we don't know how to// modify the scans.// Do we already have alpha?  We can tell by the number of channels// We must have an sof, or we can't do anything further// proceed only if the old state and the new state differ// Adding alpha// If an adobe marker is present, transform must be UNKNOWN// Add a component spec with appropriate parameters to SOF// Add a component spec with appropriate parameters to SOS// Removing alpha// Remove a component spec from SOF// Remove a component spec from SOS// In this case a reset followed by a merge is correct// Build a whole new marker sequence from the tree// for all the children, add a marker segment// SOF numBands = total scan bands// No SOS is OK// If JFIF is present, component ids are 1-3, bands are 1 or 3// If both JFIF and Adobe are present,// Adobe transform == unknown for gray,// YCC for 3-chan.// stream can't have jfif, adobe, sof, or sos// Write a default JFIF segment, including thumbnails// This won't be duplicated below because forceJFIF will be// set only if there is no JFIF present already.// Not compatible, so ignore Adobe.// Iterate over each MarkerSegment// Otherwise ignore it, as requested// If adobe isn't JFIF compatible, ignore it// Otherwise no need to resetint MAX_JPEG_DATA_SIZE;// 2-byte length reduces max to 65533String resourceBaseName;setResourceBaseName(...)// Format shared between image and stream formatsList<> classes/** Returns <code>true</code> if the named element occurs in the ... */String[] childrengetChildNames(...)// Just check if it appears in the format...[] commonContents;JPEGStreamMetadataFormat theInstance;new JPEGStreamMetadataFormat(...)Object[][] commonCopy// return a copy of commonContents; in theory we want a deep clone// of commonContents, but since it only contains (immutable) Strings,// this shallow copy is sufficient/** All metadata is stored in MarkerSegments.  Marker segments ... */int LENGTH_SIZE;int tag;// length is 2 bytes// See JPEG.java/* Sometimes needed by subclasses; doesn't include ... */boolean unknown;// Raw segment data, used for unrecognized segments/** Constructor for creating <code>MarkerSegment</code>s by reading ... */// Set to true if the tag is not recognized/** Constructor used when creating segments other than by ... */this.tag/** Construct a MarkerSegment from an "unknown" DOM Node. */IIOMetadataNode iioNodeIIOInvalidTreeException newGuy/** Deep copy of data array. *//** We have determined that we don't know the type, so load ... *//** Writes the marker, tag, and length.  Note that length ... */// tag plus length// JPEG length includes itself, we don't// Now that we know the true length, ensure that we've got it,// or at least a bufferful if length is too big.// The type of node should have been verified already.// get the attribute and assign it to the tag// get the user object and clone it to the data/** An SOF (Start Of Frame)  marker segment. */int samplePrecision;int numLines;int samplesPerLine;...[] componentSpecs;// Array size is num componentsint factorint qselnew ComponentSpec(...)newGuy.componentSpecscomponentSpecs.lengthSOFMarkerSegment$ComponentSpec/** A component spec within an SOF marker segment. */int componentId;int HsamplingFactor;int VsamplingFactor;int QtableSelector;//import javax.imageio.IIOException;// All attributes are optional, so setup defaults first// If samplePrecision is present, it must be 8.// This just checks.  We don't bother to assign the value.// We don't write SOF segments; the IJG library does.// Parent already did a loadBuf/** An SOS (Start Of Scan) marker segment. */int startSpectralSelection;int endSpectralSelection;int approxHigh;int approxLow;// Array size is numScanComponentsint tableSelnew ScanComponentSpec(...)SOSMarkerSegment newGuySOSMarkerSegment$ScanComponentSpec/** A scan component spec within an SOS marker segment. */int componentSelector;int dcHuffTable;int acHuffTable;// Now the children// We don't write SOS segments; the IJG library does.// Parent already loaded the bufferimport BufferedInputStreamimport SequenceInputStreamimport Inflaterimport InflaterInputStreamimport InputStreamAdapterimport SubImageInputStreamimport ByteInterleavedRasterboolean firstTime;new SubImageInputStream(...)new InputStreamAdapter(...)int crcPNGImageReader.IDAT_TYPEnew PNGMetadata(...)int IHDR_TYPE;// Critical chunks/* Note: The following chunk type constants are autogenerated.  Each ... */int PLTE_TYPE;int IDAT_TYPE;int IEND_TYPE;int bKGD_TYPE;// Ancillary chunksint cHRM_TYPE;int gAMA_TYPE;int hIST_TYPE;int iCCP_TYPE;int iTXt_TYPE;int pHYs_TYPE;int sBIT_TYPE;int sPLT_TYPE;int sRGB_TYPE;int tEXt_TYPE;int tIME_TYPE;int tRNS_TYPE;int zTXt_TYPE;int PNG_COLOR_GRAY;int PNG_COLOR_RGB;int PNG_COLOR_PALETTE;int PNG_COLOR_GRAY_ALPHA;int PNG_COLOR_RGB_ALPHA;...[] inputBandsForColorType;// The number of bands by PNG color typeint PNG_FILTER_NONE;int PNG_FILTER_SUB;int PNG_FILTER_UP;int PNG_FILTER_AVERAGE;int PNG_FILTER_PAETH;...[] adam7XOffset;...[] adam7YOffset;...[] adam7XSubsampling;...[] adam7YSubsampling;boolean gotMetadata;ImageReadParam lastParam;long imageStartPosition;...[] sourceBands;PNGMetadata metadata;DataInputStream pixelStream;int pixelsDone;// The number of source pixels processedint totalPixels;// The total number of pixels in the source imageint IHDR_lengthint IHDR_typeint colorTypeint compressionMethodint filterMethodint interlaceMethodmetadata.IHDR_presentmetadata.IHDR_widthmetadata.IHDR_heightmetadata.IHDR_bitDepthmetadata.IHDR_colorTypemetadata.IHDR_compressionMethodmetadata.IHDR_filterMethodmetadata.IHDR_interlaceMethodmetadata.PLTE_presentint maxEntriesmetadata.PLTE_redmetadata.PLTE_greenmetadata.PLTE_bluemetadata.bKGD_colorTypemetadata.bKGD_indexmetadata.bKGD_graymetadata.bKGD_redmetadata.bKGD_greenmetadata.bKGD_bluemetadata.bKGD_presentmetadata.cHRM_whitePointXmetadata.cHRM_whitePointYmetadata.cHRM_redXmetadata.cHRM_redYmetadata.cHRM_greenXmetadata.cHRM_greenYmetadata.cHRM_blueXmetadata.cHRM_blueYmetadata.cHRM_presentint gammametadata.gAMA_gammametadata.gAMA_presentmetadata.hIST_histogrammetadata.hIST_histogram.lengthmetadata.hIST_presentString keywordreadNullTerminatedString(...)byte[] compressedProfilemetadata.iCCP_profileNamemetadata.iCCP_compressionMethodmetadata.iCCP_compressedProfilemetadata.iCCP_presentlong chunkStartint compressionFlagString languageTagint maxLenString translatedKeywordString textmetadata.iTXt_keywordmetadata.iTXt_compressionFlagmetadata.iTXt_compressionMethodmetadata.iTXt_languageTagmetadata.iTXt_translatedKeywordinflate(...)metadata.iTXt_textmetadata.pHYs_pixelsPerUnitXAxismetadata.pHYs_pixelsPerUnitYAxismetadata.pHYs_unitSpecifiermetadata.pHYs_presentmetadata.sBIT_grayBitsmetadata.sBIT_redBitsmetadata.sBIT_greenBitsmetadata.sBIT_blueBitsmetadata.sBIT_alphaBitsmetadata.sBIT_colorTypemetadata.sBIT_presentint sampleDepthmetadata.sPLT_paletteNamemetadata.sPLT_sampleDepthmetadata.sPLT_redmetadata.sPLT_greenmetadata.sPLT_bluemetadata.sPLT_alphametadata.sPLT_frequencymetadata.sPLT_presentmetadata.sRGB_renderingIntentmetadata.sRGB_presentmetadata.tEXt_keywordmetadata.tEXt_textmetadata.tIME_yearmetadata.tIME_monthmetadata.tIME_daymetadata.tIME_hourmetadata.tIME_minutemetadata.tIME_secondmetadata.tIME_presentmetadata.PLTE_red.lengthmetadata.tRNS_alphametadata.tRNS_colorTypemetadata.tRNS_graymetadata.tRNS_redmetadata.tRNS_greenmetadata.tRNS_bluemetadata.tRNS_presentInputStream baisInputStream iisnew InflaterInputStream(...)int methodmetadata.zTXt_keywordmetadata.zTXt_compressionMethodmetadata.zTXt_textint chunkLengthint chunkTypeint chunkCRCStringBuilder chunkNamenew StringBuilder(...)int ancillaryBitparse_PLTE_chunk(...)parse_bKGD_chunk(...)parse_cHRM_chunk(...)parse_gAMA_chunk(...)parse_hIST_chunk(...)parse_iCCP_chunk(...)parse_iTXt_chunk(...)parse_pHYs_chunk(...)parse_sBIT_chunk(...)parse_sPLT_chunk(...)parse_sRGB_chunk(...)parse_tEXt_chunk(...)parse_tIME_chunk(...)parse_tRNS_chunk(...)parse_zTXt_chunk(...)metadata.unknownChunkTypemetadata.unknownChunkData// Data filtering methodsint rawint priorint priorPixelint priorRowint pint paint pbint pcint priorRowPixelpaethPredictor(...)Point origincreatePackedRaster(...)new DataBufferUShort(...)int inputBandsint bytesPerRowint srcYint dstMinXint dstMaxXint dstMinYint dstMaxYint updateMinXint updateMinYint updateWidthint updateXStepint updateYStepint bytesPerPixelint eltsPerRowint sourceXint srcXint srcXStepbyte[] byteDatashort[] shortDatabyte[] currbyte[] priorWritableRaster passRowcreateRaster(...)int[] psgetPixel(...)boolean adjustBitDepthsint[] outputSampleSizeoutputSampleSize.lengthint[][] scaleboolean useSetRectupdateImageProgress(...)createWritableChild(...)int maxInSampleint halfMaxInSampleint maxOutSampleint sint filterint sourceYbyte[] tmpZipException zedecodeSubFilter(...)decodeUpFilter(...)decodeAverageFilter(...)decodePaethFilter(...)int dstYint newSrcXint dstXsetPixel(...)this.pixelsDonethis.totalPixelsdecodePass(...)int XOffsetint YOffsetint XSubsamplingint YSubsamplingint xbumpint ybumpskipPass(...)Inflater infEnumeration<InputStream> enew PNGImageDataEnumeration(...)new SequenceInputStream(...)Rectangle destRegionnew Inflater(...)new BufferedInputStream(...)this.pixelStreamnew DataInputStream(...)setLocation(...)getLocation(...)decodeImage(...)end(...)ArrayList<ImageTypeSpecifier> lnew ArrayList<ImageTypeSpecifier>(...)ColorSpace rgbColorSpace grayint plengthbyte[] alphacreateGrayscale(...)BufferedImage.TYPE_3BYTE_BGRBufferedImage.TYPE_INT_BGRcopyOf(...)metadata.PLTE_green.lengthmetadata.PLTE_blue.lengthmetadata.tRNS_alpha.lengthred.lengthBufferedImage.TYPE_4BYTE_ABGRBufferedImage.TYPE_INT_ARGB/* Super class implementation uses first element ... */Iterator<ImageTypeSpecifier> typesImageTypeSpecifier raw// skip chunk type// gray// unused// rgb// gray + alpha// rgb + alpha// Re-use signature array to bulk-read these unsigned byte values// Skip IHDR CRC// Round array sizes up to 2^2^n// RGB or RGB_ALPHA/* According to PNG specification length of ... */// Decompress the text// Alpha table may have fewer entries than RGB palette/* Optimization: We can skip the remaining metadata if the ... */// We've reached the image data// Skip the chunk plus the 4 CRC bytes that follow// verify the chunk length// If chunk type is 'IDAT', we've reached the image data.// Read an unknown chunk// double check whether all chunk data were consumed// G// GA in GA order// RGB in RGB order// RGBA in RGBA order// Read the image row-by-row// Skip filter byte and the remaining row bytes// If read has been aborted, just return// processReadAborted will be called later// Determine which pixels will be updated in this pass// If no pixels need updating, just skip the input data// Update count of pixels read// Backwards map from destination pixels// (dstX = updateMinX + k*updateXStep)// to source pixels (sourceX), and then// to offset and skip in passRow (srcX and srcXStep)// Compute the step factor in the source// Create a 1-row tall Raster to hold the data// Create an array suitable for holding one pixel// Handle source and destination bands// Determine if all of the relevant output bands have the// same bit depth as the source data// If the bit depths differ, create a lookup table per band to perform// the conversion// Limit passRow to relevant area for the case where we// will can setRect to copy a contiguous span// Decode the (sub)image row-by-row// Read the filter type byte and a row of data// Swap curr and prior// TODO - throw a more meaningful exception// Copy data into passRow byte by byte// True Y position in source// Init default values// If an ImageReadParam is available, get values from it/* InflaterInputStream uses an Inflater instance which consumes ... *//* NB: the PNG spec declares that valid range for width ... */// At this point the header has been read and we know// how many bands are in the image, so perform checking// of the read param.// Packed grayscale// some standard types of buffered images// which can be used as destination// Component R, G, B// Need tRNS chunk/* The PLTE chunk spec says: ... */// Alpha from tRNS chunk may have fewer entries than// the RGB LUTs from the PLTE chunk; if so, pad with// 255.// Component G, A// wich can be used as destination// Component R, G, B, A (non-premultiplied)PNGMetadata.nativeMetadataFormatNamenew PNGImageReader(...)import DataOutputimport Deflaterimport DeflaterOutputStreamimport ImageOutputStreamImpl...[] crcTable;int crc;new CRC(...)long startPos;CRC crc;this.startPosupdate(...)// fixed length.// Compress output and write as a series of 'IDAT' chunks ofnew Deflater(...)Deflater.BEST_COMPRESSION...[] chunkType;int chunkLength;Deflater def;int bytesRemaining;this.chunkLengthstartChunk(...)this.bytesRemainingfinished(...)needsInput(...)deflate(...)finishChunk(...)byte[] wbuffinish(...)this.localenew RowFilter(...)// Factors from the ImageWriteParamint periodX;int periodY;int bpp;RowFilter rowFilter;...[] prevRow;...[] currRow;...[] filteredRows;...[] sampleSize;// given by sampleSize, and an output bit depth given by scalingBitDepth.// The tables will be designed for use with a set of input but depths// will be valid, or scaleh and scalel will be valid, but not both.// After the first call to initializeScaleTables, either scale and scale0// Per-band scaling tablesint scalingBitDepth;// Sample size per band, in bits...[] scale;// Tables for 1, 2, 4, or 8 bit output// Output bit depth of the scaling tables...[] scale0;// 8 bit table...[] scaleh;// Tables for 16 bit output// equivalent to scale[0]...[] scalel;// High bytes of output// Low bytes of output// Total number of pixels to be written by write_IDAT// Running count of pixels written by write_IDAT...[] allowedProgressivePasses;new PNGImageWriteParam(...)PNGMetadata mbyte[] magicChunkStream csnew ChunkStream(...)PNGImageReader.IHDR_TYPEPNGImageReader.cHRM_TYPEPNGImageReader.gAMA_TYPEPNGImageReader.iCCP_TYPEPNGImageReader.sBIT_TYPEPNGImageReader.PNG_COLOR_GRAYPNGImageReader.PNG_COLOR_GRAY_ALPHAPNGImageReader.PNG_COLOR_RGBPNGImageReader.PNG_COLOR_PALETTEPNGImageReader.PNG_COLOR_RGB_ALPHAPNGImageReader.sRGB_TYPEPNGImageReader.PLTE_TYPEPNGImageReader.hIST_TYPEwriteChars(...)PNGImageReader.tRNS_TYPEint chunkRedint chunkGreenint chunkBluePNGImageReader.bKGD_TYPEPNGImageReader.pHYs_TYPEPNGImageReader.sPLT_TYPEmetadata.sPLT_red.lengthPNGImageReader.tIME_TYPEIterator<> keywordIterIterator<> textIterPNGImageReader.tEXt_TYPEDeflaterOutputStream dosnew DeflaterOutputStream(...)Iterator<String> keywordIterIterator<Boolean> flagIterIterator<Integer> methodIterIterator<String> languageIterIterator<String> translatedKeywordIterIterator<String> textIterPNGImageReader.iTXt_TYPEBoolean compressedIterator<> methodIterPNGImageReader.zTXt_TYPEIterator<> typeIterIterator<> dataIterchunkType(...)char c0char c1char c2char c3int hpixelsint vpixelsint samplesPerByteint numSamplesint[] samplesIndexColorModel icm_gray_alphaRaster rasint[] paletteOrdermetadata.PLTE_orderint tmpint filterTypefilterRow(...)byte[] swapbyte val// Use sourceXOffset, etc.IDATOutputStream iosnew IDATOutputStream(...)encodePass(...)PNGImageReader.adam7XOffsetPNGImageReader.adam7YOffsetPNGImageReader.adam7XSubsamplingPNGImageReader.adam7YSubsamplingPNGImageReader.IEND_TYPE// if either array is null// Check two int arrays for value equality, always returns falses0.lengths1.length// output bit depth// hold the results of scaling an input value to the desired// Initialize the scale/scale0 or scaleh/scalel arrays tothis.sampleSizethis.scalingBitDepthRenderedImage imIIOMetadata imdthis.numBandsthis.sourceXOffsetthis.sourceYOffsetthis.sourceWidththis.sourceHeightthis.sourceBandsthis.periodXthis.periodYcreateFromRenderedImage(...)this.bppinitializeScaleTables(...)write_magic(...)write_IHDR(...)write_cHRM(...)write_gAMA(...)write_iCCP(...)write_sBIT(...)write_sRGB(...)write_PLTE(...)write_hIST(...)write_tRNS(...)write_bKGD(...)write_pHYs(...)write_sPLT(...)write_tIME(...)write_tEXt(...)write_iTXt(...)write_zTXt(...)writeUnknownChunks(...)write_IDAT(...)writeIEND(...)// Initialize CRC table// length, will backpatch// Write CRC// Write length// Return to end of chunk and flush to minimize buffering// TODO - deal with imageType// Write signature// Write IHDR chunk// null terminator// PLTE cannot occur in a gray image// Special case: image is RGB and chunk is Gray// Promote chunk contents to RGB// Special case: image is RGB(A) and chunk is Gray// Make a gray bKGD chunk look like RGB// Ignore status of alpha in colorType// colorType == PNGImageReader.PNG_COLOR_RGB ||// colorType == PNGImageReader.PNG_COLOR_RGB_ALPHA// sampleDepth == 16// Adjust offsets and skips based on source subsampling factors// Early exit if no data for this pass// Convert X offset and skip from pixels to samples// Create row buffers// reserve space for alpha samples// will be used to calculate alpha value for the pixel// Reorder palette data if necessary// leave first 'bpp' bytes zero// Image can only have a single band// Left shift the last byte// Perform filtering// Swap current and previous rows// If write has been aborted, just return;// processWriteAborted will be called later// If the existing tables are still valid, just return// Compute new tables// bitDepth == 16// Divide scaling table into high and low bytes// Set source region and subsampling to default values// Compute total number of pixels for progress notification// Create metadata// Use Adam7 interlacing if set in write param// MODE_COPY_FROM_METADATA should alreay be taken care of// MODE_EXPLICIT is not allowed// Initialize bitDepth and colorType// Overwrite IHDR width and height values with values from image// Initialize scaling tables for this image// Finish up and inform the listeners we are donenew PNGImageWriter(...)// Ensure bitDepth is between 1 and 16// Check number of bands, alpha// Fix 4464413: PNGTransparency reg-test was failing// because for IndexColorModels that have alpha,// numBands == 1 && hasAlpha == true, thus causing// the check below to fail and return false.new ArrayList<String>(...)new ArrayList<Boolean>(...)new ArrayList<Integer>(...)new ArrayList<byte[]>(...)String nativeMetadataFormatClassName;...[] IHDR_colorTypeNames;// Color types for IHDR chunk...[] IHDR_numChannels;...[] IHDR_bitDepths;// Bit depths for IHDR chunk...[] IHDR_compressionMethodNames;// Compression methods for IHDR chunk...[] IHDR_filterMethodNames;// Filter methods for IHDR chunk...[] IHDR_interlaceMethodNames;// Interlace methods for IHDR chunk...[] iCCP_compressionMethodNames;// Compression methods for iCCP chunk...[] zTXt_compressionMethodNames;// Compression methods for zTXt chunkint PHYS_UNIT_UNKNOWN;// "Unknown" unit for pHYs chunkint PHYS_UNIT_METER;// "Meter" unit for pHYs chunk...[] unitSpecifierNames;// Unit specifiers for pHYs chunk...[] renderingIntentNames;// Rendering intents for sRGB chunk...[] colorSpaceTypeNames;// Color space types for Chroma->ColorSpaceType nodeboolean IHDR_present;// IHDR chunkint IHDR_width;int IHDR_height;int IHDR_bitDepth;int IHDR_colorType;int IHDR_compressionMethod;int IHDR_filterMethod;int IHDR_interlaceMethod;boolean PLTE_present;// PLTE chunk// 0 == none, 1 == adam7...[] PLTE_red;...[] PLTE_green;...[] PLTE_blue;...[] PLTE_order;// IndexColorModel image type.// PLTE_order will be null unless 'initialize' is called with an// 'i' in the source should be encoded as index 'PLTE_order[i]'.// order to minimize the size of the tRNS chunk.  Thus an index of// If non-null, used to reorder palette entries during encoding inboolean bKGD_present;// always store it as gray and promote when writing// If external (non-PNG sourced) data has red = green = blue,// bKGD chunkint bKGD_colorType;int bKGD_index;// PNG_COLOR_GRAY, _RGB, or _PALETTEint bKGD_gray;int bKGD_red;int bKGD_green;int bKGD_blue;boolean cHRM_present;// cHRM chunkint cHRM_whitePointX;int cHRM_whitePointY;int cHRM_redX;int cHRM_redY;int cHRM_greenX;int cHRM_greenY;int cHRM_blueX;int cHRM_blueY;boolean gAMA_present;// gAMA chunkint gAMA_gamma;boolean hIST_present;// hIST chunk...[] hIST_histogram;boolean iCCP_present;// iCCP chunkString iCCP_profileName;int iCCP_compressionMethod;...[] iCCP_compressedProfile;ArrayList<String> iTXt_keyword;// iTXt chunkArrayList<Boolean> iTXt_compressionFlag;ArrayList<Integer> iTXt_compressionMethod;ArrayList<String> iTXt_languageTag;ArrayList<String> iTXt_translatedKeyword;ArrayList<String> iTXt_text;boolean pHYs_present;// pHYs chunkint pHYs_pixelsPerUnitXAxis;int pHYs_pixelsPerUnitYAxis;int pHYs_unitSpecifier;boolean sBIT_present;// sBIT chunk// 0 == unknown, 1 == meterint sBIT_colorType;int sBIT_grayBits;// PNG_COLOR_GRAY, _GRAY_ALPHA, _RGB, _RGB_ALPHAint sBIT_redBits;int sBIT_greenBits;int sBIT_blueBits;int sBIT_alphaBits;boolean sPLT_present;// sPLT chunkString sPLT_paletteName;int sPLT_sampleDepth;// 1-79 characters...[] sPLT_red;// 8 or 16...[] sPLT_green;...[] sPLT_blue;...[] sPLT_alpha;...[] sPLT_frequency;boolean sRGB_present;// sRGB chunkint sRGB_renderingIntent;ArrayList<String> tEXt_keyword;// tEXt chunkArrayList<String> tEXt_text;boolean tIME_present;// tIME chunkint tIME_year;int tIME_month;int tIME_day;int tIME_hour;int tIME_minute;int tIME_second;boolean tRNS_present;// tRNS chunkint tRNS_colorType;...[] tRNS_alpha;int tRNS_gray;// May have fewer entries than PLTE_red, etc.int tRNS_red;int tRNS_green;int tRNS_blue;ArrayList<String> zTXt_keyword;// zTXt chunkArrayList<Integer> zTXt_compressionMethod;ArrayList<String> zTXt_text;ArrayList<String> unknownChunkType;// Unknown chunksArrayList<byte[]> unknownChunkData;/** Sets the IHDR_bitDepth and IHDR_colorType variables. ... */boolean isGraybyte redbyte[] newAlphaalpha.lengthint numTransparentbyte[] oldRedbyte[] oldGreenbyte[] oldBlueoldRed.lengthArrayList<byte[]> list// Deep clonePNGMetadata metadatacloneBytesArrayList(...)this.unknownChunkDataIIOMetadataNode IHDR_nodeIIOMetadataNode PLTE_nodePLTE_red.lengthIIOMetadataNode bKGD_nodeIIOMetadataNode cHRM_nodeIIOMetadataNode gAMA_nodeIIOMetadataNode hIST_nodehIST_histogram.lengthIIOMetadataNode histIIOMetadataNode iCCP_nodeObject profileIIOMetadataNode iTXt_parentIIOMetadataNode iTXt_nodeIIOMetadataNode pHYs_nodeIIOMetadataNode sBIT_nodeIIOMetadataNode sPLT_nodesPLT_red.lengthIIOMetadataNode sRGB_nodeIIOMetadataNode tEXt_parentIIOMetadataNode tEXt_nodeIIOMetadataNode tIME_nodeIIOMetadataNode tRNS_nodetRNS_alpha.lengthIIOMetadataNode zTXt_parentIIOMetadataNode zTXt_nodeint cmIIOMetadataNode unknown_parentIIOMetadataNode unknown_nodegetNumChannels(...)int alphaString bitDepthrepeat(...)String sbitsint maxindexNode PLTE_entryNode bKGD_nodeString bKGD_namechar[] histNode hIST_entryObject compressedProfileNode iTXt_nodeisValidKeyword(...)boolean compressionFlagString compressionMethodNode sBIT_nodeString sBIT_nameint[] redint[] greenint[] blueint[] alphaint[] frequencyNode sPLT_entryNode tEXt_nodeNode tRNS_nodeString tRNS_nameNode tRNS_paletteEntryNode zTXt_nodeNode unknown_nodeString chunkTypeObject chunkData/* Accrding to PNG spec, keywords are restricted to 1 to 79 bytes ... */isISOLatin(...)/* According to PNG spec, keyword shall contain only printable ... */float gammaint redint greenint blueint scansStringTokenizer tint maxBitsboolean gotWidthboolean gotHeightboolean gotAspectRatiofloat widthfloat heightint denomint numString languageString compression// Reset all instance variables to their initial state// 0// 1// 2// 3// TODO -- implement// Initialize IHDR_bitDepth// Choose max bit depth over all channels// Fixes bug 4413109// Multi-channel images must have a bit depth of 8 or 16// Round bit depth up to a power of 2// Initialize IHDR_colorType// Determine whether the color tables are actually a gray ramp// if the color type has not been set previously// Determine whether transparency exists/* NB: PNG_COLOR_GRAY_ALPHA color type may be not optimal for images ... */// Reorder the palette so that non-opaque entries// come first.  Since the tRNS chunk does not have// to store trailing 255's, this can save a// considerable amount of space when encoding// images with only one transparent pixel value,// e.g., images from GIF sources.// Scan for non-opaque entries and assign them// positions starting at 0.// Scan for opaque entries and assign them// positions following the non-opaque entries.// Reorder the palettes// All have the same length// Copy only the transparent entries into tRNS_alpha// unknownChunkData needs deep clone// IHDR// IHDR_compressionMethod must be 0 in PNG 1.1// IHDR_filterMethod must be 0 in PNG 1.1// PLTE// bKGD// cHRM// gAMA// hIST// iCCP// iTXt// pHYs// sBIT// sPLT// sRGB// tEXt// tIME// tRNS// zTXt// Determine number of channels// Be careful about palette color with transparency// sBIT_colorType == PNGImageReader.PNG_COLOR_RGB ||// sBIT_colorType == PNGImageReader.PNG_COLOR_RGB_ALPHA// Guard against partial overwrite// silently skip invalid text entry// not printable. Check whether this is an allowed// control char//                  } else if (childName.equals("ColorSpaceType")) {//                  } else if (childName.equals("NumChannels")) {// Use Adam7 if NumProgressiveScans > 1//                  } else if (childName.equals("CompressionTypeName")) {//                  } else if (childName.equals("Lossless")) {//                  } else if (childName.equals("BitRate")) {//                      } else if (childName.equals("PlanarConfiguration")) {//                      } else if (childName.equals("SampleFormat")) {//                      } else if (childName.equals("SampleMSB")) {//                  } else if (childName.equals("ImageOrientation")) {//                  } else if//                      (childName.equals("HorizontalPhysicalPixelSpacing")) {//                      (childName.equals("VerticalPhysicalPixelSpacing")) {//                  } else if (childName.equals("HorizontalPosition")) {//                  } else if (childName.equals("VerticalPosition")) {//                  } else if (childName.equals("HorizontalPixelOffset")) {//                  } else if (childName.equals("VerticalPixelOffset")) {// Find a reasonable rational approximation//                  } else if (childName.equals("SubimageInterpretation")) {//                  } else if (childName.equals("ImageCreationTime")) {// Just ignore this node, PNG requires keywords// Use a zTXt node// Use a tEXt node// Use an iTXt node// fake it//          } else if (name.equals("Transparency")) {//              Node child = node.getFirstChild();//              while (child != null) {//                  String childName = child.getNodeName();//                  if (childName.equals("Alpha")) {//                  } else if (childName.equals("TransparentIndex")) {//                  } else if (childName.equals("TransparentColor")) {//                  } else if (childName.equals("TileTransparencies")) {//                  } else if (childName.equals("TileOpacities")) {//                  }//                  child = child.getNextSibling();//              }//          } else {//              // fatal(node, "Unknown child of root node!");String VALUE_0;String VALUE_1;String VALUE_12;String VALUE_23;String VALUE_31;String VALUE_59;String VALUE_60;String VALUE_255;String VALUE_MAX_16;String VALUE_MAX_32;// 2^16 - 1// 2^32 - 1String[] colorTypesPNGMetadata.IHDR_bitDepthsPNGMetadata.IHDR_compressionMethodNamesPNGMetadata.IHDR_filterMethodNamesPNGMetadata.IHDR_interlaceMethodNamesPNGMetadata.iCCP_compressionMethodNamesPNGMetadata.unitSpecifierNamesPNGMetadata.renderingIntentNamesPNGMetadata.zTXt_compressionMethodNamesnew PNGMetadataFormat(...)// root -> IHDR// root -> PLTE// root -> PLTE -> PLTEEntry// root -> bKGD// root -> bKGD -> bKGD_Grayscale// root -> bKGD -> bKGD_RGB// root -> bKGD -> bKGD_Palette// root -> cHRM// root -> gAMA// root -> hIST// root -> hISTEntry// root -> iCCP// root -> iTXt// root -> iTXt -> iTXtEntry// root -> pHYS// root -> sBIT// root -> sBIT -> sBIT_Grayscale// root -> sBIT -> sBIT_GrayAlpha// root -> sBIT -> sBIT_RGB// root -> sBIT -> sBIT_RGBAlpha// root -> sBIT -> sBIT_Palette// root -> sPLT// root -> sPLT -> sPLTEntry// root -> sRGB// root -> tEXt// root -> tEXt -> tEXtEntry// root -> tIME// root -> tRNS// root -> tRNS -> tRNS_Grayscale// root -> tRNS -> tRNS_RGB// root -> tRNS -> tRNS_Palette// root -> zTXt// root -> zTXt -> zTXtEntry// root -> UnknownChunks// root -> UnknownChunks -> UnknownChunk// Returns the sum of absolute differencesint badnessint currint differenceint upint[] filterBadnessint minBadnessbyte[] subFilteredRowsubFilter(...)byte[] upFilteredRowupFilter(...)byte[] averageFilteredRowbyte[] paethFilteredRowint upleftint predictor// Use type 0 for palette images/** This class is the Java Image IO plugin reader for WBMP images. ... */int wbmpType;WBMPMetadata metadata;/** Constructs <code>WBMPImageReader</code> from the provided ... */byte fixHeaderFieldnew WBMPMetadata(...)isValidWbmpType(...)metadata.wbmpTypereadMultiByteInteger(...)BufferedImage.TYPE_BYTE_BINARYWritableRaster tileMultiPixelPackedSampleModel sm/* This method verifies that given byte is valid wbmp type marker. ... */// TypeField// check for valid wbmp image// Read image width// Read image height// Get the SampleModel.// If noTransform is necessary, read the data.int MAX_WBMP_WIDTH;int MAX_WBMP_HEIGHT;WBMPMetadata.nativeMetadataFormatNameint fixHeaderFieldlong dataLengthlong scanSizenew WBMPImageReader(...)// check WBMP "header"// while WBMP reader does not support ext WBMP headers// check image dimension// We can't verify that amount of data in the stream// corresponds to image dimension because we do not know// the length of the data stream.// Assuming that wbmp image are used for mobile devices,// let's introduce an upper limit for image dimension.// In case if exact amount of raster data is unknown,// let's reject images with dimension above the limit.// Get the number of bits required to represent an int.// Convert an int value to WBMP multi-byte format.int numBitsLeftbyte[] multiBytesmultiBytes.length/** Constructs <code>WBMPImageWriter</code> based on the provided ... */WBMPMetadata metameta.wbmpTypeSampleModel destSMboolean isWhiteZerocheckSampleModel(...)getSample(...)intToMultiByte(...)byte[] invertedint col// default wbmp level// If the data are not formatted nominally then reformat.// Check whether the image is white-is-zero.// Get the line stride, bytes per row, and data array.// Write WBMP header.// FixHeaderField// Write the data.// Write the entire image.// Write the image row-by-row.// Black-is-zero// White-is-zero: need to invert data.new WBMPImageWriter(...)new WBMPMetadataFormat(...)import ImageInputStreamSpiimport FileImageInputStreamFile.classClass<> inputClass;new FileImageInputStream(...)import ImageOutputStreamSpiimport FileImageOutputStreamClass<> outputClass;new FileImageOutputStream(...)import FileCacheImageInputStreamimport MemoryCacheImageInputStreamnew FileCacheImageInputStream(...)new MemoryCacheImageInputStream(...)import FileCacheImageOutputStreamnew FileCacheImageOutputStream(...)import RandomAccessFileRandomAccessFile.class/** Convenience class that closes a given resource (e.g. RandomAccessFile), ... */Closeable closeable;this.closeable/** This class provide means to properly close hanging ... */WeakHashMap<CloseAction,Object> toCloseQueue;Thread streamCloser;StreamCloser.classnew WeakHashMap<CloseAction,Object>(...)Runnable streamCloserRunnablenew Runnable(...) { ... }StreamCloser$1Set<CloseAction> setCloseAction[] actionsnew CloseAction[]CloseAction caperformAction(...)StreamCloser$2ThreadGroup tgnsetContextClassLoader(...)addShutdownHook(...)new CloseAction(...)StreamCloser$CloseAction// Make a copy of the set in order to avoid// concurrent modification (the is.close()// will in turn call removeFromQueue())/* The thread must be a member of a thread group ... *//* Set context class loader to null in order to avoid ... *//** Small class to assist in properly closing an ImageInputStream instance ... */finalize(...)/** This class is preserved for backward compatibility with JDK 6. ... *//* Copyright (c) 2005, 2013, Oracle and/or its affiliates. All rights reserved. ... */import EventQueueDelegateimport SunToolkitimport Callableimport AWTEventimport EventQueueimport Componentimport Containerimport Windowimport JComponentimport RepaintManager/** A collection of utility methods for Swing. ... */new WeakHashMap<Container,Boolean>(...)Object DELEGATE_REPAINT_MANAGER_KEY;/** The {@code clientProperty} key for delegate {@code RepaintManager} *//** Registers delegate RepaintManager for {@code JComponent}. */putClientProperty(...)Map<Container,Boolean> vsyncedMap;/** Sets vsyncRequested state for the {@code rootContainer}.  If ... *//** Checks if vsync painting is requested for {@code rootContainer} ... *//** Returns delegate {@code RepaintManager} for {@code component} hierarchy. */RepaintManager delegatetargetToAppContext(...)getClientProperty(...)/* We use maps to avoid reflection. Hopefully it should perform better ... */new EventQueueDelegateFromMap(...)SwingUtilities3$EventQueueDelegateFromMapEventQueueDelegate.Delegate...[] afterDispatchEventArgument;...[] afterDispatchHandleArgument;Callable<Void> afterDispatchCallable;...[] beforeDispatchEventArgument;Callable<Object> beforeDispatchCallable;...[] getNextEventEventQueueArgument;Callable<AWTEvent> getNextEventCallable;Map<String,Object> methodMapcall(...)/* setting up flag in AppContext to speed up lookups in case ... */import java.awt.*import java.awt.event.*import java.awt.image.*import javax.swing.*import javax.swing.colorchooser.*import javax.swing.event.*import javax.swing.plaf.*/** A color chooser panel mimicking that of GTK's: a color wheel showing ... */Math.PIfloat PI_3;ColorTriangle triangle;JLabel lastLabel;JLabel label;JSpinner hueSpinner;JSpinner saturationSpinner;JSpinner valueSpinner;JSpinner redSpinner;JSpinner greenSpinner;JSpinner blueSpinner;JTextField colorNameTF;boolean settingColor;float hue;// The colors are mirrored to avoid creep in adjusting an individualfloat saturation;float brightness;// PENDING: remove this when a variant of this is added to awt./** Convenience method to transfer focus to the next child of component. */Container containerContainer rootAncestorgetFocusCycleRootAncestor(...)isFocusCycleRoot(...)FocusTraversalPolicy policygetFocusTraversalPolicy(...)Component compgetDefaultComponent(...)requestFocus(...)getComponentAfter(...)getComponentBefore(...)/** Returns a user presentable description of this GTKColorChooserPane. *//** Returns the mnemonic to use with <code>getDisplayName</code>. */String m/** Character to underline that represents the mnemonic. */uninstallChooserPanel(...)/** Builds and configures the widgets for the GTKColorChooserPanel. */Box hBoxcreateHorizontalBox(...)new ColorTriangle(...)new OpaqueLabel(...)setOpaque(...)setMinimumSize(...)setPreferredSize(...)setMaximumSize(...)new JSpinner(...)new SpinnerNumberModel(...)configureSpinner(...)new JTextField(...)setLayout(...)new GridBagLayout(...)new JSeparator(...)new GridBagConstraints(...)SwingConstants.HORIZONTALGridBagConstraints.LINE_STARTGridBagConstraints.HORIZONTALnew Insets(...)GridBagConstraints.NONEGridBagConstraints.CENTER/** Configures the spinner. */JComponent editorgetEditor(...)addChangeListener(...)JSpinner.DefaultEditorJFormattedTextField ftfgetTextField(...)setFocusLostBehavior(...)JFormattedTextField.COMMIT_OR_REVERT/** Adds the widget creating a JLabel with the specified name. */JLabel labelnew JLabel(...)String mnemonicGridBagConstraints conGridBagConstraints.FIRST_LINE_ENDString mnemonicIndexsetDisplayedMnemonic(...)setDisplayedMnemonicIndex(...)setLabelFor(...)getComponentCount(...)con.insets.topcon.insetscon.gridx/** Refreshes the display from the model. */setBackground(...)getColorFromModel(...)setColor(...)/** Resets the red component of the selected color. */setRGB(...)getColor(...)/** Resets the green component of the selected color. *//** Resets the blue component of the selected color. *//** Sets the hue of the selected color and updates the display if ... */setHSB(...)/** Returns the current amount of hue. *//** Resets the saturation. *//** Returns the saturation. *//** Sets the brightness. *//** Returns the brightness. *//** Sets the saturation and brightness and updates the display if ... *//** Resets the rgb values. */Color color/** Resets the hsb values. */getHSBColor(...)this.huethis.saturationthis.brightness/** Rests the color. ... */Color.BLACKfloat[] hsbRGBtoHSB(...)ColorSelectionModel modelgetColorSelectionModel(...)setSelectedColor(...)setText(...)getBackground(...)/** ChangeListener method, updates the necessary display widgets. */getSource(...)setHue(...)setSaturation(...)setBrightness(...)setRed(...)setGreen(...)setBlue(...)int FLAGS_CHANGED_ANGLE;/** Flag indicating the angle, or hue, has changed and the triangle ... */int FLAGS_DRAGGING;/** Indicates the wheel is being dragged. */int FLAGS_DRAGGING_TRIANGLE;/** Indicates the triangle is being dragged. */int FLAGS_SETTING_COLOR;/** Indicates a color is being set and we should ignore setColor */int FLAGS_FOCUSED_WHEEL;/** Indicates the wheel has focus. */int FLAGS_FOCUSED_TRIANGLE;/** Indicates the triangle has focus. */GTKColorChooserPanel$ColorTriangle/** Class responsible for rendering a color wheel and color triangle. */Image wheelImage;/** Cached image of the wheel. */Image triangleImage;/** Cached image of the triangle. */double angle;/** Angle triangle is rotated by. */int flags;/** Boolean bitmask. */int circleX;/** X location of selected color indicator. */int circleY;/** Y location of selected color indicator. */ActionMap mapenableEvents(...)AWTEvent.FOCUS_EVENT_MASKAWTEvent.MOUSE_EVENT_MASKAWTEvent.MOUSE_MOTION_EVENT_MASKgetWheelRadius(...)setFocusTraversalKeysEnabled(...)getInputMap(...)getKeyStroke(...)new ActionMapUIResource(...)new ColorAction(...)getLookAndFeelDefaults(...)replaceUIActionMap(...)/** Returns the GTKColorChooserPanel. */GTKColorChooserPanel.this/** Gives focus to the wheel. */setFocusType(...)/** Gives focus to the triangle. *//** Returns true if the wheel currently has focus. */isSet(...)/** Resets the selected color. */setAngleFromHue(...)setSaturationAndBrightness(...)/** Returns the selected color. *//** Returns the x location of the selected color indicator. */getWheelXOrigin(...)getIndicatorSize(...)/** Returns the y location of the selected color indicator. */getWheelYOrigin(...)getID(...)MouseEvent.MOUSE_PRESSEDMouseEvent.MOUSE_DRAGGEDgetX(...)getY(...)hasFocus(...)adjustHue(...)adjustSB(...)MouseEvent.MOUSE_RELEASEDFocusEvent.FOCUS_LOSTFocusEvent.FOCUS_GAINEDrepaint(...)processEvent(...)getWheelWidth(...)Image imagegetImage(...)int lineX0cos(...)int lineY0sin(...)int lineX1int lineY1paintComponent(...)drawOval(...)toDegrees(...)Color.WHITEdrawLine(...)Graphics g2int innerRgetTriangleCircumscribedRadius(...)rotate(...)/** Returns an image representing the triangle and wheel. */int triangleSizedouble rotatetoRadians(...)getWheelImage(...)fillRect(...)paintTriangle(...)fillOval(...)float huedouble dSizetan(...)float factorfloat saturation/** Returns a color wheel image for the specified size. ... */int minSizeint doubleSizeBufferedImage imageint ySquareddouble radint rgbcolorWheelLocationToRGB(...)/** Adjusts the saturation and brightness. <code>x</code> and ... */boolean resetXYdouble x1double y1double x2double y2float maxX/** Sets the saturation and brightness. */double xdouble maxYdouble yint newCircleXint newCircleY/** Adjusts the hue based on the passed in location. ... */double angleatan(...)setHueAngle(...)getSaturation(...)getBrightness(...)/** Rotates the triangle to accommodate the passed in hue. *//** Sets the angle representing the hue. */double oldAnglethis.angle/** Returns the size of the color indicator. *//** Returns the circumscribed radius of the triangle. *//** Returns the x origin of the wheel and triangle. *//** Returns y origin of the wheel and triangle. *//** Returns the width of the wheel. *//** Sets the focus to one of: 0 no one, 1 the wheel or 2 the triangle. */int toSetint toUnset/** Returns the radius of the wheel. *//** Updates the flags bitmask. *//** Returns true if a particular flag has been set. *//** Returns the RGB color to use for the specified location. The ... */acos(...)/** Increments the hue. */getHue(...)getGTKColorChooserPanel(...)GTKColorChooserPanel$ColorAction/** Action class used for colors. */ColorTriangle triangleisWheelFocused(...)incrementHue(...)focusTriangle(...)compositeRequestFocus(...)int xDeltaint yDeltafocusWheel(...)getColorX(...)getColorY(...)GTKColorChooserPanel$OpaqueLabel// PENDING: when we straighten out user setting opacity, this should// be changed.// Force Integer to pad the string with 0's by adding 0x1000000 and// then removing the first character.// We want to handle tab ourself.// PENDING: this should come from the style.// Assign focus to either the wheel or triangle and attempt// to drag either the wheel or triangle.// Stopped dragging// Reset the flags to indicate no one has focus// Gained focus, reassign focus to the wheel if no one// currently has focus.// Draw the wheel and triangle// Draw the focus indicator for the wheel// Draw a line on the wheel indicating the selected hue.// Draw the focus indicator on the triangle// Draw the selected color indicator.// Invert the axis.// Rotate to origin and and verify x is valid.// Verify y location is valid.// Rotate again to determine value and scale// Map the location to an angle and reset hue// As far as I can tell, GTK doesn't allow stretching this// widget// FFFF00 - FF0000// FF0000 - FF00FF// 00FF00 - FFFF00// FF00FF - 0000FF// 00FFFF - 00FF00// 0000FF - 00FFFF// up// down// left// rightimport ColorTypeimport ColorUIResourcenew GTKColorType(...)ColorType LIGHT;// values.// gtkrc, the rest (dark, mid, light) are calculated from these// GTK allows you to specify the foreground and background in aColorType DARK;ColorType MID;ColorType BLACK;ColorType WHITE;int MAX_COUNT;...[] HLS_COLORS;Object HLS_COLOR_LOCK;float m2float m1float rfloat gfloat bhlsValue(...)/** Converts from RGB color space to HLS colorspace. */float maxfloat minfloat lfloat sfloat h/** Creates and returns a new color derived from the passed in color. ... */float[] hlsrgbToHLS(...)new ColorUIResource(...)hlsToRGB(...)/* calculate lightness */int UNDEFINED;/** Used to indicate a constant is not defined. */GTKConstants$IconSize/** Java representation of native GtkIconSize enum */new IconSize(...)IconSize INVALID;IconSize MENU;IconSize SMALL_TOOLBAR;IconSize LARGE_TOOLBAR;IconSize BUTTON;IconSize DND;IconSize DIALOG;GTKConstants$TextDirection/** Java representation of native GtkTextDirection enum */new TextDirection(...)TextDirection NONE;TextDirection LTR;TextDirection RTL;GTKConstants$ShadowType/** Java representation of native GtkShadowType enum */new ShadowType(...)ShadowType NONE;ShadowType IN;ShadowType OUT;ShadowType ETCHED_IN;ShadowType ETCHED_OUT;GTKConstants$StateType/** Java representation of native GtkStateType enum */new StateType(...)StateType NORMAL;StateType ACTIVE;StateType PRELIGHT;StateType SELECTED;StateType INSENSITIVE;GTKConstants$ExpanderStyle/** Java representation of native GtkExpanderStyle enum */new ExpanderStyle(...)ExpanderStyle COLLAPSED;ExpanderStyle SEMI_COLLAPSED;ExpanderStyle SEMI_EXPANDED;ExpanderStyle EXPANDED;GTKConstants$PositionType/** Java representation of native GtkPositionType enum */new PositionType(...)PositionType LEFT;PositionType RIGHT;PositionType TOP;PositionType BOTTOM;GTKConstants$ArrowType/** Java representation of native GtkArrowType enum */new ArrowType(...)ArrowType UP;ArrowType DOWN;ArrowType LEFT;ArrowType RIGHT;GTKConstants$Orientation/** Java representation of native GtkOrientation enum */new Orientation(...)Orientation HORIZONTAL;Orientation VERTICAL;/* Copyright (c) 2002, 2005, Oracle and/or its affiliates. All rights reserved. ... */import javax.swing.plaf.synth.*import ArrowTypeimport ExpanderStyleimport Orientationimport PositionTypeimport ShadowTypeimport TextDirectionimport SunWritableRasterimport ImageCache/** GTKEngine delegates all painting job to native GTK libraries. ... */new ImageCache(...)new GTKEngine(...)getDefaultToolkit(...)new HashMap<Region,Object>(...)Region.ARROW_BUTTONnew WidgetType[]WidgetType.SPINNER_ARROW_BUTTONWidgetType.COMBO_BOX_ARROW_BUTTONWidgetType.HSCROLL_BAR_BUTTON_LEFTWidgetType.HSCROLL_BAR_BUTTON_RIGHTWidgetType.VSCROLL_BAR_BUTTON_UPWidgetType.VSCROLL_BAR_BUTTON_DOWNRegion.BUTTONWidgetType.BUTTONRegion.CHECK_BOXWidgetType.CHECK_BOXRegion.CHECK_BOX_MENU_ITEMWidgetType.CHECK_BOX_MENU_ITEMRegion.COLOR_CHOOSERWidgetType.COLOR_CHOOSERRegion.FILE_CHOOSERWidgetType.OPTION_PANERegion.COMBO_BOXWidgetType.COMBO_BOXRegion.DESKTOP_ICONWidgetType.DESKTOP_ICONRegion.DESKTOP_PANEWidgetType.DESKTOP_PANERegion.EDITOR_PANEWidgetType.EDITOR_PANERegion.FORMATTED_TEXT_FIELDWidgetType.FORMATTED_TEXT_FIELDWidgetType.SPINNER_TEXT_FIELDGTKRegion.HANDLE_BOXWidgetType.HANDLE_BOXRegion.INTERNAL_FRAMEWidgetType.INTERNAL_FRAMERegion.INTERNAL_FRAME_TITLE_PANEWidgetType.INTERNAL_FRAME_TITLE_PANERegion.LABELWidgetType.LABELWidgetType.COMBO_BOX_TEXT_FIELDRegion.LISTWidgetType.LISTRegion.MENUWidgetType.MENURegion.MENU_BARWidgetType.MENU_BARRegion.MENU_ITEMWidgetType.MENU_ITEMRegion.MENU_ITEM_ACCELERATORWidgetType.MENU_ITEM_ACCELERATORRegion.OPTION_PANERegion.PANELWidgetType.PANELRegion.PASSWORD_FIELDWidgetType.PASSWORD_FIELDRegion.POPUP_MENUWidgetType.POPUP_MENURegion.POPUP_MENU_SEPARATORWidgetType.POPUP_MENU_SEPARATORRegion.PROGRESS_BARWidgetType.HPROGRESS_BARWidgetType.VPROGRESS_BARRegion.RADIO_BUTTONWidgetType.RADIO_BUTTONRegion.RADIO_BUTTON_MENU_ITEMWidgetType.RADIO_BUTTON_MENU_ITEMRegion.ROOT_PANEWidgetType.ROOT_PANERegion.SCROLL_BARWidgetType.HSCROLL_BARWidgetType.VSCROLL_BARRegion.SCROLL_BAR_THUMBWidgetType.HSCROLL_BAR_THUMBWidgetType.VSCROLL_BAR_THUMBRegion.SCROLL_BAR_TRACKWidgetType.HSCROLL_BAR_TRACKWidgetType.VSCROLL_BAR_TRACKRegion.SCROLL_PANEWidgetType.SCROLL_PANERegion.SEPARATORWidgetType.HSEPARATORWidgetType.VSEPARATORRegion.SLIDERWidgetType.HSLIDERWidgetType.VSLIDERRegion.SLIDER_THUMBWidgetType.HSLIDER_THUMBWidgetType.VSLIDER_THUMBRegion.SLIDER_TRACKWidgetType.HSLIDER_TRACKWidgetType.VSLIDER_TRACKRegion.SPINNERWidgetType.SPINNERRegion.SPLIT_PANEWidgetType.SPLIT_PANERegion.SPLIT_PANE_DIVIDERWidgetType.HSPLIT_PANE_DIVIDERWidgetType.VSPLIT_PANE_DIVIDERRegion.TABBED_PANEWidgetType.TABBED_PANERegion.TABBED_PANE_CONTENTWidgetType.TABBED_PANE_CONTENTRegion.TABBED_PANE_TABWidgetType.TABBED_PANE_TABRegion.TABBED_PANE_TAB_AREAWidgetType.TABBED_PANE_TAB_AREARegion.TABLEWidgetType.TABLERegion.TABLE_HEADERWidgetType.TABLE_HEADERRegion.TEXT_AREAWidgetType.TEXT_AREARegion.TEXT_FIELDWidgetType.TEXT_FIELDRegion.TEXT_PANEWidgetType.TEXT_PANECustomRegion.TITLED_BORDERWidgetType.TITLED_BORDERRegion.TOGGLE_BUTTONWidgetType.TOGGLE_BUTTONRegion.TOOL_BARWidgetType.TOOL_BARRegion.TOOL_BAR_CONTENTRegion.TOOL_BAR_DRAG_WINDOWWidgetType.TOOL_BAR_DRAG_WINDOWRegion.TOOL_BAR_SEPARATORWidgetType.TOOL_BAR_SEPARATORRegion.TOOL_TIPWidgetType.TOOL_TIPRegion.TREEWidgetType.TREERegion.TREE_CELLWidgetType.TREE_CELLRegion.VIEWPORTWidgetType.VIEWPORTnew ColorModel[]getRGBdefault(...)GTKEngine INSTANCE;int CACHE_SIZE;/** Size of the image cache */GTKEngine$WidgetType/** This enum mirrors that in gtk2_interface.h */new WidgetType(...)WidgetType BUTTON;WidgetType CHECK_BOX;WidgetType CHECK_BOX_MENU_ITEM;WidgetType COLOR_CHOOSER;WidgetType COMBO_BOX;WidgetType COMBO_BOX_ARROW_BUTTON;WidgetType COMBO_BOX_TEXT_FIELD;WidgetType DESKTOP_ICON;WidgetType DESKTOP_PANE;WidgetType EDITOR_PANE;WidgetType FORMATTED_TEXT_FIELD;WidgetType HANDLE_BOX;WidgetType HPROGRESS_BAR;WidgetType HSCROLL_BAR;WidgetType HSCROLL_BAR_BUTTON_LEFT;WidgetType HSCROLL_BAR_BUTTON_RIGHT;WidgetType HSCROLL_BAR_TRACK;WidgetType HSCROLL_BAR_THUMB;WidgetType HSEPARATOR;WidgetType HSLIDER;WidgetType HSLIDER_TRACK;WidgetType HSLIDER_THUMB;WidgetType HSPLIT_PANE_DIVIDER;WidgetType INTERNAL_FRAME;WidgetType INTERNAL_FRAME_TITLE_PANE;WidgetType IMAGE;WidgetType LABEL;WidgetType LIST;WidgetType MENU;WidgetType MENU_BAR;WidgetType MENU_ITEM;WidgetType MENU_ITEM_ACCELERATOR;WidgetType OPTION_PANE;WidgetType PANEL;WidgetType PASSWORD_FIELD;WidgetType POPUP_MENU;WidgetType POPUP_MENU_SEPARATOR;WidgetType RADIO_BUTTON;WidgetType RADIO_BUTTON_MENU_ITEM;WidgetType ROOT_PANE;WidgetType SCROLL_PANE;WidgetType SPINNER;WidgetType SPINNER_ARROW_BUTTON;WidgetType SPINNER_TEXT_FIELD;WidgetType SPLIT_PANE;WidgetType TABBED_PANE;WidgetType TABBED_PANE_TAB_AREA;WidgetType TABBED_PANE_CONTENT;WidgetType TABBED_PANE_TAB;WidgetType TABLE;WidgetType TABLE_HEADER;WidgetType TEXT_AREA;WidgetType TEXT_FIELD;WidgetType TEXT_PANE;WidgetType TITLED_BORDER;WidgetType TOGGLE_BUTTON;WidgetType TOOL_BAR;WidgetType TOOL_BAR_DRAG_WINDOW;WidgetType TOOL_BAR_SEPARATOR;WidgetType TOOL_TIP;WidgetType TREE;WidgetType TREE_CELL;WidgetType VIEWPORT;WidgetType VPROGRESS_BAR;WidgetType VSCROLL_BAR;WidgetType VSCROLL_BAR_BUTTON_UP;WidgetType VSCROLL_BAR_BUTTON_DOWN;WidgetType VSCROLL_BAR_TRACK;WidgetType VSCROLL_BAR_THUMB;WidgetType VSEPARATOR;WidgetType VSLIDER;WidgetType VSLIDER_TRACK;WidgetType VSLIDER_THUMB;WidgetType VSPLIT_PANE_DIVIDER;GTKEngine$Settings/** Representation of GtkSettings properties. ... */new Settings(...)Settings GTK_FONT_NAME;Settings GTK_ICON_SIZES;Settings GTK_CURSOR_BLINK;Settings GTK_CURSOR_BLINK_TIME;GTKEngine$CustomRegion/* Custom regions are needed for representing regions that don't exist ... */new CustomRegion(...)Region TITLED_BORDER;/* TITLED_BORDER Region is mapped to GtkFrame class which can draw ... */HashMap<Region,Object> regionToWidgetTypeMap;ImageCache cache;int x0, ...;Graphics graphics;...[] cacheArgs;/** Translate Region and JComponent into WidgetType ordinals */WidgetType[] widgetsgetOrientation(...)JScrollBar.HORIZONTALJSeparator separatorJSeparator.HORIZONTALJSlider.HORIZONTALJProgressBar.HORIZONTALJSplitPane.HORIZONTAL_SPLITInteger propint dirSwingConstants.WESTSwingConstants.EASTSwingConstants.NORTHSwingConstants.SOUTHTextDirection dirTextDirection.NONEJComponent compgetComponent(...)ComponentOrientation cogetComponentOrientation(...)isLeftToRight(...)TextDirection.LTRTextDirection.RTLordinal(...)int widgetgetWidgetType(...)synthStateToGTKStateType(...)native_paint_arrow(...)int gtkStateint synthStategetComponentState(...)getTextDirection(...)native_paint_box(...)native_paint_box_gap(...)native_paint_check(...)native_paint_expander(...)native_paint_extension(...)native_paint_flat_box(...)native_paint_focus(...)native_paint_handle(...)native_paint_hline(...)native_paint_option(...)Container parentis3(...)SynthConstants.FOCUSEDnative_paint_shadow(...)native_paint_slider(...)native_paint_vline(...)native_paint_background(...)...[] COLOR_MODELS;...[] BAND_OFFSETS;/** Paint a cached image identified by its size and a set of additional ... */Image img/* Allocate a native offscreen buffer of the specified size. */nativeStartPainting(...)/** Convenience method that delegates to finishPainting() with ... */finishPainting(...)/** Called to indicate that painting is finished. We create a new ... */DataBufferInt dataBuffernew DataBufferInt(...)nativeFinishPainting(...)stealData(...)markDirty(...)setImage(...)/** Notify native layer of theme change, and flush cache */UNIXToolkit.GTK_LOCKnative_switch_theme(...)/* GtkSettings enum mirrors that in gtk2_interface.h */native_get_gtk_setting(...)/** Sets up the GtkAdjustment values for the native GtkRange widget ... */nativeSetRangeValue(...)/* Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved. ... */// Make sure the awt toolkit is loaded so we have access to native// Initialize regionToWidgetTypeMap/* We should return correrct WidgetType if the seperator is inserted ... *//* For all ListCellRenderers we will use COMBO_BOX_TEXT_FIELD widget ... */// Transparency.OPAQUE// Transparency.BITMASK// Transparency.TRANSLUCENT// OPAQUE// BITMASK// TRANSLUCENT// look for cached image// Note that stealData() requires a markDirty() afterwards// since we modify the data in it.import java.beans.*import MessageFormatimport javax.swing.border.*import javax.swing.filechooser.*import BasicDirectoryModelimport javax.swing.table.*import javax.accessibility.*import SwingUtilities2import sun.swing.plaf.synth.*import FilePaneimport ShellFolder/** GTK FileChooserUI. ... */new DirectoryComboBoxAction(...)new GTKFileView(...)new GTKApproveSelectionAction(...)Short.MAX_VALUEJPanel accessoryPanel;// The accessoryPanel is a container to place the JFileChooser accessory componentString newFolderButtonText;String newFolderErrorSeparator;String newFolderErrorText;String newFolderDialogText;String newFolderNoDirectoryErrorTitleText;String newFolderNoDirectoryErrorText;String deleteFileButtonText;String renameFileButtonText;String newFolderButtonToolTipText;String deleteFileButtonToolTipText;String renameFileButtonToolTipText;int newFolderButtonMnemonic;int deleteFileButtonMnemonic;int renameFileButtonMnemonic;int foldersLabelMnemonic;int filesLabelMnemonic;String renameFileDialogText;String renameFileErrorTitle;String renameFileErrorText;JComboBox<> filterComboBox;FilterComboBoxModel filterComboBoxModel;JPanel rightPanel;// From MotifJList<> directoryList;JList<> fileList;JLabel pathField;JTextField fileNameTextField;Dimension hstrut3;Dimension vstrut10;Dimension prefListSize;Dimension PREF_SIZE;int MIN_WIDTH;int MIN_HEIGHT;Dimension ZERO_ACC_SIZE;Dimension MAX_SIZE;Insets buttonMargin;String filesLabelText;String foldersLabelText;String pathLabelText;String filterLabelText;int pathLabelMnemonic;int filterLabelMnemonic;JComboBox<> directoryComboBox;DirectoryComboBoxModel directoryComboBoxModel;Action directoryComboBoxAction;JPanel bottomButtonPanel;GTKDirectoryModel model;Action newFolderAction;boolean readOnly;boolean showDirectoryIcons;boolean showFileIcons;GTKFileView fileView;PropertyChangeListener gtkFCPropertyChangeListener;Action approveSelectionAction;GTKDirectoryListModel directoryListModel;getApproveSelectionAction(...)getCancelSelectionAction(...)getChangeToParentDirectoryAction(...)getFileNameCompletionAction(...)JFileChooser fcgetFileChooser(...)String typedInNameint modegetFileSelectionMode(...)JList<> listJFileChooser.DIRECTORIES_ONLYObject[] filesgetSelectedValues(...)files.lengthVector<String> resultnew Vector<String>(...)isMultiSelectionEnabled(...)//      return pathField.getText();//     public String getDirectoryName() {validateFileCache(...)getModel(...)// ***********************// * FileView operations *isDirectory(...)JFileChooser filechooserJRootPane rootgetRootPane(...)getControlButtonsAreShown(...)getDefaultButton(...)setDefaultButton(...)getApproveButton(...)setDefaultCapable(...)getCancelButton(...)File fgetNewValue(...)doSelectedFileChanged(...)setFileName(...)ListSelectionModel smgetSelectionModel(...)File currentDirectorygetCurrentDirectory(...)clearSelection(...)moveLeadSelectionIndex(...)setAnchorSelectionIndex(...)setDirectoryName(...)getPath(...)getNormalizedFile(...)addItem(...)directoryChanged(...)doDirectoryChanged(...)getAccessoryPanel(...)JComponent accessorygetOldValue(...)BorderLayout.CENTERgetPreferredSize(...)setVisible(...)doFileSelectionModeChanged(...)setSelectionMode(...)ListSelectionModel.MULTIPLE_INTERVAL_SELECTIONListSelectionModel.SINGLE_SELECTIONdoMultiSelectionChanged(...)doControlButtonsChanged(...)BorderLayout.SOUTHupdateDefaultButton(...)selectAll(...)doAncestorChanged(...)// ********************************************// ************ Create Listeners **************new SelectionListener(...)GTKFileChooserUI$DoubleClickListenerJList<> list;this.listisLeftMouseButton(...)getClickCount(...)locationToIndex(...)getPoint(...)getElementAt(...)isTraversable(...)rescanCurrentDirectory(...)setCurrentDirectory(...)approveSelection(...)TransferHandler th1getTransferHandler(...)TransferHandler th2setTransferHandler(...)getDragEnabled(...)setDragEnabled(...)new DoubleClickListener(...)getValueIsAdjusting(...)JFileChooser chooserFile[] filesObject[] objectsobjects.lengthchooser.DIRECTORIES_ONLYisFileSystem(...)getFileSystemView(...)setDirectorySelected(...)setDirectory(...)ArrayList<File> fListnew ArrayList<File>(...)isFileSelectionEnabled(...)isFile(...)isDirectorySelectionEnabled(...)new File[]setSelectedFiles(...)getSelectedValue(...)chooser.FILES_ONLYsetSelectedFile(...)// ComponentUI Interface Implementation methodsnew GTKFileChooserUI(...)new JPanel(...)new BorderLayout(...)installUI(...)removePropertyChangeListener(...)uninstallUI(...)boolean leftToRightJPanel topButtonPanelnew FlowLayout(...)FlowLayout.LEADINGJButton deleteFileButtonnew JButton(...)RenameFileAction rfanew RenameFileAction(...)JButton renameFileButtonJPanel interiorJPanel comboBoxPanelnew FlowLayout(...) { ... }GTKFileChooserUI$1FlowLayout.CENTERJComboBox<> comboBoxlayoutContainer(...)JPanel centerPanelJSplitPane splitPanelnew JSplitPane(...)JPanel leftPanelTableCellRenderer headerRenderergetDefaultRenderer(...)new JTableHeader(...)JLabel directoryListLabelgetTableCellRendererComponent(...)JLabel fileListLabelJComponent accessoryPanelgetAccessory(...)JPanel pathFieldPanelJLabel pathFieldLabelString curDirNameSet<AWTKeyStroke> forwardTraversalKeysgetFocusTraversalKeys(...)KeyboardFocusManager.FORWARD_TRAVERSAL_KEYSJPanel panelJLabel filterLabelJPanel pnButtonsnew GridLayout(...)JButton cancelButtonJButton approveButtoninstallComponents(...)setAlignmentX(...)JComponent.CENTER_ALIGNMENTsetBorder(...)new EmptyBorder(...)JButton newFolderButtongetNewFolderAction(...)setMnemonic(...)setToolTipText(...)BorderLayout.NORTHalign(...)new BoxLayout(...)BoxLayout.PAGE_AXIScreateDirectoryComboBoxModel(...)new JComboBox<>(...)addActionListener(...)setMaximumRowCount(...)setDividerLocation(...)PREF_SIZE.widthGridBagConstraints.WESTcreateDirectoryList(...)GridBagConstraints.EASTGridBagConstraints.BOTHcreateFilesList(...)JSplitPane.LEFTJSplitPane.RIGHTBorderLayout.AFTER_LINE_ENDScreateRigidArea(...)new JLabel(...) { ... }GTKFileChooserUI$2Dimension dgetMaximumSize(...)d.heightgetPreferredSize(...).heightnew JTextField(...) { ... }GTKFileChooserUI$3new HashSet<AWTKeyStroke>(...)KeyEvent.VK_TABsetFocusTraversalKeys(...)getActionMap(...)createFilterComboBoxModel(...)addPropertyChangeListener(...)setRenderer(...)createFilterComboBoxRenderer(...)FlowLayout.TRAILINGsetMargin(...)installListeners(...)new GTKFCPropertyChangeListener(...)getUIDefaultsInt(...)uninstallListeners(...)GTKFileChooserUI$GTKFCPropertyChangeListenerinstallDefaults(...)getIcon(...)Locale linstallStrings(...)getMnemonic(...)uninstallStrings(...)JScrollPane scrollpanenew JScrollPane(...)new JList<>(...)AccessibleContext.ACCESSIBLE_NAME_PROPERTYsetModel(...)new GTKFileListModel(...)removeSelectionInterval(...)setCellRenderer(...)new FileCellRenderer(...)addListSelectionListener(...)createListSelectionListener(...)addMouseListener(...)createDoubleClickListener(...)setVerticalScrollBarPolicy(...)JScrollPane.VERTICAL_SCROLLBAR_ALWAYSnew DirectoryCellRenderer(...)new GTKDirectoryListModel(...)new GTKDirectoryModel(...)GTKFileChooserUI$GTKDirectoryModelnew Comparator<File>(...) { ... }GTKFileChooserUI$GTKDirectoryModel$1getSystemDisplayName(...)FileSystemView fsv;Comparator<File> fileComparator;GTKFileChooserUI$GTKDirectoryListModelFile curDir;addListDataListener(...)getDirectories(...)fireIntervalAdded(...)getIndex0(...)getIndex1(...)fireIntervalRemoved(...)// whole list has changed.// incremental adjustment values instead of saying that the// PENDING - this is inefficient - should sent outfireContentsChanged(...)// out that everything has changed// PENDING - fire the correct interval changed - currently sendingcreateFileObject(...)getFiles(...)// PENDING - fire the interval changedgetListCellRendererComponent(...)setIcon(...)Dimension prefSizepreferredLayoutSize(...)getLayout(...)prefSize.widthgetPreferredSize(...).widthd.widthprefSize.heightJComponent.LEFT_ALIGNMENTsetAlignmentY(...)JComponent.TOP_ALIGNMENTnew NewFolderAction(...)// DataModel for DirectoryComboxboxnew DirectoryComboBoxModel(...)GTKFileChooserUI$DirectoryComboBoxModel/** Data model for a type-face selection combo-box. */new Vector<File>(...)Vector<File> directories;File selectedDirectory;JFileChooser chooser;File dir/** Adds the directory to the model and sets it to be selected, ... */File canonicalgetParentFile(...)setSelectedItem(...)this.selectedDirectory/** Acts when DirectoryComboBox has changed the selected item. */getSelectedItem(...)/** Creates a new folder. */FilePane.ACTION_NEW_FOLDERString dirNameshowInputDialog(...)JOptionPane.PLAIN_MESSAGEFile newDirshowMessageDialog(...)JOptionPane.ERROR_MESSAGEGTKFileChooserUI$GTKApproveSelectionActionisDirectorySelected(...)getDirectory(...)actionPerformed(...)/** Renames file */FilePane.ACTION_EDIT_FILE_NAMEString newFileNamenew MessageFormat(...)File oldFileFile newFilerenameFile(...)// Renderer for Filter ComboBoxnew FilterComboBoxRenderer(...)/** Render different filters */getDescription(...)// DataModel for Filter Comboboxnew FilterComboBoxModel(...)/** Data model for filter combo-box. */...[] filters;getChoosableFileFilters(...)JFileChooser.CHOOSABLE_FILE_FILTER_CHANGED_PROPERTYJFileChooser.FILE_FILTER_CHANGED_PROPERTYsetFileFilter(...)FileFilter currentFiltergetFileFilter(...)FileFilter filteraddChoosableFileFilter(...)filters.length// we return all selected file names// plus the file name typed into the text field, if not already there// construct the resulting string// PENDING// Ancestor was added, set initial focus// Strip trailing ".."// That's ok, we'll use f as is// Top row of buttons// CurrentDir ComboBox// CENTER: left, right, accessory// SPLIT PANEL: left, right// left panel - Filter & directoryList// Add the Directory List// Create a label that looks like button (should be a table header)// create files list// add the fileName field// Add the filter combo box// Add buttons// Add the current directory to the model, and make it the// selectedDirectory// Get the canonical (full) path. This has the side// benefit of removing extraneous chars from the path,// for example /foo/bar/ becomes /foo/bar// Maybe drive is not ready. Can't abort here.// create File instances of each directory leading up to the top// Ok, use f as is// As SynthComboBoxRenderer's are asked for a size BEFORE they// are parented getName is overriden to force the name to be// ComboBox.renderer if it isn't set. If we didn't do this the// wrong style could be used for size calculations.// Ensure that the current filter is in the list.// NOTE: we shouldnt' have to do this, since JFileChooser adds// the filter to the choosable filters list when the filter// is set. Lets be paranoid just in case someone overrides// setFileFilter in JFileChooser.// This shouldn't happen. Try to recover gracefully.int componentStateString themeNamegetGtkThemeName(...)getRegion(...)shouldShadowText(...)paintText(...)/** Paints text at the specified location. This will not attempt to ... */Region idJComponent sourceisFocusPainted(...)GTKStyle stylegetStyle(...)int focusSizegetClassSpecificIntValue(...)int focusPadint totalFocusbounds.xbounds.ybounds.widthbounds.heightpaintFocus(...)GTKPainter.INSTANCEsynthStateToGTKState(...)SynthConstants.MOUSE_OVER/* Copyright (c) 2002, 2018, Oracle and/or its affiliates. All rights reserved. ... */// We don't need to paint empty strings// Metacity handles painting of text on internal frame title,// ignore this.// The "bounds" parameter encompasses only the actual text;// when drawing the focus, we need to expand that bounding// box by "focus-line-width" plus "focus-padding".  Note that// the layout process for these components will have already// taken these values into account, so there should always// be enough space allocated for drawing the focus indicator.new HashMap<String,DelegatingIcon>(...)int CHECK_ICON_EXTRA_INSET;int DEFAULT_ICON_SPACING;int DEFAULT_ICON_SIZE;int DEFAULT_TOGGLE_MENU_ITEM_SIZE;String RADIO_BUTTON_ICON;// For pre-gtk2.4String CHECK_BOX_ICON;String MENU_ARROW_ICON;String CHECK_BOX_MENU_ITEM_CHECK_ICON;String RADIO_BUTTON_MENU_ITEM_CHECK_ICON;String TREE_EXPANDED_ICON;String TREE_COLLAPSED_ICON;String ASCENDING_SORT_ICON;String DESCENDING_SORT_ICON;String TOOL_BAR_HANDLE_ICON;Map<String,DelegatingIcon> iconsPool;DelegatingIcon resultnew SynthExpanderIcon(...)new ToolBarHandleIcon(...)new MenuArrowIcon(...)new DelegatingIcon(...)// Sort arrow// Radio button// CheckBox// Menus// ToolBar HandleDelegatingIcon diresetIconDimensions(...)GTKIconFactory$DelegatingIconSynthContext.classGraphics.class...[] PARAM_TYPES;Object method;int iconDimension;paintIcon(...)getIconDimension(...)resolveMethod(...)GTKPainter.classgetMethodParamTypes(...)Region regiongetClassSpecificValue(...)getSize2D(...)getFont(...)GTKIconFactory$SynthExpanderIconupdateSizeIfNecessary(...)GTKIconFactory$ToolBarHandleIcon// HandleBox.// we create a unique icon per ToolBar and lookup the style for the// GTK has a separate widget for the handle box, to mirror thisOrientation.classSynthStyle style;JToolBar toolbarOrientation orientationOrientation.HORIZONTALOrientation.VERTICALJToolBar.HORIZONTALgetStyleFactory(...)new SynthContext(...)SynthConstants.ENABLEDGTKIconFactory$MenuArrowIconArrowType.classArrowType arrowDirArrowType.RIGHTArrowType.LEFTimport java.lang.ref.*import DefaultEditorKitimport StateTypeimport UNIXToolkitimport OSInfoimport DefaultLayoutStylegetLanguage(...)getDefault(...)boolean cjkLocaleLocale.CHINESELocale.JAPANESELocale.KOREANboolean isSunDesktopgetOSType(...)GTKLookAndFeel$1SunGraphicsEnvironment.isOpenSolarisnew ReferenceQueue<GTKLookAndFeel>(...)boolean IS_22;boolean IS_3;Object aaTextInfo;/** Whether or not text is drawn antialiased.  This keys off the ... */boolean isSunCJK;/** Solaris, or Linux with Sun JDS in a CJK Locale. ... */boolean gtkAAFontSettingsCond;/* Used to override if system (desktop) text anti-aliasing settings should ... */Font fallbackFont;/** Font to use in places where there is no widget. */boolean inInitialize;/** If true, GTKLookAndFeel is inside the <code>initialize</code> ... */boolean pclInstalled;/** If true, PropertyChangeListeners have been installed for the ... */GTKStyleFactory styleFactory;/** StyleFactory needs to be created only the first time. */String gtkThemeName;/** Cached theme name. Used by GTKGraphicsUtils *//** Returns true if running on system containing at least 2.2. *//** Maps a swing constant to a GTK constant. */SwingConstants.LEFTPositionType.LEFTSwingConstants.RIGHTPositionType.RIGHTSwingConstants.TOPPositionType.TOPSwingConstants.BOTTOMPositionType.BOTTOM/** Maps from Synth state to native GTK state using typesafe enumeration ... */StateType resultSynthConstants.PRESSEDStateType.ACTIVEStateType.PRELIGHTSynthConstants.SELECTEDStateType.SELECTEDSynthConstants.DISABLEDStateType.INSENSITIVEStateType.NORMAL/** Maps from a Synth state to the corresponding GTK state. ... */UIDefaults tablegetDefaults(...)initResourceBundle(...)initSystemColorDefaults(...)initComponentDefaults(...)installPropertyChangeListeners(...)Toolkit kitWeakPCL pclnew WeakPCL(...)flushUnreferenced(...)addResourceBundle(...)Integer zeroObject zeroBordernew SwingLazyValue(...)Object focusBordernew GTKLazyValue(...)GTKStyle.GTKLazyValueObject focusSelectedBorderObject noFocusBorderGTKStyleFactory factoryGTKStyle tableStyleColor tableBggetGTKColor(...)GTKColorType.TEXT_BACKGROUNDColor tableFocusCellBgGTKColorType.BACKGROUNDColor tableFocusCellFgGTKColorType.FOREGROUNDGTKStyle progStyleint progXThicknessgetXThickness(...)int progYThicknessgetYThickness(...)int hProgWidthint hProgHeightint vProgWidthint vProgHeightInteger caretBlinkRateInsets zeroInsetsnew InsetsUIResource(...)Double defaultCaretAspectRatioColor caretColorColor controlTextObject fieldInputMapnew LazyInputMap(...)UIDefaults.LazyInputMapDefaultEditorKit.copyActionDefaultEditorKit.pasteActionDefaultEditorKit.cutActionDefaultEditorKit.selectionBackwardActionDefaultEditorKit.selectionForwardActionDefaultEditorKit.previousWordActionDefaultEditorKit.nextWordActionDefaultEditorKit.selectionPreviousWordActionDefaultEditorKit.selectionNextWordActionDefaultEditorKit.selectAllActionDefaultEditorKit.beginLineActionDefaultEditorKit.endLineActionDefaultEditorKit.selectionBeginLineActionDefaultEditorKit.selectionEndLineActionDefaultEditorKit.deletePrevCharActionDefaultEditorKit.deleteNextCharActionDefaultEditorKit.deleteNextWordActionDefaultEditorKit.deletePrevWordActionDefaultEditorKit.forwardActionDefaultEditorKit.backwardActionJTextField.notifyActionObject passwordInputMapObject editorMarginObject multilineInputMapDefaultEditorKit.upActionDefaultEditorKit.downActionDefaultEditorKit.pageUpActionDefaultEditorKit.pageDownActionDefaultEditorKit.selectionUpActionDefaultEditorKit.selectionDownActionDefaultEditorKit.insertBreakActionDefaultEditorKit.insertTabActionDefaultEditorKit.beginActionDefaultEditorKit.endActionDefaultEditorKit.selectionBeginActionDefaultEditorKit.selectionEndActionclass ...Object[] defaultsnew FontLazyValue(...)GTKLookAndFeel$1FontLazyValuenew UIDefaults.ActiveValue(...) { ... }GTKLookAndFeel$2new DimensionUIResource(...)JTextField.LEADINGnew UIDefaults.LazyValue(...) { ... }GTKLookAndFeel$3GTKLookAndFeel$4UIDefaults.ActiveValuenew AbstractColorChooserPanel[]new GTKColorChooserPanel(...)new TitledBorder(...)GTKPainter.TitledBordergetToolBarHandleIcon(...)getSetting(...)GTKEngine.INSTANCEGTKEngine.Settings.GTK_CURSOR_BLINKGTKEngine.SettingsGTKEngine.Settings.GTK_CURSOR_BLINK_TIMERegion region;this.regiongetDefaultFont(...)putDefaults(...)SwingUtilities2.AA_TEXT_PROPERTY_KEYGTKStyle windowStyleGTKStyle entryStyleObject caretColorGTKStyle menuStyleGTKStyle scrollbarStyleGTKStyle infoStyleGTKStyle desktopStyleGTKStyle widgetStyleColor bgGTKColorType.TEXT_FOREGROUNDGTKStyle.BLACK_COLORGTKColorType.LIGHTGTKColorType.DARKGTKColorType.BLACKGTKColorType.MIDGTKColorType.WHITE/** Creates the GTK look and feel class for the passed in Component. */intern(...)getUIClassID(...)createUI(...)/** Returns the cached gtkThemeName */Toolkit toolkitloadGTK(...)getGtkVersion(...)UNIXToolkit.GtkVersions.GTK2UNIXToolkit.GtkVersionsUNIXToolkit.GtkVersions.GTK3loadStyles(...)isLocalDisplay(...)getAATextInfo(...)SwingUtilities2.AATextInfoReferenceQueue<GTKLookAndFeel> queue;poll(...)GTKLookAndFeel$WeakPCLToolkit kit;String key;this.kitGTKLookAndFeel lnfgetLookAndFeel(...)invokeLater(...)GTKLookAndFeel$WeakPCL$1Window[] appWindowsgetWindows(...)themeChanged(...)resetIcons(...)appWindows.lengthupdateStyles(...)isNativeGTKAvailable(...)// and load the system colors.// Subclassed to pass in false to the superclass, we don't want to tryloadSystemColors(...)getDesktopProperty(...)setStyleFactory(...)getGTKStyleFactory(...)GTKEngine engineObject iconSizesGTKEngine.Settings.GTK_ICON_SIZESObject fontNameFont defaultFontlookupFont(...)configIconSizes(...)GTKEngine.Settings.GTK_FONT_NAMEnew GTKStyleFactory(...)initStyles(...)String[] sizesString[] splitsString sizeString widthString heightsplits.lengthgetIconType(...)GTKStyle.GTKStockIconInfosetIconSize(...)/** Returns whether or not the UIs should update their ... *//** {@inheritDoc} */GnomeLayoutStyle.INSTANCEGTKLookAndFeel$GnomeLayoutStyle/** Gnome layout style.  From: ... */new GnomeLayoutStyle(...)GnomeLayoutStyle INSTANCE;getPreferredGap(...)isLabelAndNonlabel(...)getContainerGap(...)// NOTE: We're currently hard coding to use 2.2.// If we want to support both GTK 2.0 and 2.2, we'll// need to get the major/minor/micro version from the .so.// Refer to bug 4912613 for details.// If the button is SELECTED and is PRELIGHT we need to// make the state MOUSE_OVER otherwise we don't paint the// PRELIGHT.// These Regions treat FOREGROUND as TEXT.// We need to call super for basic's properties file.// SynthTabbedPaneUI supports rollover on tabs, GTK does not// Prevents Synth from setting text AA by itself// For compatibility with apps expecting certain defaults we'll// populate the table with the values from basic.// The following progress bar size calculations come from// gtkprogressbar.c (version 2.8.20), see MIN_* constants and// the gtk_progress_bar_size_request() method./* DefaultEditorKit.unselectAction *//* DefaultEditorKit.toggleComponentOrientation */// These bindings are only enabled when there is a default// button set on the rootpane.// colors specific only for GTK// It is impossible to create a simple GtkWidget without specifying the// type. So for GtkWidget we can use any appropriate concrete type of// wigdet. LABEL in this case./* We need to call loadGTK() to ensure that the native GTK ... *//* Check if system AA font settings should be used. ... */// The property was GC'ed, we're no longer interested in// PropertyChanges, remove the listener.// We are using invokeLater here because we are getting called// on the AWT-Motif thread which can cause a deadlock./* We are listening for GTK desktop text AA settings: ... */// If we are in initialize initializations will be// called later, don't do it now.// Desktop property appears to have preference over rc font.// Checks args// Indent group members 12 pixels to denote hierarchy and// association.// Fall through to related// As a basic rule of thumb, leave space between user// interface components in increments of 6 pixels, going up as// the relationship between related elements becomes more// distant. For example, between icon labels and associated// graphics within an icon, 6 pixels are adequate. Between// labels and associated components, leave 12 horizontal// pixels. For vertical spacing between groups of components,// 18 pixels is adequate.// The first part of this is handled automatically by Icon (which// won't give you 6 pixels).// A general padding of 12 pixels is// recommended between the contents of a dialog window and the// window borders.import ModalExclude// focus-line-pattern://        indicator.// focus-padding: Integer giving padding between border and focus// focus-line-width: Integer giving size of focus border//                       outside border.// interior_focus: Indicates if focus should appear inside border, or// default_outside_border: Insets when default.// Need to support:new PositionType[]new ShadowType[]ShadowType.NONEShadowType.INShadowType.OUTShadowType.ETCHED_INnew GTKPainter(...)...[] POSITIONS;...[] SHADOWS;GTKEngine ENGINE;GTKPainter INSTANCE;isSubregion(...)paintRadioButtonBackground(...)paintRadioButtonMenuItemBackground(...)// FORMATTED_TEXT_FIELDpaintTextBackground(...)// TOOL_BAR_DRAG_WINDOWpaintToolBarBackground(...)// TOOL_BARint stateint orientationpaintCachedImage(...)startPainting(...)paintBox(...)// PASSWORD_FIELD// TEXT_FIELDpaintTreeCellEditorBackground(...)// NOTE: this is called for JCheckBox too// RADIO_BUTTONpaintFlatBox(...)ShadowType.ETCHED_OUTColorType.BACKGROUND// NOTE: this is called for JCheckBoxMenuItem too// RADIO_BUTTON_MENU_ITEMShadowType shadowis2_2(...)// LABELJComponent cpaintButtonBackgroundImpl(...)// INTERNAL_FRAMEpaintFrameBorder(...)Metacity.INSTANCE// DESKTOP_PANEfillArea(...)// DESKTOP_ICONpaintButtonBackground(...)AbstractButton buttonboolean paintBGisContentAreaFilled(...)isBorderPainted(...)boolean paintFocusboolean defaultCapableisDefaultCapable(...)boolean toolButtonboolean interiorFocusgetClassSpecificBoolValue(...)int totalFocusSizeint xThicknessint yThicknessboolean paintBgInsets defaultInsetsgetClassSpecificInsetsValue(...)GTKStyle.BUTTON_DEFAULT_BORDER_INSETSSynthConstants.DEFAULTdefaultInsets.leftdefaultInsets.topdefaultInsets.rightdefaultInsets.bottomShadowType shadowType// ARROW_BUTTONComponent cArrowType arrowTypeString detailArrowType.UPArrowType.DOWNpaintArrow(...)int directionSwingConstants.CENTERint spinStateisEnabled(...)int modyint modh// LISTint shadowdouble scaleFactorscaleColorComponent(...)// MENUpaintMenuItemBackground(...)// This is called for both MENU and MENU_ITEMColor highlightColorGTKEngine.WidgetType.MENU_ITEMGTKEngine.WidgetTypeColor backgroundColorGTKEngine.WidgetType.MENU_BARint minBrightnessint maxBrightnessint minBrightnessDifferenceint actualBrightnessDifferencegetMaxColorDiff(...)int highlightBrightnessint backgroundBrightnessint originalHighlightBrightnessderiveColor(...)boolean isHWgetHeavyweightComponent(...)paintBackground(...)int borderColor cdarker(...)paintShadow(...)JToolBar.Separatorfloat pctSeparator sepDimension sizegetSeparatorSize(...)size.heightsize.widthInsets insetsgetInsets(...)insets.leftinsets.topinsets.rightinsets.bottompaintHline(...)paintVline(...)boolean focusedJSlider sliderdouble mingetMinimum(...)double maxgetMaximum(...)double visibleJSlider.VERTICALsetRangeValue(...)boolean hasFocuspaintSlider(...)// SPINNER// SPLIT_PANE_DIVIDERJSplitPane splitPanepaintHandle(...)paintSplitPaneDividerForeground(...)JTabbedPane paneint selectedIndexgetSelectedIndex(...)PositionType placementSwingOrientationConstantToGTK(...)getTabPlacement(...)int gapStartint gapSizeRectangle tabBoundsgetBoundsAt(...)tabBounds.xtabBounds.widthtabBounds.ytabBounds.heightpaintBoxGap(...)int placementPositionType sidepaintExtension(...)// TEXT_PANEpaintTextAreaBackground(...)// EDITOR_PANE// TEXT_AREA// too.// NOTE: Combobox and Label, Password and FormattedTextField calls thisContainer containerParentColorType.TEXT_BACKGROUND// ROOT_PANE// TOGGLE_BUTTONJToggleButton toggleButton// SCROLL_BARint troughBorder// SCROLL_BAR_THUMBJScrollBar sbboolean rtlgetVisibleAmount(...)// TOOL_TIP// TREE_CELL// TREE// VIEWPORT// All icon painting methods are called from under GTK_LOCKpaintExpander(...)ExpanderStyle.EXPANDEDExpanderStyle.COLLAPSEDGTKIconFactory.DEFAULT_ICON_SIZEGTKIconFactory.DEFAULT_ICON_SPACINGpaintCheck(...)paintOption(...)GTKIconFactory.DEFAULT_TOGGLE_MENU_ITEM_SIZEGTKIconFactory.CHECK_ICON_EXTRA_INSET/* Fill an area with color determined from this context's Style using the ... */isOpaque(...)GTKPainter$ListTableFocusBorder// Refer to GTKLookAndFeel for details on this.boolean selectedCell;boolean focusedCell;new ListTableFocusBorder(...)this.selectedCellthis.focusedCellSynthContext contextComponentUI uigetUI(...)GTKPainter$TitledBorder// TitledBorder implementation for GTK L&FGTKEngine.CustomRegion.TITLED_BORDERGTKEngine.CustomRegion/* If the label is a ListCellRenderer and it's in a container ... */// Does not call into ENGINE for better performance// Paint the default indicator// Render the box.// Toolbar buttons should only have their background painted// in the PRESSED, SELECTED, or MOUSE_OVER states.// Otherwise, always paint the button's background, unless// the user has overridden it and we're in the ENABLED state.// focus/* The ubuntulooks engine (and presumably others) expect us to ... */// fix no menu borders in Adwaita theme// Note that we don't call paintCachedImage() here.  Since the// progress bar foreground is painted differently for each value// it would be wasteful to try to cache an image for each state,// so instead we simply avoid caching in this case.// don't bother caching the image/* Note: In theory, the style's x/y thickness values would determine ... *//* GTK renders toolbar separators differently in that an ... */// For regular/menu separators, we simply subtract out the insets.// For focused sliders, we paint focus rect outside the bounds passed.// Need to adjust for that.// The ubuntulooks engine paints slider troughs differently depending// on the current slider value and its component orientation.// not used for sliders; any value will work// Note that we don't call paintCachedImage() here.  Since some// engines (e.g. ubuntulooks) paint the slider background// differently for any given slider value, it would be wasteful// to try to cache an image for each state, so instead we simply// avoid caching in this case.// This is handled in paintTextFieldBackground// Text is odd in that it uses the TEXT_BACKGROUND vs BACKGROUND.// Note: the scrollbar insets already include the "trough-border",// which is needed to position the scrollbar buttons properly.// But when we render, we need to take the trough border out// of the equation so that we paint the entire area covered by// the trough border and the scrollbar content itself.// The clearlooks engine paints scrollbar thumbs differently// depending on the current scroll value (specifically, it will avoid// rendering a certain line when the thumb is at the starting or// ending position).  Therefore, we normalize the current value to// the range [0,100] here and then pass it down to setRangeValue()// so that the native widget is configured appropriately.  Note that// there are really only four values that matter (min, middle, max,// or fill) so we restrict to one of those four values to avoid// blowing out the image cache.// In this case, the thumb fills the entire track, so it is// touching both ends at the same time// At minimum// At maximum// Somewhere in between// the string arg should alternate based on row being painted,// but we currently don't pass that in.// As far as I can tell, these don't call into the ENGINE.// Also note that you don't want this to call into the ENGINE// as if it where to paint a background JViewport wouldn't scroll// The orientation parameter passed down by Synth refers to the// orientation of the toolbar, but the one we pass to GTK refers// to the orientation of the handle.  Therefore, we need to swap// the value here: horizontal toolbars have vertical handles, and// vice versa.import Region/** A typesafe enumeration of the distinct rendering portions specific ... */new GTKRegion(...)Region HANDLE_BOX;import SynthIconimport WidgetTypenew FontUIResource(...)Font.PLAINnew GTKGraphicsUtils(...)UNIXToolkit tknew HashMap<String,String>(...)new HashMap<String,GTKStockIcon>(...)new GTKStockIcon(...)checkGtkVersion(...)String ICON_PROPERTY_PREFIX;Color BLACK_COLOR;Color WHITE_COLOR;Font DEFAULT_FONT;Insets BUTTON_DEFAULT_BORDER_INSETS;GTKGraphicsUtils GTK_GRAPHICS;Map<String,String> CLASS_SPECIFIC_MAP;/** Maps from a key that is passed to Style.get to the equivalent class ... */Map<String,GTKStockIcon> ICONS_MAP;/** Backing style properties that are used if the style does not ... */Font font;/** The font used for this particular style, as determined at ... */int widgetType;/** Widget type used when looking up class specific values. */int xThickness, ...;/** The x/y thickness values for this particular style. */String pangoFontNameFont pangoFontthis.widgetTypenativeGetXThickness(...)nativeGetYThickness(...)nativeGetPangoFontName(...)this.fontGTKLookAndFeel.aaTextInfo/** Returns a <code>SynthPainter</code> that will route the appropriate ... */ColorType.FOCUSColorType.TEXT_FOREGROUNDColorType.FOREGROUNDgetStyleSpecificColor(...)/** Returns color specific to the current style. This method is ... */nativeGetColorForState(...)/** Returns the color for the specified state. ... */Color fggetForeground(...)getColorForState(...)Font propFont/** Returns the X thickness to use for this GTKStyle. ... *//** Returns the Y thickness to use for this GTKStyle. ... *//** Returns the Insets. If <code>insets</code> is non-null the resulting ... */JComponent componentgetSimpleInsets(...)getButtonInsets(...)getRadioInsets(...)getMenuBarInsets(...)getMenuItemInsets(...)getTextFieldInsets(...)getBorderInsets(...)getThicknessInsets(...)getScrollBarInsets(...)getSliderTrackInsets(...)getTabbedPaneTabInsets(...)getSeparatorInsets(...)int CHILD_SPACINGComponent component/* This is used for both RADIO_BUTTON and CHECK_BOX. */int internalPaddingint horizPaddingint pad// NOTE: this is called for ComboBox, and FormattedTextField alsoint spacingisFocusable(...)/** Returns the value for a class specific property for a particular ... */nativeGetClassValue(...)/** Convenience method to get a class specific integer value for ... *//** Returns the value for a class specific property. A class specific value ... *//** Convenience method to get a class specific integer value. ... *//** Convenience method to get a class specific Insets value. ... *//** Convenience method to get a class specific Boolean value. ... *//** Returns the value to initialize the opacity property of the Component ... */String classKeyGTKStockIcon stockIconJSeparator sepboolean horizWidgetType wtint sliderWidthint stepperSizeint arrowSizegetFontSize(...)int indicatorSpacingint focusLineWidthTextDirection directionIcon icongetStyleSpecificIcon(...)new ImageIcon(...)getStockIcon(...)GTKStyle$GTKStockIconInfoMap<String,Integer> ICON_TYPE_MAP;Object ICON_SIZE_KEY;AppContext appContextDimension[] iconSizes/** Return the size of a particular icon type (logical size) ... */getIconSizesMap(...)iconSizes.length/** Change icon size in a type to size mapping. This is called by code ... *//** Return icon type (GtkIconSize value) given a symbolic name which can ... */Integer ninitIconTypeMap(...)new HashMap<String,Integer>(...)GTKStyle$GTKStockIcon/** An Icon that is fetched using getStockIcon. */boolean loadedLTR;boolean loadedRTL;Icon ltrIcon;Icon rtlIcon;this.sizegetIconWidth(...)getIconHeight(...)SynthStyle stylethis.styleGTKStyle$GTKLazyValue/** GTKLazyValue is a slimmed down version of <code>ProxyLaxyValue</code>. ... *//** Name of the class to create. */String methodName;this.methodNameMethod m// For the enabled state, prefer the widget's colors// If getForeground returns a non-UIResource it means the// developer has explicitly set the foreground, use it over// that of TEXT_FOREGROUND as that is typically the expected// behavior.// if font property got a value then return it// The following calculations are derived from gtkbutton.c// (GTK+ version 2.8.20), gtk_button_size_allocate() method.// Include the default border insets, but only for JButtons// that are default capable.  Note that// JButton.getDefaultCapable() returns true by default, but// GtkToolButtons are never default capable, so we skip this// step if the button is contained in a toolbar.// The following calculations are derived from gtkcheckbutton.c// (GTK+ version 2.8.20), gtk_check_button_size_allocate() method.// Note: GTKIconFactory.DelegateIcon will have already included the// "indicator-spacing" value in the size of the indicator icon,// which explains why we use zero as the left inset (or right inset// in the RTL case); see 6489585 for more details.// The following calculations are derived from gtkmenubar.c// (GTK+ version 2.8.20), gtk_menu_bar_size_allocate() method.// The following calculations are derived from gtkmenuitem.c// (GTK+ version 2.8.20), gtk_menu_item_size_allocate() method.// This scrollbar is part of a scrollpane; use only the// "scrollbar-spacing" style property to determine the padding// between the scrollbar and its parent scrollpane.// This is a standalone scrollbar; leave enough room for the// focus line in addition to the trough border.// See if this is a class specific value.//This is a workaround as the "slider-length" property has been//deprecated for GtkScale from gtk 3.20, so default value of 31//is used and makes redering of slider wrong. Value 14 is being//used as default value for Slider.thumbHeight is 14 and making//width 14 as well makes slider thumb render in proper shape// Is it a specific value ?//This is a workaround as the "min-slider-length" property has been//deprecated for GtkScrollBar from gtk 3.20, so default value of 21//is used and makes ScrollBar thumb very small. Value 40 is being//used as this is the value mentioned in css files// Believe it or not, the size of a spinner arrow button is// dependent upon the size of the spinner's font.  These// calculations come from gtkspinbutton.c (version 2.8.20),// spin_button_get_arrow_size() method.// For all other kinds of arrow buttons (e.g. combobox arrow// buttons), we will simply fall back on the value of// ArrowButton.size as defined in the UIDefaults for// GTKLookAndFeel when we call UIManager.get() below...// The iconTextGap value needs to include "indicator-spacing"// and it also needs to leave enough space for the focus line,// which falls between the indicator icon and the text.// See getRadioInsets() and 6489585 for more details.// Is it a stock icon ?// Is it another kind of value ?// For backward compatibility we'll fallback to the UIManager.// We don't go to the UIManager for engine as the engine is GTK// specific.// Don't call super, we don't want to pick up defaults from// SynthStyle.// First try loading a theme-specific icon using the native// GTK libraries (native GTK handles the resizing for us).// In a failure case where native GTK (unexpectedly) returns a// null icon, we can try loading a default icon as a fallback.// In an extreme failure situation, just return null (callers are// already prepared to handle a null icon, so the worst that can// happen is that an icon won't be included in the button/dialog).// GTK_ICON_SIZE_INVALID// GTK_ICON_SIZE_MENU// GTK_ICON_SIZE_SMALL_TOOLBAR// GTK_ICON_SIZE_LARGE_TOOLBAR// GTK_ICON_SIZE_BUTTON// GTK_ICON_SIZE_DND// GTK_ICON_SIZE_DIALOG//check whether the gtk version is >= 3.10 as the Icon names were//changed from this versionimport FontMap<Object,GTKStyle> stylesCache;/** Saves all styles that have been accessed.  In most common cases, ... */Font defaultFont;new HashMap<Object,GTKStyle>(...)/** Returns the <code>GTKStyle</code> to use based on the ... */GTKStyle resultboolean spboolean ltrboolean focusablenew ComplexKey(...)JButton btnisTopLevelMenu(...)new GTKStyle(...)this.defaultFontGTKStyleFactory$ComplexKey/** Represents a hash key used for fetching GTKStyle objects from the ... */WidgetType wt;this.wtObject argComplexKey thatthat.wtthat.argsthis.args.lengththat.args.lengthObject a1Object a2// The style/insets of a scrollbar can depend on a number of// factors (see GTKStyle.getScrollBarInsets()) so use a// complex key here.// The style/insets of a checkbox or radiobutton can depend// on the component orientation, so use a complex key here.// The style/insets of a button can depend on whether it is// default capable or in a toolbar, so use a complex key here.// Otherwise, just use the WidgetType as the key.import java.awt.geom.*import java.net.*import javax.xml.parsers.*import SAXExceptionimport org.w3c.dom.*new TitlePaneLayout(...)new ColorizeImageFilter(...)new ArithmeticExpressionEvaluator(...)new HashMap<String,Image>(...)getUserTheme(...)new Metacity(...)FileNotFoundException exParserConfigurationException exSAXException exMetacity INSTANCE;// http://art.gnome.org/theme_list.php?category=metacity// Themes:// http://developer.gnome.org/doc/tutorials/metacity/metacity-themes.html// Tutorial:...[] themeNames;boolean errorLogged;DocumentBuilder documentBuilder;Document xmlDoc;String userHome;Node frame_style_set;Map<String,Object> frameGeometry;Map<String,Map<String,Object>> frameGeometries;LayoutManager titlePaneLayout;ColorizeImageFilter imageFilter;URL themeDir;SynthContext context;String themeName;ArithmeticExpressionEvaluator aee;Map<String,Integer> variables;RoundRectClipShape roundedClipShape;// Reusable clip shape objectNodeList nodesthis.themeNamegetThemeDir(...)URL themeURLgetXMLDoc(...)new FileNotFoundException(...)getStringAttr(...)NumberFormatException exnew HashMap<String,Map<String,Object>>(...)HashMap<String,Object> gmString parentGMNodeList childNodesint ncputAll(...)getBooleanAttr(...)getNodeType(...)Node.ELEMENT_NODEgetIntAttr(...)getFloatAttr(...)INSTANCE.titlePaneLayoutnew RoundRectClipShape(...)setRoundedRect(...)JButton buttonString buttonNameint buttonStateJComponent titlePaneContainer titlePaneParentJInternalFrame jifboolean activeisSelected(...)String stateString functionString locationboolean left_cornerboolean right_cornerNode framegetNode(...)isMaximum(...)updateFrameGeometry(...)this.contextgetInternalFrame(...)int nButtonsisIconifiable(...)isMaximizable(...)isClosable(...)Node frame_styleShape oldClipgetClip(...)Point buttonLocRectangle clipBoundssetClip(...)getRoundedClipShape(...)RoundRectClipShape.TOP_RIGHTRoundRectClipShape.TOP_LEFTclipRect(...)clipBounds.xclipBounds.yclipBounds.widthclipBounds.heightdrawButton(...)Node buttonNodeNode draw_opsString draw_ops_namedraw(...)findChild(...)Font oldFontRectangle titleRectcalculateTitleArea(...)JComponent menuButtonIcon frameIcongetFrameIcon(...)FontMetrics fmgetFontMetrics(...)setFont(...)calculateTitleTextWidth(...)getAscent(...)getDescent(...)boolean roundTopLeftboolean roundTopRightboolean roundBottomLeftboolean roundBottomRightint titleHeightboolean minimizedisIcon(...)int leftTitlebarEdgeint rightTitlebarEdgeint topTitlebarEdgeint bottomTitlebarEdgeRoundRectClipShape.BOTTOM_LEFTRoundRectClipShape.BOTTOM_RIGHTdrawPiece(...)titleRect.xtitleRect.ytitleRect.widthtitleRect.heightMetacity$Privilegedint GET_THEME_DIR;int GET_USER_THEME;int GET_IMAGE;Object arg;this.argString sepString[] dirsURL themeDirdirs.lengthtoURL(...)toURI(...)MalformedURLException exString filenamegetResource(...)String themeReader readeropenStream(...)StringBuffer strBufString strLowerCaseint i2new Privileged(...)Privileged.GET_THEME_DIRPrivileged.GET_USER_THEMEGraphics2D g2Composite oldCompgetComposite(...)int swint shfloat falphas.lengthfloat alphaint swmsetComposite(...)AlphaComposite.SRC_OVERHashMap<String,Image> images;colorize(...)Privileged.GET_IMAGEMetacity$ColorizeImageFilterdouble cr, ...;ImageProducer producernew FilteredImageSource(...)createImage(...)double grayLeveldouble rdouble gdouble bminimumLayoutSize(...)JInternalFrame frameDimension buttonDimcalculateButtonSize(...)Insets title_bordergetFrameGeometry(...)Insets button_borderbuttonDim.widthString frameTitlegetTitle(...)int title_wstringWidth(...)int title_lengthint buttonHeightbuttonDim.heighttitle_border.lefttitle_border.rightint subtitle_wtitle_border.toptitle_border.bottombutton_border.topbutton_border.bottomMap<> gmJComponent minimizeButtonJComponent maximizeButtonJComponent closeButtonbutton_border.rightbutton_border.left// end TitlePaneLayoutthis.frameGeometryInteger iBoolean bparseColor(...)int start_angleint extent_angleboolean filledfillArc(...)drawArc(...)int x1int y1int x2int y2int lineWidthGraphics2D g2dStroke strokegetStroke(...)setStroke(...)new BasicStroke(...)drawRect(...)int x0int y0int twint thclip(...)AlphaComposite acString colorStrString titleclipStringIfNecessary(...)calculateTitleArea(...).widthdrawString(...)int buttonWidthFloat aspect_ratioRectangle rr.xr.yr.heightr.widthString arrowString shadowString stateStrArrowType directionpaintMetacityElement(...)Node[] colorNodesgetNodesByName(...)Color[] colorsnew Color[]colorNodes.lengthboolean horizontalboolean verticalcolors.lengthsetPaint(...)new GradientPaint(...)String colorizeStrColor colorizeString alphaImage objectString fill_typefloat[] alphastileImage(...)float aint oldWidthint oldHeightdrawInclude(...)drawGradient(...)drawGTKArrow(...)drawGTKBox(...)drawGTKVLine(...)drawIcon(...)drawRectangle(...)drawTint(...)drawTile(...)drawTitle(...)Node piece(...).topNode windowsetFrameGeometry(...)// XML Parsingnew PrivilegedAction<InputStream>(...) { ... }Metacity$1Document docnewDocumentBuilder(...)ArrayList<Node> listnew ArrayList<Node>(...)new Node[]String inheritFromNode inheritFromNodegetParentNode(...)NamedNodeMap nodeAttrsboolean matchesint nAttrsattrs.lengthString aNameString aValueNode itemparseColor2(...)adjustColor(...)int i1String typeStrColorType typeparseColorString(...).../=...lookupColor(...)Metacity$ArithmeticExpressionEvaluatorPeekableStringTokenizer tokenizer;new PeekableStringTokenizer(...)expression(...)getTermValue(...)float value2getFactorValue(...)...%=...Metacity$PeekableStringTokenizerString token;String tMetacity$RoundRectClipShapeint TOP_LEFT;int TOP_RIGHT;int BOTTOM_LEFT;int BOTTOM_RIGHT;int arcwidth;int archeight;int corners;this.cornersthis.xthis.ythis.arcwidththis.archeightnew RoundishRectIterator(...)Metacity$RoundRectClipShape$RoundishRectIteratornew double[][]double x, ...;AffineTransform affine;...[] ctrlpts;...[] types;double a;double b;double c;double cv;double acv;...[] CtrlPtTemplate;//                  y + v2 * h + v3 * arcHeight);//         point = (x + v0 * w + v1 * arcWidth,//     4 values for each point {v0, v1, v2, v3}:// For each array:...[] CornerFlags;this.wthis.hthis.awgetArcWidth(...)this.ahgetArcHeight(...)this.affineint cornersgetCornerFlags(...)int numedgesctrlpts.lengthdouble[] ctrlsisDone(...)ctrls.lengthtransform(...)// Initialize constants// Ignore bad value// Cache frame geometries// These don't seem to apply here, but the Galaxy theme uses them. Not sure why.// Debian/Redhat/Solaris// SuSE// System property may not be set so skip null directories.// Set userHome here because we need the privilege// Note: this is a small file (< 1024 bytes) so it's not worth// starting an XML parser or even to use a buffered reader.// Pending: verify character encoding spec for gconf// OK to just ignore. We'll use a fallback theme.//log("Bad image url: "+ themeDir + "/" + key);// Assume all rgb values are shades of gray// Calculate width.// Leave room for three characters in the title.// Calculate height.// Get colors from child nodes// ElementNode// skip right paren// Not called/* BOTTOM LEFT corner *//* BOTTOM LEFT arc start *//* BOTTOM LEFT arc curve *//* BOTTOM RIGHT corner *//* BOTTOM RIGHT arc start *//* BOTTOM RIGHT arc curve *//* TOP RIGHT corner *//* TOP RIGHT arc start *//* TOP RIGHT arc curve *//* TOP LEFT corner *//* TOP LEFT arc start *//* TOP LEFT arc curve *//* Closing path element */// Don't draw anything...// 4xCORNER_POINT, CLOSE// Add one for each corner that has a curveimport AffineTransformimport FontUIResourceimport FontConfigManagerimport FontUtilitiesGraphicsEnvironment gegetLocalGraphicsEnvironment(...)isHeadless(...)GraphicsConfiguration gcgetDefaultConfiguration(...)getDefaultScreenDevice(...)AffineTransform atgetNormalizingTransform(...)getScaleY(...)String CHARS_DIGITS;double fontScale;/** Calculate a default scale factor for fonts in this L&F to match ... *//** Parses a String containing a pango font description and returns ... */String familyint styleStringTokenizer tokdouble dsizeint dpiString fcFamilyLCString wordFont.ITALICFont.BOLDmapFcName(...)Font fontgetFontConfigFUIR(...)deriveFont(...)new Font(...)FontUIResource fuirgetCompositeFontUIResource(...)/* Java 2D font point sizes are in a user-space scale of 72dpi. ... *//* 50 dpi is the minimum value gnome allows *//* The Java rasteriser assumes pts are in a user space of ... *//* If there's no property, GTK scales for the resolution ... *//* Round size to nearest integer pt size *//* family is a Fc/Pango logical font which we need to expand. *//* It's a physical font which we will create with a fallback *//* a roundabout way to set the font size in floating points */new XColor(...)new XColor[]XColors$XColorthis.redthis.greenthis.blueXColor otherXColor key;binarySearch(...)key.nametoColor(...)...[] colors;import FontMetricsimport Insets/** Factory object that can vend Icons appropriate for the basic L & F. ... */MotifBorders$BevelBorderColor darkShadow;Color lightShadow;boolean isRaised;this.isRaisedthis.darkShadowthis.lightShadowMotifBorders$FocusBorderColor focus;Color control;this.controlthis.focusColor shadow;Color highlight;this.shadowthis.highlightboolean isPressedboolean canBeDefaultboolean isDefaultint bx1int by1int bx2int by2AbstractButton bButtonModel modelisArmed(...)isPressed(...)isDefaultButton(...)int thicknessdrawBezel(...)JMenuBar menuBarMotifBorders$FrameBorderJComponent jcomp;Color frameHighlight;Color frameColor;Color frameShadow;int BORDER_SIZE;// The width of the border/** Constructs an FrameBorder for the JComponent <b>comp</b>. *//** Sets the FrameBorder's JComponent. *//** Returns the FrameBorder's JComponent. ... *//** Draws the FrameBorder's top border. */Rectangle titleBarRectintersects(...)getClipBounds(...)/** Draws the FrameBorder's left border. */Rectangle borderRectgetBorderInsets(...).left/** Draws the FrameBorder's right border. */getBorderInsets(...).right/** Draws the FrameBorder's bottom border. */int marginHeightgetBorderInsets(...).bottom// Returns true if the associated component has focus./** Draws the FrameBorder in the given Rect.  Calls ... */isActiveFrame(...)brighter(...)drawTopBorder(...)drawLeftBorder(...)drawRightBorder(...)drawBottomBorder(...)MotifBorders$InternalFrameBorderJInternalFrame frame;int CORNER_SIZE;// The size of the bounding box for Motif frame corners./** Constructs an InternalFrameBorder for the InternalFrame ... *//** Sets the InternalFrameBorder's InternalFrame. *//** Returns the InternalFrameBorder's InternalFrame. ... *//** Returns the width of the InternalFrameBorder's resize controls, ... */isResizable(...)FrameBorder.BORDER_SIZE/** Draws the InternalFrameBorder's top border. */getFrameShadow(...)getFrameHighlight(...)/** Draws the InternalFrameBorder's left border. */int topYint bottomY/** Draws the InternalFrameBorder's right border. *//** Draws the InternalFrameBorder's bottom border. */// Returns true if the associated internal frame has focus.Color oldColorColor shadowColor;Color highlightColor;int TEXT_SPACING;// Space between the border and textint GROOVE_HEIGHT;// Space for the separator under the title/** Creates a MotifPopupMenuBorder instance */this.backgroundthis.foregroundthis.shadowColorthis.highlightColor/** Paints the border for the specified component with the ... */Font origFontColor origColorJPopupMenu popupgetLabel(...)int fontHeightint descentint ascentPoint textLocint stringWidthtextLoc.ytextLoc.xdrawGroove(...)/** Reinitialize the insets parameter with this Border's current Insets. ... *//* Copyright (c) 1997, 2010, Oracle and/or its affiliates. All rights reserved. ... */// top// bottom// this draws the MenuBar border// Draw frame// Draw highlights// Draw shadows// inner border// inner 3D border// black drop shadow  __|import javax.swing.plaf.basic.*/** Button Listener ... *//* Copyright (c) 1997, 2001, Oracle and/or its affiliates. All rights reserved. ... *//** MotifButton implementation ... */Color selectColor;boolean defaults_initialized;Object MOTIF_BUTTON_UI_KEY;// ********************************//          Create PLAFMotifButtonUI motifButtonUInew MotifButtonUI(...)//         Create Listenersnew MotifButtonListener(...)//          Install DefaultsgetPropertyPrefix(...)installProperty(...)uninstallDefaults(...)//          Default Accessors//          Paint MethodsfillContentArea(...)paint(...)// Overridden to ensure we don't paint icon over button borders.Rectangle newClipgetInteriorRectangle(...)getBorder(...)computeIntersection(...)Insets margingetMargin(...)margin.leftmargin.topmargin.rightmargin.bottom// focus painting is handled by the borderimport BasicButtonListenerimport BasicCheckBoxMenuItemUI/** MotifCheckboxMenuItem implementation ... */ChangeListener changeListener;new MotifCheckBoxMenuItemUI(...)createChangeListener(...)removeChangeListener(...)new ChangeHandler(...)JMenuItem cnew MouseInputHandler(...)MenuSelectionManager managerdefaultManager(...)setSelectedPath(...)JMenuItem menuItemclearSelectedPath(...)doClick(...)processMouseEvent(...)/* Copyright (c) 1997, 2006, Oracle and/or its affiliates. All rights reserved. ... *//** MotifCheckBox implementation ... */Object MOTIF_CHECK_BOX_UI_KEY;String propertyPrefix;//         Create PLAFMotifCheckBoxUI motifCheckBoxUInew MotifCheckBoxUI(...)//          Defaults/* Copyright (c) 1997, 1998, Oracle and/or its affiliates. All rights reserved. ... *//** ComboBox motif look and feel ... */Icon arrowIcon;int HORIZ_MARGIN;new MotifComboBoxUI(...)Runnable initCodeMotifComboBoxUI$1motifGetEditor(...)new MotifComboBoxArrowIcon(...)int buttonSizeiconAreaWidth(...)getDisplaySize(...)new MotifComboPopup(...)/** Overriden to empty the MouseMotionListener. *//** Motif combo popup should not track the mouse in the list. */new MouseMotionAdapter(...) { ... }MotifComboBoxUI$MotifComboPopup$1createKeyListener(...)BasicComboPopup.InvocationKeyHandlerMotifComboPopup.thisisEditable(...)addEditor(...)removeEditor(...)rectangleForCurrentValue(...)paintCurrentValue(...)rectangleForArrowIcon(...)Border borderInsets inin.topgetBounds(...).heightin.bottomListCellRenderer<> renderergetRenderer(...)setForeground(...)Rectangle bb.xin.leftb.yb.widthin.rightb.heightconfigureEditor(...)new ComboBoxLayoutManager(...)/** This inner class is marked &quot;public&quot; due to a compiler bug. ... */BasicComboBoxUI.ComboBoxLayoutManagerMotifComboBoxUI.thisRectangle cvbcvb.xcvb.ycvb.widthcvb.heightMotifComboBoxUI$MotifComboBoxArrowIconColor fill;this.fill/** {@inheritDoc} ... */new MotifPropertyChangeListener(...)MotifComboBoxUI$MotifPropertyChangeListener/** This class should be made &quot;protected&quot; in future releases. */BasicComboBoxUI.PropertyChangeHandlerString propertyNamepropertyChange(...)Component editor// Draw the separationimport EventListenerimport AWTAccessorimport MouseEventAccessor/** Motif rendition of the component. ... */Font.SANS_SERIFDesktopIconActionListener desktopIconActionListener;DesktopIconMouseListener desktopIconMouseListener;Icon defaultIcon;IconButton iconButton;IconLabel iconLabel;MotifInternalFrameTitlePane sysMenuTitlePane;// we can remove its listeners.// This is only used for its system menu, but we need a reference to it soJPopupMenu systemMenu;EventListener mml;int LABEL_HEIGHT;int LABEL_DIVIDER;Font defaultTitleFont;// padding between icon and labelnew MotifDesktopIconUI(...)MotifBorders.FrameBorderFrameBorder bordernew FrameBorder(...)setDefaultIcon(...)createIconButton(...)new MotifInternalFrameTitlePane(...)getSystemMenu(...)createIconLabel(...)validate(...)putLayer(...)getLayer(...)createDesktopIconActionListener(...)createDesktopIconMouseListener(...)show(...)getDesktopIcon(...)new IconLabel(...)new IconButton(...)new DesktopIconActionListener(...)new DesktopIconMouseListener(...)removeActionListener(...)removeMouseListener(...)JInternalFrame iframegetBorderInsets(...).topgetMinimumSize(...)/** Returns the default desktop icon. *//** Sets the icon used as the default desktop icon. */MotifDesktopIconUI$IconLabelthis.frameaddMouseMotionListener(...)new MouseMotionListener(...) { ... }MotifDesktopIconUI$IconLabel$1forwardEventToParent(...)new MouseListener(...) { ... }MotifDesktopIconUI$IconLabel$2MouseEvent newEventnew MouseEvent(...)getWhen(...)getXOnScreen(...)getYOnScreen(...)isPopupTrigger(...)MouseEvent.NOBUTTONMouseEventAccessor meAccessorgetMouseEventAccessor(...)setCausedByTouchEvent(...)isCausedByTouchEvent(...)dispatchEvent(...)Color shadowMotifDesktopIconUI$IconButtonIcon icon;this.iconMotifDesktopIconUI$IconButton$1MotifDesktopIconUI$IconButton$2isShowing(...)// if we drag or move we should deengage the popupgetFrame(...)PropertyVetoException e2endDraggingFrame(...)getDesktopManager(...)getDesktopPane(...)/* Copyright (c) 1997, 2005, Oracle and/or its affiliates. All rights reserved. ... */// An underhanded way of creating a system popup menu.// Forward mouse events to titlebar for moves.// touch-up frame// fill background// draw text -- clipping to truncate text like CDE/Motif/* the mouse release will not get reported correctly, ... *//// DesktopPaneUI methodsnew MotifDesktopPaneUI(...)new MotifDesktopManager(...)setDesktopManager(...)adjustIcons(...)MotifDesktopPaneUI$DragPane///////////////////////////////////////////////////////////////////////////////////////  DragPane classColor.darkGrayMotifDesktopPaneUI$MotifDesktopManager///  MotifDesktopManager classJComponent dragPane;boolean usingDragPane;JLayeredPane layeredPaneForDragPane;int iconWidth, ...;// PENDING(klobad) this should be optimizedboolean didResizecomputeUnion(...)new DragPane(...)setLayer(...)setBoundsForFrame(...)adjustBoundsForIcon(...)JLayeredPane pJDesktopIcon iconiconifyFrame(...)/** Change positions of icons in the desktop pane so that ... */new JDesktopIcon(...)new JInternalFrame(...)Dimension iconSizeJInternalFrame[] framesgetAllFrames(...)iconSize.widthiconSize.heightframes.lengthPoint ipip.xip.y/** Change positions of icon so that it doesn't overlap ... */JDesktopPane cint maxyint lxint ygapint lygetIconAt(...)JDesktopIcon currentIconComponent[] componentsgetComponents(...)// We need to know Motif icon size/* Fix for disappearing icons. If the y value is maxy then this ... *//* Compute the offset for the cell we are trying to go in. *//* How far are we into the cell we dropped the icon in. *//* Set coordinates for the icon. *//* Cancel the move if the x value was moved off screen. *//// END of MotifDesktopManagerimport javax.swing.text.*import BasicEditorPaneUI/** Provides the look and feel for an pluggable content-type text editor. ... *//** Creates a UI for the JTextPane. ... */new MotifEditorPaneUI(...)/** Creates the object to use for a caret.  By default an ... */createCaret(...)import MouseAdapterimport MouseEvent/** Motif FileChooserUI. ... */JList<File> directoryList;JList<File> fileList;JTextField pathField;JComboBox<FileFilter> filterComboBox;JTextField filenameTextField;Dimension hstrut10;Insets insets;Dimension WITH_ACCELERATOR_PREF_SIZE;Dimension PREF_ACC_SIZE;JPanel bottomPanel;JButton approveButton;String enterFolderNameLabelText;int enterFolderNameLabelMnemonic;String enterFileNameLabelText;int enterFileNameLabelMnemonic;JLabel fileNameLabel;fileNameString(...)new PropertyChangeListener(...) { ... }MotifFileChooserUI$1JFileChooser.SELECTED_FILE_CHANGED_PROPERTYJFileChooser.SELECTED_FILES_CHANGED_PROPERTYJFileChooser.DIRECTORY_CHANGED_PROPERTYgetDirectoryName(...)JFileChooser.FILE_SELECTION_MODE_CHANGED_PROPERTYpopulateFileNameLabel(...)JFileChooser.MULTI_SELECTION_ENABLED_CHANGED_PROPERTYJFileChooser.ACCESSORY_CHANGED_PROPERTYJFileChooser.APPROVE_BUTTON_TEXT_CHANGED_PROPERTYJFileChooser.APPROVE_BUTTON_TOOL_TIP_TEXT_CHANGED_PROPERTYJFileChooser.DIALOG_TYPE_CHANGED_PROPERTYgetApproveButtonText(...)getApproveButtonToolTipText(...)JFileChooser.CONTROL_BUTTONS_ARE_SHOWN_CHANGED_PROPERTYComponentOrientation oJFileChooser ccapplyComponentOrientation(...)new MotifFileChooserUI(...)new JPanel(...) { ... }MotifFileChooserUI$2JLabel lJScrollPane spJPanel rightPanelJPanel buttonPanelJButton updateButtonnew JButton(...) { ... }MotifFileChooserUI$7MAX_SIZE.widthMotifFileChooserUI$8JButton helpButtonMotifFileChooserUI$9setInheritsPopupMenu(...)MotifFileChooserUI$3getUpdateAction(...)BoxLayout.LINE_AXISnew JComboBox<FileFilter>(...) { ... }MotifFileChooserUI$4setFocusable(...)getVerticalScrollBar(...)getHorizontalScrollBar(...)getView(...)getViewport(...)MotifFileChooserUI$5getBottomPanel(...)createGlue(...)MotifFileChooserUI$6getApproveButtonMnemonic(...)new JList<File>(...)new MotifFileListModel(...)new MouseAdapter(...) { ... }MotifFileChooserUI$10loc2IndexFileList(...)new MotifDirectoryListModel(...)// PENDING(jeff) - this is inefficient - should sent out// PENDING(jeff) - fire the correct interval changed - currently sending// PENDING(jeff) - fire the interval changed// DataModel for Types Comboxbox// Renderer for Types ComboBox/** Render different type sizes and styles. *//* Copyright (c) 1997, 2015, Oracle and/or its affiliates. All rights reserved. ... */// PENDING(jeff)// PENDING(jeff) - I18N// Change to folder on return// CENTER: left, right accessory// left panel - Filter & folderList// add the filter PENDING(jeff) - I18N// leftPanel.add(Box.createRigidArea(vstrut10));// Add the Folder List PENDING(jeff) - I18N// add the filename field PENDING(jeff) - I18N// Since motif doesn't have button icons, leave this empty// which overrides the supertype icon loadingimport KeyEventimport View/* @author Jeff Dinkins ... */String MAX_ACC_WIDTH;/* Client Property keys for text and accelerator text widths *//** Draws the point (<b>x</b>, <b>y</b>) in the current color. *//* Convenience method for drawing a grooved line *//** Draws <b>aString</b> in the rectangle defined by ... */drawStringInRect(...)FontMetrics fontMetricsint drawWidth/** This method is not being used to paint menu item since ... */JMenuItem bInsets iRectangle viewRectRectangle iconRectRectangle textRectRectangle acceleratorRectRectangle checkRectRectangle arrowRectFont holdfFont fFontMetrics fmAccelKeyStroke acceleratorgetAccelerator(...)String acceleratorTextlayoutMenuItem(...)getVerticalAlignment(...)getHorizontalAlignment(...)getVerticalTextPosition(...)getHorizontalTextPosition(...)Color holdcviewRect.xi.leftviewRect.yi.topviewRect.widthi.rightviewRect.heighti.bottomgetKeyModifiersText(...)getKeyText(...)getKeyCode(...)checkRect.xcheckRect.ygetDisabledIcon(...)getPressedIcon(...)iconRect.xiconRect.yView vint mnemIndexgetDisplayedMnemonicIndex(...)drawStringUnderlineCharAt(...)textRect.xtextRect.yint accOffsetJComponent pInteger maxValueIntMotifGraphicsUtils.MAX_ACC_WIDTHint maxValueacceleratorRect.widthacceleratorRect.xacceleratorRect.yarrowRect.xarrowRect.y/** Compute and return the location of the icons origin, the ... */Rectangle labelRunion(...)layoutCompoundLabel(...)acceleratorR.widthacceleratorR.heightcheckIconR.widthcheckIconR.heightarrowIconR.widtharrowIconR.heighttextR.xiconR.xacceleratorR.xviewR.xviewR.widthcheckIconR.xarrowIconR.xacceleratorR.ylabelR.ylabelR.heightarrowIconR.ycheckIconR.y/* Convenience function for determining ComponentOrientation.  Helps us ... *//* Copyright (c) 1997, 2008, Oracle and/or its affiliates. All rights reserved. ... */// Make no net change to g//            throw new InconsistencyException("No font set");//            throw new InconsistencyException("No metrics for Font " + font());// get Accelerator text// layout the text and icon// Paint the Check// Paint the Icon// Use default icon// Draw the Text// Once BasicHTML becomes public, use BasicHTML.propertyKey// instead of the hardcoded string below!// *** paint the text disabled// *** paint the text normally// Draw the Accelerator Text//Get the maxAccWidth from the parent to calculate the offset.//Calculate the offset, with which the accelerator texts will be drawn with.// *** paint the acceleratorText disabled// *** paint the acceleratorText normally// Paint the Arrow/* Initialize the acceelratorText bounds rectangle textR.  If a null ... *//* Initialize the checkIcon bounds rectangle checkIconR. *//* Initialize the arrowIcon bounds rectangle arrowIconR. */// Position the Accelerator text rect// Position the Check and Arrow Icons// Align the accelertor text and the check and arrow icons vertically// with the center of the label rect./* System.out.println("Layout: v=" +viewR+"  c="+checkIconR+" i="+ ... */// shadowed button regionimport UIResourceimport Polygon/** Icon factory for the CDE/Motif Look and Feel ... */Icon checkBoxIcon;Icon radioButtonIcon;Icon menuItemCheckIcon;Icon menuItemArrowIcon;Icon menuArrowIcon;new MenuItemArrowIcon(...)new CheckBoxIcon(...)new RadioButtonIcon(...)MotifIconFactory$CheckBoxIconint csize;boolean flatboolean isArmedboolean isEnabledboolean isSelectedboolean checkToggleInboolean uncheckToggleOutboolean checkInisBorderPaintedFlat(...)drawCheckBezel(...)drawCheckBezelOut(...)Color controlShadowMotifIconFactory$RadioButtonIcon// end class CheckBoxIconColor dot;MotifIconFactory$MenuItemCheckIcon// end class RadioButtonIconMotifIconFactory$MenuItemArrowIcon// end class MenuItemCheckIconMotifIconFactory$MenuArrowIcon// end class MenuItemArrowIcon// There are 4 "looks" to the Motif CheckBox://  drawCheckBezelOut  -  default unchecked state//  drawBezel          -  when we uncheck in toggled state//  drawCheckBezel     -  when we check in toggle state//  drawCheckBezelIn   -  selected, mouseReleased// toggled from unchecked to checked// MotifBorderFactory.drawBezel(g,x,y,csize,csize,false,false);// show checked, unpressed state//  show unchecked state//bottom//right//left//top// draw check// fill interior// These variables are kind of pointless as the following code// assumes the icon will be 10 x 10 regardless of their value.// End class MenuArrowIconimport InternalFrameEventimport PropertyChangeListenerimport PropertyChangeEventimport VetoableChangeListenerimport PropertyVetoException/** Class that manages a Motif title bar ... */SystemButton systemButton;MinimizeButton minimizeButton;MaximizeButton maximizeButton;Title title;Color color;int BUTTON_SIZE;// The width and height of a title pane button// 17 + 1 pixel borderJMenuItem minew JPopupMenu(...)getButtonMnemonic(...)new SystemButton(...)new ActionListener(...) { ... }MotifInternalFrameTitlePane$1MotifInternalFrameTitlePane$2setSelected(...)PropertyVetoException pvenew ActionEvent(...)ActionEvent.ACTION_PERFORMEDnew MinimizeButton(...)new MaximizeButton(...)new Title(...)JInternalFrame fJInternalFrame.IS_SELECTED_PROPERTYrevalidate(...)JInternalFrame.TITLE_PROPERTYenableActions(...)Dimension buttonDimension;MotifInternalFrameTitlePane$FrameButtonsetFocusPainted(...)setBorderPainted(...)boolean pressedMotifInternalFrameTitlePane$MinimizeButtonMotifInternalFrameTitlePane$MaximizeButtonboolean isMaxedMotifInternalFrameTitlePane$SystemButtonMotifInternalFrameTitlePane$TitlesetHorizontalAlignment(...)createBevelBorder(...)BevelBorder.RAISEDMotifInternalFrameTitlePane$Title$1MotifInternalFrameTitlePane$Title$2// Get around protected method in superclass// ignore request.// draw background// draw border/** A Motif L&F implementation of InternalFrame. ... */MotifInternalFrameTitlePane titlePane;KeyStroke closeMenuKey;/** As of Java 2 platform v1.3 this previously undocumented field is no ... */new MotifInternalFrameUI(...)setColors(...)Border frameBordercreateLayoutManager(...)new InternalFrameBorder(...)MotifBorders.InternalFrameBorderinstallKeyboardActions(...)KeyEvent.VK_ESCAPEuninstallBorder(...)getScreenSize(...)uninstallKeyboardActions(...)isKeyBindingRegistered(...)JDesktopIcon direplaceUIInputMap(...)JComponent.WHEN_IN_FOCUSED_WINDOWgetUIActionMap(...)setupMenuOpenKey(...)new AbstractAction(...) { ... }MotifInternalFrameUI$1showSystemMenu(...)isKeyBindingActive(...)InputMap diInputMapgetUIInputMap(...)ActionMap diActionMapMotifInternalFrameUI$2hideSystemMenu(...)Object[] bindingsmakeComponentInputMap(...)MotifInternalFrameUI$3MotifDesktopIconUI micon/** This method is called when the frame becomes selected. */activateFrame(...)/** This method is called when the frame is no longer selected. */deactivateFrame(...)// We replace the// we use JPopup in our TitlePane so need escape support// BasicInternalFrameUI creates an action with the same name, we override// it as MotifInternalFrameTitlePane has a titlePane ivar that shadows the// titlePane ivar in BasicInternalFrameUI, making supers action throw// an NPE for us.// Set up the bindings for the DesktopIcon, it is odd that// we install them, and not the desktop icon.import BasicLabelUIimport ComponentUI/** A Motif L&F implementation of LabelUI. ... */Object MOTIF_LABEL_UI_KEY;MotifLabelUI motifLabelUInew MotifLabelUI(...)import InputEventimport JTextComponentimport BasicLookAndFeelimport BasicBordersimport BasicComboBoxRendererimport BasicComboBoxEditor/** Implements the Motif Look and Feel. ... */OSInfo.OSType.SOLARISOSInfo.OSType/** Load the SystemColors into the defaults table.  The keys ... */String[] defaultSystemColorsString motifPackageNameObject[] uiDefaultsinitClassDefaults(...)/** Initialize the defaults table with the name of the ResourceBundle ... */FontUIResource dialogPlain12Font.DIALOGFontUIResource serifPlain12Font.SERIFFontUIResource sansSerifPlain12FontUIResource monospacedPlain12Font.MONOSPACEDColorUIResource redColor.redColorUIResource blackColor.blackColorUIResource whiteColor.whiteColorUIResource lightGrayColor.lightGrayColorUIResource controlDarkerColorUIResource scrollBarTrackColorUIResource menuItemPressedBackgroundColorUIResource menuItemPressedForegroundBorder loweredBevelBordernew BevelBorder(...)MotifBorders.BevelBorderBorder raisedBevelBorderBorder marginBordernew MarginBorder(...)BasicBorders.MarginBorderBorder focusBordernew FocusBorder(...)MotifBorders.FocusBorderBorder focusBevelBordernew CompoundBorderUIResource(...)BorderUIResource.CompoundBorderUIResourceBorder comboBoxBorderBorder buttonBordernew ButtonBorder(...)MotifBorders.ButtonBorderBorder toggleButtonBordernew ToggleButtonBorder(...)MotifBorders.ToggleButtonBorderBorder textFieldBorderBorder popupMenuBordernew MotifPopupMenuBorder(...)MotifBorders.MotifPopupMenuBorderObject menuItemCheckIconMotifLookAndFeel$1getMenuItemCheckIcon(...)Object menuItemArrowIconMotifLookAndFeel$2getMenuItemArrowIcon(...)Object menuArrowIconMotifLookAndFeel$3getMenuArrowIcon(...)Object checkBoxIconMotifLookAndFeel$4getCheckBoxIcon(...)Object radioButtonIconMotifLookAndFeel$5getRadioButtonIcon(...)Object unselectedTabBackgroundMotifLookAndFeel$6Object unselectedTabForegroundMotifLookAndFeel$7Object unselectedTabShadowMotifLookAndFeel$8Color baseObject unselectedTabHighlightMotifLookAndFeel$9Object treeOpenIconmakeIcon(...)MotifLookAndFeel.classObject treeClosedIconObject treeLeafIconMotifLookAndFeel$10loadLeafIcon(...)Object treeExpandedIconMotifLookAndFeel$11createExpandedIcon(...)MotifTreeUI.MotifExpandedIconObject treeCollapsedIconMotifLookAndFeel$12createCollapsedIcon(...)MotifTreeUI.MotifCollapsedIconBorder menuBarBordernew MenuBarBorder(...)MotifBorders.MenuBarBorderBorder menuMarginBorderBorder focusCellHighlightBordernew LineBorderUIResource(...)BorderUIResource.LineBorderUIResourceObject sliderFocusInsetsObject tabbedPaneTabInsetsObject tabbedPaneTabPadInsetsObject tabbedPaneTabAreaInsetsObject tabbedPaneContentBorderInsetsObject optionPaneBordernew EmptyBorderUIResource(...)BorderUIResource.EmptyBorderUIResourceObject optionPaneButtonAreaBorderObject optionPaneMessageAreaBordergetSystemMnemonicKeyMask(...)KeyEvent.META_MASK/* Color of the desktop background *//* Color for captions (title bars) when they are active. *//* Text color for text in captions (title bars). *//* Border color for caption (title bar) window borders. *//* Color for captions (title bars) when not active. *//* Text color for text in inactive captions (title bars). *//* Border color for inactive caption (title bar) window borders. *//* Default color for the interior of windows *//* ??? *//* Text background color *//* Text foreground color *//* Text background color when selected *//* Text color when selected *//* Text color when disabled *//* Default color for controls (buttons, sliders, etc) *//* Default color for text in controls *//* Highlight color for controls *//* Light highlight color for controls *//* Shadow color for controls *//* Dark shadow color for controls *//* Scrollbar ??? color. PENDING(jeff) foreground? background? ? */// slate blue// *** Text// *** Tree// ** for tabbedpane// ** for optionpane// Buttons// DEPRECATED - DO NOT USE!// These are a little odd, MotifInternalFrameUI isntalls em!// Spinner// default: dark slate blue// default: black// default: white// default: maroon//      "Table.background", white,  // cell background color// ToolBar.// These window InputMap bindings are used when the Menu is// selected.import BasicMenuBarUI/** A Windows L&F implementation of MenuBarUI.  This implementation ... */new MotifMenuBarUI(...)//REMIND// end classimport BasicMenuItemUI/** MotifMenuItem implementation ... */new MotifMenuItemUI(...)import MenuSelectionManager/** A default MouseListener for menu elements ... */import BasicMenuUI/** A Motif L&F implementation of MenuUI. ... */new MotifMenuUI(...)//      menuItem.removeChangeListener(changeListener);//      super.uninstallListeners();//    protected void uninstallListeners() {//        menuItem.addChangeListener(changeListener);//        changeListener = createChangeListener(menuItem);//      super.installListeners();//    protected void installListeners() {// and this class overrides createChangeListener.// These should not be necessary because BasicMenuUI does this,new MotifChangeHandler(...)JPopupMenu pmgetPopupMenu(...)me.lengthstateChanged(...)JMenu menuMenuElement[] pathContainer cntMenuElement[] menew MenuElement[]path.lengthMenuElement[] newPath// c.repaint();import BasicOptionPaneUI/** Provides the CDE/Motif look and feel for a JOptionPane. ... *//** Creates a new MotifOptionPaneUI instance. */new MotifOptionPaneUI(...)/** Creates and returns a Container containin the buttons. The buttons ... */Container bcreateButtonArea(...)setCentersChildren(...)/** Returns null, CDE/Motif does not impose a minimum size. */MotifOptionPaneUI$1/** Creates and adds a JLabel representing the icon returned from ... */Icon sideIconJLabel iconLabelsetVerticalAlignment(...)/* Create the icon. */import BasicPasswordFieldUI/** Provides the Motif look and feel for a password field. ... *//** Creates a UI for a JPasswordField. ... */new MotifPasswordFieldUI(...)/** A Motif L&F implementation of PopupMenuSeparatorUI.  This implementation ... */new MotifPopupMenuSeparatorUI(...)Dimension ss.width/* Copyright (c) 1998, Oracle and/or its affiliates. All rights reserved. ... */import Frameimport LayoutManagerimport BasicPopupMenuUI/** A Motif L&F implementation of PopupMenuUI. ... */Border border;Font titleFont;new MotifPopupMenuUI(...)/* This has to deal with the fact that the title may be wider than ... */LayoutManager layoutnew ChangeListener(...) { ... }MotifPopupMenuUI$1MouseEvent.BUTTON3_MASKimport BasicProgressBarUI/** A Motif ProgressBarUI. ... *//** Creates the ProgressBar's UI */new MotifProgressBarUI(...)import BasicRadioButtonMenuItemUI/** MotifRadioButtonMenuItem implementation ... */new MotifRadioButtonMenuItemUI(...)import BasicRadioButtonUI/** RadioButtonUI implementation for MotifRadioButtonUI ... */Object MOTIF_RADIO_BUTTON_UI_KEY;Color focusColor;MotifRadioButtonUI motifRadioButtonUInew MotifRadioButtonUI(...)//         Paint MethodsgetFocusColor(...)import BasicArrowButton/** Motif scroll bar button. ... */this.directionsetRequestFocusEnabled(...)Color leadColor trailColor fillint cxint cyimport JButtonimport JScrollBarimport BasicScrollBarUIimport static SwingUtilities2.drawHLineimport static SwingUtilities2.drawVLine/** Implementation of ScrollBarUI for the Motif Look and Feel ... */new MotifScrollBarUI(...)JScrollBar.VERTICALnew MotifScrollBarButton(...)trackBounds.xtrackBounds.ytrackBounds.widthtrackBounds.heightthumbBounds.widththumbBounds.heightthumbBounds.xthumbBounds.ydrawVLine(...)drawHLine(...)/* Copyright (c) 1997, 2014, Oracle and/or its affiliates. All rights reserved. ... */import BasicScrollPaneUI/** A CDE/Motif L&F implementation of ScrollPaneUI. ... */Border vsbMarginBorderR;Border vsbMarginBorderL;Border hsbMarginBorder;CompoundBorder vsbBorder;CompoundBorder hsbBorder;PropertyChangeListener propertyChangeHandler;createPropertyChangeHandler(...)MotifScrollPaneUI$1JScrollPane paneJScrollBar vsbnew CompoundBorder(...)getInsideBorder(...)JScrollBar hsbnew MotifScrollPaneUI(...)// The Border on the verticall scrollbar matches// what we installed, reset it.import BasicSeparatorUI/** A Motif L&F implementation of SeparatorUI.  This implementation ... */new MotifSeparatorUI(...)import JSliderimport BasicSliderUI/** Motif Slider ... */Dimension PREFERRED_HORIZONTAL_SIZE;Dimension PREFERRED_VERTICAL_SIZE;Dimension MINIMUM_HORIZONTAL_SIZE;Dimension MINIMUM_VERTICAL_SIZE;/** MotifSliderUI Constructor *//** create a MotifSliderUI object */new MotifSliderUI(...)Rectangle knobBoundsknobBounds.xknobBounds.yknobBounds.widthknobBounds.heightgetHighlightColor(...)getShadowColor(...)// PENDING(jeff) - the thumb should be dithered when disabled// fill// highlight// center// shadowimport JSplitPaneimport UIManagerimport BasicSplitPaneUIimport BasicSplitPaneDivider/** Divider used for Motif split pane. ... */getPredefinedCursor(...)Cursor.DEFAULT_CURSORCursor defaultCursor;/** Default cursor, supers is package private, so we have to have one ... */int minimumThumbSize;int defaultDividerSize;int pad;int hThumbOffset;int vThumbOffset;int hThumbWidth;int hThumbHeight;int vThumbWidth;int vThumbHeight;Color focusedColor;/** Creates a new Motif SplitPaneDivider */setDividerSize(...)/** overrides to hardcode the size of the divider ... */int borderSizegetBasicSplitPaneUI(...)// It should be dynamic.// PENDING(jeff) - the thumb's location and size is currently hard coded./** Paints the divider. */Color bgColorint center/** The minimums size is the same as the preferredSize *//** Sets the SplitPaneUI that is using the receiver. This is completely ... */removeMouseMotionListener(...)getSplitPane(...)new MotifMouseHandler(...)isOneTouchExpandable(...)oneTouchExpandableChanged(...)/** Returns true if the point at <code>x</code>, <code>y</code> ... */// superclass protected ivars// Two methods are exposed so that MotifMouseHandler can see theMotifSplitPaneDivider$MotifMouseHandler/** MouseHandler is subclassed to only pass off to super if the mouse ... */isInThumb(...)MotifSplitPaneDivider.thisgetDragger(...)mousePressed(...)getCursor(...)setCursor(...)mouseMoved(...)/* Copyright (c) 1997, 1999, Oracle and/or its affiliates. All rights reserved. ... */// split line// draw thumb// Constrain the mouse pressed to the thumb./** Motif rendition of a split pane. ... *//** Creates a new MotifSplitPaneUI instance */new MotifSplitPaneUI(...)/** Creates the default divider. */new MotifSplitPaneDivider(...)import BasicTabbedPaneUI/** A Motif L&F implementation of TabbedPaneUI. ... */Color unselectedTabBackground;// Instance variables initialized at installationColor unselectedTabForeground;Color unselectedTabShadow;Color unselectedTabHighlight;// UI creationnew MotifTabbedPaneUI(...)// UI Installation/De-installation// UI RenderingRectangle selRectgetTabBounds(...)selRect.xselRect.widthselRect.yselRect.heightgetBackgroundAt(...)Rectangle tabRecttabRect.xtabRect.ytabRect.widthtabRect.heighttabInsets.righttabInsets.lefttabInsets.bottomtabInsets.top// Draw unbroken line if tabs are not on TOP, OR// selected tab is not visible (SCROLL_TAB_LAYOUT)// Break line to show visual connection to selected tab// Draw unbroken line if tabs are not on BOTTOM, OR// Draw unbroken line if tabs are not on RIGHT, OR// Ensure that runover lay is not more than insets// 2 pixel offset is set from insets to each runimport BasicTextAreaUI/** Provides the look and feel for a plain text editor.  In this ... *//** Creates a UI for a JTextArea. ... */new MotifTextAreaUI(...)import BasicTextFieldUIimport Caret/** Provides the Motif look and feel for a text field. ... *//** Creates a UI for a JTextField. ... */new MotifTextFieldUI(...)import BasicTextPaneUI/** Provides the look and feel for a styled text editor. ... */new MotifTextPaneUI(...)/** Provides the look and feel features that are common across ... */new KeyBinding[]new KeyBinding(...)JTextComponent.KeyBindingKeyEvent.VK_INSERTInputEvent.CTRL_MASKInputEvent.SHIFT_MASKKeyEvent.VK_DELETEKeyEvent.VK_LEFTKeyEvent.VK_RIGHT/** Creates the object to use for a caret for all of the Motif ... */new MotifCaret(...)MotifTextUI$MotifCaret/** The motif caret is rendered as an I beam. ... *//** Called when the component containing the caret gains ... */focusGained(...)/** Called when the component containing the caret loses ... */focusLost(...)/** Damages the area surrounding the caret to cause ... *//** Renders the caret as a vertical line.  If this is reimplemented ... */isVisible(...)JTextComponent cgetCaretColor(...)getDisabledTextColor(...)TextUI mappergetDot(...)modelToView(...)BadLocationException eint IBeamOverhang;...[] defaultBindings;/** Default bindings all keymaps implementing the Motif feel. */// can't render I guess//System.err.println("Can't render caret");/** BasicToggleButton implementation ... */Object MOTIF_TOGGLE_BUTTON_UI_KEY;MotifToggleButtonUI motifToggleButtonUInew MotifToggleButtonUI(...)getSelectColor(...)import javax.swing.tree.*/** Motif rendered to display a tree cell. ... */new IconUIResource(...)new TreeLeafIcon(...)int LEAF_SIZE;Icon LEAF_ICON;MotifTreeCellRenderer$TreeLeafIcon/** Icon for a node with no children. ... */Color bg;/** Motif rendition of the tree component. ... */int HALF_SIZE;int SIZE;/** creates a UI object to represent a Motif Tree widget */// BasicTreeUI overridesMotifTreeUI$MotifExpandedIcon/** The minus sign button icon. ... */Color fg;new MotifExpandedIcon(...)/** The plus sign button icon. ... */new MotifCollapsedIcon(...)new MotifTreeUI(...)/** Returns the default cell renderer that is used to do the ... */new MotifTreeCellRenderer(...)import GetBooleanActionimport UIClientPropertyKeyimport static State.*import Partimport Propimport Skin/** A class to help mimic Vista theme animations.  The only kind of ... */new WeakHashMap<JComponent,Map<Part,AnimationState>>(...)new Timer(...)new GetBooleanAction(...)boolean VISTA_ANIMATION_DISABLED;Object ANIMATION_CONTROLLER_KEY;Map<JComponent,Map<Part,AnimationState>> animationStateMap;Timer timer;//30 repaints per second should give smooth animation affect//this timer is used to cause repaint on animated componentsnew AnimationController(...)setRepeats(...)setCoalesce(...)AnimationController controllergetAnimationController(...)State oldStatePart.TP_BUTTONputState(...)State.DEFAULTEDState.HOTlong durationXPStyle xpgetXP(...)getThemeTransitionDuration(...)normalizeState(...)Prop.TRANSITIONDURATIONSstartAnimation(...)// only for up button states thus we doing this translation here.// defined by states.  It seems that theme has duration defined// for scrollbar up, down, left and right button pictures areState rvObject tmpObjectboolean isForwardAndReverseMap<Part,AnimationState> mapnew EnumMap<Part,AnimationState>(...)Part.classnew AnimationState(...)isRunning(...)paintSkinRaw(...)triggerAnimation(...)skin.partAnimationState animationStatecontroller.animationStateMappaintSkin(...)List<JComponent> componentsToRemoveList<Part> partsToRemovenew ArrayList<JComponent>(...)Part partnew ArrayList<Part>(...)stop(...)AnimationController.classAnimationController$AnimationStateState startState;long duration;//animation duration in nanosecondslong startTime;//animatin start time in nanosecondsboolean isForward;//!forward - from 1 to 0//forward  - from 0 to 1//direction the alpha value is changingboolean isForwardAndReverse;//from 1 to 0 and so forth//forward and reverse. alpha value is changing from 0 to 1 then//if isForwardAndReverse the animation continually goesfloat progress;isEventDispatchThread(...)this.startStatethis.durationthis.startTimenanoTime(...)this.isForwardAndReverselong currentTimeupdateProgress(...)Graphics2D gderive(...)AlphaComposite.SrcOverAnimationController$PartUIClientPropertyKeynew EnumMap<Part,PartUIClientPropertyKey>(...)Map<Part,PartUIClientPropertyKey> map;PartUIClientPropertyKey rvnew PartUIClientPropertyKey(...)Part part;this.part/* Copyright (c) 2006, 2014, Oracle and/or its affiliates. All rights reserved. ... *///we need to dispose the controller on l&f change//idk: we can not handle tabs animation because//the same (component,part) is used to handle all the tabs//and we can not track the states//Vista theme might have transition duration for toolbar buttons//but native application does not seem to animate them// it seems for DEFAULTED button state Vista does animation from// HOT//Only button might have DEFAULTED state//idk: do not know how to get the value from Vista//one second seems plausible value/* falls through *///animation is done for the component//in case time was reset// to move to a different package in the future.// NOTE: Don't rely on this class staying in this location. It is likely/** Wrapper for a value from the desktop. The value is lazily looked up, and ... */new ReferenceQueue<DesktopProperty>(...)boolean updatePending;/** Indicates if an updateUI call is pending. */ReferenceQueue<DesktopProperty> queue;/** ReferenceQueue of unreferenced WeakPCLs. */WeakPCL pcl;/** PropertyChangeListener attached to the Toolkit. *//** Key used to lookup value from desktop. *//** Value to return. */Object fallback;/** Fallback value in case we get null from desktop. *//** Cleans up any lingering state held by unrefeernced ... *//** Sets whether or not an updateUI call is pending. *//** Returns true if a UI update is pending. *//** Updates the UIs of all the known Frames. */Class<> uiClassFrame[] appFramesgetFrames(...)DesktopProperty.classinvalidateStyle(...)Frame appFrameupdateWindowUI(...)/** Updates the UI of the passed in window and all its children. */Window[] ownedWinsgetOwnedWindows(...)updateComponentTreeUI(...)Window ownedWin/** Creates a DesktopProperty. ... */this.fallbackflushUnreferencedProperties(...)/** UIManager.LazyValue method, returns the value from the desktop ... */configureValue(...)getValueFromDesktop(...)/** Returns the value from the desktop. *//** Returns the value to use if the desktop property is null. *//** Invalidates the current value. ... */invalidate(...)/** Invalides the current value so that the next invocation of ... *//** Requests that all components in the GUI hierarchy be updated ... */isUpdatePending(...)Runnable uiUpdaterDesktopProperty$1updateAllUIs(...)setUpdatePending(...)/** Configures the value as appropriate for a defaults property in ... */createValue(...)/** Returns the key used to lookup the desktop properties value. */DesktopProperty$WeakPCL/** As there is typically only one Toolkit, the PropertyChangeListener ... */LookAndFeel laf;this.lafDesktopProperty propertyupdateUI(...)/* Copyright (c) 2001, 2009, Oracle and/or its affiliates. All rights reserved. ... */// Check if the current UI is WindowsLookAndfeel and flush the XP style map.// Note: Change the package test if this class is moved to a different package.// The only sure fire way to clear our references is to create a// Thread and wait for a reference to be added to the queue.// Because it is so rare that you will actually change the look// and feel, this stepped is forgoed and a middle ground of// flushing references from the constructor is instead done.// The implication is that once one DesktopProperty is created// there will most likely be n (number of DesktopProperties created// by the LookAndFeel) WeakPCLs around, but this number will not// grow past n.import ThemeReader/** Implements Windows Parts and their States and Properties for the Windows Look and Feel. ... */TMSchema$Control/** An enumeration of the various Windows controls (also known as ... */new Control(...)Control BUTTON;Control COMBOBOX;Control EDIT;Control HEADER;Control LISTBOX;Control LISTVIEW;Control MENU;Control PROGRESS;Control REBAR;Control SCROLLBAR;Control SPIN;Control TAB;Control TOOLBAR;Control TRACKBAR;Control TREEVIEW;Control WINDOW;TMSchema$Part/** An enumeration of the Windows compoent parts */new Part(...)Control.MENUControl.BUTTONControl.COMBOBOXControl.EDITControl.HEADERControl.LISTBOXControl.LISTVIEWControl.PROGRESSControl.REBARControl.SCROLLBARControl.SPINControl.TABControl.TOOLBARControl.TRACKBARControl.TREEVIEWControl.WINDOWPart MENU;Part MP_BARBACKGROUND;// Special case, not in nativePart MP_BARITEM;Part MP_POPUPBACKGROUND;Part MP_POPUPBORDERS;Part MP_POPUPCHECK;Part MP_POPUPCHECKBACKGROUND;Part MP_POPUPGUTTER;Part MP_POPUPITEM;Part MP_POPUPSEPARATOR;Part MP_POPUPSUBMENU;Part BP_PUSHBUTTON;Part BP_RADIOBUTTON;Part BP_CHECKBOX;Part BP_GROUPBOX;Part CP_COMBOBOX;Part CP_DROPDOWNBUTTON;Part CP_BACKGROUND;Part CP_TRANSPARENTBACKGROUND;Part CP_BORDER;Part CP_READONLY;Part CP_DROPDOWNBUTTONRIGHT;Part CP_DROPDOWNBUTTONLEFT;Part CP_CUEBANNER;Part EP_EDIT;Part EP_EDITTEXT;Part HP_HEADERITEM;Part HP_HEADERSORTARROW;Part LBP_LISTBOX;Part LVP_LISTVIEW;Part PP_PROGRESS;Part PP_BAR;Part PP_BARVERT;Part PP_CHUNK;Part PP_CHUNKVERT;Part RP_GRIPPER;Part RP_GRIPPERVERT;Part SBP_SCROLLBAR;Part SBP_ARROWBTN;Part SBP_THUMBBTNHORZ;Part SBP_THUMBBTNVERT;Part SBP_LOWERTRACKHORZ;Part SBP_UPPERTRACKHORZ;Part SBP_LOWERTRACKVERT;Part SBP_UPPERTRACKVERT;Part SBP_GRIPPERHORZ;Part SBP_GRIPPERVERT;Part SBP_SIZEBOX;Part SPNP_UP;Part SPNP_DOWN;Part TABP_TABITEM;Part TABP_TABITEMLEFTEDGE;Part TABP_TABITEMRIGHTEDGE;Part TABP_PANE;Part TP_TOOLBAR;Part TP_BUTTON;Part TP_SEPARATOR;Part TP_SEPARATORVERT;Part TKP_TRACK;Part TKP_TRACKVERT;Part TKP_THUMB;Part TKP_THUMBBOTTOM;Part TKP_THUMBTOP;Part TKP_THUMBVERT;Part TKP_THUMBLEFT;Part TKP_THUMBRIGHT;Part TKP_TICS;Part TKP_TICSVERT;Part TVP_TREEVIEW;Part TVP_GLYPH;Part WP_WINDOW;Part WP_CAPTION;Part WP_MINCAPTION;Part WP_MAXCAPTION;Part WP_FRAMELEFT;Part WP_FRAMERIGHT;Part WP_FRAMEBOTTOM;Part WP_SYSBUTTON;Part WP_MDISYSBUTTON;Part WP_MINBUTTON;Part WP_MDIMINBUTTON;Part WP_MAXBUTTON;Part WP_CLOSEBUTTON;Part WP_MDICLOSEBUTTON;Part WP_RESTOREBUTTON;Part WP_MDIRESTOREBUTTON;Control control;String subAppNameTMSchema$State/** An enumeration of the possible component states */State ACTIVE;State ASSIST;State BITMAP;State CHECKED;State CHECKEDDISABLED;State CHECKEDHOT;State CHECKEDNORMAL;State CHECKEDPRESSED;State CHECKMARKNORMAL;State CHECKMARKDISABLED;State BULLETNORMAL;State BULLETDISABLED;State CLOSED;State DEFAULTED;State DISABLED;State DISABLEDHOT;State DISABLEDPUSHED;State DOWNDISABLED;State DOWNHOT;State DOWNNORMAL;State DOWNPRESSED;State FOCUSED;State HOT;State HOTCHECKED;State ICONHOT;State ICONNORMAL;State ICONPRESSED;State ICONSORTEDHOT;State ICONSORTEDNORMAL;State ICONSORTEDPRESSED;State INACTIVE;State INACTIVENORMAL;State INACTIVEHOT;// See note 1State INACTIVEPUSHED;State INACTIVEDISABLED;State LEFTDISABLED;State LEFTHOT;State LEFTNORMAL;State LEFTPRESSED;State MIXEDDISABLED;State MIXEDHOT;State MIXEDNORMAL;State MIXEDPRESSED;State NORMAL;State PRESSED;State OPENED;State PUSHED;State READONLY;State RIGHTDISABLED;State RIGHTHOT;State RIGHTNORMAL;State RIGHTPRESSED;State SELECTED;State UNCHECKEDDISABLED;State UNCHECKEDHOT;State UNCHECKEDNORMAL;State UNCHECKEDPRESSED;State UPDISABLED;State UPHOT;State UPNORMAL;State UPPRESSED;State HOVER;State UPHOVER;State DOWNHOVER;State LEFTHOVER;State RIGHTHOVER;State SORTEDDOWN;State SORTEDHOT;State SORTEDNORMAL;State SORTEDPRESSED;State SORTEDUP;EnumMap<Part,State[]> stateMap;/** A map of allowed states for each Part */State[] comboBoxStatesnew State[]State[] scrollBarStatesState[] spinnerStatesState[] frameButtonStatesState[] sliderThumbStatesState[] tabStatesState[] frameStatesState[] captionStatesnew EnumMap<Part,State[]>(...)Part.EP_EDITTEXTPart.BP_PUSHBUTTONPart.BP_RADIOBUTTONPart.BP_CHECKBOXPart.CP_COMBOBOXPart.CP_DROPDOWNBUTTONPart.CP_BACKGROUNDPart.CP_TRANSPARENTBACKGROUNDPart.CP_BORDERPart.CP_READONLYPart.CP_DROPDOWNBUTTONRIGHTPart.CP_DROPDOWNBUTTONLEFTPart.CP_CUEBANNERPart.HP_HEADERITEMPart.HP_HEADERSORTARROWPart.SBP_SCROLLBARPart.SBP_THUMBBTNVERTPart.SBP_THUMBBTNHORZPart.SBP_GRIPPERVERTPart.SBP_GRIPPERHORZPart.SBP_ARROWBTNPart.SPNP_UPPart.SPNP_DOWNPart.TVP_GLYPHPart.WP_CLOSEBUTTONProp.IMAGECOUNTPart.WP_MINBUTTONPart.WP_MAXBUTTONPart.WP_RESTOREBUTTONPart.TKP_TRACKPart.TKP_TRACKVERTPart.TKP_THUMBPart.TKP_THUMBBOTTOMPart.TKP_THUMBTOPPart.TKP_THUMBVERTPart.TKP_THUMBRIGHTPart.TABP_TABITEMPart.TABP_TABITEMLEFTEDGEPart.TABP_TABITEMRIGHTEDGEPart.WP_WINDOWPart.WP_FRAMELEFTPart.WP_FRAMERIGHTPart.WP_FRAMEBOTTOMPart.WP_CAPTIONPart.WP_MINCAPTIONPart.WP_MAXCAPTIONPart.MP_BARBACKGROUNDPart.MP_BARITEMPart.MP_POPUPCHECKPart.MP_POPUPCHECKBACKGROUNDPart.MP_POPUPITEMPart.MP_POPUPSUBMENUEnum<>[] statesinitStates(...)states.lengthState.NORMALTMSchema$Prop/** An enumeration of the possible component attributes and the ... */new Prop(...)Color.classDimension.classBoolean.classInteger.classPoint.classInsets.classProp COLOR;Prop SIZE;Prop FLATMENUS;Prop BORDERONLY;Prop IMAGECOUNT;// only draw the border area of the imageProp BORDERSIZE;// the number of state images in an imagefileProp PROGRESSCHUNKSIZE;// the size of the border line for bgtype=BorderFillProp PROGRESSSPACESIZE;// size of progress control chunksProp TEXTSHADOWOFFSET;// size of progress control spacesProp NORMALSIZE;// where char shadows are drawn, relative to orig. charsProp SIZINGMARGINS;// size of dest rect that exactly sourceProp CONTENTMARGINS;// margins used for 9-grid sizingProp CAPTIONMARGINS;// margins that define where content can be placedProp BORDERCOLOR;// margins that define where caption text can be placedProp FILLCOLOR;// color of borders for BorderFillProp TEXTCOLOR;// color of bg fillProp TEXTSHADOWCOLOR;// color text is drawn inProp BGTYPE;// color of text shadowProp TEXTSHADOWTYPE;// basic drawing type for each partProp TRANSITIONDURATIONS;// type of shadow to draw with textTMSchema$TypeEnum/** An enumeration of attribute values for some Props */new TypeEnum(...)Prop.BGTYPEProp.TEXTSHADOWTYPETypeEnum BT_IMAGEFILE;TypeEnum BT_BORDERFILL;TypeEnum TST_NONE;TypeEnum TST_SINGLE;TypeEnum TST_CONTINUOUS;this.propthis.enumNameProp prop;String enumName;TypeEnum ee.prop/* <p>These classes are designed to be used while the ... */// Note 1: The INACTIVE frame button states apply when the frame//         is inactive. They are not defined in tmschema.h// Fix for 6316538: Vista has five frame button states// States for Slider (trackbar)// States for Tabsimport static TMSchema.*import static XPStyle.Skin/** Factory object that can vend Borders appropriate for the Windows 95 L & F. ... *//** Returns a  border instance for a Windows Progress Bar ... */Border progressBarBordernew ProgressBarBorder(...)WindowsBorders.ProgressBarBorder/** Returns a border instance for a Windows ToolBar ... */Border toolBarBordernew ToolBarBorder(...)WindowsBorders.ToolBarBorder/** Returns an new instance of a border used to indicate which cell item ... */new ComplementDashedBorder(...)Border tableHeaderBorderBasicBorders.ButtonBorderBorder internalFrameBordernew InternalFrameLineBorder(...)WindowsBorders.InternalFrameLineBorder/** A border for the ToolBar. If the ToolBar is floatable then the handle grip is drawn ... */Border xpBorderPart.TP_TOOLBARpaintBorder(...)isFloatable(...)Part.RP_GRIPPERVERTPart.RP_GRIPPERSkin skingetSkin(...)int dwint dhint gripInset/** This class is an implementation of a dashed border. ... */drawDashedRect(...)WindowsBorders$ComplementDashedBorder/** A dashed border that paints itself in the complementary color ... */Color origColor;Color paintColor;/** This class is an implementation of the InternalFrameLine border. ... */Color activeColor;Color inactiveColor;/* Copyright (c) 1998, 2010, Oracle and/or its affiliates. All rights reserved. ... */// draw top// draw left// draw bottom// draw right// Vertical// Set the line color so the line border gets the correct// color./* Copyright (c) 1998, 2006, Oracle and/or its affiliates. All rights reserved. ... *//* This class is currently not used, but exists in case customers ... */import static Part.*/** Windows button. ... */int dashedRectGapX;int dashedRectGapY;int dashedRectGapWidth;int dashedRectGapHeight;Object WINDOWS_BUTTON_UI_KEY;WindowsButtonUI windowsButtonUInew WindowsButtonUI(...)//            DefaultsString ppgetXPButtonType(...)/** Overridden method to render the text without the mnemonic */getTextShiftOffset(...)setTextShiftOffset(...)//          Layout MethodsRectangle viewRect;/* These rectangles/insets are allocated once for all ... */paintXPButtonBackground(...)boolean toolbarState stateState.CHECKEDDISABLEDState.UNCHECKEDDISABLEDState.CHECKEDPRESSEDState.UNCHECKEDPRESSEDisRollover(...)State.CHECKEDHOTState.UNCHECKEDHOTState.CHECKEDNORMALState.UNCHECKEDNORMALState.PRESSEDState.DISABLEDState.HOTCHECKEDState.CHECKEDgetXPButtonState(...)getOpaqueInsets(...)/** returns - b.getBorderInsets(c) if border is opaque ... */isBorderOpaque(...)CompoundBorder cbInsets iOutgetOutsideBorder(...)Insets iIniOut.topiIn.topiOut.leftiIn.leftiOut.bottomiIn.bottomiOut.rightiIn.right// focus painted same color as text on Basic??/* Ensure that the width and height of the button is odd, ... */// Note: The border may be compound, containing an outer// opaque border (supplied by the application), plus an// inner transparent margin border. We want to size the// background to fill the transparent part, but stay// inside the opaque part.// Outside border is opaque, keep looking// Inside is non-opaque, use outside insets// Found non-opaque somewhere in the inside (which is// also compound).// Outside is either all non-opaque or has non-opaque// border inside another compound border/** Windows check box menu item. ... */new WindowsMenuItemUIAccessor(...) { ... }WindowsCheckBoxMenuItemUI$1getPart(...)WindowsMenuItemUIAccessor accessor;new WindowsCheckBoxMenuItemUI(...)isVistaPainting(...)/** Method which renders the text of the current menu item. ... */// Uses protected field./** Windows check box. ... */Object WINDOWS_CHECK_BOX_UI_KEY;// painting changes made in MetalRadioButtonUI.// of BasicCheckBoxUI because we want to pick up all the// NOTE: MetalCheckBoxUI inherts from MetalRadioButtonUI insteadWindowsCheckBoxUI windowsCheckBoxUInew WindowsCheckBoxUI(...)/** Implements the Windows95/98/ME/NT/2000 Look and Feel. ... */import static TMSchema.Partimport static TMSchema.Stateimport DefaultLookupimport StringUIClientPropertyKey/** Windows combo box. ... */WindowsComboBoxUI$1getComboBox(...)WindowsComboBoxUI comboBoxUIgetWindowsComboBoxUI(...)ButtonModel mcomboBoxUI.arrowButtonsetRollover(...)comboBoxUI.isRolloverhandleRollover(...)Object sourceJComboBox<> rvgetWindowsComboBoxUI(...).comboBoxWindowsComboBoxUI rvWindowsComboBoxUI$2setPart(...)ComponentOrientation.RIGHT_TO_LEFTMouseListener rolloverListener;boolean isRollover;PropertyChangeListener componentOrientationListener;new WindowsComboBoxUI(...)isSkinDefined(...)unconfigureEditor(...)paintXPComboBoxBackground(...)isPopupVisible(...)getXPComboBoxState(...)/** If necessary paints the currently selected item. ... */boolean shouldValidatepaintCurrentValueBackground(...)/** Creates a layout manager for managing the components which make up the ... */new BasicComboBoxUI.ComboBoxLayoutManager(...) { ... }WindowsComboBoxUI$3createPopup(...)/** Creates the default editor that will be used in editable combo boxes. ... */new WindowsComboBoxEditor(...)new WindowsComboBoxRenderer(...)createRenderer(...)/** Creates an button which will be used as the control to show or hide ... */new XPComboBoxButton(...)createArrowButton(...)WindowsComboBoxUI$XPComboBoxButtonXPStyle.GlyphButtonWindowsComboBoxUI.this/** Subclassed to add Windows specific Key Bindings. ... */new InvocationKeyHandler(...)WindowsComboPopup.this/** Subclassed to highlight selected item in an editable combo box. */BasicComboBoxEditor.UIResourceJTextField editorcreateEditorComponent(...)Object focusgetFocusOwner(...)getCurrentKeyboardFocusManager(...)setItem(...)WindowsComboBoxUI$WindowsComboBoxRenderer/** Subclassed to set opacity {@code false} on the renderer ... */BasicComboBoxRenderer.UIResourcenew StringUIClientPropertyKey(...)Object BORDER_KEY;Border NULL_BORDER;Component rvBorder dashedBordernew DashedBorder(...)WindowsBorders.DashedBorderObject storedBorder//mouse over editable ComboBox does not switch rollover//for the arrow button//we can not do it in installListeners because arrowButton//is initialized after installListeners is invoked//button glyph for LTR and RTL combobox might differ// On vista for READNLY ComboBox// color for currentValue is the same as for any other item// mostly copied from javax.swing.plaf.basic.BasicComboBoxUI.paintCurrentValue/* for non editable ComboBoxes Vista seems to have the ... *///store current border in client property if needed/** Windows icon for a minimized window on the desktop. ... */new WindowsDesktopIconUI(...)// Uninstall the listeners added by the WindowsInternalFrameTitlePaneWindowsInternalFrameTitlePane thePanenew WindowsInternalFrameTitlePane(...)/** Windows desktop icons are restricted to a width of 160 pixels by ... */Dimension dimdim.width// Windows desktop icons can not be resized.  Therefore, we should// always return the minimum size of the desktop icon. See// getMinimumSize(JComponent c).import DefaultDesktopManagerimport JInternalFrameimport JLayeredPaneimport WeakReference/** This class implements a DesktopManager which more closely follows ... */WeakReference<JInternalFrame> currentFrameRef;/* The frame which is currently selected/activated. ... */JInternalFrame currentFramesetMaximum(...)PropertyVetoException enew WeakReference<JInternalFrame>(...)/* Copyright (c) 1998, 2008, Oracle and/or its affiliates. All rights reserved. ... */// If the current frame is maximized, transfer that// attribute to the frame being activated.//Special case.  If key binding was used to select next//frame instead of minimizing the icon via the minimize//icon./** Windows desktop pane. ... */new WindowsDesktopPaneUI(...)new WindowsDesktopManager(...)requestDefaultFocus(...)// Request focus if it isn't set./** Windows rendition of the component. ... *//** Creates a UI for a JEditorPane. ... */new WindowsEditorPaneUI(...)new WindowsCaret(...)WindowsTextUI.WindowsCaretimport FileNotFoundExceptionimport sun.swing.*/** Windows L&F implementation of a FileChooser. ... */new WindowsFileView(...)JPanel centerPanel;// Windows FileChooser L&F is not complete yet.// The following are private because the implementation of theJLabel lookInLabel;JComboBox<File> directoryComboBox;ActionListener directoryComboBoxAction;FilePane filePane;WindowsPlacesBar placesBar;JButton cancelButton;JPanel buttonPanel;Dimension vstrut4;Dimension vstrut6;Dimension vstrut8;Insets shrinkwrap;int PREF_WIDTH;// Preferred and Minimum sizes for the dialog boxint PREF_HEIGHT;int LIST_PREF_WIDTH;int LIST_PREF_HEIGHT;Dimension LIST_PREF_SIZE;int lookInLabelMnemonic;// Labels, mnemonics, and tooltips (oh my!)String lookInLabelText;String saveInLabelText;int fileNameLabelMnemonic;String fileNameLabelText;int folderNameLabelMnemonic;String folderNameLabelText;int filesOfTypeLabelMnemonic;String filesOfTypeLabelText;String upFolderToolTipText;String upFolderAccessibleName;String newFolderToolTipText;String newFolderAccessibleName;String viewMenuButtonToolTipText;String viewMenuButtonAccessibleName;BasicFileView fileView;new WindowsFileChooserUI(...)WindowsFileChooserUI$WindowsFileChooserUIAccessorFilePane.FileChooserUIAccessorWindowsFileChooserUI.thiscreateList(...)createDetailsView(...)FileSystemView fsvJToolBar topPanelnew JToolBar(...)JButton upFolderButtoncreateToolButton(...)ButtonGroup viewButtonGroupnew ButtonGroup(...)JPopupMenu viewTypePopupMenuJRadioButtonMenuItem listViewMenuItemnew JRadioButtonMenuItem(...)getViewTypeAction(...)FilePane.VIEWTYPE_LISTJRadioButtonMenuItem detailsViewMenuItemFilePane.VIEWTYPE_DETAILSGraphics graphicsJButton viewMenuButtonJPanel labelPanelJLabel ftlJPanel fileAndFilterPanelInsets buttonMarginnew FilePane(...)new WindowsFileChooserUIAccessor(...)updateUseShellFolder(...)setFloatable(...)WindowsFileChooserUI$1JLabel.TRAILINGnew JComboBox<File>(...) { ... }WindowsFileChooserUI$2createDirectoryComboBoxRenderer(...)getViewType(...)fillPolygon(...)WindowsFileChooserUI$3addKeyListener(...)new KeyAdapter(...) { ... }WindowsFileChooserUI$4KeyEvent.VK_SPACEaddPopupMenuListener(...)new PopupMenuListener(...) { ... }WindowsFileChooserUI$5WindowsFileChooserUI$5$1WindowsFileChooserUI$6BoxLayout.Y_AXISWindowsFileChooserUI$7addFocusListener(...)new FocusAdapter(...) { ... }WindowsFileChooserUI$8getSelectedFiles(...)getSelectedFile(...)new JComboBox<FileFilter>(...)getButtonPanel(...)WindowsFileChooserUI$9buttonMargin.topbuttonMargin.bottombuttonMargin.leftbuttonMargin.rightWindowsFileChooserUI$10addControlButtons(...)usesShellFolder(...)new WindowsPlacesBar(...)BorderLayout.BEFORE_LINE_BEGINSActionMap actionMapcreateActionMap(...)addActionsToMap(...)getActions(...)/** Creates a selection listener for the list of files and directories. ... */// Obsolete class, not used in this version./** Returns the preferred size of the specified ... */int prefWidthPREF_SIZE.height/** Returns the minimum size of the <code>JFileChooser</code>. ... *//** Returns the maximum size of the <code>JFileChooser</code>. ... */isFileSystemRoot(...)/* The following methods are used by the PropertyChange Listener */clearIconCache(...)getDialogType(...)JFileChooser.SAVE_DIALOGremoveControlButtons(...)/* Listen for filechooser property changes, such as ... */WindowsFileChooserUI$11doSelectedFilesChanged(...)doFilterChanged(...)doAccessoryChanged(...)doApproveButtonTextChanged(...)doDialogTypeChanged(...)JFileChooser.APPROVE_BUTTON_MNEMONIC_CHANGED_PROPERTYdoApproveButtonMnemonicChanged(...)ensureFileIsVisible(...)/** Property to remember whether a directory is currently selected in the UI. ... */new DirectoryComboBoxRenderer(...)JButton resultWindowsLookAndFeel.HI_RES_DISABLED_ICON_CLIENT_KEYnew DefaultButtonModel(...) { ... }WindowsFileChooserUI$12setPressed(...)WindowsFileChooserUI$13WindowsFileChooserUI$DirectoryComboBoxRenderer// Renderer for DirectoryComboBoxnew IndentIcon(...)IndentIcon ii;File directoryii.iconii.depthgetDepth(...)int space;WindowsFileChooserUI$IndentIconint depth;WindowsFileChooserUI$DirectoryComboBoxModel...[] depths;boolean useShellFolderFile[] baseFoldersgetCanonicalFile(...)File sfgetShellFolder(...)Vector<File> pathint pathCountint topIndexcalculateDepths(...)depths.lengthFile parent/* FileView type descriptions */getCachedIcon(...)getSystemIcon(...)cacheIcon(...)// ********************************* //// **** Construct the top panel **** //// Directory manipulation buttons// Add the top panel to the fileChooser// ComboBox Label// Must be small enough to not affect total width.// Up Button// New Directory Button// View button group// Popup Menu// Create icon for viewMenuButton// Details Button// Forbid keyboard actions if the button is not in rollover state// ************************************** //// ******* Add the directory pane ******* //// ********************************** //// **** Construct the bottom panel ** //// Add the bottom panel to file chooser// labels// file entry and filters// buttons// Decide whether to use the ShellFolder class to populate shortcut// panel and combobox.// Remove listeners// PENDING(jeff) - get the name from the directory combobox// PENDING(jeff) - set the name in the directory combobox// Reset other buttons// Insert chain at appropriate place in vector/** A collection of static utility methods used for rendering the Windows look ... *//** Renders a text String in Windows without the mnemonic. ... */isMnemonicHidden(...)paintXPText(...)paintClassicText(...)Color textColorTypeEnum shadowTypegetTypeEnum(...)Prop.TEXTCOLORColor enabledColorTypeEnum.TST_SINGLETypeEnum.TST_CONTINUOUSColor shadowColorProp.TEXTSHADOWCOLORPoint offsetProp.TEXTSHADOWOFFSEToffset.xoffset.y/* Repaints all the components with the mnemonics in the given window and ... */Window[] ownedWindowsownedWindows.lengthrepaintMnemonicsInWindow(...)repaintMnemonicsInContainer(...)/* Repaints all the components with the mnemonics in container. ... */getDisplayedMnemonic(...)// W2K Feature: Check to see if the Underscore should be rendered./* Draw the Text *//** * paint the text normally *//* We shall not set foreground color for selected menu or ... *//** * paint the text disabled ** */// to work around an apparent bug in Windows, use the pushbutton// color for disabled toolbar buttons if the disabled color is the// same as the enabled color// only draw shadow if developer hasn't changed the foreground color// and if the current style has text shadows.import ButtonUIimport MenuItemCheckIconFactory/** Factory object that can vend Icons appropriate for the Windows L & F. ... */Icon frame_closeIcon;Icon frame_iconifyIcon;Icon frame_maxIcon;Icon frame_minIcon;Icon frame_resizeIcon;Icon checkBoxMenuItemIcon;Icon radioButtonMenuItemIcon;VistaMenuItemCheckIconFactory menuItemCheckIconFactory;new MenuItemCheckIcon(...)new CheckBoxMenuItemIcon(...)new RadioButtonMenuItemIcon(...)new VistaMenuItemCheckIconFactory(...)new FrameButtonIcon(...)new ResizeIcon(...)WindowsIconFactory$FrameButtonIcongetAncestorOfClass(...)JInternalFrame.classboolean jifSelectedState.PUSHEDState.INACTIVEDISABLEDState.INACTIVEPUSHEDState.INACTIVEHOTState.INACTIVENORMALint thickness2getPartSize(...)WindowsIconFactory$ResizeIconWindowsIconFactory$CheckBoxIconJCheckBox cbWindowsIconFactory$RadioButtonIconWindowsIconFactory$CheckBoxMenuItemIconWindowsIconFactory$RadioButtonMenuItemIcon// End class CheckBoxMenuItemIconfillRoundRect(...)WindowsIconFactory$MenuItemCheckIcon// End class RadioButtonMenuItemIconWindowsIconFactory$MenuItemArrowIcon// End class MenuItemCheckIconWindowsIconFactory$MenuArrowIcon// End class MenuItemArrowIconWindowsIconFactory$VistaMenuItemCheckIconFactoryint OFFSET;new VistaMenuItemCheckIcon(...)(...).typeClass<? extends JMenuItem> rvJCheckBoxMenuItem.classJRadioButtonMenuItem.classJMenu.classJMenuItem.classWindowsIconFactory$VistaMenuItemCheckIconFactory$VistaMenuItemCheckIcon/** CheckIcon for JMenuItem, JMenu, JCheckBoxMenuItem and ... */JMenuItem menuItem;Class<? extends JMenuItem> type;this.menuItemIcon lafIcongetLaFIcon(...)Part backgroundPartState backgroundStateState.BITMAPState.BULLETNORMALState.CHECKMARKNORMALState.DISABLEDPUSHEDState.BULLETDISABLEDState.CHECKMARKDISABLEDWindowsMenuItemUIAccessor rvButtonUI uiObject(...).accessorWindowsMenuItemUIAccessor accessorgetAccessor(...)State.DISABLEDHOTIcon rv/** Check if developer changed icon in the UI table. ... */StringBuilder sb// Find out if frame is inactive// Fix for XP bug where sometimes these sizes aren't updated properly// Assume for now that height is correct and derive width using the// ratio from the uxtheme part// outer bevel// Outer top/left// Outer bottom/right// Inner top.left// Inner bottom/right// inside box// paint check// outter left arc// outter right arc// inner left arc// inner right arc// indicate whether selected or not/* For debugging: ... */// this should never happen// use icon from the UI table if it does not match this one.// remove package name, dot and the first character// End class VistaMenuItemCheckIconFactoryimport BasicInternalFrameTitlePaneColor selectedTitleGradientColor;Color notSelectedTitleGradientColor;JPopupMenu systemPopupMenu;JLabel systemLabel;int titlePaneHeight;int buttonWidth, ...;boolean hotTrackingOn;Color activeBorderColorcreateLineBorder(...)createButtons(...)setContentAreaFilled(...)setButtonIcons(...)paintTitleBackground(...)Font newFontint baselinegetLeading(...)Rectangle lastIconBoundsint titleXint titleWint gaplastIconBounds.xgetInsets(...).rightint minTitleXlastIconBounds.widthint availableWidthgetInsets(...).leftString shadowTypePoint shadowOffsetshadowOffset.xshadowOffset.yBoolean gradientsOngetDesktopPropertyValue(...)Paint savePaintgetPaint(...)GradientPaint titleGradientaddSystemMenuItems(...)WindowsInternalFrameTitlePane$1int iconWidthint iconHeightdouble drawScaleWindowsInternalFrameTitlePane$2doDefaultCloseAction(...)mouseClicked(...)showSystemPopupMenu(...)dim.heightnew WindowsPropertyChangeHandler(...)new WindowsTitlePaneLayout(...)WindowsInternalFrameTitlePane$WindowsTitlePaneLayoutBasicInternalFrameTitlePane.TitlePaneLayoutInsets captionMargin;Insets contentMargin;XPStyle xp;WindowsInternalFrameTitlePane.thisProp.CAPTIONMARGINSProp.CONTENTMARGINSint iconSizecaptionMargin.leftcaptionMargin.rightlayoutButton(...)Part.WP_SYSBUTTON// end WindowsTitlePaneLayoutJInternalFrame.FRAME_ICON_PROPERTYWindowsInternalFrameTitlePane$ScalableIconUIResource/** A versatile Icon implementation which can take an array of Icon ... */// We can use an arbitrary size here because we scale to it in paintIcon()...[] icons;/** @params ... */this.iconsnew Icon[]icons.lengthint bestIndexint minDiffint diffdouble scalegetScaleX(...)getTransform(...)getBestIcon(...)// JDK-8039383: initialize these colors because getXP() may return null when theme is changed// Center text vertically.// There are no icons// Note: Don't know how to calculate height on XP,// the captionbarheight is 25 but native caption is 30 (maximized 26)// Create scratch graphics// Set drawing scale to make icon scale to our desired size// Center icon vertically// Center icon horizontally// System button// Note: this icon is square, but the buttons aren't always.// Right hand buttons// XP seems to ignore margins and offset here// Update the internal frame icon for the system menu.// Calculate how big our drawing area is in pixels// Assume we are square// Set drawing scale to make icon act true to our reported sizenew XPBorder(...)new WindowsInternalFrameUI(...)WindowsInternalFrameUI$XPBorderSkin leftSkin;Skin rightSkin;Skin bottomSkin;int topBorderHeightgetSize(...).heightimport JLabelObject WINDOWS_LABEL_UI_KEY;WindowsLabelUI windowsLabelUInew WindowsLabelUI(...)int mnemonicIndexColor backgroundimport ImageFilterimport ImageProducerimport FilteredImageSourceimport RGBImageFilterimport ActionEventimport ImageIconUIResourceimport SwingLazyValueimport VistaMenuItemCheckIconFactory/** Implements the Windows95/98/NT/2000 Look and Feel. ... */Object HI_RES_DISABLED_ICON_CLIENT_KEY;/** A client property that can be used with any JComponent that will end up ... */boolean useSystemFontSettings;boolean useSystemFontSizeSettings;DesktopProperty themeActive, ...;// private members to avoid being GC'd.// These properties are not used directly, but are kept asDesktopProperty aaSettings;LayoutStyle style;int baseUnitX;/** Base dialog units along the horizontal axis. */int baseUnitY;/** Base dialog units along the vertical axis. */OSInfo.OSType.WINDOWSisNativeLookAndFeel(...)String systemFontsgetWindowsVersion(...)OSInfo.WINDOWS_95addKeyEventPostProcessor(...)WindowsRootPaneUI.altProcessor/** Initialize the uiClassID to BasicComponentUI mapping. ... */String windowsPackageName// ie. Take a look at RadioButtonBorder, etc...// XXX - there are probably a lot of redundant values that could be removed.Integer twelveInteger fontPlainInteger fontBoldObject dialogPlain12Object sansSerifPlain12Object monospacedPlain12Object dialogBold12ColorUIResource grayColor.grayColorUIResource darkGrayColorUIResource scrollBarTrackHighlightWindowsTreeUI.ExpandedIconWindowsTreeUI.CollapsedIconObject menuItemAcceleratorDelimiterObject ControlBackgroundColornew DesktopProperty(...)Object ControlLightColorObject ControlHighlightColorObject ControlShadowColorObject ControlDarkShadowColorObject ControlTextColorObject MenuBackgroundColorObject MenuBarBackgroundColorObject MenuTextColorObject SelectionBackgroundColorObject SelectionTextColorObject WindowBackgroundColorObject WindowTextColorObject WindowBorderWidthObject TitlePaneHeightObject TitleButtonWidthObject TitleButtonHeightObject InactiveTextColorObject ScrollbarBackgroundColorObject buttonFocusColornew FocusColorProperty(...)Object TextBackgroundnew XPColorValue(...)Part.EP_EDITProp.FILLCOLORObject ReadOnlyTextBackgroundObject DisabledTextBackgroundObject MenuFontObject FixedControlFontObject ControlFontObject MessageFontObject WindowFontObject ToolTipFontObject IconFontObject scrollBarWidthObject menuBarHeightObject hotTrackingOnObject showMnemonicsnew XPValue(...)new LazyWindowsIcon(...)new XPBorderValue(...)createFrameMaximizeIcon(...)createFrameMinimizeIcon(...)createFrameIconifyIcon(...)createFrameCloseIcon(...)new XPDLUValue(...)new ActiveWindowsIcon(...)Part.LVP_LISTVIEWWindowsLookAndFeel.classBasicLookAndFeel.classXPValue.NULL_VALUEPart.BP_GROUPBOXObject aaTextInfogetDesktopFontValue(...)this.aaSettingsnew FontDesktopProperty(...)SunToolkit.DESKTOPFONTHINTSnew WindowsFontSizeProperty(...)OSInfo.WINDOWS_XPthis.themeActivenew TriggerDesktopProperty(...)this.dllNamethis.colorNamethis.sizeNamegetLazyValueDefaults(...)initVistaComponentDefaults(...)OSInfo.WINDOWS_VISTAString[] menuClassesObject[] menuDefaultsmenuClasses.lengthVistaMenuItemCheckIconFactory menuItemCheckIconFactorygetMenuItemCheckIconFactory(...)InsetsUIResource insetsInteger checkIconOffsetIntegerInteger afterCheckIconGapgetSpanAfterGutter(...)getSpanBeforeGutter(...)getGutterWidth(...)Object minimumTextOffsetWindowsLookAndFeel$1String POPUP_MENU_BORDERObject popupMenuBorderPart.MENUcreateEmptyBorder(...)isOnVista(...)Object oldValuenew SkinIcon(...)State.SORTEDDOWNState.SORTEDUP/** If we support loading of fonts from the desktop this will return ... */new WindowsFontProperty(...)// the updated desktop property values (colors mostly)// reinitialized in the defaults table to ensure the classes reference// When a desktop property change is detected, these classes must beObject buttonBorderObject textFieldBorderObject textFieldMarginObject spinnerBorderObject spinnerArrowInsetsObject comboBoxBorderObject focusCellHighlightBorderObject etchedBorderObject internalFrameBorderObject loweredBevelBorderObject marginBorderObject menuBarBorderObject progressBarBorderObject radioButtonBorderObject scrollPaneBorderPart.LBP_LISTBOXObject tableScrollPaneBorderObject tableHeaderBorderObject toolBarBorderObject toolTipBorderObject radioButtonMenuItemIconObject[] lazyDefaultsuninitialize(...)WindowsPopupMenuUI.mnemonicListenerremoveKeyEventPostProcessor(...)boolean isMnemonicHidden;// Toggle flag for drawing the mnemonic stateboolean isClassicWindows;// should be disabled.// Flag which indicates that the Win98/Win2k/WinME features/** Sets the state of the hide mnemonic flag. This flag is used by the ... *//** Gets the state of the hide mnemonic flag. This only has meaning ... *//** Gets the state of the flag which indicates if the old Windows ... */provideErrorFeedback(...)LayoutStyle stylenew WindowsLayoutStyle(...)/** Returns an <code>Action</code>. ... */// ********* Auditory Cue support methods and objects *********String audioKeyString audioValuenew AudioAction(...)WindowsLookAndFeel$AudioAction/** Pass the name String to the super constructor. This is used ... */Runnable audioRunnable;String audioResource;/** We use the String as the name of the Action and as a pointer to ... */WindowsLookAndFeel$LazyWindowsIcon/** Gets an <code>Icon</code> from the native libraries if available, ... */String nativeImage;String resource;this.nativeImagethis.resourceWindowsLookAndFeel$ActiveWindowsIcon/** Gets an <code>Icon</code> from the native libraries if available. ... */String nativeImageName;String fallbackName;DesktopProperty desktopProperty;this.nativeImageNamethis.fallbackNamethis.desktopPropertynew TriggerDesktopProperty(...) { ... }WindowsLookAndFeel$ActiveWindowsIcon$1new ImageIconUIResource(...)LazyValue fallbackWindowsLookAndFeel$SkinIcon/** Icon backed-up by XP Skin. *//** Draw the icon at the specified location.  Icon implementations ... *//** Returns the icon's width. ... *//** Returns the icon's height. ... */WindowsLookAndFeel$WindowsFontProperty/** DesktopProperty for fonts. If a font with the name 'MS Sans Serif' ... */(...).styleFont msFontgetScreenResolution(...)HeadlessException exgetFamily(...)fontSupportsDefaultEncoding(...)WindowsLookAndFeel$WindowsFontSizeProperty/** DesktopProperty for fonts that only gets sizes from the desktop, ... */String fontName;int fontSize;int fontStyle;this.fontNamethis.fontSizethis.fontStyleWindowsLookAndFeel$XPValue/** A value wrapper that actively retrieves values from xp or falls back ... */Object classicValue, ...;Object NULL_VALUE;// A constant that lets you specify null when using XP styles.this.xpValuethis.classicValuegetXPValue(...)getClassicValue(...)recursiveCreateValue(...)WindowsLookAndFeel$XPBorderValueBorder extraMargin;this.extraMarginWindowsLookAndFeel$XPColorValuenew XPColorValueKey(...)XPColorValueKey keykey.skinkey.propWindowsLookAndFeel$XPColorValue$XPColorValueKeySkin skin;this.skinnew Skin(...)WindowsLookAndFeel$XPDLUValueint direction;int pxdluToPixels(...)WindowsLookAndFeel$TriggerDesktopPropertyWindowsLookAndFeel$FontDesktopPropertyUIDefaults defaultsWindowsLookAndFeel$WindowsLayoutStyle// http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnwue/html/ch14e.asp// Windows LayoutStyle.  From:int indentgetIndent(...)getButtonGap(...)/** Converts the dialog unit argument to pixels along the specified ... */calculateBaseUnits(...)/** Calculates the dialog unit mapping. */FontMetrics metricsImageFilter filternew RGBGrayFilter(...)Image resultImagefloat avgint rgbvalObject highContrastOn// Set the flag which determines which version of Windows should// be rendered. This flag only need to be set once.// if version <= 4.0 then the classic LAF should be loaded.// Using the fonts set by the user can potentially cause// performance and compatibility issues, so allow this feature// to be switched off either at runtime or programmatically/* Background color for menus *//* LightShadow of menubutton highlight *//* Default color for foreground "text" in menu item *//* Text color for menus *//* "controlHighlight", "#E0E0E0", *//* Specular highlight (opposite of the shadow) *//* Scrollbar background (usually the "track") */// *** Shared Fonts// *** Colors// XXX - some of these doens't seem to be used//The following four lines were commented out as part of bug 4991597//This code *is* correct, however it differs from WindowsXP and is, apparently//a Windows XP bug. Until Windows fixes this bug, we shall also exhibit the same//behavior//Object ReadOnlyTextBackground = new XPColorValue(Part.EP_EDITTEXT, State.READONLY, Prop.FILLCOLOR,//                                                 ControlBackgroundColor);//Object DisabledTextBackground = new XPColorValue(Part.EP_EDITTEXT, State.DISABLED, Prop.FILLCOLOR,/* Put the desktop AA settings in the defaults. ... */// These desktop properties are not used directly, but are needed to// trigger realoading of UI's.// *** Auditory Feedback// this key defines which of the various cues to render// Overridden from BasicL&F. This L&F should play all sounds// all the time. The infrastructure decides what to play.// This is disabled until sound bugs can be resolved.// table.get("AuditoryCues.cueList"),// Button.foreground, Button.shadow, Button.darkShadow,// Button.disabledForground, and Button.disabledShadow are only// used for Windows Classic. Windows XP will use colors// from the current visual style.// W2K keyboard navigation hidding.// margin is 2 all the way around, BasicBorders.RadioButtonBorder// (checkbox uses RadioButtonBorder) is 2 all the way around too.// DeskTop.// DesktopIcon// The constructor takes one arg: an array of UIDefaults.LazyValue// representing the icons// Internal Frame Auditory Cue Mappings// Label// List.// PopupMenu// MenuBar.// Menu Item Auditory Cue Mapping// indicates that keyboard navigation won't skip disabled menu items// is 2 all the way around too.// OptionPane.// Option Pane Auditory Cue Mappings// Error// Info Plain// Question// Warning// *** Panel// *** PasswordField// for disabled// for readonly// *** ProgressBar// *** RootPane.// *** ScrollBar.// *** ScrollPane.// *** Separator// *** Slider.// *** SplitPane// *** TabbedPane// *** Table// cell text color// cell background color// grid line color// header text color// header background// use default bg from XP styles// or white bg otherwise// *** TextArea// *** TextField// *** TextPane// *** TitledBorder// *** ToggleButton// *** ToolBar// *** ToolTip// *** ToolTipManager// *** Viewport/* START handling menus for Vista *//* all the menus need to be non opaque. *//* acceleratorSelectionForeground color is the same as ... *//* they have the same MenuItemCheckIconFactory *//* height can be even *//* no margins *//* set checkIcon offset *//* set width of the gap after check icon *//* text is started after this position *//* JPopupMenu has a bit of free space around menu items *//* END handling menus for Vista *//* START table handling for Vista *//* END table handling for Vista */// For focus rectangle for cells and trees.// *** ToolTips// Do not hide mnemonics if the UI defaults do not support this// Runnable appears to block until completed playing, hence// start up another thread to handle playing.// This desktop property is needed to trigger reloading the icon.// It is kept in member variable to avoid GC.// 4950968: Workaround to mimic the way Windows maps the default// font size of 6 pts to the smallest available bitmap font size.// This happens mostly on Win 98/Me & NT.// This call adds a property change listener for the property,// which triggers a call to updateUI(). The value returned// is not interesting here.// Make sure property change listener is readded each time// Windows doesn't spec this// Fall through to related.// Between text labels and their associated controls (for// example, text boxes and list boxes): 3// NOTE: We're not honoring:// 'Text label beside a button 3 down from the top of// the button,' but I suspect that is an attempt to// enforce a baseline layout which will be handled// separately.  In order to enforce this we would need// this API to return a more complicated type (Insets,// or something else).// Between related controls: 4// Between unrelated controls: 7// This calculation comes from:// http://support.microsoft.com/default.aspx?scid=kb;EN-US;125681// The -1 comes from experimentation.// if the component has a HI_RES_DISABLED_ICON_CLIENT_KEY// client property set to Boolean.TRUE, then use the new// hi res algorithm for creating the disabled icon (used// in particular by the WindowsFileChooserUI class)// find the average of red, green, and blue// pull out the alpha channel// calc the average// turn back into rgb// Fallback value is never used because of the configureValue method doesn't return nullimport ActionMapUIResourceimport HierarchyEventimport HierarchyListenerimport WindowAdapterimport WindowEventimport WindowListenerimport WindowStateListenerimport TMSchema.*import XPStyle.*WindowListener windowListener;/* to be accessed on the EDT only */HierarchyListener hierarchyListener;Window window;new WindowsMenuBarUI(...)uninstallWindowListener(...)removeHierarchyListener(...)getTopLevelAncestor(...)new WindowAdapter(...) { ... }WindowsMenuBarUI$1addWindowListener(...)removeWindowListener(...)installWindowListener(...)new HierarchyListener(...) { ... }WindowsMenuBarUI$2getChangeFlags(...)HierarchyEvent.DISPLAYABILITY_CHANGEDisDisplayable(...)addHierarchyListener(...)new TakeFocus(...)WindowsMenuBarUI$TakeFocus/** Action that activates the menu (e.g. when F10 is pressed). ... */getMenu(...)MenuSelectionManager msmsetMnemonicHidden(...)repaintRootPane(...)/** Checks if component belongs to an active window. ... */JRootPane rootPane// show mnemonicsWindowsMenuItemUI$1new WindowsMenuItemUI(...)int menuWidthint menuHeight/* TODO idk can we use XPStyle.isVista? ... *//* part of it copied from WindowsGraphicsUtils.java */import JMenuItem/** Accessor interface for WindowsMenuItemUI to allow for "multiple implementation ... */import MouseInputListenerWindowsMenuUI$1State stateTmpMenuElement menuElementgetSubElements(...)Integer menuBarHeight;new WindowsMenuUI(...)isClassicWindows(...)setRolloverEnabled(...)/** Draws the background of the menu. ... */Color highlightboolean otherMenuSelectedMenuElement[] menusmenus.lengthboolean paintRollovernew WindowsMouseInputHandler(...)/** This class implements a mouse handler that sets the rollover flag to ... */BasicMenuUI.MouseInputHandlermouseEntered(...)isRolloverEnabled(...)mouseExited(...)getPreferredMenuItemSize(...)/* Copyright (c) 1997, 2007, Oracle and/or its affiliates. All rights reserved. ... *//* Only paint rollover if no other menu on menubar is ... *///non top level menus have HOT state instead of PUSHED/* on Vista top level menu for non active frame looks disabled */// Use superclass method for the old Windows LAF,// for submenus, and for XP toplevel if selected or pressed// Draw a lowered bevel border// Only paint rollover if no other menu on menubar is selected// Draw a raised bevel border// Note: When toolbar containers (rebars) are implemented, only do// this if the JMenuBar is not in a rebar (i.e. ignore the desktop// property win.menu.height if in a rebar.)/* Copyright (c) 1997, 2000, Oracle and/or its affiliates. All rights reserved. ... *//** Creates a UI for a JPasswordField ... */new WindowsPasswordFieldUI(...)import BasicPopupMenuSeparatorUI/** Windows L&F implementation of PopupMenuSeparatorUI. ... */new WindowsPopupMenuSeparatorUI(...)Component parentPart.MP_POPUPSEPARATORint skinHeights.heightObject gutterOffsetObjectWindowsPopupMenuUI.GUTTER_OFFSET_KEY/* Copyright (c) 2004, 2014, Oracle and/or its affiliates. All rights reserved. ... *//* gutter offset is in parent's coordinates. ... */import KeyEventPostProcessorimport KeyboardFocusManagerimport static SwingUtilities2.BASICMENUITEMUI_MAX_TEXT_OFFSETMnemonicListener mnemonicListener;Object GUTTER_OFFSET_KEY;new WindowsPopupMenuUI(...)new MnemonicListener(...)/** Returns the <code>Popup</code> that will be responsible for ... */PopupFactory popupFactorygetSharedInstance(...)getPopup(...)getInvoker(...)WindowsPopupMenuUI$MnemonicListenerJRootPane repaintRoot;getSelectedPath(...)Window wingetWindowAncestor(...)/** Returns offset for the text. ... */int rvObject maxTextOffsetint menuItemOffset/** Returns span before gutter. ... *//** Returns span after gutter. ... *//** Returns gutter width. ... */Part.MP_POPUPGUTTER/** Checks if PopupMenu is leftToRight ... */Part.MP_POPUPBACKGROUNDint textOffsetgetTextOffset(...)int gutterWidthint gutterOffset// menu was canceled -- hide mnemonics/* this is in JMenuItem coordinates. ... *//* paint gutter only for leftToRight case */import JWindow/** A class which tags a window with a particular semantic usage, ... */int UNDEFINED_WINDOW_TYPE;int TOOLTIP_WINDOW_TYPE;int MENU_WINDOW_TYPE;int SUBMENU_WINDOW_TYPE;int POPUPMENU_WINDOW_TYPE;int COMBOBOX_POPUP_WINDOW_TYPE;int windowType;setFocusableWindowState(...)hide(...)removeNotify(...)pack(...)/** We need to call removeNotify() here because hide() does ... */Rectangle previousFullBox;Insets indeterminateInsets;new WindowsProgressBarUI(...)/** Returns the baseline. ... */getBaseline(...)isStringPainted(...)getInsets(...).topisIndeterminate(...)Part.PP_BARgetPreferredInnerHorizontal(...)Part.PP_BARVERTgetPreferredInnerVertical(...)boolean isLeftToRightint barRectWidthint barRectHeightint amountFullgetAmountFull(...)paintXPBackground(...)BasicStroke.CAP_BUTTBasicStroke.JOIN_BEVELpaintString(...)Part.PP_CHUNKVERTPart.PP_CHUNKint chunkSizePart.PP_PROGRESSProp.PROGRESSCHUNKSIZEint spaceSizeProp.PROGRESSSPACESIZEint nChunkspaintDeterminate(...)setAnimationIndex(...)Rectangle chunkgetFullChunkBounds(...)getBoxLength(...)getBox(...)Insets insint currentFramegetAnimationIndex(...)int framecountgetFrameCount(...)ins.rightins.leftdouble deltains.topins.bottompaintIndeterminateFrame(...)paintIndeterminate(...)int chunksizebox.widthbox.ybox.heightbox.xGraphics2D gfxPart chunkint deltaxint deltayRectangle fullBoxRectangle progbarExtentsRectangle repaintAreaXPStyle.Skin// amount of progress to draw// Paint progress// Do not paint the standard stripes from the skin, because they obscure// the text// See if we can squeeze in an extra chunk without spacing after// get the full repaint area and add it the// previous one so we can erase it// an apparently hard coded value in Windows// this code adjusts the chunk size to properly account for the// size and gap specified in the XP style. It also does it's own// box placement for the chunk animation. This is required because// the inherited algorithm from BasicProgressBarUI goes back and// forth whereas XP only goes in one direction. XP also has ghosted// trailing chunks to create the illusion of speed. This code// adjusts the pixel length of the animation to account for the// trails.// add 2x for the trails// Paint the bouncing box.// create a new graphics to keep drawing surface state// calculate the chunk offsets// Calculate the area of the chunks combined// save this box for the next time// this is the entire progress bar minus the track and borders// only paint where the chunks overlap with the progress bar drawing area// adjust the cliprect to chop the chunks when they go off the end// get the skin// do the drawing// get rid of our clip and composite changes// Paint backgroundWindowsRadioButtonMenuItemUI$1new WindowsRadioButtonMenuItemUI(...)Object WINDOWS_RADIO_BUTTON_UI_KEY;WindowsRadioButtonUI windowsRadioButtonUInew WindowsRadioButtonUI(...)//           DefaultstextRect.widthtextRect.heightimport Eventimport Toolkitimport AbstractActionimport ActionMapimport InputMapimport KeyStrokeimport JRootPaneimport SwingUtilitiesimport AbstractButtonimport JFrameimport JMenuimport JMenuBarimport MenuElementimport InputMapUIResourceimport BasicRootPaneUIimport ComboPopup/** Windows implementation of RootPaneUI, there is one shared between all ... */new WindowsRootPaneUI(...)new AltProcessor(...)WindowsRootPaneUI windowsRootPaneUI;AltProcessor altProcessor;WindowsRootPaneUI$AltProcessorboolean altKeyPressed;boolean menuCanceledOnPress;JRootPane root;Window winAncestor;consume(...)JMenuBar mbargetJMenuBar(...)getSelectedPath(...).lengthboolean skipToolkit tkComponent originalSourcegetOriginalSource(...)getKeyEventAccessor(...)getContainingWindow(...)getWindowDeactivationTime(...)isConsumed(...)KeyEvent.VK_ALTKeyEvent.KEY_PRESSEDaltPressed(...)KeyEvent.KEY_RELEASEDaltReleased(...)// We are in ComboBox// if no menu is active, we try activating the menubar// It might happen that the altRelease event is processed// with a reasonable delay since it has been generated.// Here we check the last deactivation time of the containing// window. If this time appears to be greater than the altRelease// event time the event is skipped to avoid unexpected menu// activation. See 7121442.// Also we must ensure that original source of key event belongs// to the same window object as winAncestor. See 8001633.// mnemonic combination, it's consumed, but we need// set altKeyPressed to false, otherwise after selection// component by mnemonic combination a menu will be openGrid thumbGrid;Grid highlightGrid;Dimension horizontalThumbSize;Dimension verticalThumbSize;/** Creates a UI for a JScrollBar. ... */new WindowsScrollBarUI(...)getMinimumThumbSize(...)configureScrollBarColors(...)getGrid(...)new WindowsArrowButton(...)isVista(...)new ArrowButtonListener(...) { ... }WindowsScrollBarUI$1createArrowButtonListener(...)boolean vPart.SBP_LOWERTRACKVERTPart.SBP_LOWERTRACKHORZpaintTrack(...)paintDecreaseHighlight(...)paintIncreaseHighlight(...)Part thumbPartPart gripperPartInsets gripperInsetsisThumbRollover(...)State.HOVERgripperInsets.bottomgripperInsets.topgripperInsets.rightgripperInsets.leftpaintThumb(...)Rectangle thumbRgetThumbBounds(...)thumbR.ythumbR.xthumbR.heightthumbR.widthboolean oldsetThumbRollover(...)/** WindowsArrowButton is used for the buttons to position the ... */boolean jointRolloverState.UPPRESSEDState.DOWNPRESSEDState.LEFTPRESSEDState.RIGHTPRESSEDState.UPDISABLEDState.DOWNDISABLEDState.LEFTDISABLEDState.RIGHTDISABLEDState.UPHOTState.DOWNHOTState.LEFTHOTState.RIGHTHOTState.UPHOVERState.DOWNHOVERState.LEFTHOVERState.RIGHTHOVERState.UPNORMALState.DOWNNORMALState.LEFTNORMALState.RIGHTNORMALWindowsScrollBarUI$Grid/** This should be pulled out into its own class if more classes need to ... */new HashMap<String,WeakReference<Grid>>(...)HashMap<String,WeakReference<Grid>> map;WeakReference<Grid> refGrid gridnew Grid(...)new WeakReference<Grid>(...)int[] cmappaintGrid(...)/** Paints the grid into the specified Graphics at the specified ... */Rectangle clipRectclipRect.xclipRect.yclipRect.widthclipRect.heightint xCounterint yCounter/** Actually renders the grid into the Graphics <code>g</code>. */// we need to repaint the entire scrollbar because state change for each// button causes a state change for the thumb and other button on Vista// Pending: Implement rollover (hot) and pressed// Paint thumb// Paint gripper// we need to repaint the entire scrollbar because state change for thumb// causes state change for incr and decr buttons on Vista// normal, rollover, pressed, disabled/** Windows Separator. ... */boolean rollover;boolean pressed;new WindowsSliderUI(...)/** Overrides to return a private track listener subclass which handles ... */new WindowsTrackListener(...)WindowsSliderUI$WindowsTrackListenerupdateRollover(...)updatePressed(...)mouseReleased(...)trackRect.widthtrackRect.ytrackRect.heighttrackRect.xPart.TKP_TICSProp.COLORpaintMinorTickForHorizSlider(...)paintMajorTickForHorizSlider(...)Part.TKP_TICSVERTpaintMinorTickForVertSlider(...)paintMajorTickForVertSlider(...)getXPThumbPart(...)State.FOCUSEDthumbRect.xthumbRect.ySkin sgetThumbSize(...)Boolean paintThumbArrowShapegetPaintTicks(...)Part.TKP_THUMBLEFT// You can't press a disabled slider// You can't have a rollover on a disabled slidernew WindowsSpinnerUI(...)getXPState(...)JButton xpButtonnew GlyphButton(...)getDimension(...)installPreviousButtonListeners(...)createPreviousButton(...)installNextButtonListeners(...)createNextButton(...)listeners.length/** Divider used for Windows split pane. ... *//** Creates a new Windows SplitPaneDivider *//** Creates a new WindowsSplitPaneUI instance */new WindowsSplitPaneUI(...)new WindowsSplitPaneDivider(...)Set<KeyStroke> managingFocusForwardTraversalKeys;/** Keys to use for forward focus traversal when the JComponent is ... */Set<KeyStroke> managingFocusBackwardTraversalKeys;/** Keys to use for backward focus traversal when the JComponent is ... */boolean contentOpaque;new HashSet<KeyStroke>(...)KeyboardFocusManager.BACKWARD_TRAVERSAL_KEYSnew WindowsTabbedPaneUI(...)int oldRolloverTabgetRolloverTab(...)Rectangle r1Rectangle r2setRolloverTab(...)getTabCount(...)Part.TABP_PANEInsets tabAreaInsetsint tabWidthcalculateTabAreaWidth(...)tabAreaInsets.bottomint tabHeightcalculateTabAreaHeight(...)paintRotatedSkin(...)paintContentBorder(...)paintTabBackground(...)int tabCountint tabRungetRunForTab(...)lastTabInRun(...)State.SELECTEDpaintTabBorder(...)// focus forward traversal key// focus backward traversal key// sets the focus forward and backward traversal keys to null// to restore the defaults// Rollover is only supported on XP// Note: don't call getTabAreaInsets(), because it causes rotation.// Make sure "TabbedPane.tabsOverlapBorder" is set to true in WindowsLookAndFeel// Expand area by tabAreaInsets.bottom to allow tabs to overlap onto the border.// Align with right edgeimport static XPStyle.*import sun.swing.table.*TableCellRenderer originalHeaderRenderer;new WindowsTableHeaderUI(...)setDefaultRenderer(...)new XPDefaultRenderer(...)getHeaderRect(...)WindowsTableHeaderUI$XPDefaultRendererboolean isSelected, ...;int column;Insets marginsgetContentMargin(...)int contentTopint contentLeftint contentBottomint contentRightIcon sortIconthis.isSelectedthis.hasFocusthis.columnthis.hasRollovergetRolloverColumn(...)margins.topmargins.leftmargins.bottommargins.rightSortOrder sortOrdergetColumnSortOrder(...)new IconBorder(...)int sortIconHeightTableColumn draggedColumngetDraggedColumn(...)convertColumnIndexToView(...)getColumnModel(...)getModelIndex(...)State.SORTEDNORMALState.SORTEDPRESSEDState.SORTEDHOTWindowsTableHeaderUI$IconBorder/** A border with an Icon at the middle of the top side. ... */int left;int bottom;int right;/** Creates this border; ... */this.topthis.leftthis.bottomthis.right/* idk: ... *//* On Vista sortIcon is painted above the header's text. ... *//* on Vista there are more states for sorted columns *//* do nothing */new WindowsTextAreaUI(...)/** Provides the Windows look and feel for a text field.  This ... */new WindowsTextFieldUI(...)/** Paints a background for the view.  This will only be ... *//** Creates the caret for a field. ... */new WindowsFieldCaret(...)/** WindowsFieldCaret has different scrolling behavior than ... *//** Adjusts the visibility of the caret according to ... */new SafeScroller(...)/** Gets the painter for the Highlighter. ... */Highlighter.HighlightPainterWindowsTextUI.WindowsPainterWindowsTextFieldUI$WindowsFieldCaret$SafeScrollerthis.rJTextField fieldTextUI uiPosition.BiasBias biasPosition.Bias.ForwardRectangle startRectBoundedRangeModel visgetHorizontalVisibility(...)int quarterSpangetExtent(...)BadLocationException bleRectangle endRectdamage(...)Rectangle r;// PENDING: We need to expose the bias in DefaultCaret.// If we scroll, our visual location will have changed,// but we won't have updated our internal location as// the model hasn't changed. This checks for the change,// and if necessary, resets the internal location./** Creates a UI for a JTextPane. ... */new WindowsTextPaneUI(...)import Shapeimport TextUI/** Windows text rendering. ... */new WindowsHighlightPainter(...)LayeredHighlighter.LayerPainter WindowsPainter;LayeredHighlighter.LayerPainter/* public */WindowsTextUI$WindowsCaretWindowsTextUI$WindowsHighlightPainterDefaultHighlighter.DefaultHighlightPainter/** Paints a highlight. ... */// --- HighlightPainter methods ---------------------------------------Rectangle allocRectangle p0Rectangle p1boolean firstIsDotboolean secondIsDotgetSelectionColor(...)getCaretPosition(...)p0.yp1.yint p0ToMarginWidthp0.xalloc.xalloc.widthp0.heightp1.xp1.height/** Paints a portion of a highlight. ... */// --- LayerPainter methods ----------------------------getStartOffset(...)getEndOffset(...)alloc.yalloc.heightShape shapePosition.Bias.Backward// --- determine locations ---// --- render ---// same line, render a rectangle// different lines// can't render// Contained in view, can just use bounds.// Should only render part of View.// Only if exception/** A Windows toggle button. ... */Object WINDOWS_TOGGLE_BUTTON_UI_KEY;WindowsToggleButtonUI windowsToggleButtonUInew WindowsToggleButtonUI(...)Color cachedSelectedColor;Color cachedBackgroundColor;Color cachedHighlightColor;Color c1Color c2int r1int r2int g1int g2/** Draws Windows toolbar separators. ... */new WindowsToolBarSeparatorUI(...)SwingConstants.VERTICALPart.TP_SEPARATORPart.TP_SEPARATORVERTDimension prefpref.widthpref.heightColor tempimport JToggleButtonimport UIDefaultsimport Borderimport CompoundBorderimport EmptyBorderimport BasicToolBarUInew WindowsToolBarUI(...)setRolloverBorders(...)createRolloverBorder(...)createNonRolloverBorder(...)getRolloverBorder(...)/** A Windows tree. ... */new WindowsTreeUI(...)/** Ensures that the rows identified by beginRow through endRow are ... */getRowCount(...)Rectangle visRectgetVisibleRect(...)Rectangle scrollBoundsgetPathBounds(...)getPathForRow(...)scrollBounds.xvisRect.xscrollBounds.widthvisRect.widthscrollRectToVisible(...)Rectangle beginRectRectangle testRectint beginYbeginRect.yvisRect.heighttestRect.ytestRect.heightnew WindowsTreeCellRenderer(...)WindowsTreeUI$ExpandedIcon/** The minus sign button icon ... */new ExpandedIcon(...)State.OPENED/** The plus sign button icon ... */new CollapsedIcon(...)State.CLOSED/** Configures the renderer based on the passed in components. ... */getTreeCellRendererComponent(...)setDisabledIcon(...)getLeafIcon(...)getOpenIcon(...)getClosedIcon(...)// Windows displays the open icon when the tree item selected.import CachedPainter/** Implements Windows XP Styles for the Windows Look and Feel. ... */new SkinPainter(...)// Singleton instance of this classSkinPainter skinPainter;// Singleton instance of SkinPainterBoolean themeActive;HashMap<String,Border> borderMap;HashMap<String,Color> colorMap;boolean flatMenus;/** Static method for clearing the hashmap and loading the ... *//** Get the singleton instance of this class ... */GetPropertyAction propertyActionisThemed(...)new XPStyle(...)isXPStyleEnabled(...)/** Get a named <code>String</code> value from the current style ... */getTypeEnumName(...)int enumValuegetEnum(...)getControlName(...)/** Get a named <code>int</code> value from the current style ... *//** Get a named <code>Dimension</code> value from the current style ... *//** Get a named <code>Point</code> (e.g. a location or an offset) value ... *//** Get a named <code>Insets</code> value from the current style ... */getThemeMargins(...)/** Get a named <code>Color</code> value from the current style ... */skin.state/** Get a named <code>Border</code> value from the current style ... */skin.stringnew XPFillBorder(...)String bgTypeProp.BORDERSIZEProp.BORDERCOLORnew XPStatefulFillBorder(...)Insets mProp.SIZINGMARGINSProp.BORDERONLYnew XPImageBorder(...)new XPEmptyBorder(...)XPStyle$XPFillBorderXPStyle$XPStatefulFillBorderJComboBox<> cbWindowsComboBoxUI wcbXPStyle$XPImageBorderInsets borderInsetsborderInsets.topborderInsets.leftborderInsets.bottomborderInsets.rightXPStyle$XPEmptyBorderm.topm.leftm.bottomm.rightisThemePartDefi        